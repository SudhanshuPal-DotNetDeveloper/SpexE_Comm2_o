!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).firebase=t()}(this,function(){"use strict";function n(e){e=i(e);return s.encodeByteArray(e,!0)}function i(n){const r=[];let i=0;for(let t=0;t<n.length;t++){let e=n.charCodeAt(t);e<128?r[i++]=e:(e<2048?r[i++]=e>>6|192:(55296==(64512&e)&&t+1<n.length&&56320==(64512&n.charCodeAt(t+1))?(e=65536+((1023&e)<<10)+(1023&n.charCodeAt(++t)),r[i++]=e>>18|240,r[i++]=e>>12&63|128):r[i++]=e>>12|224,r[i++]=e>>6&63|128),r[i++]=63&e|128)}return r}const t={NODE_CLIENT:!1,NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"},y=function(e,t){if(!e)throw K(t)},K=function(e){return new Error("Firebase Database ("+t.SDK_VERSION+") INTERNAL ASSERT FAILED: "+e)},s={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(r,e){if(!Array.isArray(r))throw Error("encodeByteArray takes an array as a parameter");this.init_();var i=e?this.byteToCharMapWebSafe_:this.byteToCharMap_;const s=[];for(let n=0;n<r.length;n+=3){var a=r[n],o=n+1<r.length,l=o?r[n+1]:0,c=n+2<r.length,u=c?r[n+2]:0;let e=(15&l)<<2|u>>6,t=63&u;c||(t=64,o||(e=64)),s.push(i[a>>2],i[(3&a)<<4|l>>4],i[e],i[t])}return s.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(i(e),t)},decodeString(n,r){if(this.HAS_NATIVE_SUPPORT&&!r)return atob(n);{var i=this.decodeStringToByteArray(n,r);const l=[];let e=0,t=0;for(;e<i.length;){var s,a,o=i[e++];o<128?l[t++]=String.fromCharCode(o):191<o&&o<224?(s=i[e++],l[t++]=String.fromCharCode((31&o)<<6|63&s)):239<o&&o<365?(a=((7&o)<<18|(63&i[e++])<<12|(63&i[e++])<<6|63&i[e++])-65536,l[t++]=String.fromCharCode(55296+(a>>10)),l[t++]=String.fromCharCode(56320+(1023&a))):(s=i[e++],a=i[e++],l[t++]=String.fromCharCode((15&o)<<12|(63&s)<<6|63&a))}return l.join("")}},decodeStringToByteArray(t,e){this.init_();var n=e?this.charToByteMapWebSafe_:this.charToByteMap_;const r=[];for(let e=0;e<t.length;){var i=n[t.charAt(e++)],s=e<t.length?n[t.charAt(e)]:0,a=++e<t.length?n[t.charAt(e)]:64,o=++e<t.length?n[t.charAt(e)]:64;if(++e,null==i||null==s||null==a||null==o)throw Error();r.push(i<<2|s>>4),64!==a&&(r.push(s<<4&240|a>>2),64!==o&&r.push(a<<6&192|o))}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),(this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e)>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}},a=function(e){return n(e).replace(/\./g,"")},c=function(e){try{return s.decodeString(e,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function u(e,t){if(!(t instanceof Object))return t;switch(t.constructor){case Date:const n=t;return new Date(n.getTime());case Object:void 0===e&&(e={});break;case Array:e=[];break;default:return t}for(const r in t)t.hasOwnProperty(r)&&"__proto__"!==r&&(e[r]=u(e[r],t[r]));return e}function d(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function W(){return"undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(d())}function z(){try{return"[object process]"===Object.prototype.toString.call(global.process)}catch(e){return}}function G(){var e="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof e&&void 0!==e.id}function H(){return"object"==typeof navigator&&"ReactNative"===navigator.product}function $(){const e=d();return 0<=e.indexOf("MSIE ")||0<=e.indexOf("Trident/")}function Q(){return!0===t.NODE_ADMIN}function Y(){return"object"==typeof indexedDB}function J(){return new Promise((t,n)=>{try{let e=!0;const r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),e||self.indexedDB.deleteDatabase(r),t(!0)},i.onupgradeneeded=()=>{e=!1},i.onerror=()=>{var e;n((null==(e=i.error)?void 0:e.message)||"")}}catch(e){n(e)}})}function X(){return!("undefined"==typeof navigator||!navigator.cookieEnabled)}function Z(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof global)return global;throw new Error("Unable to locate global object.")}const ee=()=>{try{return Z().__FIREBASE_DEFAULTS__||(()=>{var e;if("undefined"!=typeof process&&void 0!==process.env)return(e=process.env.__FIREBASE_DEFAULTS__)?JSON.parse(e):void 0})()||(()=>{if("undefined"!=typeof document){let e;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(e){return}var t=e&&c(e[1]);return t&&JSON.parse(t)}})()}catch(e){return void console.info("Unable to get __FIREBASE_DEFAULTS__ due to: "+e)}},te=()=>{var e;return null==(e=ee())?void 0:e.config};var h,ne;class re{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(n){return(e,t)=>{e?this.reject(e):this.resolve(t),"function"==typeof n&&(this.promise.catch(()=>{}),1===n.length?n(e):n(e,t))}}}function ie(e,t){if(e.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');var t=t||"demo-project",n=e.iat||0,r=e.sub||e.user_id;if(r)return r=Object.assign({iss:"https://securetoken.google.com/"+t,aud:t,iat:n,exp:n+3600,auth_time:n,sub:r,user_id:r,firebase:{sign_in_provider:"custom",identities:{}}},e),[a(JSON.stringify({alg:"none",type:"JWT"})),a(JSON.stringify(r)),""].join(".");throw new Error("mockUserToken must contain 'sub' or 'user_id' field!")}class se extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,se.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,ae.prototype.create)}}class ae{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e,...t){var r,t=t[0]||{},n=this.service+"/"+e,e=(e=this.errors[e])?(r=t,e.replace(oe,(e,t)=>{var n=r[t];return null!=n?String(n):`<${t}?>`})):"Error",e=this.serviceName+`: ${e} (${n}).`;return new se(n,e,t)}}const oe=/\{\$([^}]+)}/g;function le(e){return JSON.parse(e)}function ce(e){return JSON.stringify(e)}function ue(e){let t={},n={},r={},i="";try{var s=e.split(".");t=le(c(s[0])||""),n=le(c(s[1])||""),i=s[2],r=n.d||{},delete n.d}catch(e){}return{header:t,claims:n,data:r,signature:i}}function he(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function de(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]}function pe(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}function fe(e,t,n){const r={};for(const i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=t.call(n,e[i],i,e));return r}function ge(e,t){if(e===t)return 1;const n=Object.keys(e),r=Object.keys(t);for(const a of n){if(!r.includes(a))return;var i=e[a],s=t[a];if(me(i)&&me(s)){if(!ge(i,s))return}else if(i!==s)return}for(const o of r)if(!n.includes(o))return;return 1}function me(e){return null!==e&&"object"==typeof e}function ve(e){const t=[];for(const[n,r]of Object.entries(e))Array.isArray(r)?r.forEach(e=>{t.push(encodeURIComponent(n)+"="+encodeURIComponent(e))}):t.push(encodeURIComponent(n)+"="+encodeURIComponent(r));return t.length?"&"+t.join("&"):""}function ye(e){const n={},t=e.replace(/^\?/,"").split("&");return t.forEach(e=>{var t;e&&([e,t]=e.split("="),n[decodeURIComponent(e)]=decodeURIComponent(t))}),n}function _e(e){var t=e.indexOf("?");if(!t)return"";var n=e.indexOf("#",t);return e.substring(t,0<n?n:void 0)}class we{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=64,this.pad_[0]=128;for(let e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(t,n){n=n||0;const r=this.W_;if("string"==typeof t)for(let e=0;e<16;e++)r[e]=t.charCodeAt(n)<<24|t.charCodeAt(n+1)<<16|t.charCodeAt(n+2)<<8|t.charCodeAt(n+3),n+=4;else for(let e=0;e<16;e++)r[e]=t[n]<<24|t[n+1]<<16|t[n+2]<<8|t[n+3],n+=4;for(let e=16;e<80;e++){var i=r[e-3]^r[e-8]^r[e-14]^r[e-16];r[e]=4294967295&(i<<1|i>>>31)}let s=this.chain_[0],a=this.chain_[1],o=this.chain_[2],l=this.chain_[3],c=this.chain_[4],u,h;for(let e=0;e<80;e++){h=e<40?e<20?(u=l^a&(o^l),1518500249):(u=a^o^l,1859775393):e<60?(u=a&o|l&(a|o),2400959708):(u=a^o^l,3395469782);var d=(s<<5|s>>>27)+u+c+h+r[e]&4294967295;c=l,l=o,o=4294967295&(a<<30|a>>>2),a=s,s=d}this.chain_[0]=this.chain_[0]+s&4294967295,this.chain_[1]=this.chain_[1]+a&4294967295,this.chain_[2]=this.chain_[2]+o&4294967295,this.chain_[3]=this.chain_[3]+l&4294967295,this.chain_[4]=this.chain_[4]+c&4294967295}update(n,r){if(null!=n){var i=(r=void 0===r?n.length:r)-this.blockSize;let e=0;const s=this.buf_;let t=this.inbuf_;for(;e<r;){if(0===t)for(;e<=i;)this.compress_(n,e),e+=this.blockSize;if("string"==typeof n){for(;e<r;)if(s[t]=n.charCodeAt(e),++t,++e,t===this.blockSize){this.compress_(s),t=0;break}}else for(;e<r;)if(s[t]=n[e],++t,++e,t===this.blockSize){this.compress_(s),t=0;break}}this.inbuf_=t,this.total_+=r}}digest(){const n=[];let t=8*this.total_;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let e=this.blockSize-1;56<=e;e--)this.buf_[e]=255&t,t/=256;this.compress_(this.buf_);let r=0;for(let t=0;t<5;t++)for(let e=24;0<=e;e-=8)n[r]=this.chain_[t]>>e&255,++r;return n}}function be(e,t){const n=new Ie(e,t);return n.subscribe.bind(n)}class Ie{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(e=>{this.error(e)})}next(t){this.forEachObserver(e=>{e.next(t)})}error(t){this.forEachObserver(e=>{e.error(t)}),this.close(t)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,n){let r;if(void 0===e&&void 0===t&&void 0===n)throw new Error("Missing Observer.");void 0===(r=function(e){if("object"==typeof e&&null!==e)for(const t of["next","error","complete"])if(t in e&&"function"==typeof e[t])return 1}(e)?e:{next:e,error:t,complete:n}).next&&(r.next=Te),void 0===r.error&&(r.error=Te),void 0===r.complete&&(r.complete=Te);e=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?r.error(this.finalError):r.complete()}catch(e){}}),this.observers.push(r),e}unsubscribeOne(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],--this.observerCount,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(t){if(!this.finalized)for(let e=0;e<this.observers.length;e++)this.sendOne(e,t)}sendOne(e,t){this.task.then(()=>{if(void 0!==this.observers&&void 0!==this.observers[e])try{t(this.observers[e])}catch(e){"undefined"!=typeof console&&console.error&&console.error(e)}})}close(e){this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function Te(){}function l(e,t,n,r){let i;if(r<t?i="at least "+t:n<r&&(i=0===n?"none":"no more than "+n),i)throw t=e+" failed: Was called with "+r+(1===r?" argument.":" arguments.")+" Expects "+i+".",new Error(t)}function Ee(e,t){return e+` failed: ${t} argument `}function ke(e,t,n,r){if((!r||n)&&"function"!=typeof n)throw new Error(Ee(e,t)+"must be a valid function.")}function Se(e,t,n,r){if((!r||n)&&("object"!=typeof n||null===n))throw new Error(Ee(e,t)+"must be a valid context object.")}const Ce=function(t){let n=0;for(let e=0;e<t.length;e++){var r=t.charCodeAt(e);r<128?n++:r<2048?n+=2:55296<=r&&r<=56319?(n+=4,e++):n+=3}return n},Ae=1e3,Ne=2,Re=144e5,xe=.5;function De(e,t=Ae,n=Ne){t*=Math.pow(n,e),n=Math.round(xe*t*(Math.random()-.5)*2);return Math.min(Re,t+n)}function _(e){return e&&e._delegate?e._delegate:e}class o{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const Pe="[DEFAULT]";class Oe{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){var t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const r=new re;if(this.instancesDeferred.set(t,r),this.isInitialized(t)||this.shouldAutoInitialize())try{var n=this.getOrInitializeService({instanceIdentifier:t});n&&r.resolve(n)}catch(e){}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t=this.normalizeInstanceIdentifier(null==e?void 0:e.identifier),n=null!=(n=null==e?void 0:e.optional)&&n;if(!this.isInitialized(t)&&!this.shouldAutoInitialize()){if(n)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:t})}catch(e){if(n)return null;throw e}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,this.shouldAutoInitialize()){if("EAGER"===e.instantiationMode)try{this.getOrInitializeService({instanceIdentifier:Pe})}catch(e){}for(var[t,n]of this.instancesDeferred.entries()){t=this.normalizeInstanceIdentifier(t);try{var r=this.getOrInitializeService({instanceIdentifier:t});n.resolve(r)}catch(e){}}}}clearInstance(e=Pe){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(e=>"INTERNAL"in e).map(e=>e.INTERNAL.delete()),...e.filter(e=>"_delete"in e).map(e=>e._delete())])}isComponentSet(){return null!=this.component}isInitialized(e=Pe){return this.instances.has(e)}getOptions(e=Pe){return this.instancesOptions.get(e)||{}}initialize(e={}){var{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error(this.name+`(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);var r,i,s=this.getOrInitializeService({instanceIdentifier:n,options:t});for([r,i]of this.instancesDeferred.entries())n===this.normalizeInstanceIdentifier(r)&&i.resolve(s);return s}onInit(e,t){t=this.normalizeInstanceIdentifier(t);const n=null!=(r=this.onInitCallbacks.get(t))?r:new Set;n.add(e),this.onInitCallbacks.set(t,n);var r=this.instances.get(t);return r&&e(r,t),()=>{n.delete(e)}}invokeOnInitCallbacks(e,t){var n=this.onInitCallbacks.get(t);if(n)for(const r of n)try{r(e,t)}catch(e){}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let n=this.instances.get(e);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:(r=e)===Pe?void 0:r,options:t}),this.instances.set(e,n),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(n,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,n)}catch(e){}var r;return n||null}normalizeInstanceIdentifier(e=Pe){return!this.component||this.component.multipleInstances?e:Pe}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class Me{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with `+this.name);t.setComponent(e)}addOrOverwriteComponent(e){const t=this.getProvider(e.name);t.isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);var t=new Oe(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}const Le=[],Fe=((Ft=h=h||{})[Ft.DEBUG=0]="DEBUG",Ft[Ft.VERBOSE=1]="VERBOSE",Ft[Ft.INFO=2]="INFO",Ft[Ft.WARN=3]="WARN",Ft[Ft.ERROR=4]="ERROR",Ft[Ft.SILENT=5]="SILENT",{debug:h.DEBUG,verbose:h.VERBOSE,info:h.INFO,warn:h.WARN,error:h.ERROR,silent:h.SILENT}),Ue=h.INFO,qe={[h.DEBUG]:"log",[h.VERBOSE]:"log",[h.INFO]:"info",[h.WARN]:"warn",[h.ERROR]:"error"},Ve=(e,t,...n)=>{if(!(t<e.logLevel)){var r=(new Date).toISOString(),i=qe[t];if(!i)throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`);console[i](`[${r}]  ${e.name}:`,...n)}};class Be{constructor(e){this.name=e,this._logLevel=Ue,this._logHandler=Ve,this._userLogHandler=null,Le.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in h))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?Fe[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,h.DEBUG,...e),this._logHandler(this,h.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,h.VERBOSE,...e),this._logHandler(this,h.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,h.INFO,...e),this._logHandler(this,h.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,h.WARN,...e),this._logHandler(this,h.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,h.ERROR,...e),this._logHandler(this,h.ERROR,...e)}}const je=(t,e)=>e.some(e=>t instanceof e);let Ke,We;const ze=new WeakMap,Ge=new WeakMap,He=new WeakMap,$e=new WeakMap,Qe=new WeakMap;let Ye={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return Ge.get(e);if("objectStoreNames"===t)return e.objectStoreNames||He.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return Xe(e[t])},set(e,t,n){return e[t]=n,!0},has(e,t){return e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e}};function Je(e){return"function"==typeof e?(n=e)!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(We=We||[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey]).includes(n)?function(...e){return n.apply(Ze(this),e),Xe(ze.get(this))}:function(...e){return Xe(n.apply(Ze(this),e))}:function(e,...t){t=n.call(Ze(this),e,...t);return He.set(t,e.sort?e.sort():[e]),Xe(t)}:(e instanceof IDBTransaction&&(s=e,Ge.has(s)||(t=new Promise((e,t)=>{const n=()=>{s.removeEventListener("complete",r),s.removeEventListener("error",i),s.removeEventListener("abort",i)},r=()=>{e(),n()},i=()=>{t(s.error||new DOMException("AbortError","AbortError")),n()};s.addEventListener("complete",r),s.addEventListener("error",i),s.addEventListener("abort",i)}),Ge.set(s,t))),je(e,Ke=Ke||[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])?new Proxy(e,Ye):e);var n,s,t}function Xe(e){if(e instanceof IDBRequest){var s=e;const n=new Promise((e,t)=>{const n=()=>{s.removeEventListener("success",r),s.removeEventListener("error",i)},r=()=>{e(Xe(s.result)),n()},i=()=>{t(s.error),n()};s.addEventListener("success",r),s.addEventListener("error",i)});return n.then(e=>{e instanceof IDBCursor&&ze.set(e,s)}).catch(()=>{}),Qe.set(n,s),n}if($e.has(e))return $e.get(e);var t=Je(e);return t!==e&&($e.set(e,t),Qe.set(t,e)),t}const Ze=e=>Qe.get(e);function et(e,t,{blocked:n,upgrade:r,blocking:i,terminated:s}={}){const a=indexedDB.open(e,t),o=Xe(a);return r&&a.addEventListener("upgradeneeded",e=>{r(Xe(a.result),e.oldVersion,e.newVersion,Xe(a.transaction))}),n&&a.addEventListener("blocked",()=>n()),o.then(e=>{s&&e.addEventListener("close",()=>s()),i&&e.addEventListener("versionchange",()=>i())}).catch(()=>{}),o}function tt(e,{blocked:t}={}){const n=indexedDB.deleteDatabase(e);return t&&n.addEventListener("blocked",()=>t()),Xe(n).then(()=>{})}const nt=["get","getKey","getAll","getAllKeys","count"],rt=["put","add","delete","clear"],it=new Map;function st(e,t){if(e instanceof IDBDatabase&&!(t in e)&&"string"==typeof t){if(it.get(t))return it.get(t);const r=t.replace(/FromIndex$/,""),i=t!==r,s=rt.includes(r);return r in(i?IDBIndex:IDBObjectStore).prototype&&(s||nt.includes(r))?(e=async function(e,...t){e=this.transaction(e,s?"readwrite":"readonly");let n=e.store;return i&&(n=n.index(t.shift())),(await Promise.all([n[r](...t),s&&e.done]))[0]},it.set(t,e),e):void 0}}Ye={...ne=Ye,get:(e,t,n)=>st(e,t)||ne.get(e,t,n),has:(e,t)=>!!st(e,t)||ne.has(e,t)};class at{constructor(e){this.container=e}getPlatformInfoString(){const e=this.container.getProviders();return e.map(e=>{if("VERSION"!==(null==(t=e.getComponent())?void 0:t.type))return null;var t=e.getImmediate();return t.library+"/"+t.version}).filter(e=>e).join(" ")}}const ot="@firebase/app",lt=new Be("@firebase/app"),ct="[DEFAULT]",ut={"@firebase/app":"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","fire-js":"fire-js",firebase:"fire-js-all"},ht=new Map,dt=new Map;function pt(t,n){try{t.container.addComponent(n)}catch(e){lt.debug(`Component ${n.name} failed to register with FirebaseApp `+t.name,e)}}function ft(e,t){e.container.addOrOverwriteComponent(t)}function gt(e){var t=e.name;if(dt.has(t))return lt.debug(`There were multiple attempts to register component ${t}.`),!1;dt.set(t,e);for(const n of ht.values())pt(n,e);return!0}function mt(e,t){const n=e.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),e.container.getProvider(t)}const vt=new ae("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()","bad-app-name":"Illegal App name: '{$appName}","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}."});class yt{constructor(e,t,n){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new o("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw vt.create("app-deleted",{appName:this._name})}}const _t="9.14.0";function wt(e,t={}){if("object"!=typeof t){const n=t;t={name:n}}t=Object.assign({name:ct,automaticDataCollectionEnabled:!1},t);const n=t.name;if("string"!=typeof n||!n)throw vt.create("bad-app-name",{appName:String(n)});if(!(e=e||te()))throw vt.create("no-options");var r=ht.get(n);if(r){if(ge(e,r.options)&&ge(t,r.config))return r;throw vt.create("duplicate-app",{appName:n})}const i=new Me(n);for(const s of dt.values())i.addComponent(s);return t=new yt(e,t,i),ht.set(n,t),t}function bt(e=ct){var t=ht.get(e);if(!t&&e===ct)return wt();if(t)return t;throw vt.create("no-app",{appName:e})}async function It(e){var t=e.name;ht.has(t)&&(ht.delete(t),await Promise.all(e.container.getProviders().map(e=>e.delete())),e.isDeleted=!0)}function r(e,t,n){let r=null!=(i=ut[e])?i:e;n&&(r+="-"+n);var e=r.match(/\s|\//),i=t.match(/\s|\//);if(e||i){const s=[`Unable to register library "${r}" with version "${t}":`];return e&&s.push(`library name "${r}" contains illegal characters (whitespace or "/")`),e&&i&&s.push("and"),i&&s.push(`version name "${t}" contains illegal characters (whitespace or "/")`),void lt.warn(s.join(" "))}gt(new o(r+"-version",()=>({library:r,version:t}),"VERSION"))}function Tt(e,t){if(null!==e&&"function"!=typeof e)throw vt.create("invalid-log-argument");var s=e,n=t;for(const r of Le){let i=null;n&&n.level&&(i=Fe[n.level]),r.userLogHandler=null===s?null:(e,t,...n)=>{var r=n.map(e=>{if(null==e)return null;if("string"==typeof e)return e;if("number"==typeof e||"boolean"==typeof e)return e.toString();if(e instanceof Error)return e.message;try{return JSON.stringify(e)}catch(e){return null}}).filter(e=>e).join(" ");t>=(null!==i&&void 0!==i?i:e.logLevel)&&s({level:h[t].toLowerCase(),message:r,args:n,type:e.name})}}}function Et(e){var t=e;Le.forEach(e=>{e.setLogLevel(t)})}const kt="firebase-heartbeat-store";let St=null;function Ct(){return St=St||et("firebase-heartbeat-database",1,{upgrade:(e,t)=>{0===t&&e.createObjectStore(kt)}}).catch(e=>{throw vt.create("idb-open",{originalErrorMessage:e.message})})}async function At(e,t){try{const n=await Ct(),r=n.transaction(kt,"readwrite"),i=r.objectStore(kt);return await i.put(t,Nt(e)),r.done}catch(e){e instanceof se?lt.warn(e.message):(t=vt.create("idb-set",{originalErrorMessage:null==e?void 0:e.message}),lt.warn(t.message))}}function Nt(e){return e.name+"!"+e.options.appId}class Rt{constructor(e){this.container=e,this._heartbeatsCache=null;e=this.container.getProvider("app").getImmediate();this._storage=new Dt(e),this._heartbeatsCachePromise=this._storage.read().then(e=>this._heartbeatsCache=e)}async triggerHeartbeat(){const e=this.container.getProvider("platform-logger").getImmediate();var t=e.getPlatformInfoString();const n=xt();if(null===this._heartbeatsCache&&(this._heartbeatsCache=await this._heartbeatsCachePromise),this._heartbeatsCache.lastSentHeartbeatDate!==n&&!this._heartbeatsCache.heartbeats.some(e=>e.date===n))return this._heartbeatsCache.heartbeats.push({date:n,agent:t}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(e=>{e=new Date(e.date).valueOf();return Date.now()-e<=2592e6}),this._storage.overwrite(this._heartbeatsCache)}async getHeartbeatsHeader(){if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null===this._heartbeatsCache||0===this._heartbeatsCache.heartbeats.length)return"";var e=xt(),{heartbeatsToSend:t,unsentEntries:n}=function(e){const t=[];let n=e.slice();for(const r of e){const i=t.find(e=>e.agent===r.agent);if(i){if(i.dates.push(r.date),1024<Pt(t)){i.dates.pop();break}}else if(t.push({agent:r.agent,dates:[r.date]}),1024<Pt(t)){t.pop();break}n=n.slice(1)}return{heartbeatsToSend:t,unsentEntries:n}}(this._heartbeatsCache.heartbeats),t=a(JSON.stringify({version:2,heartbeats:t}));return this._heartbeatsCache.lastSentHeartbeatDate=e,0<n.length?(this._heartbeatsCache.heartbeats=n,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),t}}function xt(){const e=new Date;return e.toISOString().substring(0,10)}class Dt{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!Y()&&J().then(()=>!0).catch(()=>!1)}async read(){return await this._canUseIndexedDBPromise&&await async function(e){var t;try{const n=await Ct();return n.transaction(kt).objectStore(kt).get(Nt(e))}catch(e){e instanceof se?lt.warn(e.message):(t=vt.create("idb-get",{originalErrorMessage:null==e?void 0:e.message}),lt.warn(t.message))}}(this.app)||{heartbeats:[]}}async overwrite(e){var t,n;if(await this._canUseIndexedDBPromise)return n=await this.read(),At(this.app,{lastSentHeartbeatDate:null!=(t=e.lastSentHeartbeatDate)?t:n.lastSentHeartbeatDate,heartbeats:e.heartbeats})}async add(e){var t,n;if(await this._canUseIndexedDBPromise)return n=await this.read(),At(this.app,{lastSentHeartbeatDate:null!=(t=e.lastSentHeartbeatDate)?t:n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...e.heartbeats]})}}function Pt(e){return a(JSON.stringify({version:2,heartbeats:e})).length}gt(new o("platform-logger",e=>new at(e),"PRIVATE")),gt(new o("heartbeat",e=>new Rt(e),"PRIVATE")),r(ot,"0.8.4",""),r(ot,"0.8.4","esm2017"),r("fire-js","");var Ot=Object.freeze({__proto__:null,SDK_VERSION:_t,_DEFAULT_ENTRY_NAME:ct,_addComponent:pt,_addOrOverwriteComponent:ft,_apps:ht,_clearComponents:function(){dt.clear()},_components:dt,_getProvider:mt,_registerComponent:gt,_removeServiceInstance:function(e,t,n=ct){mt(e,t).clearInstance(n)},deleteApp:It,getApp:bt,getApps:function(){return Array.from(ht.values())},initializeApp:wt,onLog:Tt,registerVersion:r,setLogLevel:Et,FirebaseError:se});class Mt{constructor(e,t){this._delegate=e,this.firebase=t,pt(e,new o("app-compat",()=>this,"PUBLIC")),this.container=e.container}get automaticDataCollectionEnabled(){return this._delegate.automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this._delegate.automaticDataCollectionEnabled=e}get name(){return this._delegate.name}get options(){return this._delegate.options}delete(){return new Promise(e=>{this._delegate.checkDestroyed(),e()}).then(()=>(this.firebase.INTERNAL.removeApp(this.name),It(this._delegate)))}_getService(e,t=ct){this._delegate.checkDestroyed();const n=this._delegate.container.getProvider(e);return n.isInitialized()||"EXPLICIT"!==(null==(e=n.getComponent())?void 0:e.instantiationMode)||n.initialize(),n.getImmediate({identifier:t})}_removeServiceInstance(e,t=ct){this._delegate.container.getProvider(e).clearInstance(t)}_addComponent(e){pt(this._delegate,e)}_addOrOverwriteComponent(e){ft(this._delegate,e)}toJSON(){return{name:this.name,automaticDataCollectionEnabled:this.automaticDataCollectionEnabled,options:this.options}}}const Lt=new ae("app-compat","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance."});var Ft=function e(){const t=function(i){const n={},s={__esModule:!0,initializeApp:function(e,t={}){e=wt(e,t);if(he(n,e.name))return n[e.name];t=new i(e,s);return n[e.name]=t},app:a,registerVersion:r,setLogLevel:Et,onLog:Tt,apps:null,SDK_VERSION:_t,INTERNAL:{registerComponent:function(n){const r=n.name,t=r.replace("-compat","");var e;return gt(n)&&"PUBLIC"===n.type&&(e=(e=a())=>{if("function"!=typeof e[t])throw Lt.create("invalid-app-argument",{appName:r});return e[t]()},void 0!==n.serviceProps&&u(e,n.serviceProps),s[t]=e,i.prototype[t]=function(...e){const t=this._getService.bind(this,r);return t.apply(this,n.multipleInstances?e:[])}),"PUBLIC"===n.type?s[t]:null},removeApp:function(e){delete n[e]},useAsService:function(e,t){return"serverAuth"===t?null:t},modularAPIs:Ot}};function a(e){if(e=e||ct,he(n,e))return n[e];throw Lt.create("no-app",{appName:e})}return s.default=s,Object.defineProperty(s,"apps",{get:function(){return Object.keys(n).map(e=>n[e])}}),a.App=i,s}(Mt);return t.INTERNAL=Object.assign(Object.assign({},t.INTERNAL),{createFirebaseNamespace:e,extendNamespace:function(e){u(t,e)},createSubscribe:be,ErrorFactory:ae,deepExtend:u}),t}();const Ut=new Be("@firebase/app-compat");if("object"==typeof self&&self.self===self&&void 0!==self.firebase){Ut.warn(`
    Warning: Firebase is already defined in the global scope. Please make sure
    Firebase library is only loaded once.
  `);const ER=self.firebase.SDK_VERSION;ER&&0<=ER.indexOf("LITE")&&Ut.warn(`
    Warning: You are trying to load Firebase while using Firebase Performance standalone script.
    You should load Firebase Performance with this instance of Firebase to avoid loading duplicate code.
    `)}const qt=Ft;r("@firebase/app-compat","0.1.39",void 0),qt.registerVersion("firebase","9.14.0","app-compat");var e="@firebase/installations",Vt="0.5.16";const Bt=1e4,jt="w:"+Vt,Kt="FIS_v2",Wt="https://firebaseinstallations.googleapis.com/v1",zt=36e5,Gt=new ae("installations","Installations",{"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."});function Ht(e){return e instanceof se&&e.code.includes("request-failed")}function $t({projectId:e}){return Wt+`/projects/${e}/installations`}function Qt(e){return{token:e.token,requestStatus:2,expiresIn:(e=e.expiresIn,Number(e.replace("s","000"))),creationTime:Date.now()}}async function Yt(e,t){t=(await t.json()).error;return Gt.create("request-failed",{requestName:e,serverCode:t.code,serverMessage:t.message,serverStatus:t.status})}function Jt({apiKey:e}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":e})}async function Xt(e){var t=await e();return 500<=t.status&&t.status<600?e():t}function Zt(t){return new Promise(e=>{setTimeout(e,t)})}const en=/^[cdef][\w-]{21}$/,tn="";function nn(e){return e.appName+"!"+e.appId}const rn=new Map;function sn(e,t){e=nn(e);an(e,t);{!on&&"BroadcastChannel"in self&&((on=new BroadcastChannel("[Firebase] FID Change")).onmessage=e=>{an(e.data.key,e.data.fid)});const n=on;return n&&n.postMessage({key:e,fid:t}),void(0===rn.size&&on&&(on.close(),on=null))}}function an(e,t){e=rn.get(e);if(e)for(const n of e)n(t)}let on=null;const ln="firebase-installations-store";let cn=null;function un(){return cn=cn||et("firebase-installations-database",1,{upgrade:(e,t)=>{0===t&&e.createObjectStore(ln)}})}async function hn(e,t){var n=nn(e);const r=await un(),i=r.transaction(ln,"readwrite"),s=i.objectStore(ln);var a=await s.get(n);return await s.put(t,n),await i.done,a&&a.fid===t.fid||sn(e,t.fid),t}async function dn(e){e=nn(e);const t=await un(),n=t.transaction(ln,"readwrite");await n.objectStore(ln).delete(e),await n.done}async function pn(e,t){var n=nn(e);const r=await un(),i=r.transaction(ln,"readwrite"),s=i.objectStore(ln);var a=await s.get(n),t=t(a);return void 0===t?await s.delete(n):await s.put(t,n),await i.done,!t||a&&a.fid===t.fid||sn(e,t.fid),t}async function fn(t){let n;var e=await pn(t.appConfig,e=>{e=mn(e||{fid:function(){try{const t=new Uint8Array(17),n=self.crypto||self.msCrypto;n.getRandomValues(t),t[0]=112+t[0]%16;var e=function(t){const e=function(){const e=btoa(String.fromCharCode(...t));return e.replace(/\+/g,"-").replace(/\//g,"_")}();return e.substr(0,22)}(t);return en.test(e)?e:tn}catch(e){return tn}}(),registrationStatus:0}),e=function(e,t){if(0!==t.registrationStatus)return 1===t.registrationStatus?{installationEntry:t,registrationPromise:async function(e){let t=await gn(e.appConfig);for(;1===t.registrationStatus;)await Zt(100),t=await gn(e.appConfig);if(0!==t.registrationStatus)return t;var{installationEntry:n,registrationPromise:r}=await fn(e);return r||n}(e)}:{installationEntry:t};if(!navigator.onLine)return{installationEntry:t,registrationPromise:Promise.reject(Gt.create("app-offline"))};t={fid:t.fid,registrationStatus:1,registrationTime:Date.now()};return{installationEntry:t,registrationPromise:async function(e,t){try{var n=await async function({appConfig:e,heartbeatServiceProvider:t},{fid:n}){const r=$t(e),i=Jt(e),s=t.getImmediate({optional:!0});s&&(a=await s.getHeartbeatsHeader())&&i.append("x-firebase-client",a);var a={fid:n,authVersion:Kt,appId:e.appId,sdkVersion:jt};const o={method:"POST",headers:i,body:JSON.stringify(a)},l=await Xt(()=>fetch(r,o));if(l.ok)return{fid:(a=await l.json()).fid||n,registrationStatus:2,refreshToken:a.refreshToken,authToken:Qt(a.authToken)};throw await Yt("Create Installation",l)}(e,t);return hn(e.appConfig,n)}catch(n){throw Ht(n)&&409===n.customData.serverCode?await dn(e.appConfig):await hn(e.appConfig,{fid:t.fid,registrationStatus:0}),n}}(e,t)}}(t,e);return n=e.registrationPromise,e.installationEntry});return e.fid===tn?{installationEntry:await n}:{installationEntry:e,registrationPromise:n}}function gn(e){return pn(e,e=>{if(e)return mn(e);throw Gt.create("installation-not-found")})}function mn(e){return 1===e.registrationStatus&&e.registrationTime+Bt<Date.now()?{fid:e.fid,registrationStatus:0}:e}async function vn({appConfig:e,heartbeatServiceProvider:t},n){[i,s]=[e,n.fid];const r=$t(i)+`/${s}/authTokens:generate`;var i,s;const a=function(e,{refreshToken:t}){const n=Jt(e);return n.append("Authorization",Kt+" "+t),n}(e,n),o=t.getImmediate({optional:!0});o&&(l=await o.getHeartbeatsHeader())&&a.append("x-firebase-client",l);var l={installation:{sdkVersion:jt,appId:e.appId}};const c={method:"POST",headers:a,body:JSON.stringify(l)},u=await Xt(()=>fetch(r,c));if(u.ok)return Qt(await u.json());throw await Yt("Generate Auth Token",u)}async function yn(s,a=!1){let o;var e=await pn(s.appConfig,e=>{if(!wn(e))throw Gt.create("not-registered");var t,n,r,i=e.authToken;if(a||2!==(t=i).requestStatus||(n=t,(r=Date.now())<n.creationTime||n.creationTime+n.expiresIn<r+zt)){if(1===i.requestStatus)return o=async function(e,t){let n=await _n(e.appConfig);for(;1===n.authToken.requestStatus;)await Zt(100),n=await _n(e.appConfig);var r=n.authToken;return 0===r.requestStatus?yn(e,t):r}(s,a),e;if(navigator.onLine)return t=e,i={requestStatus:1,requestTime:Date.now()},i=Object.assign(Object.assign({},t),{authToken:i}),o=async function(e,t){try{var n=await vn(e,t),r=Object.assign(Object.assign({},t),{authToken:n});return await hn(e.appConfig,r),n}catch(r){throw!Ht(r)||401!==r.customData.serverCode&&404!==r.customData.serverCode?(n=Object.assign(Object.assign({},t),{authToken:{requestStatus:0}}),await hn(e.appConfig,n)):await dn(e.appConfig),r}}(s,i),i;throw Gt.create("app-offline")}return e});return o?await o:e.authToken}function _n(e){return pn(e,e=>{if(!wn(e))throw Gt.create("not-registered");var t=e.authToken;return 1===t.requestStatus&&t.requestTime+Bt<Date.now()?Object.assign(Object.assign({},e),{authToken:{requestStatus:0}}):e})}function wn(e){return void 0!==e&&2===e.registrationStatus}function bn(e){return Gt.create("missing-app-config-values",{valueName:e})}const In="installations",Tn=(gt(new o(In,e=>{e=e.getProvider("app").getImmediate();return{app:e,appConfig:function(e){if(!e||!e.options)throw bn("App Configuration");if(!e.name)throw bn("App Name");for(const t of["projectId","apiKey","appId"])if(!e.options[t])throw bn(t);return{appName:e.name,projectId:e.options.projectId,apiKey:e.options.apiKey,appId:e.options.appId}}(e),heartbeatServiceProvider:mt(e,"heartbeat"),_delete:()=>Promise.resolve()}},"PUBLIC")),gt(new o("installations-internal",e=>{const t=mt(e.getProvider("app").getImmediate(),In).getImmediate();return{getId:()=>async function(e){const{installationEntry:t,registrationPromise:n}=await fn(e);return(n||yn(e)).catch(console.error),t.fid}(t),getToken:e=>async function(e,t=!1){var n;return await((n=(await fn(e)).registrationPromise)&&await n),(await yn(e,t)).token}(t,e)}},"PRIVATE")),r(e,Vt),r(e,Vt,"esm2017"),"analytics"),En="firebase_id",kn="origin",Sn="https://www.googletagmanager.com/gtag/js",Cn=new Be("@firebase/analytics");function An(e){return Promise.all(e.map(e=>e.catch(e=>e)))}function Nn(w,b,I,T){return async function(e,t,n){try{if("event"===e){{var r=w;var i=b;var s=I;var a=t;var o=n;try{let t=[];if(o&&o.send_to){let e=o.send_to;Array.isArray(e)||(e=[e]);const v=await An(s);for(const y of e){var l=v.find(e=>e.measurementId===y),c=l&&i[l.appId];if(!c){t=[];break}t.push(c)}}0===t.length&&(t=Object.values(i)),await Promise.all(t),r("event",a,o||{})}catch(r){Cn.error(r)}}await 0}else if("config"===e){{var u=w;var h=b;var d=I;var p=t;var f=n;var g=T[p];try{if(g)await h[g];else{const _=await An(d);var m=_.find(e=>e.measurementId===p);m&&await h[m.appId]}}catch(u){Cn.error(u)}u("config",p,f)}await 0}else"consent"===e?w("consent","update",n):w("set",t)}catch(e){Cn.error(e)}}}const Rn=new ae("analytics","Analytics",{"already-exists":"A Firebase Analytics instance with the appId {$id}  already exists. Only one Firebase Analytics instance can be created for each appId.","already-initialized":"initializeAnalytics() cannot be called again with different options than those it was initially called with. It can be called again with the same options to return the existing instance, or getAnalytics() can be used to get a reference to the already-intialized instance.","already-initialized-settings":"Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.","interop-component-reg-failed":"Firebase Analytics Interop Component failed to instantiate: {$reason}","invalid-analytics-context":"Firebase Analytics is not supported in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","indexeddb-unavailable":"IndexedDB unavailable or restricted in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","fetch-throttle":"The config fetch request timed out while in an exponential backoff state. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.","config-fetch-failed":"Dynamic config fetch failed: [{$httpStatus}] {$responseMessage}","no-api-key":'The "apiKey" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid API key.',"no-app-id":'The "appId" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid app ID.'}),xn=30,Dn=new class{constructor(e={},t=1e3){this.throttleMetadata=e,this.intervalMillis=t}getThrottleMetadata(e){return this.throttleMetadata[e]}setThrottleMetadata(e,t){this.throttleMetadata[e]=t}deleteThrottleMetadata(e){delete this.throttleMetadata[e]}};async function Pn(e,t=Dn,n){var{appId:e,apiKey:r,measurementId:i}=e.options;if(!e)throw Rn.create("no-app-id");if(!r){if(i)return{measurementId:i,appId:e};throw Rn.create("no-api-key")}var s=t.getThrottleMetadata(e)||{backoffCount:0,throttleEndTimeMillis:Date.now()};const a=new On;return setTimeout(async()=>{a.abort()},void 0!==n?n:6e4),async function e(t,{throttleEndTimeMillis:n,backoffCount:r},i,s=Dn){var a,o,l,{appId:c,measurementId:u}=t;try{o=i,l=n,await new Promise((e,t)=>{var n=Math.max(l-Date.now(),0);const r=setTimeout(e,n);o.addEventListener(()=>{clearTimeout(r),t(Rn.create("fetch-throttle",{throttleEndTimeMillis:l}))})})}catch(n){if(u)return Cn.warn("Timed out fetching this Firebase app's measurement ID from the server. Falling back to the measurement ID "+u+` provided in the "measurementId" field in the local Firebase config. [${null==(a=n)?void 0:a.message}]`),{appId:c,measurementId:u};throw n}try{var h=await async function(t){var n,{appId:e,apiKey:r}=t,r={method:"GET",headers:new Headers({Accept:"application/json","x-goog-api-key":r})},e="https://firebase.googleapis.com/v1alpha/projects/-/apps/{app-id}/webConfig".replace("{app-id}",e);const i=await fetch(e,r);if(200===i.status||304===i.status)return i.json();{let e="";try{var s=await i.json();null!=(n=s.error)&&n.message&&(e=s.error.message)}catch(t){}throw Rn.create("config-fetch-failed",{httpStatus:i.status,responseMessage:e})}}(t);return s.deleteThrottleMetadata(c),h}catch(n){h=n;if(!function(e){if(!(e instanceof se&&e.customData))return;e=Number(e.customData.httpStatus);return 429===e||500===e||503===e||504===e}(h)){if(s.deleteThrottleMetadata(c),u)return Cn.warn("Failed to fetch this Firebase app's measurement ID from the server. Falling back to the measurement ID "+u+` provided in the "measurementId" field in the local Firebase config. [${null==h?void 0:h.message}]`),{appId:c,measurementId:u};throw n}u=503===Number(null==(a=null==h?void 0:h.customData)?void 0:a.httpStatus)?De(r,s.intervalMillis,xn):De(r,s.intervalMillis),h={throttleEndTimeMillis:Date.now()+u,backoffCount:r+1};return s.setThrottleMetadata(c,h),Cn.debug(`Calling attemptFetch again in ${u} millis`),e(t,h,i,s)}}({appId:e,apiKey:r,measurementId:i},s,a,t)}class On{constructor(){this.listeners=[]}addEventListener(e){this.listeners.push(e)}abort(){this.listeners.forEach(e=>e())}}class Mn{constructor(e){this.app=e}_delete(){return delete Ln[this.app.options.appId],Promise.resolve()}}let Ln={},Fn=[];const Un={};let qn="dataLayer",Vn="gtag",Bn,jn,Kn=!1;function Wn(e,t,n){{const a=[];G()&&a.push("This is a browser extension environment."),X()||a.push("Cookies are not available."),0<a.length&&(i=a.map((e,t)=>`(${t+1}) `+e).join(" "),i=Rn.create("invalid-analytics-context",{errorInfo:i}),Cn.warn(i.message))}var r,i=e.options.appId;if(!i)throw Rn.create("no-app-id");if(!e.options.apiKey){if(!e.options.measurementId)throw Rn.create("no-api-key");Cn.warn('The "apiKey" field is empty in the local Firebase config. This is needed to fetch the latest measurement ID for this Firebase app. Falling back to the measurement ID '+e.options.measurementId+' provided in the "measurementId" field in the local Firebase config.')}if(null!=Ln[i])throw Rn.create("already-exists",{id:i});if(!Kn){{var s=qn;let e=[];Array.isArray(window[s])?e=window[s]:window[s]=e,e}({wrappedGtag:s,gtagCore:r}=function(e,t,n,r,i){let s=function(){window[r].push(arguments)};return window[i]&&"function"==typeof window[i]&&(s=window[i]),window[i]=Nn(s,e,t,n),{gtagCore:s,wrappedGtag:window[i]}}(Ln,Fn,Un,qn,Vn)),jn=s,Bn=r,Kn=!0}return Ln[i]=async function(t,e,n,r,i,s,a){const o=Pn(t);o.then(e=>{n[e.measurementId]=e.appId,t.options.measurementId&&e.measurementId!==t.options.measurementId&&Cn.warn(`The measurement ID in the local Firebase config (${t.options.measurementId})`+` does not match the measurement ID fetched from the server (${e.measurementId}).`+" To ensure analytics events are always sent to the correct Analytics property, update the measurement ID field in the local config or remove it from the local config.")}).catch(e=>Cn.error(e)),e.push(o);var e=async function(){if(!Y())return Cn.warn(Rn.create("indexeddb-unavailable",{errorInfo:"IndexedDB is not available in this environment."}).message),!1;try{await J()}catch(e){return Cn.warn(Rn.create("indexeddb-unavailable",{errorInfo:null==e?void 0:e.toString()}).message),!1}return!0}().then(e=>{if(e)return r.getId()}),[l,c]=await Promise.all([o,e]);if(!function(e){var t=window.document.getElementsByTagName("script");for(const n of Object.values(t))if(n.src&&n.src.includes(Sn)&&n.src.includes(e))return n}(s)){var u=l.measurementId;const d=document.createElement("script");d.src=Sn+`?l=${s}&id=`+u,d.async=!0,document.head.appendChild(d)}i("js",new Date);const h=null!=(e=null==a?void 0:a.config)?e:{};return h[kn]="firebase",h.update=!0,null!=c&&(h[En]=c),i("config",l.measurementId,h),l.measurementId}(e,Fn,Un,t,Bn,qn,n),new Mn(e)}function zn(e,t,n,i){e=_(e),async function(e,t,n,r){i&&i.global?e("event",n,r):(t=await t,e("event",n,Object.assign(Object.assign({},r),{send_to:t})))}(jn,Ln[e.app.options.appId],t,n).catch(e=>Cn.error(e))}var Gn="@firebase/analytics";gt(new o(Tn,(e,{options:t})=>Wn(e.getProvider("app").getImmediate(),e.getProvider("installations-internal").getImmediate(),t),"PUBLIC")),gt(new o("analytics-internal",function(e){try{const r=e.getProvider(Tn).getImmediate();return{logEvent:(e,t,n)=>zn(r,e,t,n)}}catch(e){throw Rn.create("interop-component-reg-failed",{reason:e})}},"PRIVATE")),r(Gn,"0.8.4"),r(Gn,"0.8.4","esm2017");class Hn{constructor(e,t){this.app=e,this._delegate=t}logEvent(e,t,n){zn(this._delegate,e,t,n)}setCurrentScreen(e,t){var n,r;n=this._delegate,e=e,r=t,n=_(n),async function(e,t,n){return r&&r.global?(e("set",{screen_name:n}),Promise.resolve()):void e("config",await t,{update:!0,screen_name:n})}(jn,Ln[n.app.options.appId],e).catch(e=>Cn.error(e))}setUserId(e,t){var n,r;n=this._delegate,e=e,r=t,n=_(n),async function(e,t,n){return r&&r.global?(e("set",{user_id:n}),Promise.resolve()):void e("config",await t,{update:!0,user_id:n})}(jn,Ln[n.app.options.appId],e).catch(e=>Cn.error(e))}setUserProperties(e,t){var n,s;n=this._delegate,e=e,s=t,n=_(n),async function(e,t,n){if(s&&s.global){const r={};for(const i of Object.keys(n))r["user_properties."+i]=n[i];return e("set",r),Promise.resolve()}e("config",await t,{update:!0,user_properties:n})}(jn,Ln[n.app.options.appId],e).catch(e=>Cn.error(e))}setAnalyticsCollectionEnabled(e){var t;t=this._delegate,e=e,t=_(t),async function(e,t){e=await e;window["ga-disable-"+e]=!t}(Ln[t.app.options.appId],e).catch(e=>Cn.error(e))}}rN=Gn={ADD_SHIPPING_INFO:"add_shipping_info",ADD_PAYMENT_INFO:"add_payment_info",ADD_TO_CART:"add_to_cart",ADD_TO_WISHLIST:"add_to_wishlist",BEGIN_CHECKOUT:"begin_checkout",CHECKOUT_PROGRESS:"checkout_progress",EXCEPTION:"exception",GENERATE_LEAD:"generate_lead",LOGIN:"login",PAGE_VIEW:"page_view",PURCHASE:"purchase",REFUND:"refund",REMOVE_FROM_CART:"remove_from_cart",SCREEN_VIEW:"screen_view",SEARCH:"search",SELECT_CONTENT:"select_content",SELECT_ITEM:"select_item",SELECT_PROMOTION:"select_promotion",SET_CHECKOUT_OPTION:"set_checkout_option",SHARE:"share",SIGN_UP:"sign_up",TIMING_COMPLETE:"timing_complete",VIEW_CART:"view_cart",VIEW_ITEM:"view_item",VIEW_ITEM_LIST:"view_item_list",VIEW_PROMOTION:"view_promotion",VIEW_SEARCH_RESULTS:"view_search_results"},Gn={Analytics:Hn,settings:function(e){if(Kn)throw Rn.create("already-initialized");e.dataLayerName&&(qn=e.dataLayerName),e.gtagName&&(Vn=e.gtagName)},isSupported:async function(){if(G())return!1;if(!X())return!1;if(!Y())return!1;try{return await J()}catch(e){return!1}},EventName:Gn};qt.INTERNAL.registerComponent(new o("analytics-compat",e=>{var t=e.getProvider("app-compat").getImmediate(),e=e.getProvider("analytics").getImmediate();return new Hn(t,e)},"PUBLIC").setServiceProps(Gn).setMultipleInstances(!0)),qt.registerVersion("@firebase/analytics-compat","0.1.17");const $n=new Map,Qn={activated:!1,tokenObservers:[]},Yn={initialized:!1,enabled:!1};function Jn(e){return $n.get(e)||Object.assign({},Qn)}const Xn="https://content-firebaseappcheck.googleapis.com/v1",Zn="exchangeDebugToken",er={OFFSET_DURATION:3e5,RETRIAL_MIN_WAIT:3e4,RETRIAL_MAX_WAIT:96e4};class tr{constructor(e,t,n,r,i){if(this.operation=e,this.retryPolicy=t,this.getWaitDuration=n,this.lowerBound=r,this.upperBound=i,this.pending=null,i<(this.nextErrorWaitInterval=r))throw new Error("Proactive refresh lower bound greater than upper bound!")}start(){this.nextErrorWaitInterval=this.lowerBound,this.process(!0).catch(()=>{})}stop(){this.pending&&(this.pending.reject("cancelled"),this.pending=null)}isRunning(){return!!this.pending}async process(e){this.stop();try{this.pending=new re,t=this.getNextRun(e),await new Promise(e=>{setTimeout(e,t)}),this.pending.resolve(),await this.pending.promise,this.pending=new re,await this.operation(),this.pending.resolve(),await this.pending.promise,this.process(!0).catch(()=>{})}catch(e){this.retryPolicy(e)?this.process(!1).catch(()=>{}):this.stop()}var t}getNextRun(e){if(e)return this.nextErrorWaitInterval=this.lowerBound,this.getWaitDuration();e=this.nextErrorWaitInterval;return this.nextErrorWaitInterval*=2,this.nextErrorWaitInterval>this.upperBound&&(this.nextErrorWaitInterval=this.upperBound),e}}const nr=new ae("appCheck","AppCheck",{"already-initialized":"You have already called initializeAppCheck() for FirebaseApp {$appName} with different options. To avoid this error, call initializeAppCheck() with the same options as when it was originally called. This will return the already initialized instance.","use-before-activation":"App Check is being used before initializeAppCheck() is called for FirebaseApp {$appName}. Call initializeAppCheck() before instantiating other Firebase services.","fetch-network-error":"Fetch failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.","fetch-parse-error":"Fetch client could not parse response. Original error: {$originalErrorMessage}.","fetch-status-error":"Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.","storage-open":"Error thrown when opening storage. Original error: {$originalErrorMessage}.","storage-get":"Error thrown when reading from storage. Original error: {$originalErrorMessage}.","storage-set":"Error thrown when writing to storage. Original error: {$originalErrorMessage}.","recaptcha-error":"ReCAPTCHA error.",throttled:"Requests throttled due to {$httpStatus} error. Attempts allowed again after {$time}"});function rr(e=!1){return e?null==(e=self.grecaptcha)?void 0:e.enterprise:self.grecaptcha}function ir(e){if(!Jn(e).activated)throw nr.create("use-before-activation",{appName:e.name})}function sr(e){var e=Math.round(e/1e3),t=Math.floor(e/86400),n=Math.floor((e-3600*t*24)/3600),r=Math.floor((e-3600*t*24-3600*n)/60),e=e-3600*t*24-3600*n-60*r;let i="";return t&&(i+=ar(t)+"d:"),n&&(i+=ar(n)+"h:"),i+=ar(r)+"m:"+ar(e)+"s"}function ar(e){return 0===e?"00":10<=e?e.toString():"0"+e}async function or({url:e,body:t},n){const r={"Content-Type":"application/json"},i=n.getImmediate({optional:!0});i&&(o=await i.getHeartbeatsHeader())&&(r["X-Firebase-Client"]=o);n={method:"POST",body:JSON.stringify(t),headers:r};let s;try{s=await fetch(e,n)}catch(e){throw nr.create("fetch-network-error",{originalErrorMessage:null==e?void 0:e.message})}if(200!==s.status)throw nr.create("fetch-status-error",{httpStatus:s.status});let a;try{a=await s.json()}catch(e){throw nr.create("fetch-parse-error",{originalErrorMessage:null==e?void 0:e.message})}var o=a.ttl.match(/^([\d.]+)(s)$/);if(o&&o[2]&&!isNaN(Number(o[1])))return n=1e3*Number(o[1]),o=Date.now(),{token:a.token,expireTimeMillis:o+n,issuedAtTimeMillis:o};throw nr.create("fetch-parse-error",{originalErrorMessage:"ttl field (timeToLive) is not in standard Protobuf Duration format: "+a.ttl})}const lr="firebase-app-check-store",cr="debug-token";let ur=null;function hr(){return ur||(ur=new Promise((t,n)=>{try{const e=indexedDB.open("firebase-app-check-database",1);e.onsuccess=e=>{t(e.target.result)},e.onerror=e=>{n(nr.create("storage-open",{originalErrorMessage:null==(e=e.target.error)?void 0:e.message}))},e.onupgradeneeded=e=>{const t=e.target.result;0===e.oldVersion&&t.createObjectStore(lr,{keyPath:"compositeKey"})}}catch(e){n(nr.create("storage-open",{originalErrorMessage:null==e?void 0:e.message}))}}))}async function dr(e,t){const n=await hr(),r=n.transaction(lr,"readwrite"),i=r.objectStore(lr),s=i.put({compositeKey:e,value:t});return new Promise((t,n)=>{s.onsuccess=e=>{t()},r.onerror=e=>{n(nr.create("storage-set",{originalErrorMessage:null==(e=e.target.error)?void 0:e.message}))}})}async function pr(e){const t=await hr(),r=t.transaction(lr,"readonly"),n=r.objectStore(lr),i=n.get(e);return new Promise((t,n)=>{i.onsuccess=e=>{e=e.target.result;t(e?e.value:void 0)},r.onerror=e=>{n(nr.create("storage-get",{originalErrorMessage:null==(e=e.target.error)?void 0:e.message}))}})}function fr(e){return e.options.appId+"-"+e.name}const gr=new Be("@firebase/app-check");function mr(e,t){return Y()?dr(fr(e),t).catch(e=>{gr.warn("Failed to write token to IndexedDB. Error: "+e)}):Promise.resolve()}async function vr(){let e=void 0;try{e=await pr(cr)}catch(e){}if(e)return e;var t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{const t=16*Math.random()|0,n="x"===e?t:3&t|8;return n.toString(16)}),n=t;return dr(cr,n).catch(e=>gr.warn("Failed to persist debug token to IndexedDB. Error: "+e)),t}function yr(){return Yn.enabled}async function _r(){var e=Yn;if(e.enabled&&e.token)return e.token.promise;throw Error(`
            Can't get debug token in production mode.
        `)}const wr={error:"UNKNOWN_ERROR"};async function br(e,t=!1){var n,r=e.app;ir(r);const i=Jn(r);let s=i.token,a=void 0;if(s&&!Sr(s)&&(i.token=void 0,s=void 0),s||(n=await i.cachedTokenPromise)&&(Sr(n)?s=n:await mr(r,void 0)),!t&&s&&Sr(s))return{token:s.token};let o=!1;if(yr())return i.exchangeTokenPromise||(i.exchangeTokenPromise=or(function(e,t){var{projectId:e,appId:n,apiKey:r}=e.options;return{url:`${Xn}/projects/${e}/apps/${n}:${Zn}?key=`+r,body:{debug_token:t}}}(r,await _r()),e.heartbeatServiceProvider).finally(()=>{i.exchangeTokenPromise=void 0}),o=!0),await mr(r,n=await i.exchangeTokenPromise),{token:(i.token=n).token};try{i.exchangeTokenPromise||(i.exchangeTokenPromise=i.provider.getToken().finally(()=>{i.exchangeTokenPromise=void 0}),o=!0),s=await Jn(r).exchangeTokenPromise}catch(e){"appCheck/throttled"===e.code?gr.warn(e.message):gr.error(e),a=e}let l;return s?a?l=Sr(s)?{token:s.token,internalError:a}:Cr(a):(l={token:s.token},await mr(r,i.token=s)):l=Cr(a),o&&kr(r,l),l}function Ir(e,t,n,r){const i=Jn(e.app);if(r={next:n,error:r,type:t},i.tokenObservers=[...i.tokenObservers,r],i.token&&Sr(i.token)){const s=i.token;Promise.resolve().then(()=>{n({token:s.token}),Er(e)}).catch(()=>{})}i.cachedTokenPromise.then(()=>Er(e))}function Tr(e,t){const n=Jn(e);e=n.tokenObservers.filter(e=>e.next!==t);0===e.length&&n.tokenRefresher&&n.tokenRefresher.isRunning()&&n.tokenRefresher.stop(),n.tokenObservers=e}function Er(e){const t=Jn(e.app);let n=t.tokenRefresher;n||(n=function(t){const n=t.app;return new tr(async()=>{var e=Jn(n).token?await br(t,!0):await br(t);if(e.error)throw e.error;if(e.internalError)throw e.internalError},()=>!0,()=>{var e,t=Jn(n);return t.token?(e=t.token.issuedAtTimeMillis+.5*(t.token.expireTimeMillis-t.token.issuedAtTimeMillis)+3e5,t=t.token.expireTimeMillis-3e5,e=Math.min(e,t),Math.max(0,e-Date.now())):0},er.RETRIAL_MIN_WAIT,er.RETRIAL_MAX_WAIT)}(e),t.tokenRefresher=n),!n.isRunning()&&t.isTokenAutoRefreshEnabled&&n.start()}function kr(e,t){for(const n of Jn(e).tokenObservers)try{"EXTERNAL"===n.type&&null!=t.error?n.error(t.error):n.next(t)}catch(e){}}function Sr(e){return 0<e.expireTimeMillis-Date.now()}function Cr(e){return{token:(t=wr,s.encodeString(JSON.stringify(t),!1)),error:e};var t}class Ar{constructor(e,t){this.app=e,this.heartbeatServiceProvider=t}_delete(){for(const e of Jn(this.app).tokenObservers)Tr(this.app,e.next);return Promise.resolve()}}function Nr(t,n){const r=new re,e=Jn(t),i=(e.reCAPTCHAState={initialized:r},Dr(t));var s=rr(!1);if(s)xr(t,n,s,i,r);else{const a=document.createElement("script");a.src="https://www.google.com/recaptcha/api.js",a.onload=()=>{var e=rr(!1);if(!e)throw new Error("no recaptcha");xr(t,n,e,i,r)},document.head.appendChild(a)}return r.promise}function Rr(t,n){const r=new re,e=Jn(t),i=(e.reCAPTCHAState={initialized:r},Dr(t));var s=rr(!0);if(s)xr(t,n,s,i,r);else{const a=document.createElement("script");a.src="https://www.google.com/recaptcha/enterprise.js",a.onload=()=>{var e=rr(!0);if(!e)throw new Error("no recaptcha");xr(t,n,e,i,r)},document.head.appendChild(a)}return r.promise}function xr(r,i,s,a,o){s.ready(()=>{{var e=r;const t=s.render(a,{sitekey:i,size:"invisible"}),n=Jn(e);n.reCAPTCHAState=Object.assign(Object.assign({},n.reCAPTCHAState),{widgetId:t})}o.resolve(s)})}function Dr(e){e="fire_app_check_"+e.name;const t=document.createElement("div");return t.id=e,t.style.display="none",document.body.appendChild(t),e}async function Pr(r){ir(r);const i=await Jn(r).reCAPTCHAState.initialized.promise;return new Promise((e,t)=>{const n=Jn(r).reCAPTCHAState;i.ready(()=>{e(i.execute(n.widgetId,{action:"fire_app_check"}))})})}class Or{constructor(e){this._siteKey=e,this._throttleData=null}async getToken(){Ur(this._throttleData);var e=await Pr(this._app).catch(e=>{throw nr.create("recaptcha-error")});let t;try{t=await or(function(e,t){var{projectId:e,appId:n,apiKey:r}=e.options;return{url:Xn+`/projects/${e}/apps/${n}:exchangeRecaptchaV3Token?key=`+r,body:{recaptcha_v3_token:t}}}(this._app,e),this._heartbeatServiceProvider)}catch(t){throw null!=(e=t.code)&&e.includes("fetch-status-error")?(this._throttleData=Fr(Number(null==(e=t.customData)?void 0:e.httpStatus),this._throttleData),nr.create("throttled",{time:sr(this._throttleData.allowRequestsAfter-Date.now()),httpStatus:this._throttleData.httpStatus})):t}return this._throttleData=null,t}initialize(e){this._app=e,this._heartbeatServiceProvider=mt(e,"heartbeat"),Nr(e,this._siteKey).catch(()=>{})}isEqual(e){return e instanceof Or&&this._siteKey===e._siteKey}}class Mr{constructor(e){this._siteKey=e,this._throttleData=null}async getToken(){Ur(this._throttleData);var e=await Pr(this._app).catch(e=>{throw nr.create("recaptcha-error")});let t;try{t=await or(function(e,t){var{projectId:e,appId:n,apiKey:r}=e.options;return{url:Xn+`/projects/${e}/apps/${n}:exchangeRecaptchaEnterpriseToken?key=`+r,body:{recaptcha_enterprise_token:t}}}(this._app,e),this._heartbeatServiceProvider)}catch(t){throw null!=(e=t.code)&&e.includes("fetch-status-error")?(this._throttleData=Fr(Number(null==(e=t.customData)?void 0:e.httpStatus),this._throttleData),nr.create("throttled",{time:sr(this._throttleData.allowRequestsAfter-Date.now()),httpStatus:this._throttleData.httpStatus})):t}return this._throttleData=null,t}initialize(e){this._app=e,this._heartbeatServiceProvider=mt(e,"heartbeat"),Rr(e,this._siteKey).catch(()=>{})}isEqual(e){return e instanceof Mr&&this._siteKey===e._siteKey}}class Lr{constructor(e){this._customProviderOptions=e}async getToken(){var t=await this._customProviderOptions.getToken(),e=null!==(e=function(){const e=ue(t.token).claims;return"object"==typeof e&&e.hasOwnProperty("iat")?e.iat:null}())&&e<Date.now()&&0<e?1e3*e:Date.now();return Object.assign(Object.assign({},t),{issuedAtTimeMillis:e})}initialize(e){this._app=e}isEqual(e){return e instanceof Lr&&this._customProviderOptions.getToken.toString()===e._customProviderOptions.getToken.toString()}}function Fr(e,t){if(404===e||403===e)return{backoffCount:1,allowRequestsAfter:Date.now()+864e5,httpStatus:e};var t=t?t.backoffCount:0,n=De(t,1e3,2);return{backoffCount:t+1,allowRequestsAfter:Date.now()+n,httpStatus:e}}function Ur(e){if(e&&Date.now()-e.allowRequestsAfter<=0)throw nr.create("throttled",{time:sr(e.allowRequestsAfter-Date.now()),httpStatus:e.httpStatus})}function qr(e=bt(),t){const n=mt(e=_(e),"app-check");if(!Yn.initialized){var r=Z();const l=Yn;if(l.initialized=!0,"string"==typeof r.FIREBASE_APPCHECK_DEBUG_TOKEN||!0===r.FIREBASE_APPCHECK_DEBUG_TOKEN){l.enabled=!0;const c=new re;l.token=c,"string"==typeof r.FIREBASE_APPCHECK_DEBUG_TOKEN?c.resolve(r.FIREBASE_APPCHECK_DEBUG_TOKEN):c.resolve(vr())}}if(yr()&&_r().then(e=>console.log(`App Check debug token: ${e}. You will need to add it to your app's App Check settings in the Firebase console for it to work.`)),n.isInitialized()){var i=n.getImmediate();const u=n.getOptions();if(u.isTokenAutoRefreshEnabled===t.isTokenAutoRefreshEnabled&&u.provider.isEqual(t.provider))return i;throw nr.create("already-initialized",{appName:e.name})}i=n.initialize({options:t});{var s=e,a,o;r=t.provider,t=t.isTokenAutoRefreshEnabled,a=s,o=Object.assign({},Qn),$n.set(a,o);const h=$n.get(a);h.activated=!0,h.provider=r,h.cachedTokenPromise=async function(t){if(Y()){let e=void 0;try{e=await pr(fr(t))}catch(e){gr.warn("Failed to read token from IndexedDB. Error: "+e)}return e}}(s).then(e=>(e&&Sr(e)&&(h.token=e,kr(s,{token:e.token})),e)),h.isTokenAutoRefreshEnabled=void 0===t?s.automaticDataCollectionEnabled:t,h.provider.initialize(s)}return Jn(e).isTokenAutoRefreshEnabled&&Ir(i,"INTERNAL",()=>{}),i}const Vr="app-check-internal",Br=(gt(new o("app-check",e=>{var t=e.getProvider("app").getImmediate();return e=e.getProvider("heartbeat"),new Ar(t,e)},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,n)=>{e.getProvider(Vr).initialize()})),gt(new o(Vr,e=>{var t=e.getProvider("app-check").getImmediate();return{getToken:e=>br(t,e),addTokenListener:e=>Ir(t,"INTERNAL",e),removeTokenListener:e=>Tr(t.app,e)}},"PUBLIC").setInstantiationMode("EXPLICIT")),r("@firebase/app-check","0.5.17"),new ae("appCheck","AppCheck",{"use-before-activation":"App Check is being used before activate() is called for FirebaseApp {$appName}. Call activate() before instantiating other Firebase services."}));class jr{constructor(e){this.app=e}activate(e,t){e="string"==typeof e?new Or(e):e instanceof Mr||e instanceof Or||e instanceof Lr?e:new Lr({getToken:e.getToken});this._delegate=qr(this.app,{provider:e,isTokenAutoRefreshEnabled:t})}setTokenAutoRefreshEnabled(e){if(!this._delegate)throw Br.create("use-before-activation",{appName:this.app.name});{var t;const n=Jn(this._delegate.app);return n.tokenRefresher&&(!0===e?n.tokenRefresher.start():n.tokenRefresher.stop()),void(n.isTokenAutoRefreshEnabled=e)}}getToken(t){if(this._delegate)return async function(e){e=await br(e,t);if(e.error)throw e.error;return{token:e.token}}(this._delegate);throw Br.create("use-before-activation",{appName:this.app.name})}onTokenChanged(n,r,e){if(this._delegate){var i=this._delegate;let e,t=()=>{};return e=null!=n.next?n.next.bind(n):n,null!=n.error?t=n.error.bind(n):r&&(t=r),Ir(i,"EXTERNAL",e,t),()=>Tr(i.app,e)}throw Br.create("use-before-activation",{appName:this.app.name})}}function Kr(e,t){var n={};for(i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n}qt.INTERNAL.registerComponent(new o("appCheck-compat",e=>{e=e.getProvider("app-compat").getImmediate();return new jr(e)},"PUBLIC").setServiceProps({ReCaptchaEnterpriseProvider:Mr,ReCaptchaV3Provider:Or,CustomProvider:Lr})),qt.registerVersion("@firebase/app-check-compat","0.2.17");const Wr={FACEBOOK:"facebook.com",GITHUB:"github.com",GOOGLE:"google.com",PASSWORD:"password",PHONE:"phone",TWITTER:"twitter.com"},zr="EMAIL_SIGNIN",Gr="PASSWORD_RESET",Hr="RECOVER_EMAIL",$r="REVERT_SECOND_FACTOR_ADDITION",Qr="VERIFY_AND_CHANGE_EMAIL",Yr="VERIFY_EMAIL";function Jr(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}function Xr(){return{"admin-restricted-operation":"This operation is restricted to administrators only.","argument-error":"","app-not-authorized":"This app, identified by the domain where it's hosted, is not authorized to use Firebase Authentication with the provided API key. Review your key configuration in the Google API console.","app-not-installed":"The requested mobile application corresponding to the identifier (Android package name or iOS bundle ID) provided is not installed on this device.","captcha-check-failed":"The reCAPTCHA response token provided is either invalid, expired, already used or the domain associated with it does not match the list of whitelisted domains.","code-expired":"The SMS code has expired. Please re-send the verification code to try again.","cordova-not-ready":"Cordova framework is not ready.","cors-unsupported":"This browser is not supported.","credential-already-in-use":"This credential is already associated with a different user account.","custom-token-mismatch":"The custom token corresponds to a different audience.","requires-recent-login":"This operation is sensitive and requires recent authentication. Log in again before retrying this request.","dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK.","dynamic-link-not-activated":"Please activate Dynamic Links in the Firebase Console and agree to the terms and conditions.","email-change-needs-verification":"Multi-factor users must always have a verified email.","email-already-in-use":"The email address is already in use by another account.","emulator-config-failed":'Auth instance has already been used to make a network call. Auth can no longer be configured to use the emulator. Try calling "connectAuthEmulator()" sooner.',"expired-action-code":"The action code has expired.","cancelled-popup-request":"This operation has been cancelled due to another conflicting popup being opened.","internal-error":"An internal AuthError has occurred.","invalid-app-credential":"The phone verification request contains an invalid application verifier. The reCAPTCHA token response is either invalid or expired.","invalid-app-id":"The mobile app identifier is not registed for the current project.","invalid-user-token":"This user's credential isn't valid for this project. This can happen if the user's token has been tampered with, or if the user isn't for the project associated with this API key.","invalid-auth-event":"An internal AuthError has occurred.","invalid-verification-code":"The SMS verification code used to create the phone auth credential is invalid. Please resend the verification code sms and be sure to use the verification code provided by the user.","invalid-continue-uri":"The continue URL provided in the request is invalid.","invalid-cordova-configuration":"The following Cordova plugins must be installed to enable OAuth sign-in: cordova-plugin-buildinfo, cordova-universal-links-plugin, cordova-plugin-browsertab, cordova-plugin-inappbrowser and cordova-plugin-customurlscheme.","invalid-custom-token":"The custom token format is incorrect. Please check the documentation.","invalid-dynamic-link-domain":"The provided dynamic link domain is not configured or authorized for the current project.","invalid-email":"The email address is badly formatted.","invalid-emulator-scheme":"Emulator URL must start with a valid scheme (http:// or https://).","invalid-api-key":"Your API key is invalid, please check you have copied it correctly.","invalid-cert-hash":"The SHA-1 certificate hash provided is invalid.","invalid-credential":"The supplied auth credential is malformed or has expired.","invalid-message-payload":"The email template corresponding to this action contains invalid characters in its message. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-multi-factor-session":"The request does not contain a valid proof of first factor successful sign-in.","invalid-oauth-provider":"EmailAuthProvider is not supported for this operation. This operation only supports OAuth providers.","invalid-oauth-client-id":"The OAuth client ID provided is either invalid or does not match the specified API key.","unauthorized-domain":"This domain is not authorized for OAuth operations for your Firebase project. Edit the list of authorized domains from the Firebase console.","invalid-action-code":"The action code is invalid. This can happen if the code is malformed, expired, or has already been used.","wrong-password":"The password is invalid or the user does not have a password.","invalid-persistence-type":"The specified persistence type is invalid. It can only be local, session or none.","invalid-phone-number":"The format of the phone number provided is incorrect. Please enter the phone number in a format that can be parsed into E.164 format. E.164 phone numbers are written in the format [+][country code][subscriber number including area code].","invalid-provider-id":"The specified provider ID is invalid.","invalid-recipient-email":"The email corresponding to this action failed to send as the provided recipient email address is invalid.","invalid-sender":"The email template corresponding to this action contains an invalid sender email or name. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-verification-id":"The verification ID used to create the phone auth credential is invalid.","invalid-tenant-id":"The Auth instance's tenant ID is invalid.","login-blocked":"Login blocked by user-provided method: {$originalMessage}","missing-android-pkg-name":"An Android Package Name must be provided if the Android App is required to be installed.","auth-domain-config-required":"Be sure to include authDomain when calling firebase.initializeApp(), by following the instructions in the Firebase console.","missing-app-credential":"The phone verification request is missing an application verifier assertion. A reCAPTCHA response token needs to be provided.","missing-verification-code":"The phone auth credential was created with an empty SMS verification code.","missing-continue-uri":"A continue URL must be provided in the request.","missing-iframe-start":"An internal AuthError has occurred.","missing-ios-bundle-id":"An iOS Bundle ID must be provided if an App Store ID is provided.","missing-or-invalid-nonce":"The request does not contain a valid nonce. This can occur if the SHA-256 hash of the provided raw nonce does not match the hashed nonce in the ID token payload.","missing-multi-factor-info":"No second factor identifier is provided.","missing-multi-factor-session":"The request is missing proof of first factor successful sign-in.","missing-phone-number":"To send verification codes, provide a phone number for the recipient.","missing-verification-id":"The phone auth credential was created with an empty verification ID.","app-deleted":"This instance of FirebaseApp has been deleted.","multi-factor-info-not-found":"The user does not have a second factor matching the identifier provided.","multi-factor-auth-required":"Proof of ownership of a second factor is required to complete sign-in.","account-exists-with-different-credential":"An account already exists with the same email address but different sign-in credentials. Sign in using a provider associated with this email address.","network-request-failed":"A network AuthError (such as timeout, interrupted connection or unreachable host) has occurred.","no-auth-event":"An internal AuthError has occurred.","no-such-provider":"User was not linked to an account with the given provider.","null-user":"A null user object was provided as the argument for an operation which requires a non-null user object.","operation-not-allowed":"The given sign-in provider is disabled for this Firebase project. Enable it in the Firebase console, under the sign-in method tab of the Auth section.","operation-not-supported-in-this-environment":'This operation is not supported in the environment this application is running on. "location.protocol" must be http, https or chrome-extension and web storage must be enabled.',"popup-blocked":"Unable to establish a connection with the popup. It may have been blocked by the browser.","popup-closed-by-user":"The popup has been closed by the user before finalizing the operation.","provider-already-linked":"User can only be linked to one identity for the given provider.","quota-exceeded":"The project's quota for this operation has been exceeded.","redirect-cancelled-by-user":"The redirect operation has been cancelled by the user before finalizing.","redirect-operation-pending":"A redirect sign-in operation is already pending.","rejected-credential":"The request contains malformed or mismatching credentials.","second-factor-already-in-use":"The second factor is already enrolled on this account.","maximum-second-factor-count-exceeded":"The maximum allowed number of second factors on a user has been exceeded.","tenant-id-mismatch":"The provided tenant ID does not match the Auth instance's tenant ID",timeout:"The operation has timed out.","user-token-expired":"The user's credential is no longer valid. The user must sign in again.","too-many-requests":"We have blocked all requests from this device due to unusual activity. Try again later.","unauthorized-continue-uri":"The domain of the continue URL is not whitelisted.  Please whitelist the domain in the Firebase console.","unsupported-first-factor":"Enrolling a second factor or signing in with a multi-factor account requires sign-in with a supported first factor.","unsupported-persistence-type":"The current environment does not support the specified persistence type.","unsupported-tenant-operation":"This operation is not supported in a multi-tenant context.","unverified-email":"The operation requires a verified email.","user-cancelled":"The user did not grant your application the permissions it requested.","user-not-found":"There is no user record corresponding to this identifier. The user may have been deleted.","user-disabled":"The user account has been disabled by an administrator.","user-mismatch":"The supplied credentials do not correspond to the previously signed in user.","user-signed-out":"","weak-password":"The password must be 6 characters long or more.","web-storage-unsupported":"This browser is not supported or 3rd party cookies and data may be disabled.","already-initialized":"initializeAuth() has already been called with different options. To avoid this error, call initializeAuth() with the same options as when it was originally called, or call getAuth() to return the already initialized instance."}}const Zr=Jr,ei=new ae("auth","Firebase",Jr()),ti=new Be("@firebase/auth");function ni(e,...t){ti.logLevel<=h.ERROR&&ti.error(`Auth (${_t}): `+e,...t)}function ri(e,...t){throw oi(e,...t)}function ii(e,...t){return oi(e,...t)}function si(e,t,n){n=Object.assign(Object.assign({},Zr()),{[t]:n});const r=new ae("auth","Firebase",n);return r.create(t,{appName:e.name})}function ai(e,t,n){if(!(t instanceof n))throw n.name!==t.constructor.name&&ri(e,"argument-error"),si(e,"argument-error",`Type of ${t.constructor.name} does not match expected instance.`+"Did you pass a reference from a different Auth SDK?")}function oi(e,...t){if("string"==typeof e)return ei.create(e,...t);{var n=t[0];const r=[...t.slice(1)];return r[0]&&(r[0].appName=e.name),e._errorFactory.create(n,...r)}}function v(e,t,...n){if(!e)throw oi(t,...n)}function li(e){e="INTERNAL ASSERTION FAILED: "+e;throw ni(e),new Error(e)}function ci(e,t){e||li(t)}const ui=new Map;function hi(e){ci(e instanceof Function,"Expected a class definition");let t=ui.get(e);return t?ci(t instanceof e,"Instance stored in cache mismatched with class"):(t=new e,ui.set(e,t)),t}function di(){var e;return"undefined"!=typeof self&&(null==(e=self.location)?void 0:e.href)||""}function pi(){return"http:"===fi()||"https:"===fi()}function fi(){var e;return"undefined"!=typeof self&&(null==(e=self.location)?void 0:e.protocol)||null}class gi{constructor(e,t){ci((this.shortDelay=e)<(this.longDelay=t),"Short delay should be less than long delay!"),this.isMobile=W()||H()}get(){return"undefined"!=typeof navigator&&navigator&&"onLine"in navigator&&"boolean"==typeof navigator.onLine&&(pi()||G()||"connection"in navigator)&&!navigator.onLine?Math.min(5e3,this.shortDelay):this.isMobile?this.longDelay:this.shortDelay}}function mi(e,t){ci(e.emulator,"Emulator should always be set here");e=e.emulator.url;return t?""+e+(t.startsWith("/")?t.slice(1):t):e}class vi{static initialize(e,t,n){this.fetchImpl=e,t&&(this.headersImpl=t),n&&(this.responseImpl=n)}static fetch(){return this.fetchImpl||("undefined"!=typeof self&&"fetch"in self?self.fetch:void li("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill"))}static headers(){return this.headersImpl||("undefined"!=typeof self&&"Headers"in self?self.Headers:void li("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill"))}static response(){return this.responseImpl||("undefined"!=typeof self&&"Response"in self?self.Response:void li("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill"))}}const yi={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"internal-error",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error"},_i=new gi(3e4,6e4);function wi(e,t){return e.tenantId&&!t.tenantId?Object.assign(Object.assign({},t),{tenantId:e.tenantId}):t}async function bi(i,s,a,o,e={}){return Ii(i,e,async()=>{let e={},t={};o&&("GET"===s?t=o:e={body:JSON.stringify(o)});var n=ve(Object.assign({key:i.config.apiKey},t)).slice(1);const r=await i._getAdditionalHeaders();return r["Content-Type"]="application/json",i.languageCode&&(r["X-Firebase-Locale"]=i.languageCode),vi.fetch()(Ei(i,i.config.apiHost,a,n),Object.assign({method:s,headers:r,referrerPolicy:"no-referrer"},e))})}async function Ii(e,t,n){e._canInitEmulator=!1;var r=Object.assign(Object.assign({},yi),t);try{const a=new ki(e),o=await Promise.race([n(),a.promise]);a.clearNetworkTimeout();var i=await o.json();if("needConfirmation"in i)throw Si(e,"account-exists-with-different-credential",i);if(o.ok&&!("errorMessage"in i))return i;{const l=o.ok?i.errorMessage:i.error.message,[c,u]=l.split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===c)throw Si(e,"credential-already-in-use",i);if("EMAIL_EXISTS"===c)throw Si(e,"email-already-in-use",i);if("USER_DISABLED"===c)throw Si(e,"user-disabled",i);var s=r[c]||c.toLowerCase().replace(/[_\s]+/g,"-");if(u)throw si(e,s,u);ri(e,s)}}catch(t){if(t instanceof se)throw t;ri(e,"network-request-failed")}}async function Ti(e,t,n,r,i={}){t=await bi(e,t,n,r,i);return"mfaPendingCredential"in t&&ri(e,"multi-factor-auth-required",{_serverResponse:t}),t}function Ei(e,t,n,r){t=""+t+n+"?"+r;return e.config.emulator?mi(e.config,t):e.config.apiScheme+"://"+t}class ki{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((e,t)=>{this.timer=setTimeout(()=>t(ii(this.auth,"network-request-failed")),_i.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function Si(e,t,n){const r={appName:e.name},i=(n.email&&(r.email=n.email),n.phoneNumber&&(r.phoneNumber=n.phoneNumber),ii(e,t,r));return i.customData._tokenResponse=n,i}function Ci(e){if(e)try{const t=new Date(Number(e));if(!isNaN(t.getTime()))return t.toUTCString()}catch(e){}}function Ai(e){return 1e3*Number(e)}function Ni(e){var[t,n,r]=e.split(".");if(void 0===t||void 0===n||void 0===r)return ni("JWT malformed, contained fewer than 3 sections"),null;try{var i=c(n);return i?JSON.parse(i):(ni("Failed to decode base64 JWT payload"),null)}catch(e){return ni("Caught error parsing JWT payload as JSON",null==e?void 0:e.toString()),null}}async function Ri(e,t,n=!1){if(n)return t;try{return t}catch(n){throw n instanceof se&&("auth/user-disabled"===(t=n.code)||"auth/user-token-expired"===t)&&e.auth.currentUser===e&&await e.auth.signOut(),n}}class xi{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(e){var t;return e?(t=this.errorBackoff,this.errorBackoff=Math.min(2*this.errorBackoff,96e4),t):(this.errorBackoff=3e4,t=(null!=(t=this.user.stsTokenManager.expirationTime)?t:0)-Date.now()-3e5,Math.max(0,t))}schedule(e=!1){this.isRunning&&(e=this.getInterval(e),this.timerId=setTimeout(async()=>{await this.iteration()},e))}async iteration(){try{await this.user.getIdToken(!0)}catch(e){return void("auth/network-request-failed"===(null==e?void 0:e.code)&&this.schedule(!0))}this.schedule()}}class Di{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=Ci(this.lastLoginAt),this.creationTime=Ci(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function Pi(e){var t=e.auth,n=await e.getIdToken(),r=(v(null==(a=await Ri(e,async function(){return bi(t,"POST","/v1/accounts:lookup",{idToken:n})}()))?void 0:a.users.length,t,"internal-error"),a.users[0]);e._notifyReloadListener(r);var i,s,t=null!=(n=r.providerUserInfo)&&n.length?r.providerUserInfo.map(e=>{var t=e.providerId,e=Kr(e,["providerId"]);return{providerId:t,uid:e.rawId||"",displayName:e.displayName||null,email:e.email||null,phoneNumber:e.phoneNumber||null,photoURL:e.photoUrl||null}}):[],a=(i=e.providerData,s=t,[...i.filter(t=>!s.some(e=>e.providerId===t.providerId)),...s]),n=e.isAnonymous,t=!(e.email&&r.passwordHash||null!==a&&a.length),t=!!n&&t,t={uid:r.localId,displayName:r.displayName||null,photoURL:r.photoUrl||null,email:r.email||null,emailVerified:r.emailVerified||!1,phoneNumber:r.phoneNumber||null,tenantId:r.tenantId||null,providerData:a,metadata:new Di(r.createdAt,r.lastLoginAt),isAnonymous:t};Object.assign(e,t)}class Oi{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){v(e.idToken,"internal-error"),v(void 0!==e.idToken,"internal-error"),v(void 0!==e.refreshToken,"internal-error");var t="expiresIn"in e&&void 0!==e.expiresIn?Number(e.expiresIn):(v(t=Ni(e.idToken),"internal-error"),v(void 0!==t.exp,"internal-error"),v(void 0!==t.iat,"internal-error"),Number(t.exp)-Number(t.iat));this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}async getToken(e,t=!1){return v(!this.accessToken||this.refreshToken,e,"user-token-expired"),t||!this.accessToken||this.isExpired?this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null:this.accessToken}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){s=t;var i,s,{accessToken:e,refreshToken:n,expiresIn:t}=await{accessToken:(t=await Ii(i=e,{},async()=>{var e=ve({grant_type:"refresh_token",refresh_token:s}).slice(1),{tokenApiHost:t,apiKey:n}=i.config,n=Ei(i,t,"/v1/token","key="+n);const r=await i._getAdditionalHeaders();return r["Content-Type"]="application/x-www-form-urlencoded",vi.fetch()(n,{method:"POST",headers:r,body:e})})).access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token};this.updateTokensAndExpiration(e,n,Number(t))}updateTokensAndExpiration(e,t,n){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+1e3*n}static fromJSON(e,t){var{refreshToken:t,accessToken:n,expirationTime:r}=t;const i=new Oi;return t&&(v("string"==typeof t,"internal-error",{appName:e}),i.refreshToken=t),n&&(v("string"==typeof n,"internal-error",{appName:e}),i.accessToken=n),r&&(v("number"==typeof r,"internal-error",{appName:e}),i.expirationTime=r),i}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new Oi,this.toJSON())}_performRefresh(){return li("not implemented")}}function Mi(e,t){v("string"==typeof e||void 0===e,"internal-error",{appName:t})}class Li{constructor(e){var{uid:t,auth:n,stsTokenManager:r}=e,e=Kr(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new xi(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=n,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=e.displayName||null,this.email=e.email||null,this.emailVerified=e.emailVerified||!1,this.phoneNumber=e.phoneNumber||null,this.photoURL=e.photoURL||null,this.isAnonymous=e.isAnonymous||!1,this.tenantId=e.tenantId||null,this.providerData=e.providerData?[...e.providerData]:[],this.metadata=new Di(e.createdAt||void 0,e.lastLoginAt||void 0)}async getIdToken(e){e=await Ri(this,this.stsTokenManager.getToken(this.auth,e));return v(e,this.auth,"internal-error"),this.accessToken!==e&&(this.accessToken=e,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),e}getIdTokenResult(e){return async function(e,t=!1){const n=_(e);var e=await n.getIdToken(t),t=Ni(e),r=(v(t&&t.exp&&t.auth_time&&t.iat,n.auth,"internal-error"),"object"==typeof t.firebase?t.firebase:void 0),i=null==r?void 0:r.sign_in_provider;return{claims:t,token:e,authTime:Ci(Ai(t.auth_time)),issuedAtTime:Ci(Ai(t.iat)),expirationTime:Ci(Ai(t.exp)),signInProvider:i||null,signInSecondFactor:(null==r?void 0:r.sign_in_second_factor)||null}}(this,e)}reload(){return async function(e){const t=_(e);await Pi(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}(this)}_assign(e){this!==e&&(v(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(e=>Object.assign({},e)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){return new Li(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}))}_onReload(e){v(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let n=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),n=!0),t&&await Pi(this),await this.auth._persistUserIfCurrent(this),n&&this.auth._notifyListenersIfCurrent(this)}async delete(){var t=await this.getIdToken();return await Ri(this,async function(e){return bi(e,"POST","/v1/accounts:delete",{idToken:t})}(this.auth)),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var n=null!=(a=t.displayName)?a:void 0,r=null!=(g=t.email)?g:void 0,i=null!=(o=t.phoneNumber)?o:void 0,s=null!=(c=t.photoURL)?c:void 0,a=null!=(l=t.tenantId)?l:void 0,o=null!=(g=t._redirectEventId)?g:void 0,l=null!=(c=t.createdAt)?c:void 0,c=null!=(g=t.lastLoginAt)?g:void 0;const{uid:u,emailVerified:h,isAnonymous:d,providerData:p,stsTokenManager:f}=t;v(u&&f,e,"internal-error");var g=Oi.fromJSON(this.name,f);v("string"==typeof u,e,"internal-error"),Mi(n,e.name),Mi(r,e.name),v("boolean"==typeof h,e,"internal-error"),v("boolean"==typeof d,e,"internal-error"),Mi(i,e.name),Mi(s,e.name),Mi(a,e.name),Mi(o,e.name),Mi(l,e.name),Mi(c,e.name);const m=new Li({uid:u,auth:e,email:r,emailVerified:h,displayName:n,isAnonymous:d,photoURL:s,phoneNumber:i,tenantId:a,stsTokenManager:g,createdAt:l,lastLoginAt:c});return p&&Array.isArray(p)&&(m.providerData=p.map(e=>Object.assign({},e))),o&&(m._redirectEventId=o),m}static async _fromIdTokenResponse(e,t,n=!1){const r=new Oi;r.updateFromServerResponse(t);t=new Li({uid:t.localId,auth:e,stsTokenManager:r,isAnonymous:n});return await Pi(t),t}}class Fi{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){e=this.storage[e];return void 0===e?null:e}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}Fi.type="NONE";const Ui=Fi;function qi(e,t,n){return`firebase:${e}:${t}:`+n}class Vi{constructor(e,t,n){this.persistence=e,this.auth=t,this.userKey=n;var{config:e,name:n}=this.auth;this.fullUserKey=qi(this.userKey,e.apiKey,n),this.fullPersistenceKey=qi("persistence",e.apiKey,n),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){var e=await this.persistence._get(this.fullUserKey);return e?Li._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){var t;if(this.persistence!==e)return t=await this.getCurrentUser(),await this.removeCurrentUser(),this.persistence=e,t?this.setCurrentUser(t):void 0}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,n="authUser"){if(!t.length)return new Vi(hi(Ui),e,n);const r=(await Promise.all(t.map(async e=>{if(await e._isAvailable())return e}))).filter(e=>e);let i=r[0]||hi(Ui);const s=qi(n,e.config.apiKey,e.name);let a=null;for(const u of t)try{var o=await u._get(s);if(o){var l=Li._fromJSON(e,o);u!==i&&(a=l),i=u;break}}catch(e){}var c=r.filter(e=>e._shouldAllowMigration);return i._shouldAllowMigration&&c.length&&(i=c[0],a&&await i._set(s,a.toJSON()),await Promise.all(t.map(async e=>{if(e!==i)try{await e._remove(s)}catch(e){}}))),new Vi(i,e,n)}}function Bi(e){const t=e.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";if(zi(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(ji(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(Hi(t))return"Blackberry";if($i(t))return"Webos";if(Ki(t))return"Safari";if((t.includes("chrome/")||Wi(t))&&!t.includes("edge/"))return"Chrome";if(Gi(t))return"Android";e=e.match(/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/);return 2===(null==e?void 0:e.length)?e[1]:"Other"}function ji(e=d()){return/firefox\//i.test(e)}function Ki(e=d()){const t=e.toLowerCase();return t.includes("safari/")&&!t.includes("chrome/")&&!t.includes("crios/")&&!t.includes("android")}function Wi(e=d()){return/crios\//i.test(e)}function zi(e=d()){return/iemobile/i.test(e)}function Gi(e=d()){return/android/i.test(e)}function Hi(e=d()){return/blackberry/i.test(e)}function $i(e=d()){return/webos/i.test(e)}function Qi(e=d()){return/iphone|ipad|ipod/i.test(e)||/macintosh/i.test(e)&&/mobile/i.test(e)}function Yi(e=d()){return Qi(e)||Gi(e)||$i(e)||Hi(e)||/windows phone/i.test(e)||zi(e)}function Ji(e,t=[]){let n;switch(e){case"Browser":n=Bi(d());break;case"Worker":n=Bi(d())+"-"+e;break;default:n=e}t=t.length?t.join(","):"FirebaseCore-web";return`${n}/JsCore/${_t}/`+t}class Xi{constructor(e){this.auth=e,this.queue=[]}pushCallback(r,e){var t=n=>new Promise((e,t)=>{try{e(r(n))}catch(e){t(e)}});t.onAbort=e,this.queue.push(t);const n=this.queue.length-1;return()=>{this.queue[n]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser!==e){const t=[];try{for(const n of this.queue)await n(e),n.onAbort&&t.push(n.onAbort)}catch(e){t.reverse();for(const r of t)try{r()}catch(e){}throw this.auth._errorFactory.create("login-blocked",{originalMessage:null==e?void 0:e.message})}}}}class Zi{constructor(e,t,n){this.app=e,this.heartbeatServiceProvider=t,this.config=n,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new ts(this),this.idTokenSubscription=new ts(this),this.beforeStateQueue=new Xi(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=ei,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=n.sdkClientVersion}_initializeWithPersistence(t,n){return n&&(this._popupRedirectResolver=hi(n)),this._initializationPromise=this.queue(async()=>{var e;if(!this._deleted&&(this.persistenceManager=await Vi.create(this,t),!this._deleted)){if(null!=(e=this._popupRedirectResolver)&&e._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch(e){}await this.initializeCurrentUser(n),this.lastNotifiedUid=(null==(e=this.currentUser)?void 0:e.uid)||null,this._deleted||(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(!this._deleted){var e=await this.assertedPersistence.getCurrentUser();if(this.currentUser||e)return this.currentUser&&e&&this.currentUser.uid===e.uid?(this._currentUser._assign(e),void await this.currentUser.getIdToken()):void await this._updateCurrentUser(e,!0)}}async initializeCurrentUser(e){var t,n,r,i=await this.assertedPersistence.getCurrentUser();let s=i,a=!1;if(e&&this.config.authDomain&&(await this.getOrInitRedirectPersistenceManager(),t=null==(r=this.redirectUser)?void 0:r._redirectEventId,n=null===s||void 0===s?void 0:s._redirectEventId,r=await this.tryRedirectSignIn(e),t&&t!==n||null==r||!r.user||(s=r.user,a=!0)),!s)return this.directlySetCurrentUser(null);if(s._redirectEventId)return v(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===s._redirectEventId?this.directlySetCurrentUser(s):this.reloadAndSetCurrentUserOrClear(s);if(a)try{await this.beforeStateQueue.runMiddleware(s)}catch(e){s=i,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(e))}return s?this.reloadAndSetCurrentUserOrClear(s):this.directlySetCurrentUser(null)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch(e){await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await Pi(e)}catch(e){if("auth/network-request-failed"!==(null==e?void 0:e.code))return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=function(){if("undefined"==typeof navigator)return null;var e=navigator;return e.languages&&e.languages[0]||e.language||null}()}async _delete(){this._deleted=!0}async updateCurrentUser(e){const t=e?_(e):null;return t&&v(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&v(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0)}setPersistence(e){return this.queue(async()=>{await this.assertedPersistence.setPersistence(hi(e))})}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new ae("auth","Firebase",e())}onAuthStateChanged(e,t,n){return this.registerStateListener(this.authStateSubscription,e,t,n)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,n){return this.registerStateListener(this.idTokenSubscription,e,t,n)}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:null==(e=this._currentUser)?void 0:e.toJSON()}}async _setRedirectUser(e,t){const n=await this.getOrInitRedirectPersistenceManager(t);return null===e?n.removeCurrentUser():n.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){return this.redirectPersistenceManager||(v(e=e&&hi(e)||this._popupRedirectResolver,this,"argument-error"),this.redirectPersistenceManager=await Vi.create(this,[hi(e._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()),this.redirectPersistenceManager}async _redirectUserForId(e){var t;return this._isInitialized&&await this.queue(async()=>{}),(null==(t=this._currentUser)?void 0:t._redirectEventId)===e?this._currentUser:(null==(t=this.redirectUser)?void 0:t._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:`+this.name}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e;this._isInitialized&&(this.idTokenSubscription.next(this.currentUser),e=null!=(e=null==(e=this.currentUser)?void 0:e.uid)?e:null,this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser)))}registerStateListener(e,t,n,r){if(this._deleted)return()=>{};const i="function"==typeof t?t:t.next.bind(t),s=this._isInitialized?Promise.resolve():this._initializationPromise;return v(s,this,"internal-error"),s.then(()=>i(this.currentUser)),"function"==typeof t?e.addObserver(t,n,r):e.addObserver(t)}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),(this.currentUser=e)?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return v(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){e&&!this.frameworks.includes(e)&&(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=Ji(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){const e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);var t=await(null==(t=this.heartbeatServiceProvider.getImmediate({optional:!0}))?void 0:t.getHeartbeatsHeader());return t&&(e["X-Firebase-Client"]=t),e}}function es(e){return _(e)}class ts{constructor(e){this.auth=e,this.observer=null,this.addObserver=be(e=>this.observer=e)}get next(){return v(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}function ns(e){var t=e.indexOf(":");return t<0?"":e.substr(0,t+1)}function rs(e){if(!e)return null;e=Number(e);return isNaN(e)?null:e}class is{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return li("not implemented")}_getIdTokenResponse(e){return li("not implemented")}_linkToIdToken(e,t){return li("not implemented")}_getReauthenticationResolver(e){return li("not implemented")}}async function ss(e,t){return bi(e,"POST","/v1/accounts:resetPassword",wi(e,t))}async function as(e,t){return bi(e,"POST","/v1/accounts:update",t)}async function os(e,t){return bi(e,"POST","/v1/accounts:sendOobCode",wi(e,t))}class ls extends is{constructor(e,t,n,r=null){super("password",n),this._email=e,this._password=t,this._tenantId=r}static _fromEmailAndPassword(e,t){return new ls(e,t,"password")}static _fromEmailAndCode(e,t,n=null){return new ls(e,t,"emailLink",n)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){e="string"==typeof e?JSON.parse(e):e;if(null!=e&&e.email&&null!=e&&e.password){if("password"===e.signInMethod)return this._fromEmailAndPassword(e.email,e.password);if("emailLink"===e.signInMethod)return this._fromEmailAndCode(e.email,e.password,e.tenantId)}return null}async _getIdTokenResponse(t){switch(this.signInMethod){case"password":return async function(e){return Ti(t,"POST","/v1/accounts:signInWithPassword",wi(t,e))}({returnSecureToken:!0,email:this._email,password:this._password});case"emailLink":return async function(e){return Ti(t,"POST","/v1/accounts:signInWithEmailLink",wi(t,e))}({email:this._email,oobCode:this._password});default:ri(t,"internal-error")}}async _linkToIdToken(t,e){switch(this.signInMethod){case"password":return as(t,{idToken:e,returnSecureToken:!0,email:this._email,password:this._password});case"emailLink":return async function(e){return Ti(t,"POST","/v1/accounts:signInWithEmailLink",wi(t,e))}({idToken:e,email:this._email,oobCode:this._password});default:ri(t,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}async function cs(e,t){return Ti(e,"POST","/v1/accounts:signInWithIdp",wi(e,t))}class us extends is{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new us(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):ri("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){var{providerId:t,signInMethod:n}=e="string"==typeof e?JSON.parse(e):e,e=Kr(e,["providerId","signInMethod"]);if(!t||!n)return null;const r=new us(t,n);return r.idToken=e.idToken||void 0,r.accessToken=e.accessToken||void 0,r.secret=e.secret,r.nonce=e.nonce,r.pendingToken=e.pendingToken||null,r}_getIdTokenResponse(e){return cs(e,this.buildRequest())}_linkToIdToken(e,t){const n=this.buildRequest();return n.idToken=t,cs(e,n)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,cs(e,t)}buildRequest(){const e={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=ve(t)}return e}}const hs={USER_NOT_FOUND:"user-not-found"};class ds extends is{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new ds({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new ds({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return async function(e,t){return Ti(e,"POST","/v1/accounts:signInWithPhoneNumber",wi(e,t))}(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return async function(e,t){t=await Ti(e,"POST","/v1/accounts:signInWithPhoneNumber",wi(e,t));if(t.temporaryProof)throw Si(e,"account-exists-with-different-credential",t);return t}(e,Object.assign({idToken:t},this._makeVerificationRequest()))}_getReauthenticationResolver(e){return async function(e,t){return Ti(e,"POST","/v1/accounts:signInWithPhoneNumber",wi(e,Object.assign(Object.assign({},t),{operation:"REAUTH"})),hs)}(e,this._makeVerificationRequest())}_makeVerificationRequest(){var{temporaryProof:e,phoneNumber:t,verificationId:n,verificationCode:r}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:n,code:r}}toJSON(){const e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){var{verificationId:e,verificationCode:t,phoneNumber:n,temporaryProof:r}=e="string"==typeof e?JSON.parse(e):e;return t||e||n||r?new ds({verificationId:e,verificationCode:t,phoneNumber:n,temporaryProof:r}):null}}class ps{constructor(e){var t=ye(_e(e)),n=null!=(e=t.apiKey)?e:null,e=null!=(r=t.oobCode)?r:null,r=function(){switch(null!==(r=t.mode)&&void 0!==r?r:null){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}();v(n&&e&&r,"argument-error"),this.apiKey=n,this.operation=r,this.code=e,this.continueUrl=null!=(e=t.continueUrl)?e:null,this.languageCode=null!=(e=t.languageCode)?e:null,this.tenantId=null!=(t=t.tenantId)?t:null}static parseLink(e){t=(r=ye(_e(e)).link)?ye(_e(r)).deep_link_id:null;var t,n,r=((n=ye(_e(e)).deep_link_id)?ye(_e(n)).link:null)||n||t||r||e;try{return new ps(r)}catch(e){return null}}}class fs{constructor(){this.providerId=fs.PROVIDER_ID}static credential(e,t){return ls._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){t=ps.parseLink(t);return v(t,"argument-error"),ls._fromEmailAndCode(e,t.code,t.tenantId)}}fs.PROVIDER_ID="password",fs.EMAIL_PASSWORD_SIGN_IN_METHOD="password",fs.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class gs{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class ms extends gs{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class vs extends ms{static credentialFromJSON(e){e="string"==typeof e?JSON.parse(e):e;return v("providerId"in e&&"signInMethod"in e,"argument-error"),us._fromParams(e)}credential(e){return this._credential(Object.assign(Object.assign({},e),{nonce:e.rawNonce}))}_credential(e){return v(e.idToken||e.accessToken,"argument-error"),us._fromParams(Object.assign(Object.assign({},e),{providerId:this.providerId,signInMethod:this.providerId}))}static credentialFromResult(e){return vs.oauthCredentialFromTaggedObject(e)}static credentialFromError(e){return vs.oauthCredentialFromTaggedObject(e.customData||{})}static oauthCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;var{oauthIdToken:t,oauthAccessToken:n,oauthTokenSecret:r,pendingToken:i,nonce:s,providerId:a}=e;if(!(n||r||t||i))return null;if(!a)return null;try{return new vs(a)._credential({idToken:t,accessToken:n,nonce:s,pendingToken:i})}catch(e){return null}}}class ys extends ms{constructor(){super("facebook.com")}static credential(e){return us._fromParams({providerId:ys.PROVIDER_ID,signInMethod:ys.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return ys.credentialFromTaggedObject(e)}static credentialFromError(e){return ys.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!(e&&"oauthAccessToken"in e))return null;if(!e.oauthAccessToken)return null;try{return ys.credential(e.oauthAccessToken)}catch(e){return null}}}ys.FACEBOOK_SIGN_IN_METHOD="facebook.com",ys.PROVIDER_ID="facebook.com";class _s extends ms{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return us._fromParams({providerId:_s.PROVIDER_ID,signInMethod:_s.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return _s.credentialFromTaggedObject(e)}static credentialFromError(e){return _s.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;var{oauthIdToken:t,oauthAccessToken:n}=e;if(!t&&!n)return null;try{return _s.credential(t,n)}catch(e){return null}}}_s.GOOGLE_SIGN_IN_METHOD="google.com",_s.PROVIDER_ID="google.com";class ws extends ms{constructor(){super("github.com")}static credential(e){return us._fromParams({providerId:ws.PROVIDER_ID,signInMethod:ws.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return ws.credentialFromTaggedObject(e)}static credentialFromError(e){return ws.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!(e&&"oauthAccessToken"in e))return null;if(!e.oauthAccessToken)return null;try{return ws.credential(e.oauthAccessToken)}catch(e){return null}}}ws.GITHUB_SIGN_IN_METHOD="github.com",ws.PROVIDER_ID="github.com";class bs extends is{constructor(e,t){super(e,e),this.pendingToken=t}_getIdTokenResponse(e){return cs(e,this.buildRequest())}_linkToIdToken(e,t){const n=this.buildRequest();return n.idToken=t,cs(e,n)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,cs(e,t)}toJSON(){return{signInMethod:this.signInMethod,providerId:this.providerId,pendingToken:this.pendingToken}}static fromJSON(e){var{providerId:e,signInMethod:t,pendingToken:n}="string"==typeof e?JSON.parse(e):e;return e&&t&&n&&e===t?new bs(e,n):null}static _create(e,t){return new bs(e,t)}buildRequest(){return{requestUri:"http://localhost",returnSecureToken:!0,pendingToken:this.pendingToken}}}class Is extends gs{constructor(e){v(e.startsWith("saml."),"argument-error"),super(e)}static credentialFromResult(e){return Is.samlCredentialFromTaggedObject(e)}static credentialFromError(e){return Is.samlCredentialFromTaggedObject(e.customData||{})}static credentialFromJSON(e){e=bs.fromJSON(e);return v(e,"argument-error"),e}static samlCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;var{pendingToken:t,providerId:n}=e;if(!t||!n)return null;try{return bs._create(n,t)}catch(e){return null}}}class Ts extends ms{constructor(){super("twitter.com")}static credential(e,t){return us._fromParams({providerId:Ts.PROVIDER_ID,signInMethod:Ts.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return Ts.credentialFromTaggedObject(e)}static credentialFromError(e){return Ts.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;var{oauthAccessToken:t,oauthTokenSecret:n}=e;if(!t||!n)return null;try{return Ts.credential(t,n)}catch(e){return null}}}async function Es(e,t){return Ti(e,"POST","/v1/accounts:signUp",wi(e,t))}Ts.TWITTER_SIGN_IN_METHOD="twitter.com",Ts.PROVIDER_ID="twitter.com";class ks{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,n,r=!1){e=await Li._fromIdTokenResponse(e,n,r),r=Ss(n);return new ks({user:e,providerId:r,_tokenResponse:n,operationType:t})}static async _forOperation(e,t,n){await e._updateTokensIfNecessary(n,!0);var r=Ss(n);return new ks({user:e,providerId:r,_tokenResponse:n,operationType:t})}}function Ss(e){return e.providerId||("phoneNumber"in e?"phone":null)}class Cs extends se{constructor(e,t,n,r){super(t.code,t.message),this.operationType=n,this.user=r,Object.setPrototypeOf(this,Cs.prototype),this.customData={appName:e.name,tenantId:null!=(r=e.tenantId)?r:void 0,_serverResponse:t.customData._serverResponse,operationType:n}}static _fromErrorAndOperation(e,t,n,r){return new Cs(e,t,n,r)}}function As(t,n,e,r){const i="reauthenticate"===n?e._getReauthenticationResolver(t):e._getIdTokenResponse(t);return i.catch(e=>{if("auth/multi-factor-auth-required"===e.code)throw Cs._fromErrorAndOperation(t,e,n,r);throw e})}function Ns(e){return new Set(e.map(({providerId:e})=>e).filter(e=>!!e))}async function Rs(e,t,n=!1){t=await Ri(e,t._linkToIdToken(e.auth,await e.getIdToken()),n);return ks._forOperation(e,"link",t)}async function xs(e,t,n){await Pi(t);const r=Ns(t.providerData);var i=!1===e?"provider-already-linked":"no-such-provider";v(r.has(n)===e,t.auth,i)}async function Ds(e,t,n=!1){var r=e.auth,i="reauthenticate";try{var s=await Ri(e,As(r,i,t,e),n),a=(v(s.idToken,r,"internal-error"),Ni(s.idToken)),o=(v(a,r,"internal-error"),a.sub);return v(e.uid===o,r,"user-mismatch"),ks._forOperation(e,i,s)}catch(e){throw"auth/user-not-found"===(null==e?void 0:e.code)&&ri(r,"user-mismatch"),e}}async function Ps(e,t,n=!1){t=await As(e,"signIn",t),t=await ks._fromIdTokenResponse(e,"signIn",t);return n||await e._updateCurrentUser(t.user),t}async function Os(e,t){return Ps(es(e),t)}async function Ms(e,t){e=_(e);return await xs(!1,e,t.providerId),Rs(e,t)}async function Ls(e,t){return Ds(_(e),t)}class Fs{constructor(e,t){this.factorId=e,this.uid=t.mfaEnrollmentId,this.enrollmentTime=new Date(t.enrolledAt).toUTCString(),this.displayName=t.displayName}static _fromServerResponse(e,t){return"phoneInfo"in t?Us._fromServerResponse(e,t):ri(e,"internal-error")}}class Us extends Fs{constructor(e){super("phone",e),this.phoneNumber=e.phoneInfo}static _fromServerResponse(e,t){return new Us(t)}}function qs(e,t,n){var r;v(0<(null==(r=n.url)?void 0:r.length),e,"invalid-continue-uri"),v(void 0===n.dynamicLinkDomain||0<n.dynamicLinkDomain.length,e,"invalid-dynamic-link-domain"),t.continueUrl=n.url,t.dynamicLinkDomain=n.dynamicLinkDomain,t.canHandleCodeInApp=n.handleCodeInApp,n.iOS&&(v(0<n.iOS.bundleId.length,e,"missing-ios-bundle-id"),t.iOSBundleId=n.iOS.bundleId),n.android&&(v(0<n.android.packageName.length,e,"missing-android-pkg-name"),t.androidInstallApp=n.android.installApp,t.androidMinimumVersionCode=n.android.minimumVersion,t.androidPackageName=n.android.packageName)}async function Vs(e,t){var n=_(e),r=await ss(n,{oobCode:t}),e=r.requestType;switch(v(e,n,"internal-error"),e){case"EMAIL_SIGNIN":break;case"VERIFY_AND_CHANGE_EMAIL":v(r.newEmail,n,"internal-error");break;case"REVERT_SECOND_FACTOR_ADDITION":v(r.mfaInfo,n,"internal-error");default:v(r.email,n,"internal-error")}let i=null;return r.mfaInfo&&(i=Fs._fromServerResponse(es(n),r.mfaInfo)),{data:{email:("VERIFY_AND_CHANGE_EMAIL"===r.requestType?r.newEmail:r.email)||null,previousEmail:("VERIFY_AND_CHANGE_EMAIL"===r.requestType?r.email:r.newEmail)||null,multiFactorInfo:i},operation:e}}async function Bs(e,t,n){var r=e.auth;const i={idToken:await e.getIdToken(),returnSecureToken:!0};t&&(i.email=t),n&&(i.password=n),r=await Ri(e,as(r,i)),await e._updateTokensIfNecessary(r,!0)}class js{constructor(e,t,n={}){this.isNewUser=e,this.providerId=t,this.profile=n}}class Ks extends js{constructor(e,t,n,r){super(e,t,n),this.username=r}}class Ws extends js{constructor(e,t){super(e,"facebook.com",t)}}class zs extends Ks{constructor(e,t){super(e,"github.com",t,"string"==typeof(null==t?void 0:t.login)?null==t?void 0:t.login:null)}}class Gs extends js{constructor(e,t){super(e,"google.com",t)}}class Hs extends Ks{constructor(e,t,n){super(e,"twitter.com",t,n)}}class $s{constructor(e,t,n){this.type=e,this.credential=t,this.auth=n}static _fromIdtoken(e,t){return new $s("enroll",e,t)}static _fromMfaPendingCredential(e){return new $s("signin",e)}toJSON(){return{multiFactorSession:{["enroll"===this.type?"idToken":"pendingCredential"]:this.credential}}}static fromJSON(e){var t;if(null!=e&&e.multiFactorSession){if(null!=(t=e.multiFactorSession)&&t.pendingCredential)return $s._fromMfaPendingCredential(e.multiFactorSession.pendingCredential);if(null!=(t=e.multiFactorSession)&&t.idToken)return $s._fromIdtoken(e.multiFactorSession.idToken)}return null}}class Qs{constructor(e,t,n){this.session=e,this.hints=t,this.signInResolver=n}static _fromError(e,r){const i=es(e),s=r.customData._serverResponse;e=(s.mfaInfo||[]).map(e=>Fs._fromServerResponse(i,e));v(s.mfaPendingCredential,i,"internal-error");const a=$s._fromMfaPendingCredential(s.mfaPendingCredential);return new Qs(a,e,async e=>{var e=await e._process(i,a),t=(delete s.mfaInfo,delete s.mfaPendingCredential,Object.assign(Object.assign({},s),{idToken:e.idToken,refreshToken:e.refreshToken}));switch(r.operationType){case"signIn":var n=await ks._fromIdTokenResponse(i,r.operationType,t);return await i._updateCurrentUser(n.user),n;case"reauthenticate":return v(r.user,i,"internal-error"),ks._forOperation(r.user,r.operationType,t);default:ri(i,"internal-error")}})}async resolveSignIn(e){return this.signInResolver(e)}}class Ys{constructor(t){this.user=t,this.enrolledFactors=[],t._onReload(e=>{e.mfaInfo&&(this.enrolledFactors=e.mfaInfo.map(e=>Fs._fromServerResponse(t.auth,e)))})}static _fromUser(e){return new Ys(e)}async getSession(){return $s._fromIdtoken(await this.user.getIdToken(),this.user.auth)}async enroll(e,t){const n=e;e=await this.getSession(),e=await Ri(this.user,n._process(this.user.auth,e,t));return await this.user._updateTokensIfNecessary(e),this.user.reload()}async unenroll(e){const t="string"==typeof e?e:e.uid;var n,r=await this.user.getIdToken(),r=await Ri(this.user,bi(n=this.user.auth,"POST","/v2/accounts/mfaEnrollment:withdraw",wi(n,e={idToken:r,mfaEnrollmentId:t})));this.enrolledFactors=this.enrolledFactors.filter(({uid:e})=>e!==t),await this.user._updateTokensIfNecessary(r);try{await this.user.reload()}catch(e){if("auth/user-token-expired"!==(null==e?void 0:e.code))throw e}}}const Js=new WeakMap,Xs="__sak";class Zs{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(Xs,"1"),this.storage.removeItem(Xs),Promise.resolve(!0)):Promise.resolve(!1)}catch(e){return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){e=this.storage.getItem(e);return Promise.resolve(e?JSON.parse(e):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}class ea extends Zs{constructor(){var e;super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.safariLocalStorageNotSynced=(Ki(e=d())||Qi(e))&&function(){try{return!(!window||window===window.top)}catch(e){return!1}}(),this.fallbackToPolling=Yi(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const r of Object.keys(this.listeners)){var t=this.storage.getItem(r),n=this.localCache[r];t!==n&&e(r,n,t)}}onStorageEvent(e,t=!1){if(e.key){const i=e.key;if(t?this.detachListener():this.stopPolling(),this.safariLocalStorageNotSynced){var n=this.storage.getItem(i);if(e.newValue!==n)null!==e.newValue?this.storage.setItem(i,e.newValue):this.storage.removeItem(i);else if(this.localCache[i]===e.newValue&&!t)return}var n=()=>{var e=this.storage.getItem(i);!t&&this.localCache[i]===e||this.notifyListeners(i,e)},r=this.storage.getItem(i);$()&&10===document.documentMode&&r!==e.newValue&&e.newValue!==e.oldValue?setTimeout(n,10):n()}else this.forAllChangedKeys((e,t,n)=>{this.notifyListeners(e,n)})}notifyListeners(e,t){this.localCache[e]=t;e=this.listeners[e];if(e)for(const n of Array.from(e))n(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,n)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:n}),!0)})},1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){var t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}ea.type="LOCAL";const ta=ea;class na extends Zs{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}na.type="SESSION";const ra=na;class ia{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(t){var e=this.receivers.find(e=>e.isListeningto(t));return e||(e=new ia(t),this.receivers.push(e),e)}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:n,eventType:r,data:i}=t.data;e=this.handlersMap[r];null!=e&&e.size&&(t.ports[0].postMessage({status:"ack",eventId:n,eventType:r}),e=Array.from(e).map(async e=>e(t.origin,i)),e=await Promise.all(e.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(e){return{fulfilled:!1,reason:e}}})),t.ports[0].postMessage({status:"done",eventId:n,eventType:r,response:e}))}_subscribe(e,t){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),t&&0!==this.handlersMap[e].size||delete this.handlersMap[e],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}function sa(e="",t=10){let n="";for(let e=0;e<t;e++)n+=Math.floor(10*Math.random());return e+n}ia.receivers=[];class aa{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,a=50){const o="undefined"!=typeof MessageChannel?new MessageChannel:null;if(!o)throw new Error("connection_unavailable");let l,c;return new Promise((n,r)=>{const i=sa("",20),s=(o.port1.start(),setTimeout(()=>{r(new Error("unsupported_event"))},a));c={messageChannel:o,onMessage(e){var t=e;if(t.data.eventId===i)switch(t.data.status){case"ack":clearTimeout(s),l=setTimeout(()=>{r(new Error("timeout"))},3e3);break;case"done":clearTimeout(l),n(t.data.response);break;default:clearTimeout(s),clearTimeout(l),r(new Error("invalid_response"))}}},this.handlers.add(c),o.port1.addEventListener("message",c.onMessage),this.target.postMessage({eventType:e,eventId:i,data:t},[o.port2])}).finally(()=>{c&&this.removeMessageHandler(c)})}}function oa(){return window}function la(){return void 0!==oa().WorkerGlobalScope&&"function"==typeof oa().importScripts}const ca="firebaseLocalStorageDb",ua="firebaseLocalStorage";class ha{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function da(e,t){return e.transaction([ua],t?"readwrite":"readonly").objectStore(ua)}function pa(){const r=indexedDB.open(ca,1);return new Promise((n,t)=>{r.addEventListener("error",()=>{t(r.error)}),r.addEventListener("upgradeneeded",()=>{const e=r.result;try{e.createObjectStore(ua,{keyPath:"fbase_key"})}catch(e){t(e)}}),r.addEventListener("success",async()=>{const e=r.result;var t;e.objectStoreNames.contains(ua)?n(e):(e.close(),t=indexedDB.deleteDatabase(ca),await new ha(t).toPromise(),n(await pa()))})})}async function fa(e,t,n){e=da(e,!0).put({fbase_key:t,value:n});return new ha(e).toPromise()}function ga(e,t){e=da(e,!0).delete(t);return new ha(e).toPromise()}class ma{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db||(this.db=await pa(),this.db)}async _withRetries(e){let t=0;for(;;)try{return e(await this._openDb())}catch(e){if(3<t++)throw e;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return la()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=ia._getInstance(la()?self:null),this.receiver._subscribe("keyChanged",async(e,t)=>{const n=await this._poll();return{keyProcessed:n.includes(t.key)}}),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){var e,t;this.activeServiceWorker=await async function(){if(null===navigator||void 0===navigator||!navigator.serviceWorker)return null;try{return(await navigator.serviceWorker.ready).active}catch(e){return null}}(),this.activeServiceWorker&&(this.sender=new aa(this.activeServiceWorker),(t=await this.sender._send("ping",{},800))&&null!=(e=t[0])&&e.fulfilled&&null!=(e=t[0])&&e.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0))}async notifyServiceWorker(e){var t;if(this.sender&&this.activeServiceWorker&&((null==(t=null===navigator||void 0===navigator?void 0:navigator.serviceWorker)?void 0:t.controller)||null)===this.activeServiceWorker)try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch(e){}}async _isAvailable(){try{if(!indexedDB)return!1;var e=await pa();return await fa(e,Xs,"1"),await ga(e,Xs),!0}catch(e){}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(t,n){return this._withPendingWrite(async()=>(await this._withRetries(e=>fa(e,t,n)),this.localCache[t]=n,this.notifyServiceWorker(t)))}async _get(e){var t=await this._withRetries(t=>async function(e){e=da(t,!1).get(e);return void 0===(e=await new ha(e).toPromise())?null:e.value}(e));return this.localCache[e]=t}async _remove(t){return this._withPendingWrite(async()=>(await this._withRetries(e=>ga(e,t)),delete this.localCache[t],this.notifyServiceWorker(t)))}async _poll(){var e,t,n=await this._withRetries(e=>{e=da(e,!1).getAll();return new ha(e).toPromise()});if(!n)return[];if(0!==this.pendingWrites)return[];const r=[],i=new Set;for({fbase_key:e,value:t}of n)i.add(e),JSON.stringify(this.localCache[e])!==JSON.stringify(t)&&(this.notifyListeners(e,t),r.push(e));for(const s of Object.keys(this.localCache))this.localCache[s]&&!i.has(s)&&(this.notifyListeners(s,null),r.push(s));return r}notifyListeners(e,t){this.localCache[e]=t;e=this.listeners[e];if(e)for(const n of Array.from(e))n(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&this.stopPolling()}}ma.type="LOCAL";const va=ma;function ya(r){return new Promise((e,n)=>{const t=document.createElement("script");t.setAttribute("src",r),t.onload=e,t.onerror=e=>{const t=ii("internal-error");t.customData=e,n(t)},t.type="text/javascript",t.charset="UTF-8",(null!=(e=null==(e=document.getElementsByTagName("head"))?void 0:e[0])?e:document).appendChild(t)})}function _a(e){return"__"+e+Math.floor(1e6*Math.random())}class wa{constructor(e){this.auth=e,this.counter=1e12,this._widgets=new Map}render(e,t){var n=this.counter;return this._widgets.set(n,new ba(e,this.auth.name,t||{})),this.counter++,n}reset(e){var t,e=e||1e12;null!=(t=this._widgets.get(e))&&t.delete(),this._widgets.delete(e)}getResponse(e){return(null==(e=this._widgets.get(e||1e12))?void 0:e.getResponse())||""}async execute(e){return null!=(e=this._widgets.get(e||1e12))&&e.execute(),""}}class ba{constructor(e,t,n){this.params=n,this.timerId=null,this.deleted=!1,this.responseToken=null,this.clickHandler=()=>{this.execute()};n="string"==typeof e?document.getElementById(e):e;v(n,"argument-error",{appName:t}),this.container=n,this.isVisible="invisible"!==this.params.size,this.isVisible?this.execute():this.container.addEventListener("click",this.clickHandler)}getResponse(){return this.checkIfDeleted(),this.responseToken}delete(){this.checkIfDeleted(),this.deleted=!0,this.timerId&&(clearTimeout(this.timerId),this.timerId=null),this.container.removeEventListener("click",this.clickHandler)}execute(){this.checkIfDeleted(),this.timerId||(this.timerId=window.setTimeout(()=>{this.responseToken=function(){const t=[],n="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let e=0;e<50;e++)t.push(n.charAt(Math.floor(Math.random()*n.length)));return t.join("")}();const{callback:e,"expired-callback":t}=this.params;if(e)try{e(this.responseToken)}catch(e){}this.timerId=window.setTimeout(()=>{if(this.timerId=null,this.responseToken=null,t)try{t()}catch(e){}this.isVisible&&this.execute()},6e4)},500))}checkIfDeleted(){if(this.deleted)throw new Error("reCAPTCHA mock was already deleted!")}}const Ia=_a("rcb"),Ta=new gi(3e4,6e4);class Ea{constructor(){var e;this.hostLanguage="",this.counter=0,this.librarySeparatelyLoaded=!(null==(e=oa().grecaptcha)||!e.render)}load(s,a=""){return v(a.length<=6&&/^\s*[a-zA-Z0-9\-]*\s*$/.test(a),s,"argument-error"),this.shouldResolveImmediately(a)?Promise.resolve(oa().grecaptcha):new Promise((t,r)=>{const i=oa().setTimeout(()=>{r(ii(s,"network-request-failed"))},Ta.get());oa()[Ia]=()=>{oa().clearTimeout(i),delete oa()[Ia];const e=oa().grecaptcha;if(e){const n=e.render;e.render=(e,t)=>{e=n(e,t);return this.counter++,e},this.hostLanguage=a,t(e)}else r(ii(s,"internal-error"))},ya("https://www.google.com/recaptcha/api.js??"+ve({onload:Ia,render:"explicit",hl:a})).catch(()=>{clearTimeout(i),r(ii(s,"internal-error"))})})}clearedOneInstance(){this.counter--}shouldResolveImmediately(e){var t;return!(null==(t=oa().grecaptcha)||!t.render)&&(e===this.hostLanguage||0<this.counter||this.librarySeparatelyLoaded)}}class ka{async load(e){return new wa(e)}clearedOneInstance(){}}const Sa="recaptcha",Ca={theme:"light",type:"image"};class Aa{constructor(e,t=Object.assign({},Ca),n){this.parameters=t,this.type=Sa,this.destroyed=!1,this.widgetId=null,this.tokenChangeListeners=new Set,this.renderPromise=null,this.recaptcha=null,this.auth=es(n),this.isInvisible="invisible"===this.parameters.size,v("undefined"!=typeof document,this.auth,"operation-not-supported-in-this-environment");t="string"==typeof e?document.getElementById(e):e;v(t,this.auth,"argument-error"),this.container=t,this.parameters.callback=this.makeTokenCallback(this.parameters.callback),this._recaptchaLoader=new(this.auth.settings.appVerificationDisabledForTesting?ka:Ea),this.validateStartingState()}async verify(){this.assertNotDestroyed();const e=await this.render(),r=this.getAssertedRecaptcha();return r.getResponse(e)||new Promise(t=>{const n=e=>{e&&(this.tokenChangeListeners.delete(n),t(e))};this.tokenChangeListeners.add(n),this.isInvisible&&r.execute(e)})}render(){try{this.assertNotDestroyed()}catch(e){return Promise.reject(e)}return this.renderPromise||(this.renderPromise=this.makeRenderPromise().catch(e=>{throw this.renderPromise=null,e}),this.renderPromise)}_reset(){this.assertNotDestroyed(),null!==this.widgetId&&this.getAssertedRecaptcha().reset(this.widgetId)}clear(){this.assertNotDestroyed(),this.destroyed=!0,this._recaptchaLoader.clearedOneInstance(),this.isInvisible||this.container.childNodes.forEach(e=>{this.container.removeChild(e)})}validateStartingState(){v(!this.parameters.sitekey,this.auth,"argument-error"),v(this.isInvisible||!this.container.hasChildNodes(),this.auth,"argument-error"),v("undefined"!=typeof document,this.auth,"operation-not-supported-in-this-environment")}makeTokenCallback(n){return t=>{if(this.tokenChangeListeners.forEach(e=>e(t)),"function"==typeof n)n(t);else if("string"==typeof n){const e=oa()[n];"function"==typeof e&&e(t)}}}assertNotDestroyed(){v(!this.destroyed,this.auth,"internal-error")}async makeRenderPromise(){if(await this.init(),!this.widgetId){let e=this.container;var t;this.isInvisible||(t=document.createElement("div"),e.appendChild(t),e=t),this.widgetId=this.getAssertedRecaptcha().render(e,this.parameters)}return this.widgetId}async init(){v(pi()&&!la(),this.auth,"internal-error"),await function(){let t=null;return new Promise(e=>{"complete"!==document.readyState?(t=()=>e(),window.addEventListener("load",t)):e()}).catch(e=>{throw t&&window.removeEventListener("load",t),e})}(),this.recaptcha=await this._recaptchaLoader.load(this.auth,this.auth.languageCode||void 0);var e=await((await bi(this.auth,"GET","/v1/recaptchaParams")).recaptchaSiteKey||"");v(e,this.auth,"internal-error"),this.parameters.sitekey=e}getAssertedRecaptcha(){return v(this.recaptcha,this.auth,"internal-error"),this.recaptcha}}class Na{constructor(e,t){this.verificationId=e,this.onConfirmation=t}confirm(e){e=ds._fromVerification(this.verificationId,e);return this.onConfirmation(e)}}async function Ra(e,t,n){var r,i,s=await n.verify();try{if(v("string"==typeof s,e,"argument-error"),v(n.type===Sa,e,"argument-error"),"session"in(i="string"==typeof t?{phoneNumber:t}:t)){var a=i.session;if("phoneNumber"in i)return v("enroll"===a.type,e,"internal-error"),(await bi(e,"POST","/v2/accounts/mfaEnrollment:start",wi(e,{idToken:a.credential,phoneEnrollmentInfo:{phoneNumber:i.phoneNumber,recaptchaToken:s}}))).phoneSessionInfo.sessionInfo;v("signin"===a.type,e,"internal-error");var o=(null==(r=i.multiFactorHint)?void 0:r.uid)||i.multiFactorUid;return v(o,e,"missing-multi-factor-info"),(await bi(e,"POST","/v2/accounts/mfaSignIn:start",wi(e,{mfaPendingCredential:a.credential,mfaEnrollmentId:o,phoneSignInInfo:{recaptchaToken:s}}))).phoneResponseInfo.sessionInfo}return(await bi(e,"POST","/v1/accounts:sendVerificationCode",wi(e,{phoneNumber:i.phoneNumber,recaptchaToken:s}))).sessionInfo}finally{n._reset()}}class xa{constructor(e){this.providerId=xa.PROVIDER_ID,this.auth=es(e)}verifyPhoneNumber(e,t){return Ra(this.auth,e,_(t))}static credential(e,t){return ds._fromVerification(e,t)}static credentialFromResult(e){return xa.credentialFromTaggedObject(e)}static credentialFromError(e){return xa.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;var{phoneNumber:e,temporaryProof:t}=e;return e&&t?ds._fromTokenResponse(e,t):null}}function Da(e,t){return t?hi(t):(v(e._popupRedirectResolver,e,"argument-error"),e._popupRedirectResolver)}xa.PROVIDER_ID="phone",xa.PHONE_SIGN_IN_METHOD="phone";class Pa extends is{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return cs(e,this._buildIdpRequest())}_linkToIdToken(e,t){return cs(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return cs(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function Oa(e){return Ps(e.auth,new Pa(e),e.bypassAuthState)}function Ma(e){var{auth:t,user:n}=e;return v(n,t,"internal-error"),Ds(n,new Pa(e),e.bypassAuthState)}async function La(e){var{auth:t,user:n}=e;return v(n,t,"internal-error"),Rs(n,new Pa(e),e.bypassAuthState)}class Fa{constructor(e,t,n,r,i=!1){this.auth=e,this.resolver=n,this.user=r,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(e){this.reject(e)}})}async onAuthEvent(e){var{urlResponse:t,sessionId:n,postBody:r,tenantId:i,error:s,type:a}=e;if(s)this.reject(s);else{r={auth:this.auth,requestUri:t,sessionId:n,tenantId:i||void 0,postBody:r||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(a)(r))}catch(e){this.reject(e)}}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return Oa;case"linkViaPopup":case"linkViaRedirect":return La;case"reauthViaPopup":case"reauthViaRedirect":return Ma;default:ri(this.auth,"internal-error")}}resolve(e){ci(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){ci(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const Ua=new gi(2e3,1e4);class qa extends Fa{constructor(e,t,n,r,i){super(e,t,r,i),this.provider=n,this.authWindow=null,this.pollId=null,qa.currentPopupAction&&qa.currentPopupAction.cancel(),qa.currentPopupAction=this}async executeNotNull(){var e=await this.execute();return v(e,this.auth,"internal-error"),e}async onExecution(){ci(1===this.filter.length,"Popup operations only handle one event");var e=sa();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(e=>{this.reject(e)}),this.resolver._isIframeWebStorageSupported(this.auth,e=>{e||this.reject(ii(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return(null==(e=this.authWindow)?void 0:e.associatedEvent)||null}cancel(){this.reject(ii(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,qa.currentPopupAction=null}pollUserCancellation(){const t=()=>{var e;null!=(e=null==(e=this.authWindow)?void 0:e.window)&&e.closed?this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(ii(this.auth,"popup-closed-by-user"))},2e3):this.pollId=window.setTimeout(t,Ua.get())};t()}}qa.currentPopupAction=null;const Va="pendingRedirect",Ba=new Map;class ja extends Fa{constructor(e,t,n=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,n),this.eventId=null}async execute(){let t=Ba.get(this.auth._key());if(!t){try{const e=await async function(e,t){const n=Ga(t),r=za(e);if(!await r._isAvailable())return!1;t="true"===await r._get(n);return await r._remove(n),t}(this.resolver,this.auth)?await super.execute():null;t=()=>Promise.resolve(e)}catch(e){t=()=>Promise.reject(e)}Ba.set(this.auth._key(),t)}return this.bypassAuthState||Ba.set(this.auth._key(),()=>Promise.resolve(null)),t()}async onAuthEvent(e){if("signInViaRedirect"===e.type)return super.onAuthEvent(e);if("unknown"!==e.type){if(e.eventId){var t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}else this.resolve(null)}async onExecution(){}cleanUp(){}}async function Ka(e,t){return za(e)._set(Ga(t),"true")}function Wa(e,t){Ba.set(e._key(),t)}function za(e){return hi(e._redirectPersistence)}function Ga(e){return qi(Va,e.config.apiKey,e.name)}async function Ha(e,t,n=!1){const r=es(e);e=Da(r,t);const i=new ja(r,e,n),s=await i.execute();return s&&!n&&(delete s.user._redirectEventId,await r._persistUserIfCurrent(s.user),await r._setRedirectUser(null,t)),s}async function $a(e){var t=sa(e.uid+":::");return e._redirectEventId=t,await e.auth._setRedirectUser(e),await e.auth._persistUserIfCurrent(e),t}class Qa{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(t){if(this.hasEventBeenHandled(t))return!1;let n=!1;return this.consumers.forEach(e=>{this.isEventForConsumer(t,e)&&(n=!0,this.sendToConsumer(t,e),this.saveEventToCache(t))}),!this.hasHandledPotentialRedirect&&function(e){switch(e.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return 1;case"unknown":return Ja(e);default:return}}(t)&&(this.hasHandledPotentialRedirect=!0,n||(this.queuedRedirectEvent=t,n=!0)),n}sendToConsumer(e,t){var n;e.error&&!Ja(e)?(n=(null==(n=e.error.code)?void 0:n.split("auth/")[1])||"internal-error",t.onError(ii(this.auth,n))):t.onAuthEvent(e)}isEventForConsumer(e,t){var n=null===t.eventId||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&n}hasEventBeenHandled(e){return 6e5<=Date.now()-this.lastProcessedEventTime&&this.cachedEventUids.clear(),this.cachedEventUids.has(Ya(e))}saveEventToCache(e){this.cachedEventUids.add(Ya(e)),this.lastProcessedEventTime=Date.now()}}function Ya(e){return[e.type,e.eventId,e.sessionId,e.tenantId].filter(e=>e).join("-")}function Ja({type:e,error:t}){return"unknown"===e&&"auth/no-auth-event"===(null==t?void 0:t.code)}async function Xa(e,t={}){return bi(e,"GET","/v1/projects",t)}const Za=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,eo=/^https?/;const to=new gi(3e4,6e4);function no(){const t=oa().___jsl;if(null!==t&&void 0!==t&&t.H)for(const e of Object.keys(t.H))if(t.H[e].r=t.H[e].r||[],t.H[e].L=t.H[e].L||[],t.H[e].r=[...t.H[e].L],t.CP)for(let e=0;e<t.CP.length;e++)t.CP[e]=null}let ro=null;const io=new gi(5e3,15e3),so={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},ao=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);async function oo(a){t=a;const e=await(ro=ro||(i=t,new Promise((e,t)=>{function n(){no(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{no(),t(ii(i,"network-request-failed"))},timeout:to.get()})}if(null!=(r=null==(r=oa().gapi)?void 0:r.iframes)&&r.Iframe)e(gapi.iframes.getContext());else{var r;if(null==(r=oa().gapi)||!r.load)return r=_a("iframefcb"),oa()[r]=()=>{gapi.load?n():t(ii(i,"network-request-failed"))},ya("https://apis.google.com/js/api.js?onload="+r).catch(e=>t(e));n()}}).catch(e=>{throw ro=null,e})));var i,t=oa().gapi;return v(t,a,"internal-error"),e.open({where:document.body,url:function(e){var t=e.config,n=(v(t.authDomain,e,"auth-domain-config-required"),t.emulator?mi(t,"emulator/auth/iframe"):`https://${e.config.authDomain}/__/auth/iframe`);const r={apiKey:t.apiKey,appName:e.name,v:_t},i=((t=ao.get(e.config.apiHost))&&(r.eid=t),e._getFrameworks());return i.length&&(r.fw=i.join(",")),n+"?"+ve(r).slice(1)}(a),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:so,dontclear:!0},s=>new Promise(async(e,t)=>{await s.restyle({setHideOnLeave:!1});const n=ii(a,"network-request-failed"),r=oa().setTimeout(()=>{t(n)},io.get());function i(){oa().clearTimeout(r),e(s)}s.ping(i).then(i,()=>{t(n)})}))}const lo={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class co{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch(e){}}}function uo(e,t,n,r,i,s){v(e.config.authDomain,e,"auth-domain-config-required"),v(e.config.apiKey,e,"invalid-api-key");const a={apiKey:e.config.apiKey,appName:e.name,authType:n,redirectUrl:r,v:_t,eventId:i};if(t instanceof gs){t.setDefaultLanguage(e.languageCode),a.providerId=t.providerId||"",pe(t.getCustomParameters())||(a.customParameters=JSON.stringify(t.getCustomParameters()));for(var[o,l]of Object.entries(s||{}))a[o]=l}if(t instanceof ms){const u=t.getScopes().filter(e=>""!==e);0<u.length&&(a.scopes=u.join(","))}e.tenantId&&(a.tid=e.tenantId);const c=a;for(const h of Object.keys(c))void 0===c[h]&&delete c[h];return`${e=e.config,e.emulator?mi(e,"emulator/auth/handler"):`https://${e.authDomain}/__/auth/handler`}?`+ve(c).slice(1)}const ho="webStorageSupport",po=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=ra,this._completeRedirectFn=Ha,this._overrideRedirectResult=Wa}async _openPopup(t,n,r,i){ci(null==(a=this.eventManagers[t._key()])?void 0:a.manager,"_initialize() not called before _openPopup()");{var[s,a,t,n=500,r=600]=[t,uo(t,n,r,di(),i),sa()],i=Math.max((window.screen.availHeight-r)/2,0).toString(),o=Math.max((window.screen.availWidth-n)/2,0).toString();let e="";const l=Object.assign(Object.assign({},lo),{width:n.toString(),height:r.toString(),top:i,left:o});if(i=d().toLowerCase(),t&&(e=Wi(i)?"_blank":t),ji(i)&&(a=a||"http://localhost",l.scrollbars="yes"),o=Object.entries(l).reduce((e,[t,n])=>""+e+t+`=${n},`,""),[t=d()]=[i],Qi(t)&&null!=(n=window.navigator)&&n.standalone&&"_self"!==e){{r=a||"";i=e;const u=document.createElement("a"),h=(u.href=r,u.target=i,document.createEvent("MouseEvent"));h.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),u.dispatchEvent(h)}return new co(null)}const c=window.open(a||"",e,o);v(c,s,"popup-blocked");try{c.focus()}catch(s){}return new co(c)}}async _openRedirect(e,t,n,r){return await this._originValidation(e),r=uo(e,t,n,di(),r),oa().location.href=r,new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:r,promise:n}=this.eventManagers[t];return r?Promise.resolve(r):(ci(n,"If manager is not set, promise should be"),n)}const n=this.initAndGetManager(e);return this.eventManagers[t]={promise:n},n.catch(()=>{delete this.eventManagers[t]}),n}async initAndGetManager(t){const e=await oo(t),n=new Qa(t);return e.register("authEvent",e=>(v(null==e?void 0:e.authEvent,t,"invalid-auth-event"),{status:n.onEvent(e.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[t._key()]={manager:n},this.iframes[t._key()]=e,n}_isIframeWebStorageSupported(t,n){const e=this.iframes[t._key()];e.send(ho,{type:ho},e=>{e=null==(e=null==e?void 0:e[0])?void 0:e[ho];void 0!==e&&n(!!e),ri(t,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){var t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=async function(e){if(!e.config.emulator){for(const t of(await Xa(e)).authorizedDomains)try{if(function(e){const t=di(),{protocol:n,hostname:r}=new URL(t);var i;if(e.startsWith("chrome-extension://"))return""===(i=new URL(e)).hostname&&""===r?"chrome-extension:"===n&&e.replace("chrome-extension://","")===t.replace("chrome-extension://",""):"chrome-extension:"===n&&i.hostname===r;if(eo.test(n)){if(Za.test(e))return r===e;const s=e.replace(/\./g,"\\."),a=new RegExp("^(.+\\."+s+"|"+s+")$","i");return a.test(r)}}(t))return}catch(e){}ri(e,"unauthorized-domain")}}(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return Yi()||Ki()||Qi()}};class fo extends class{constructor(e){this.factorId=e}_process(e,t,n){switch(t.type){case"enroll":return this._finalizeEnroll(e,t.credential,n);case"signin":return this._finalizeSignIn(e,t.credential);default:return li("unexpected MultiFactorSessionType")}}}{constructor(e){super("phone"),this.credential=e}static _fromCredential(e){return new fo(e)}_finalizeEnroll(e,t,n){return bi(e,"POST","/v2/accounts/mfaEnrollment:finalize",wi(e,n={idToken:t,displayName:n,phoneVerificationInfo:this.credential._makeVerificationRequest()}))}_finalizeSignIn(e,t){return bi(e,"POST","/v2/accounts/mfaSignIn:finalize",wi(e,t={mfaPendingCredential:t,phoneVerificationInfo:this.credential._makeVerificationRequest()}))}}class go{constructor(){}static assertion(e){return fo._fromCredential(e)}}go.FACTOR_ID="phone";var mo,Gn="@firebase/auth",vo="0.20.11";class yo{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),(null==(e=this.auth.currentUser)?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(t){var e;this.assertAuthConfigured(),this.internalListeners.has(t)||(e=this.auth.onIdTokenChanged(e=>{t((null==e?void 0:e.stsTokenManager.accessToken)||null)}),this.internalListeners.set(t,e),this.updateProactiveRefresh())}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){v(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){0<this.internalListeners.size?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}function _o(){return window}null!=(nl=ee())&&nl._authIdTokenMaxAge,mo="Browser",gt(new o("auth",(e,{options:t})=>{var n=e.getProvider("app").getImmediate(),e=e.getProvider("heartbeat");const{apiKey:r,authDomain:i}=n.options;v(r&&!r.includes(":"),"invalid-api-key",{appName:n.name}),v(!(null!==i&&void 0!==i&&i.includes(":")),"argument-error",{appName:n.name});var s={apiKey:r,authDomain:i,clientPlatform:mo,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:Ji(mo)},s=new Zi(n,e,s);{n=s;const a=(null==(e=t)?void 0:e.persistence)||[];t=(Array.isArray(a)?a:[a]).map(hi);null!=e&&e.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(t,null==e?void 0:e.popupRedirectResolver)}return s},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,n)=>{const r=e.getProvider("auth-internal");r.initialize()})),gt(new o("auth-internal",e=>{return e=es(e.getProvider("auth").getImmediate()),new yo(e)},"PRIVATE").setInstantiationMode("EXPLICIT")),r(Gn,vo,void 0),r(Gn,vo,"esm2017");class wo extends Qa{constructor(){super(...arguments),this.passiveListeners=new Set,this.initPromise=new Promise(e=>{this.resolveInialized=e})}addPassiveListener(e){this.passiveListeners.add(e)}removePassiveListener(e){this.passiveListeners.delete(e)}resetRedirect(){this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1}onEvent(t){return this.resolveInialized(),this.passiveListeners.forEach(e=>e(t)),super.onEvent(t)}async initialized(){await this.initPromise}}async function bo(e){var t=await Io()._get(To(e));return t&&await Io()._remove(To(e)),t}function Io(){return hi(ta)}function To(e){return qi("authEvent",e.config.apiKey,e.name)}function Eo(e){if(null==e||!e.includes("?"))return{};const[,...t]=e.split("?");return ye(t.join("?"))}const ko=class{constructor(){this._redirectPersistence=ra,this._shouldInitProactively=!0,this.eventManagers=new Map,this.originValidationPromises={},this._completeRedirectFn=Ha,this._overrideRedirectResult=Wa}async _initialize(e){var t=e._key();let n=this.eventManagers.get(t);return n||(n=new wo(e),this.eventManagers.set(t,n),this.attachCallbackListeners(e,n)),n}_openPopup(e){ri(e,"operation-not-supported-in-this-environment")}async _openRedirect(e,t,n,r){var i=e;v("function"==typeof(null==(a=null==(l=_o())?void 0:l.universalLinks)?void 0:a.subscribe),i,"invalid-cordova-configuration",{missingPlugin:"cordova-universal-links-plugin-fix"}),v(void 0!==(null==(a=null==l?void 0:l.BuildInfo)?void 0:a.packageName),i,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-buildInfo"}),v("function"==typeof(null==(a=null==(a=null==(a=null==l?void 0:l.cordova)?void 0:a.plugins)?void 0:a.browsertab)?void 0:a.openUrl),i,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-browsertab"}),v("function"==typeof(null==(a=null==(a=null==(a=null==l?void 0:l.cordova)?void 0:a.plugins)?void 0:a.browsertab)?void 0:a.isAvailable),i,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-browsertab"}),v("function"==typeof(null==(l=null==(l=null==l?void 0:l.cordova)?void 0:l.InAppBrowser)?void 0:l.open),i,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-inappbrowser"});const s=await this._initialize(e);await s.initialized(),s.resetRedirect(),Ba.clear(),await this._originValidation(e);[a,i,o=null]=[e,n,r];var a,o,l={type:i,eventId:o,urlResponse:null,sessionId:function(){const t=[],n="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let e=0;e<20;e++){var r=Math.floor(Math.random()*n.length);t.push(n.charAt(r))}return t.join("")}(),postBody:null,tenantId:a.tenantId,error:ii(a,"no-auth-event")};return n=e,r=l,await Io()._set(To(n),r),l=await function(r){const i=_o().cordova;return new Promise(n=>{i.plugins.browsertab.isAvailable(e=>{let t=null;e?i.plugins.browsertab.openUrl(r):t=i.InAppBrowser.open(r,(e=d(),/(iPad|iPhone|iPod).*OS 7_\d/i.test(e)||/(iPad|iPhone|iPod).*OS 8_\d/i.test(e)?"_blank":"_system"),"location=yes"),n(t)})})}(await async function(e,t,n){var r=_o().BuildInfo,i=(ci(t.sessionId,"AuthEvent did not contain a session ID"),await async function(e){const t=function(t){if(ci(/[0-9a-zA-Z]+/.test(t),"Can only convert alpha-numeric strings"),"undefined"!=typeof TextEncoder)return(new TextEncoder).encode(t);const e=new ArrayBuffer(t.length),n=new Uint8Array(e);for(let e=0;e<t.length;e++)n[e]=t.charCodeAt(e);return n}(e),n=await crypto.subtle.digest("SHA-256",t),r=Array.from(new Uint8Array(n));return r.map(e=>e.toString(16).padStart(2,"0")).join("")}(t.sessionId));const s={};return Qi()?s.ibi=r.packageName:Gi()?s.apn=r.packageName:ri(e,"operation-not-supported-in-this-environment"),r.displayName&&(s.appDisplayName=r.displayName),s.sessionId=i,uo(e,n,t.type,void 0,null!=(i=t.eventId)?i:void 0,s)}(e,l,t)),async function(a,o,l){const c=_o().cordova;let u=()=>{};try{await new Promise((n,e)=>{let t=null;function r(){var e;n();const t=null==(e=c.plugins.browsertab)?void 0:e.close;"function"==typeof t&&t(),"function"==typeof(null==l?void 0:l.close)&&l.close()}function i(){t=t||window.setTimeout(()=>{e(ii(a,"redirect-cancelled-by-user"))},2e3)}function s(){"visible"===(null===document||void 0===document?void 0:document.visibilityState)&&i()}o.addPassiveListener(r),document.addEventListener("resume",i,!1),Gi()&&document.addEventListener("visibilitychange",s,!1),u=()=>{o.removePassiveListener(r),document.removeEventListener("resume",i,!1),document.removeEventListener("visibilitychange",s,!1),t&&window.clearTimeout(t)}})}finally{u()}}(e,s,l)}_isIframeWebStorageSupported(e,t){throw new Error("Method not implemented.")}_originValidation(e){var t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=async function(e){var t=_o().BuildInfo;const n={};Qi()?n.iosBundleId=t.packageName:Gi()?n.androidPackageName=t.packageName:ri(e,"operation-not-supported-in-this-environment"),await Xa(e,n)}(e)),this.originValidationPromises[t]}attachCallbackListeners(r,i){const{universalLinks:e,handleOpenURL:t,BuildInfo:n}=_o(),s=setTimeout(async()=>{await bo(r),i.onEvent(So())},500),a=async e=>{clearTimeout(s);var t=await bo(r);let n=null;t&&null!=e&&e.url&&(n=function(e,t){var n,r,i,s;n=Eo(t),r=Eo(s=n.link?decodeURIComponent(n.link):void 0).link;const a=(n=Eo(i=n.deep_link_id?decodeURIComponent(n.deep_link_id):void 0).link)||i||r||s||t;return a.includes("/__/auth/callback")?(s=(s=null==(s=null==(s=null==(s=(s=Eo(a)).firebaseError?function(e){try{return JSON.parse(e)}catch(e){return null}}(decodeURIComponent(s.firebaseError)):null)?void 0:s.code)?void 0:s.split("auth/"))?void 0:s[1])?ii(s):null)?{type:e.type,eventId:e.eventId,tenantId:e.tenantId,error:s,urlResponse:null,sessionId:null,postBody:null}:{type:e.type,eventId:e.eventId,tenantId:e.tenantId,sessionId:e.sessionId,urlResponse:a,postBody:null}:null}(t,e.url)),i.onEvent(n||So())},o=(void 0!==e&&"function"==typeof e.subscribe&&e.subscribe(null,a),t),l=n.packageName.toLowerCase()+"://";_o().handleOpenURL=async e=>{if(e.toLowerCase().startsWith(l)&&a({url:e}),"function"==typeof o)try{o(e)}catch(e){console.error(e)}}}};function So(){return{type:"unknown",eventId:null,sessionId:null,urlResponse:null,postBody:null,tenantId:null,error:ii("no-auth-event")}}function Co(){var e;return(null==(e=null===self||void 0===self?void 0:self.location)?void 0:e.protocol)||null}function Ao(e=d()){return!("file:"!==Co()&&"ionic:"!==Co()&&"capacitor:"!==Co()||!e.toLowerCase().match(/iphone|ipad|ipod|android/))}function No(){try{const n=self.localStorage;var e=sa();if(n)return n.setItem(e,"1"),n.removeItem(e),t=d(),!($()&&11===(null===document||void 0===document?void 0:document.documentMode)||([t=d()]=[t],/Edge\/\d+/.test(t)))||Y()}catch(e){return Ro()&&Y()}var t;return!1}function Ro(){return"undefined"!=typeof global&&"WorkerGlobalScope"in global&&"importScripts"in global}function xo(){return("http:"===Co()||"https:"===Co()||G()||Ao())&&!(H()||z())&&No()&&!Ro()}function Do(){return Ao()&&"undefined"!=typeof document}const Po={LOCAL:"local",NONE:"none",SESSION:"session"},Oo=v,Mo="persistence";async function Lo(e){await e._initializationPromise;const t=Fo();var n=qi(Mo,e.config.apiKey,e.name);t&&t.setItem(n,e._getPersistence())}function Fo(){var e;try{return(null===(e="undefined"!=typeof window?window:null)?void 0:e.sessionStorage)||null}catch(e){return null}}const Uo=v;class qo{constructor(){this.browserResolver=hi(po),this.cordovaResolver=hi(ko),this.underlyingResolver=null,this._redirectPersistence=ra,this._completeRedirectFn=Ha,this._overrideRedirectResult=Wa}async _initialize(e){return await this.selectUnderlyingResolver(),this.assertedUnderlyingResolver._initialize(e)}async _openPopup(e,t,n,r){return await this.selectUnderlyingResolver(),this.assertedUnderlyingResolver._openPopup(e,t,n,r)}async _openRedirect(e,t,n,r){return await this.selectUnderlyingResolver(),this.assertedUnderlyingResolver._openRedirect(e,t,n,r)}_isIframeWebStorageSupported(e,t){this.assertedUnderlyingResolver._isIframeWebStorageSupported(e,t)}_originValidation(e){return this.assertedUnderlyingResolver._originValidation(e)}get _shouldInitProactively(){return Do()||this.browserResolver._shouldInitProactively}get assertedUnderlyingResolver(){return Uo(this.underlyingResolver,"internal-error"),this.underlyingResolver}async selectUnderlyingResolver(){var e;this.underlyingResolver||(e=await(!!Do()&&new Promise(e=>{const t=setTimeout(()=>{e(!1)},1e3);document.addEventListener("deviceready",()=>{clearTimeout(t),e(!0)})})),this.underlyingResolver=e?this.cordovaResolver:this.browserResolver)}}function Vo(e){return e.unwrap()}function Bo(e){var t=(e instanceof se?e.customData:e)._tokenResponse;if(!t)return null;if(!(e instanceof se)&&"temporaryProof"in t&&"phoneNumber"in t)return xa.credentialFromResult(e);const n=t.providerId;if(!n||n===Wr.PASSWORD)return null;let r;switch(n){case Wr.GOOGLE:r=_s;break;case Wr.FACEBOOK:r=ys;break;case Wr.GITHUB:r=ws;break;case Wr.TWITTER:r=Ts;break;default:var{oauthIdToken:i,oauthAccessToken:s,oauthTokenSecret:a,pendingToken:o,nonce:l}=t;return s||a||i||o?o?n.startsWith("saml.")?bs._create(n,o):us._fromParams({providerId:n,signInMethod:n,pendingToken:o,idToken:i,accessToken:s}):new vs(n).credential({idToken:i,accessToken:s,rawNonce:l}):null}return e instanceof se?r.credentialFromError(e):r.credentialFromResult(e)}function jo(t,e){return e.catch(e=>{throw e instanceof se&&function(e,t){var n,r=null==(n=t.customData)?void 0:n._tokenResponse;if("auth/multi-factor-auth-required"===(null==t?void 0:t.code)){const s=t;s.resolver=new Wo(e,(e=_(e),v((i=t).customData.operationType,e,"argument-error"),v(null==(n=i.customData._serverResponse)?void 0:n.mfaPendingCredential,e,"argument-error"),Qs._fromError(e,i)))}else if(r){var i=Bo(t);const a=t;i&&(a.credential=i,a.tenantId=r.tenantId||void 0,a.email=r.email||void 0,a.phoneNumber=r.phoneNumber||void 0)}}(t,e),e}).then(e=>{var t=e.operationType,n=e.user;return{operationType:t,credential:Bo(e),additionalUserInfo:function(e){var{user:e,_tokenResponse:t}=e;if(e.isAnonymous&&!t)return{providerId:null,isNewUser:!1,profile:null};var n=t;if(!n)return null;var r=n.providerId,i=n.rawUserInfo?JSON.parse(n.rawUserInfo):{},s=n.isNewUser||"identitytoolkit#SignupNewUserResponse"===n.kind;if(!r&&null!=n&&n.idToken){e=null==(e=null==(e=Ni(n.idToken))?void 0:e.firebase)?void 0:e.sign_in_provider;if(e)return e="anonymous"!==e&&"custom"!==e?e:null,new js(s,e)}if(!r)return null;switch(r){case"facebook.com":return new Ws(s,i);case"github.com":return new zs(s,i);case"google.com":return new Gs(s,i);case"twitter.com":return new Hs(s,i,n.screenName||null);case"custom":case"anonymous":return new js(s,null);default:return new js(s,r,i)}}(e),user:zo.getOrCreate(n)}})}async function Ko(t,e){const n=await e;return{verificationId:n.verificationId,confirm:e=>jo(t,n.confirm(e))}}class Wo{constructor(e,t){this.resolver=t,this.auth=e.wrapped()}get session(){return this.resolver.session}get hints(){return this.resolver.hints}resolveSignIn(e){return jo(Vo(this.auth),this.resolver.resolveSignIn(e))}}class zo{constructor(e){this._delegate=e,this.multiFactor=(e=_(e),Js.has(e)||Js.set(e,Ys._fromUser(e)),Js.get(e))}static getOrCreate(e){return zo.USER_MAP.has(e)||zo.USER_MAP.set(e,new zo(e)),zo.USER_MAP.get(e)}delete(){return this._delegate.delete()}reload(){return this._delegate.reload()}toJSON(){return this._delegate.toJSON()}getIdTokenResult(e){return this._delegate.getIdTokenResult(e)}getIdToken(e){return this._delegate.getIdToken(e)}linkAndRetrieveDataWithCredential(e){return this.linkWithCredential(e)}async linkWithCredential(e){return jo(this.auth,Ms(this._delegate,e))}async linkWithPhoneNumber(e,t){return Ko(this.auth,async function(e,t,n){const r=_(e);await xs(!1,r,"phone");e=await Ra(r.auth,t,_(n));return new Na(e,e=>Ms(r,e))}(this._delegate,e,t))}async linkWithPopup(e){return jo(this.auth,async function(e,t,n){e=_(e),ai(e.auth,t,gs),n=Da(e.auth,n);const r=new qa(e.auth,"linkViaPopup",t,n,e);return r.executeNotNull()}(this._delegate,e,qo))}async linkWithRedirect(e){return await Lo(es(this.auth)),i=this._delegate,e=e,t=qo,async function(e,t){var n=_(i);ai(n.auth,e,gs);const r=Da(n.auth,t);await xs(!1,n,e.providerId),await Ka(r,n.auth);t=await $a(n);return r._openRedirect(n.auth,e,"linkViaRedirect",t)}(e,t);var i,t}reauthenticateAndRetrieveDataWithCredential(e){return this.reauthenticateWithCredential(e)}async reauthenticateWithCredential(e){return jo(this.auth,Ls(this._delegate,e))}reauthenticateWithPhoneNumber(n,r){return Ko(this.auth,async function(e){const t=_(e);e=await Ra(t.auth,n,_(r));return new Na(e,e=>Ls(t,e))}(this._delegate))}reauthenticateWithPopup(e){return jo(this.auth,async function(e,t,n){e=_(e),ai(e.auth,t,gs),n=Da(e.auth,n);const r=new qa(e.auth,"reauthViaPopup",t,n,e);return r.executeNotNull()}(this._delegate,e,qo))}async reauthenticateWithRedirect(e){return await Lo(es(this.auth)),i=this._delegate,e=e,t=qo,async function(e,t){var n=_(i);ai(n.auth,e,gs);const r=Da(n.auth,t);await Ka(r,n.auth);t=await $a(n);return r._openRedirect(n.auth,e,"reauthViaRedirect",t)}(e,t);var i,t}sendEmailVerification(e){return async function(e,t){var n=_(e),r={requestType:"VERIFY_EMAIL",idToken:await e.getIdToken()};t&&qs(n.auth,r,t),(r=(await os(n.auth,r)).email)!==e.email&&await e.reload()}(this._delegate,e)}async unlink(e){return await async function(e,t){const n=_(e),r=(await xs(!0,n,t),Ns((await bi(e=n.auth,"POST","/v1/accounts:update",t={idToken:await n.getIdToken(),deleteProvider:[t]})).providerUserInfo||[]));return n.providerData=n.providerData.filter(e=>r.has(e.providerId)),r.has("phone")||(n.phoneNumber=null),await n.auth._persistUserIfCurrent(n),n}(this._delegate,e),this}updateEmail(e){return Bs(_(this._delegate),e,null)}updatePassword(e){return Bs(_(this._delegate),null,e)}updatePhoneNumber(t){return async function(e){await Rs(_(e),t)}(this._delegate)}updateProfile(e){return async function(e,{displayName:t,photoURL:n}){if(void 0!==t||void 0!==n){const i=_(e);var r=await i.getIdToken(),r=await Ri(i,async function(e){return bi(e,"POST","/v1/accounts:update",{idToken:r,displayName:t,photoUrl:n,returnSecureToken:!0})}(i.auth));i.displayName=r.displayName||null,i.photoURL=r.photoUrl||null;const s=i.providerData.find(({providerId:e})=>"password"===e);s&&(s.displayName=i.displayName,s.photoURL=i.photoURL),await i._updateTokensIfNecessary(r)}}(this._delegate,e)}verifyBeforeUpdateEmail(e,t){return async function(e,t,n){var r=_(e),t={requestType:"VERIFY_AND_CHANGE_EMAIL",idToken:await e.getIdToken(),newEmail:t};n&&qs(r.auth,t,n),(t=(await os(r.auth,t)).email)!==e.email&&await e.reload()}(this._delegate,e,t)}get emailVerified(){return this._delegate.emailVerified}get isAnonymous(){return this._delegate.isAnonymous}get metadata(){return this._delegate.metadata}get phoneNumber(){return this._delegate.phoneNumber}get providerData(){return this._delegate.providerData}get refreshToken(){return this._delegate.refreshToken}get tenantId(){return this._delegate.tenantId}get displayName(){return this._delegate.displayName}get email(){return this._delegate.email}get photoURL(){return this._delegate.photoURL}get providerId(){return this._delegate.providerId}get uid(){return this._delegate.uid}get auth(){return this._delegate.auth}}zo.USER_MAP=new WeakMap;const Go=v;class Ho{constructor(n,e){if(this.app=n,e.isInitialized())return this._delegate=e.getImmediate(),void this.linkUnderlyingAuth();var r=n.options.apiKey,t=(Go(r,"invalid-api-key",{appName:n.name}),Go(r,"invalid-api-key",{appName:n.name}),"undefined"!=typeof window?qo:void 0);this._delegate=e.initialize({options:{persistence:function(){const e=function(e,t){const n=Fo();if(!n)return[];e=qi(Mo,e,t);switch(n.getItem(e)){case Po.NONE:return[Ui];case Po.LOCAL:return[va,ra];case Po.SESSION:return[ra];default:return[]}}(r,n.name);if("undefined"==typeof self||e.includes(va)||e.push(va),"undefined"!=typeof window)for(const t of[ta,ra])e.includes(t)||e.push(t);return e.includes(Ui)||e.push(Ui),e}(),popupRedirectResolver:t}}),this._delegate._updateErrorMap(Xr),this.linkUnderlyingAuth()}get emulatorConfig(){return this._delegate.emulatorConfig}get currentUser(){return this._delegate.currentUser?zo.getOrCreate(this._delegate.currentUser):null}get languageCode(){return this._delegate.languageCode}set languageCode(e){this._delegate.languageCode=e}get settings(){return this._delegate.settings}get tenantId(){return this._delegate.tenantId}set tenantId(e){this._delegate.tenantId=e}useDeviceLanguage(){this._delegate.useDeviceLanguage()}signOut(){return this._delegate.signOut()}useEmulator(e,t){{var n=this._delegate;const i=es(n),s=(v(i._canInitEmulator,i,"emulator-config-failed"),v(/^https?:\/\//.test(e),i,"invalid-emulator-scheme"),n=!(null==t||!t.disableWarnings),ns(e));var{host:t,port:e}=function(e){const t=ns(e),n=/(\/\/)?([^?#/]+)/.exec(e.substr(t.length));if(!n)return{host:"",port:null};const r=n[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(r);if(i)return{host:s=i[1],port:rs(r.substr(s.length+1))};var[e,s]=r.split(":");return{host:e,port:rs(s)}}(e);function r(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}return i.config.emulator={url:s+`//${t}${null===e?"":":"+e}/`},i.settings.appVerificationDisabledForTesting=!0,i.emulatorConfig=Object.freeze({host:t,port:e,protocol:s.replace(":",""),options:Object.freeze({disableWarnings:n})}),void(n||("undefined"!=typeof console&&"function"==typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),"undefined"!=typeof window&&"undefined"!=typeof document&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",r):r())))}}applyActionCode(e){return async function(e,t){await bi(e=_(e),"POST","/v1/accounts:update",wi(e,{oobCode:t}))}(this._delegate,e)}checkActionCode(e){return Vs(this._delegate,e)}confirmPasswordReset(t,n){return async function(e){await ss(_(e),{oobCode:t,newPassword:n})}(this._delegate)}async createUserWithEmailAndPassword(n,r){return jo(this._delegate,async function(e){const t=es(e);e=await Es(t,{returnSecureToken:!0,email:n,password:r}),e=await ks._fromIdTokenResponse(t,"signIn",e);return await t._updateCurrentUser(e.user),e}(this._delegate))}fetchProvidersForEmail(e){return this.fetchSignInMethodsForEmail(e)}fetchSignInMethodsForEmail(e){return async function(e,t){var n=pi()?di():"http://localhost";return(await bi(e=_(e),"POST","/v1/accounts:createAuthUri",wi(e,{identifier:t,continueUri:n}))).signinMethods||[]}(this._delegate,e)}isSignInWithEmailLink(e){return this._delegate,"EMAIL_SIGNIN"===(null==(e=ps.parseLink(e))?void 0:e.operation)}async getRedirectResult(){Go(xo(),this._delegate,"operation-not-supported-in-this-environment");t=this._delegate,e=qo,await es(t)._initializationPromise;var e,t=await Ha(t,e,!1);return t?jo(this._delegate,Promise.resolve(t)):{credential:null,user:null}}addFrameworkForLogging(e){es(this._delegate)._logFramework(e)}onAuthStateChanged(e,t,n){var{next:e,error:t,complete:n}=$o(e,t,n);return this._delegate.onAuthStateChanged(e,t,n)}onIdTokenChanged(e,t,n){var{next:e,error:t,complete:n}=$o(e,t,n);return this._delegate.onIdTokenChanged(e,t,n)}sendSignInLinkToEmail(e,t){return async function(e,t,n){e=_(e),t={requestType:"EMAIL_SIGNIN",email:t},v(n.handleCodeInApp,e,"argument-error"),n&&qs(e,t,n),await os(e,t)}(this._delegate,e,t)}sendPasswordResetEmail(e,t){return async function(e,t,n){e=_(e),t={requestType:"PASSWORD_RESET",email:t},n&&qs(e,t,n),await os(e,t)}(this._delegate,e,t||void 0)}async setPersistence(e){var t=this._delegate,n=e;Oo(Object.values(Po).includes(n),t,"invalid-persistence-type"),H()?Oo(n!==Po.SESSION,t,"unsupported-persistence-type"):z()?Oo(n===Po.NONE,t,"unsupported-persistence-type"):Ro()?Oo(n===Po.NONE||n===Po.LOCAL&&Y(),t,"unsupported-persistence-type"):Oo(n===Po.NONE||No(),t,"unsupported-persistence-type");let r;switch(e){case Po.SESSION:r=ra;break;case Po.LOCAL:var i=await hi(va)._isAvailable();r=i?va:ta;break;case Po.NONE:r=Ui;break;default:return ri("argument-error",{appName:this._delegate.name})}return this._delegate.setPersistence(r)}signInAndRetrieveDataWithCredential(e){return this.signInWithCredential(e)}signInAnonymously(){return jo(this._delegate,async function(e){const t=es(e);if(await t._initializationPromise,null!=(e=t.currentUser)&&e.isAnonymous)return new ks({user:t.currentUser,providerId:null,operationType:"signIn"});e=await Es(t,{returnSecureToken:!0}),e=await ks._fromIdTokenResponse(t,"signIn",e,!0);return await t._updateCurrentUser(e.user),e}(this._delegate))}signInWithCredential(e){return jo(this._delegate,Os(this._delegate,e))}signInWithCustomToken(e){return jo(this._delegate,async function(e,t){const n=es(e);return e=await Ti(n,"POST","/v1/accounts:signInWithCustomToken",wi(n,{token:t,returnSecureToken:!0})),e=await ks._fromIdTokenResponse(n,"signIn",e),await n._updateCurrentUser(e.user),e}(this._delegate,e))}signInWithEmailAndPassword(e,t){return jo(this._delegate,Os(_(this._delegate),fs.credential(e,t)))}signInWithEmailLink(e,t){return jo(this._delegate,async function(e,t,n){e=_(e),t=fs.credentialWithLink(t,n||di());return v(t._tenantId===(e.tenantId||null),e,"tenant-id-mismatch"),Os(e,t)}(this._delegate,e,t))}signInWithPhoneNumber(n,r){return Ko(this._delegate,async function(e){const t=es(e);e=await Ra(t,n,_(r));return new Na(e,e=>Os(t,e))}(this._delegate))}async signInWithPopup(e){return Go(xo(),this._delegate,"operation-not-supported-in-this-environment"),jo(this._delegate,async function(e,t,n){var r=es(e),e=(ai(e,t,gs),Da(r,n));const i=new qa(r,"signInViaPopup",t,e);return i.executeNotNull()}(this._delegate,e,qo))}async signInWithRedirect(e){return Go(xo(),this._delegate,"operation-not-supported-in-this-environment"),await Lo(this._delegate),i=this._delegate,e=e,t=qo,async function(e,t){var n=es(i);ai(i,e,gs);const r=Da(n,t);return await Ka(r,n),r._openRedirect(n,e,"signInViaRedirect")}(e,t);var i,t}updateCurrentUser(e){return this._delegate.updateCurrentUser(e)}verifyPasswordResetCode(t){return async function(e){return(await Vs(_(e),t)).data.email}(this._delegate)}unwrap(){return this._delegate}_delete(){return this._delegate._delete()}linkUnderlyingAuth(){this._delegate.wrapped=()=>this}}function $o(e,t,n){let r=e;"function"!=typeof e&&({next:r,error:t,complete:n}=e);const i=r;return{next:e=>i(e&&zo.getOrCreate(e)),error:t,complete:n}}Ho.Persistence=Po;class Qo{constructor(){this.providerId="phone",this._delegate=new xa(Vo(qt.auth()))}static credential(e,t){return xa.credential(e,t)}verifyPhoneNumber(e,t){return this._delegate.verifyPhoneNumber(e,t)}unwrap(){return this._delegate}}Qo.PHONE_SIGN_IN_METHOD=xa.PHONE_SIGN_IN_METHOD,Qo.PROVIDER_ID=xa.PROVIDER_ID;const Yo=v;(nl=qt).INTERNAL.registerComponent(new o("auth-compat",e=>{var t=e.getProvider("app-compat").getImmediate(),e=e.getProvider("auth");return new Ho(t,e)},"PUBLIC").setServiceProps({ActionCodeInfo:{Operation:{EMAIL_SIGNIN:zr,PASSWORD_RESET:Gr,RECOVER_EMAIL:Hr,REVERT_SECOND_FACTOR_ADDITION:$r,VERIFY_AND_CHANGE_EMAIL:Qr,VERIFY_EMAIL:Yr}},EmailAuthProvider:fs,FacebookAuthProvider:ys,GithubAuthProvider:ws,GoogleAuthProvider:_s,OAuthProvider:vs,SAMLAuthProvider:Is,PhoneAuthProvider:Qo,PhoneMultiFactorGenerator:go,RecaptchaVerifier:class{constructor(e,t,n=qt.app()){var r;Yo(null==(r=n.options)?void 0:r.apiKey,"invalid-api-key",{appName:n.name}),this._delegate=new Aa(e,t,n.auth()),this.type=this._delegate.type}clear(){this._delegate.clear()}render(){return this._delegate.render()}verify(){return this._delegate.verify()}},TwitterAuthProvider:Ts,Auth:Ho,AuthCredential:is,Error:se}).setInstantiationMode("LAZY").setMultipleInstances(!1)),nl.registerVersion("@firebase/auth-compat","0.2.24");Gn="@firebase/database",vo="0.13.10";let Jo="";function Xo(e){Jo=e}class Zo{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,t){null==t?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),ce(t))}get(e){e=this.domStorage_.getItem(this.prefixedName_(e));return null==e?null:le(e)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}}class el{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){null==t?delete this.cache_[e]:this.cache_[e]=t}get(e){return he(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}var tl,nl=function(e){try{if("undefined"!=typeof window&&void 0!==window[e]){const t=window[e];return t.setItem("firebase:sentinel","cache"),t.removeItem("firebase:sentinel"),new Zo(t)}}catch(e){}return new el};function rl(e){e=function(n){const r=[];let i=0;for(let t=0;t<n.length;t++){let e=n.charCodeAt(t);var s,a;55296<=e&&e<=56319&&(s=e-55296,t++,y(t<n.length,"Surrogate pair missing trail surrogate."),a=n.charCodeAt(t)-56320,e=65536+(s<<10)+a),e<128?r[i++]=e:(e<2048?r[i++]=e>>6|192:(e<65536?r[i++]=e>>12|224:(r[i++]=e>>18|240,r[i++]=e>>12&63|128),r[i++]=e>>6&63|128),r[i++]=63&e|128)}return r}(e);const t=new we;return t.update(e),e=t.digest(),s.encodeByteArray(e)}const il=nl("localStorage"),sl=nl("sessionStorage"),al=new Be("@firebase/database"),ol=function(){let e=1;return function(){return e++}}(),ll=function(...t){let n="";for(let e=0;e<t.length;e++){var r=t[e];Array.isArray(r)||r&&"object"==typeof r&&"number"==typeof r.length?n+=ll.apply(null,r):n+="object"==typeof r?ce(r):r,n+=" "}return n};let cl=null,ul=!0;function hl(t){return function(...e){yl(t,...e)}}function dl(...e){e="FIREBASE INTERNAL ERROR: "+ll(...e);al.error(e)}function pl(e,t){return e===t?0:e<t?-1:1}function fl(e,t){if(t&&e in t)return t[e];throw new Error("Missing required key ("+e+") in object: "+ce(t))}function gl(t){if("object"!=typeof t||null===t)return ce(t);const n=[];for(const e in t)n.push(e);n.sort();let r="{";for(let e=0;e<n.length;e++)0!==e&&(r+=","),r=(r=r+ce(n[e])+":")+gl(t[n[e]]);return r+="}"}function ml(t,n){var r=t.length;if(r<=n)return[t];const i=[];for(let e=0;e<r;e+=n)e+n>r?i.push(t.substring(e,r)):i.push(t.substring(e,e+n));return i}function vl(e,t){y(!t||!0===e||!1===e,"Can't turn on custom loggers persistently."),!0===e?(al.logLevel=h.VERBOSE,cl=al.log.bind(al),t&&sl.set("logging_enabled",!0)):"function"==typeof e?cl=e:(cl=null,sl.remove("logging_enabled"))}const yl=function(...e){!0===ul&&(ul=!1,null===cl&&!0===sl.get("logging_enabled")&&vl(!0)),cl&&(e=ll.apply(null,e),cl(e))},_l=function(...e){e="FIREBASE FATAL ERROR: "+ll(...e);throw al.error(e),new Error(e)},wl=function(...e){e="FIREBASE WARNING: "+ll(...e);al.warn(e)},bl=function(){"undefined"!=typeof window&&window.location&&window.location.protocol&&-1!==window.location.protocol.indexOf("https:")&&wl("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},Il=function(e){return"number"==typeof e&&(e!=e||e===Number.POSITIVE_INFINITY||e===Number.NEGATIVE_INFINITY)},Tl="[MIN_NAME]",El="[MAX_NAME]",kl=function(e,t){if(e===t)return 0;if(e===Tl||t===El)return-1;if(t===Tl||e===El)return 1;var n=Nl(e),r=Nl(t);return null!==n?null!==r?n-r==0?e.length-t.length:n-r:-1:null===r&&e<t?-1:1};function Sl(e,t){for(const n in e)e.hasOwnProperty(n)&&t(n,e[n])}function Cl(e){y(!Il(e),"Invalid JSON number");let t,n,r,i,s;0===e?(n=0,r=0,t=1/e==-1/0?1:0):(t=e<0,e=Math.abs(e),r=e>=Math.pow(2,-1022)?(i=Math.min(Math.floor(Math.log(e)/Math.LN2),1023),n=i+1023,Math.round(e*Math.pow(2,52-i)-Math.pow(2,52))):(n=0,Math.round(e/Math.pow(2,-1074))));const a=[];for(s=52;s;--s)a.push(r%2?1:0),r=Math.floor(r/2);for(s=11;s;--s)a.push(n%2?1:0),n=Math.floor(n/2);a.push(t?1:0),a.reverse();const o=a.join("");let l="";for(s=0;s<64;s+=8){let e=parseInt(o.substr(s,8),2).toString(16);1===e.length&&(e="0"+e),l+=e}return l.toLowerCase()}function Al(e,t){const n=setTimeout(e,t);return"number"==typeof n&&"undefined"!=typeof Deno&&Deno.unrefTimer?Deno.unrefTimer(n):"object"==typeof n&&n.unref&&n.unref(),n}function Nl(e){if(Rl.test(e)){e=Number(e);if(e>=xl&&e<=Dl)return e}return null}const Rl=new RegExp("^-?(0*)\\d{1,10}$"),xl=-2147483648,Dl=2147483647,Pl=function(e){try{e()}catch(t){setTimeout(()=>{var e=t.stack||"";throw wl("Exception was thrown by user callback.",e),t},Math.floor(0))}};class Ol{constructor(e,t){this.appName_=e,this.appCheckProvider=t,this.appCheck=null==t?void 0:t.getImmediate({optional:!0}),this.appCheck||null!=t&&t.get().then(e=>this.appCheck=e)}getToken(n){return this.appCheck?this.appCheck.getToken(n):new Promise((e,t)=>{setTimeout(()=>{this.appCheck?this.getToken(n).then(e,t):e(null)},0)})}addTokenChangeListener(t){var e;null!=(e=this.appCheckProvider)&&e.get().then(e=>e.addTokenListener(t))}notifyForInvalidToken(){wl(`Provided AppCheck credentials for the app named "${this.appName_}" `+"are invalid. This usually indicates your app was not initialized correctly.")}}class Ml{constructor(e,t,n){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=n,this.auth_=null,this.auth_=n.getImmediate({optional:!0}),this.auth_||n.onInit(e=>this.auth_=e)}getToken(n){return this.auth_?this.auth_.getToken(n).catch(e=>e&&"auth/token-not-initialized"===e.code?(yl("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(e)):new Promise((e,t)=>{setTimeout(()=>{this.auth_?this.getToken(n).then(e,t):e(null)},0)})}addTokenChangeListener(t){this.auth_?this.auth_.addAuthTokenListener(t):this.authProvider_.get().then(e=>e.addAuthTokenListener(t))}removeTokenChangeListener(t){this.authProvider_.get().then(e=>e.removeAuthTokenListener(t))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',wl(e)}}class Ll{constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}}Ll.OWNER="owner";const Fl=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,Ul="websocket",ql="long_polling";class Vl{constructor(e,t,n,r,i=!1,s="",a=!1){this.secure=t,this.namespace=n,this.webSocketOnly=r,this.nodeAdmin=i,this.persistenceKey=s,this.includeNamespaceInQueryParams=a,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=il.get("host:"+e)||this._host}isCacheableHost(){return"s-"===this.internalHost.substr(0,2)}isCustomHost(){return"firebaseio.com"!==this._domain&&"firebaseio-demo.com"!==this._domain}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&il.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){var e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?"?ns="+this.namespace:"";return e+this.host+"/"+t}}function Bl(e,t,n){y("string"==typeof t,"typeof type must == string"),y("object"==typeof n,"typeof params must == object");let r;if(t===Ul)r=(e.secure?"wss://":"ws://")+e.internalHost+"/.ws?";else{if(t!==ql)throw new Error("Unknown connection type: "+t);r=(e.secure?"https://":"http://")+e.internalHost+"/.lp?"}((t=e).host!==t.internalHost||t.isCustomHost()||t.includeNamespaceInQueryParams)&&(n.ns=e.namespace);const i=[];return Sl(n,(e,t)=>{i.push(e+"="+t)}),r+i.join("&")}class jl{constructor(){this.counters_={}}incrementCounter(e,t=1){he(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return u(void 0,this.counters_)}}const Kl={},Wl={};function zl(e){e=e.toString();return Kl[e]||(Kl[e]=new jl),Kl[e]}class Gl{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,t){for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){const n=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let e=0;e<n.length;++e)n[e]&&Pl(()=>{this.onMessage_(n[e])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}class Hl{constructor(e,t,n,r,i,s,a){this.connId=e,this.repoInfo=t,this.applicationId=n,this.appCheckToken=r,this.authToken=i,this.transportSessionId=s,this.lastSessionId=a,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=hl(e),this.stats_=zl(t),this.urlFn=e=>(this.appCheckToken&&(e.ac=this.appCheckToken),Bl(t,ql,e))}open(e,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new Gl(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(3e4));var n=()=>{if(!this.isClosed_){this.scriptTagHolder=new $l((...e)=>{var[t,n,r]=e;if(this.incrementIncomingBytes_(e),this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,"start"===t)this.id=n,this.password=r;else{if("close"!==t)throw new Error("Unrecognized command received: "+t);n?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(n,()=>{this.onClosed_()})):this.onClosed_()}},(...e)=>{var[t,n]=e;this.incrementIncomingBytes_(e),this.myPacketOrderer.handleResponse(t,n)},()=>{this.onClosed_()},this.urlFn);const t={start:"t"};t.ser=Math.floor(1e8*Math.random()),this.scriptTagHolder.uniqueCallbackIdentifier&&(t.cb=this.scriptTagHolder.uniqueCallbackIdentifier),t.v="5",this.transportSessionId&&(t.s=this.transportSessionId),this.lastSessionId&&(t.ls=this.lastSessionId),this.applicationId&&(t.p=this.applicationId),this.appCheckToken&&(t.ac=this.appCheckToken),"undefined"!=typeof location&&location.hostname&&Fl.test(location.hostname)&&(t.r="f");var e=this.urlFn(t);this.log_("Connecting via long-poll to "+e),this.scriptTagHolder.addTag(e,()=>{})}};if("complete"===document.readyState)n();else{let e=!1;const r=function(){document.body?e||(e=!0,n()):setTimeout(r,Math.floor(10))};document.addEventListener?(document.addEventListener("DOMContentLoaded",r,!1),window.addEventListener("load",r,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{"complete"===document.readyState&&r()}),window.attachEvent("onload",r))}}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){Hl.forceAllow_=!0}static forceDisallow(){Hl.forceDisallow_=!0}static isAvailable(){return!!Hl.forceAllow_||!(Hl.forceDisallow_||"undefined"==typeof document||null==document.createElement||"object"==typeof window&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href)||"object"==typeof Windows&&"object"==typeof Windows.UI)}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){e=ce(e);this.bytesSent+=e.length,this.stats_.incrementCounter("bytes_sent",e.length);var t=ml(n(e),1840);for(let e=0;e<t.length;e++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,t.length,t[e]),this.curSegmentNum++}addDisconnectPingFrame(e,t){this.myDisconnFrame=document.createElement("iframe");const n={dframe:"t"};n.id=e,n.pw=t,this.myDisconnFrame.src=this.urlFn(n),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){e=ce(e).length;this.bytesReceived+=e,this.stats_.incrementCounter("bytes_received",e)}}class $l{constructor(t,n,r,e){this.onDisconnect=r,this.urlFn=e,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(1e8*Math.random()),this.sendNewPolls=!0;{this.uniqueCallbackIdentifier=ol(),window["pLPCommand"+this.uniqueCallbackIdentifier]=t,window["pRTLPCB"+this.uniqueCallbackIdentifier]=n,this.myIFrame=$l.createIFrame_();let e="";this.myIFrame.src&&"javascript:"===this.myIFrame.src.substr(0,"javascript:".length)&&(i=document.domain,e='<script>document.domain="'+i+'";<\/script>');var i="<html><body>"+e+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(i),this.myIFrame.doc.close()}catch(r){yl("frame writing exception"),r.stack&&yl(r.stack),yl(r)}}}static createIFrame_(){const t=document.createElement("iframe");if(t.style.display="none",!document.body)throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";document.body.appendChild(t);try{t.contentWindow.document||yl("No IE domain setting required")}catch(e){var n=document.domain;t.src="javascript:void((function(){document.open();document.domain='"+n+"';document.close();})())"}return t.contentDocument?t.doc=t.contentDocument:t.contentWindow?t.doc=t.contentWindow.document:t.document&&(t.doc=t.document),t}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.innerHTML="",setTimeout(()=>{null!==this.myIFrame&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));const e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(0<this.pendingSegs.length?2:1)){this.currentSerial++;const i={};i.id=this.myID,i.pw=this.myPW,i.ser=this.currentSerial;var n=this.urlFn(i);let e="",t=0;for(;0<this.pendingSegs.length&&this.pendingSegs[0].d.length+30+e.length<=1870;){var r=this.pendingSegs.shift();e=e+"&seg"+t+"="+r.seg+"&ts"+t+"="+r.ts+"&d"+t+"="+r.d,t++}return n+=e,this.addLongPollTag_(n,this.currentSerial),!0}return!1}enqueueSegment(e,t,n){this.pendingSegs.push({seg:e,ts:t,d:n}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);const n=()=>{this.outstandingRequests.delete(t),this.newRequest_()},r=setTimeout(n,Math.floor(25e3));this.addTag(e,()=>{clearTimeout(r),n()})}addTag(e,n){setTimeout(()=>{try{if(!this.sendNewPolls)return;const t=this.myIFrame.doc.createElement("script");t.type="text/javascript",t.async=!0,t.src=e,t.onload=t.onreadystatechange=function(){var e=t.readyState;e&&"loaded"!==e&&"complete"!==e||(t.onload=t.onreadystatechange=null,t.parentNode&&t.parentNode.removeChild(t),n())},t.onerror=()=>{yl("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(t)}catch(e){}},Math.floor(1))}}let Ql=null;"undefined"!=typeof MozWebSocket?Ql=MozWebSocket:"undefined"!=typeof WebSocket&&(Ql=WebSocket);class Yl{constructor(e,t,n,r,i,s,a){this.connId=e,this.applicationId=n,this.appCheckToken=r,this.authToken=i,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=hl(this.connId),this.stats_=zl(t),this.connURL=Yl.connectionURL_(t,s,a,r,n),this.nodeAdmin=t.nodeAdmin}static connectionURL_(e,t,n,r,i){const s={v:"5"};return"undefined"!=typeof location&&location.hostname&&Fl.test(location.hostname)&&(s.r="f"),t&&(s.s=t),n&&(s.ls=n),r&&(s.ac=r),i&&(s.p=i),Bl(e,Ul,s)}open(e,t){this.onDisconnect=t,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,il.set("previous_websocket_failure",!0);try{Q(),this.mySock=new Ql(this.connURL,[],void 0)}catch(e){this.log_("Error instantiating WebSocket.");t=e.message||e.data;return t&&this.log_(t),void this.onClosed_()}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=e=>{this.handleIncomingFrame(e)},this.mySock.onerror=e=>{this.log_("WebSocket error.  Closing connection.");e=e.message||e.data;e&&this.log_(e),this.onClosed_()}}start(){}static forceDisallow(){Yl.forceDisallow_=!0}static isAvailable(){let e=!1;var t;return!(e="undefined"!=typeof navigator&&navigator.userAgent&&(t=navigator.userAgent.match(/Android ([0-9]{0,}\.[0-9]{0,})/))&&1<t.length&&parseFloat(t[1])<4.4?!0:e)&&null!==Ql&&!Yl.forceDisallow_}static previouslyFailed(){return il.isInMemoryStorage||!0===il.get("previous_websocket_failure")}markConnectionHealthy(){il.remove("previous_websocket_failure")}appendFrame_(e){this.frames.push(e),this.frames.length===this.totalFrames&&(e=this.frames.join(""),this.frames=null,e=le(e),this.onMessage(e))}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(e){if(y(null===this.frames,"We already have a frame buffer"),e.length<=6){var t=Number(e);if(!isNaN(t))return this.handleNewFrameCount_(t),null}return this.handleNewFrameCount_(1),e}handleIncomingFrame(e){null!==this.mySock&&(e=e.data,this.bytesReceived+=e.length,this.stats_.incrementCounter("bytes_received",e.length),this.resetKeepAlive(),null===this.frames&&null===(e=this.extractFrameCount_(e))||this.appendFrame_(e))}send(e){this.resetKeepAlive();var e=ce(e),t=(this.bytesSent+=e.length,this.stats_.incrementCounter("bytes_sent",e.length),ml(e,16384));1<t.length&&this.sendString_(String(t.length));for(let e=0;e<t.length;e++)this.sendString_(t[e])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(45e3))}sendString_(e){try{this.mySock.send(e)}catch(e){this.log_("Exception thrown from WebSocket.send():",e.message||e.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}Yl.responsesRequiredToBeHealthy=2,Yl.healthyTimeout=3e4;class Jl{constructor(e){this.initTransports_(e)}static get ALL_TRANSPORTS(){return[Hl,Yl]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}initTransports_(e){var t=Yl&&Yl.isAvailable();let n=t&&!Yl.previouslyFailed();if(e.webSocketOnly&&(t||wl("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),n=!0),n)this.transports_=[Yl];else{const r=this.transports_=[];for(const i of Jl.ALL_TRANSPORTS)i&&i.isAvailable()&&r.push(i);Jl.globalTransportInitialized_=!0}}initialTransport(){if(0<this.transports_.length)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return 1<this.transports_.length?this.transports_[1]:null}}Jl.globalTransportInitialized_=!1;class Xl{constructor(e,t,n,r,i,s,a,o,l,c){this.id=e,this.repoInfo_=t,this.applicationId_=n,this.appCheckToken_=r,this.authToken_=i,this.onMessage_=s,this.onReady_=a,this.onDisconnect_=o,this.onKill_=l,this.lastSessionId=c,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=hl("c:"+this.id+":"),this.transportManager_=new Jl(t),this.log_("Connection created"),this.start_()}start_(){const e=this.transportManager_.initialTransport(),t=(this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0,this.connReceiver_(this.conn_)),n=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(t,n)},Math.floor(0));var r=e.healthyTimeout||0;0<r&&(this.healthyTimeout_=Al(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&102400<this.conn_.bytesReceived?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&10240<this.conn_.bytesSent?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(r)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(t){return e=>{t===this.conn_?this.onConnectionLost_(e):t===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(t){return e=>{2!==this.state_&&(t===this.rx_?this.onPrimaryMessageReceived_(e):t===this.secondaryConn_?this.onSecondaryMessageReceived_(e):this.log_("message on old connection"))}}sendRequest(e){this.sendData_({t:"d",d:e})}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){"t"in e&&("a"===(e=e.t)?this.upgradeIfSecondaryHealthy_():"r"===e?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),this.tx_!==this.secondaryConn_&&this.rx_!==this.secondaryConn_||this.close()):"o"===e&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_()))}onSecondaryMessageReceived_(e){var t=fl("t",e),e=fl("d",e);if("c"===t)this.onSecondaryControl_(e);else{if("d"!==t)throw new Error("Unknown protocol layer: "+t);this.pendingDataMessages.push(e)}}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:"p",d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:"a",d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:"n",d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){var t=fl("t",e),e=fl("d",e);"c"===t?this.onControl_(e):"d"===t&&this.onDataMessage_(e)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){var t=fl("t",e);if("d"in e){e=e.d;if("h"===t)this.onHandshake_(e);else if("n"===t){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let e=0;e<this.pendingDataMessages.length;++e)this.onDataMessage_(this.pendingDataMessages[e]);this.pendingDataMessages=[],this.tryCleanupConnection()}else"s"===t?this.onConnectionShutdown_(e):"r"===t?this.onReset_(e):"e"===t?dl("Server Error: "+e):"o"===t?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):dl("Unknown control packet command: "+t)}}onHandshake_(e){var t=e.ts,n=e.v,r=e.h;this.sessionId=e.s,this.repoInfo_.host=r,0===this.state_&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),"5"!==n&&wl("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){var e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;var e=this.connReceiver_(this.secondaryConn_),t=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(e,t),Al(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(6e4))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,1===this.state_?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),0===this.primaryResponsesRequired_?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):Al(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(5e3))}sendPingOnPrimaryIfNecessary_(){this.isHealthy_||1!==this.state_||(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:"p",d:{}}}))}onSecondaryConnectionLost_(){var e=this.secondaryConn_;this.secondaryConn_=null,this.tx_!==e&&this.rx_!==e||this.close()}onConnectionLost_(e){this.conn_=null,e||0!==this.state_?1===this.state_&&this.log_("Realtime connection lost."):(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(il.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(1!==this.state_)throw"Connection is not connected";this.tx_.send(e)}close(){2!==this.state_&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}class Zl{put(e,t,n,r){}merge(e,t,n,r){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,t,n){}onDisconnectMerge(e,t,n){}onDisconnectCancel(e,t){}reportStats(e){}}class ec{constructor(e){this.allowedEvents_=e,this.listeners_={},y(Array.isArray(e)&&0<e.length,"Requires a non-empty array")}trigger(e,...t){if(Array.isArray(this.listeners_[e])){const n=[...this.listeners_[e]];for(let e=0;e<n.length;e++)n[e].callback.apply(n[e].context,t)}}on(e,t,n){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:n});e=this.getInitialEvent(e);e&&t.apply(n,e)}off(e,t,n){this.validateEventType_(e);const r=this.listeners_[e]||[];for(let e=0;e<r.length;e++)if(r[e].callback===t&&(!n||n===r[e].context))return void r.splice(e,1)}validateEventType_(t){y(this.allowedEvents_.find(e=>e===t),"Unknown event: "+t)}}class tc extends ec{constructor(){super(["online"]),this.online_=!0,"undefined"==typeof window||void 0===window.addEventListener||W()||(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}static getInstance(){return new tc}getInitialEvent(e){return y("online"===e,"Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}class m{constructor(e,t){if(void 0===t){this.pieces_=e.split("/");let t=0;for(let e=0;e<this.pieces_.length;e++)0<this.pieces_[e].length&&(this.pieces_[t]=this.pieces_[e],t++);this.pieces_.length=t,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}toString(){let t="";for(let e=this.pieceNum_;e<this.pieces_.length;e++)""!==this.pieces_[e]&&(t+="/"+this.pieces_[e]);return t||"/"}}function f(){return new m("")}function g(e){return e.pieceNum_>=e.pieces_.length?null:e.pieces_[e.pieceNum_]}function nc(e){return e.pieces_.length-e.pieceNum_}function w(e){let t=e.pieceNum_;return t<e.pieces_.length&&t++,new m(e.pieces_,t)}function rc(e){return e.pieceNum_<e.pieces_.length?e.pieces_[e.pieces_.length-1]:null}function ic(e,t=0){return e.pieces_.slice(e.pieceNum_+t)}function sc(t){if(t.pieceNum_>=t.pieces_.length)return null;const n=[];for(let e=t.pieceNum_;e<t.pieces_.length-1;e++)n.push(t.pieces_[e]);return new m(n,0)}function b(t,n){const r=[];for(let e=t.pieceNum_;e<t.pieces_.length;e++)r.push(t.pieces_[e]);if(n instanceof m)for(let e=n.pieceNum_;e<n.pieces_.length;e++)r.push(n.pieces_[e]);else{var i=n.split("/");for(let e=0;e<i.length;e++)0<i[e].length&&r.push(i[e])}return new m(r,0)}function I(e){return e.pieceNum_>=e.pieces_.length}function ac(e,t){var n=g(e),r=g(t);if(null===n)return t;if(n===r)return ac(w(e),w(t));throw new Error("INTERNAL ERROR: innerPath ("+t+") is not within outerPath ("+e+")")}function oc(e,t){var n=ic(e,0),r=ic(t,0);for(let e=0;e<n.length&&e<r.length;e++){var i=kl(n[e],r[e]);if(0!==i)return i}return n.length===r.length?0:n.length<r.length?-1:1}function lc(n,r){if(nc(n)!==nc(r))return!1;for(let e=n.pieceNum_,t=r.pieceNum_;e<=n.pieces_.length;e++,t++)if(n.pieces_[e]!==r.pieces_[t])return!1;return!0}function cc(e,t){let n=e.pieceNum_,r=t.pieceNum_;if(nc(e)>nc(t))return!1;for(;n<e.pieces_.length;){if(e.pieces_[n]!==t.pieces_[r])return!1;++n,++r}return!0}class uc{constructor(e,t){this.errorPrefix_=t,this.parts_=ic(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let e=0;e<this.parts_.length;e++)this.byteLength_+=Ce(this.parts_[e]);hc(this)}}function hc(e){if(768<e.byteLength_)throw new Error(e.errorPrefix_+"has a key path longer than 768 bytes ("+e.byteLength_+").");if(32<e.parts_.length)throw new Error(e.errorPrefix_+"path specified exceeds the maximum depth that can be written (32) or object contains a cycle "+dc(e))}function dc(e){return 0===e.parts_.length?"":"in property '"+e.parts_.join(".")+"'"}class pc extends ec{constructor(){super(["visible"]);let t,e;"undefined"!=typeof document&&void 0!==document.addEventListener&&(void 0!==document.hidden?(e="visibilitychange",t="hidden"):void 0!==document.mozHidden?(e="mozvisibilitychange",t="mozHidden"):void 0!==document.msHidden?(e="msvisibilitychange",t="msHidden"):void 0!==document.webkitHidden&&(e="webkitvisibilitychange",t="webkitHidden")),this.visible_=!0,e&&document.addEventListener(e,()=>{var e=!document[t];e!==this.visible_&&(this.visible_=e,this.trigger("visible",e))},!1)}static getInstance(){return new pc}getInitialEvent(e){return y("visible"===e,"Unknown event type: "+e),[this.visible_]}}class fc extends Zl{constructor(e,t,n,r,i,s,a,o){if(super(),this.repoInfo_=e,this.applicationId_=t,this.onDataUpdate_=n,this.onConnectStatus_=r,this.onServerInfoUpdate_=i,this.authTokenProvider_=s,this.appCheckTokenProvider_=a,this.authOverride_=o,this.id=fc.nextPersistentConnectionId_++,this.log_=hl("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=1e3,this.maxReconnectDelay_=3e5,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,o&&!Q())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");pc.getInstance().on("visible",this.onVisible_,this),-1===e.host.indexOf("fblocal")&&tc.getInstance().on("online",this.onOnline_,this)}sendRequest(e,t,n){var r=++this.requestNumber_,e={r:r,a:e,b:t};this.log_(ce(e)),y(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(e),n&&(this.requestCBHash_[r]=n)}get(e){this.initConnection_();const n=new re;e={p:e._path.toString(),q:e._queryObject};return this.outstandingGets_.push({action:"g",request:e,onComplete:e=>{var t=e.d;"ok"===e.s?n.resolve(t):n.reject(t)}}),this.outstandingGetCount_++,e=this.outstandingGets_.length-1,this.connected_&&this.sendGet_(e),n.promise}listen(e,t,n,r){this.initConnection_();var i=e._queryIdentifier,s=e._path.toString(),r=(this.log_("Listen called for "+s+" "+i),this.listens.has(s)||this.listens.set(s,new Map),y(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),y(!this.listens.get(s).has(i),"listen() called twice for same path/queryId."),{onComplete:r,hashFn:t,query:e,tag:n});this.listens.get(s).set(i,r),this.connected_&&this.sendListen_(r)}sendGet_(t){const n=this.outstandingGets_[t];this.sendRequest("g",n.request,e=>{delete this.outstandingGets_[t],this.outstandingGetCount_--,0===this.outstandingGetCount_&&(this.outstandingGets_=[]),n.onComplete&&n.onComplete(e)})}sendListen_(r){const i=r.query,s=i._path.toString(),a=i._queryIdentifier,e=(this.log_("Listen on "+s+" for "+a),{p:s});r.tag&&(e.q=i._queryObject,e.t=r.tag),e.h=r.hashFn(),this.sendRequest("q",e,e=>{var t=e.d,n=e.s;fc.warnOnListenWarnings_(t,i),(this.listens.get(s)&&this.listens.get(s).get(a))===r&&(this.log_("listen response",e),"ok"!==n&&this.removeListen_(s,a),r.onComplete&&r.onComplete(n,t))})}static warnOnListenWarnings_(e,t){if(e&&"object"==typeof e&&he(e,"w")){const n=de(e,"w");Array.isArray(n)&&~n.indexOf("no_index")&&(e='".indexOn": "'+t._queryParams.getIndex().toString()+'"',t=t._path.toString(),wl("Using an unspecified index. Your data will be downloaded and "+`filtered on the client. Consider adding ${e} at `+t+" to your security rules for better performance."))}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){(e&&40===e.length||"object"==typeof(e=ue(e).claims)&&!0===e.admin)&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=3e4)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){const n=this.authToken_;var e=function(){const e=ue(n),t=e.claims;return t&&"object"==typeof t&&t.hasOwnProperty("iat")}()?"auth":"gauth";const t={cred:n};null===this.authOverride_?t.noauth=!0:"object"==typeof this.authOverride_&&(t.authvar=this.authOverride_),this.sendRequest(e,t,e=>{var t=e.s,e=e.d||"error";this.authToken_===n&&("ok"===t?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(t,e))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},e=>{var t=e.s,e=e.d||"error";"ok"===t?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(t,e)})}unlisten(e,t){var n=e._path.toString(),r=e._queryIdentifier;this.log_("Unlisten called for "+n+" "+r),y(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(n,r)&&this.connected_&&this.sendUnlisten_(n,r,e._queryObject,t)}sendUnlisten_(e,t,n,r){this.log_("Unlisten on "+e+" for "+t);const i={p:e};r&&(i.q=n,i.t=r),this.sendRequest("n",i)}onDisconnectPut(e,t,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:t,onComplete:n})}onDisconnectMerge(e,t,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:t,onComplete:n})}onDisconnectCancel(e,t){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,t):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:t})}sendOnDisconnect_(e,t,n,r){t={p:t,d:n};this.log_("onDisconnect "+e,t),this.sendRequest(e,t,e=>{r&&setTimeout(()=>{r(e.s,e.d)},Math.floor(0))})}put(e,t,n,r){this.putInternal("p",e,t,n,r)}merge(e,t,n,r){this.putInternal("m",e,t,n,r)}putInternal(e,t,n,r,i){this.initConnection_();const s={p:t,d:n};void 0!==i&&(s.h=i),this.outstandingPuts_.push({action:e,request:s,onComplete:r}),this.outstandingPutCount_++;n=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(n):this.log_("Buffering put: "+t)}sendPut_(t){const n=this.outstandingPuts_[t].action;var e=this.outstandingPuts_[t].request;const r=this.outstandingPuts_[t].onComplete;this.outstandingPuts_[t].queued=this.connected_,this.sendRequest(n,e,e=>{this.log_(n+" response",e),delete this.outstandingPuts_[t],this.outstandingPutCount_--,0===this.outstandingPutCount_&&(this.outstandingPuts_=[]),r&&r(e.s,e.d)})}reportStats(e){this.connected_&&(this.log_("reportStats",e={c:e}),this.sendRequest("s",e,e=>{"ok"!==e.s&&(e=e.d,this.log_("reportStats","Error sending stats: "+e))}))}onDataMessage_(e){if("r"in e){this.log_("from server: "+ce(e));var t=e.r;const n=this.requestCBHash_[t];n&&(delete this.requestCBHash_[t],n(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}}onDataPush_(e,t){this.log_("handleServerMessage",e,t),"d"===e?this.onDataUpdate_(t.p,t.d,!1,t.t):"m"===e?this.onDataUpdate_(t.p,t.d,!0,t.t):"c"===e?this.onListenRevoked_(t.p,t.q):"ac"===e?this.onAuthRevoked_(t.s,t.d):"apc"===e?this.onAppCheckRevoked_(t.s,t.d):"sd"===e?this.onSecurityDebugPacket_(t):dl("Unrecognized action received from server: "+ce(e)+"\nAre you using the latest client?")}onReady_(e,t){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=(new Date).getTime(),this.handleTimestamp_(e),this.lastSessionId=t,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){y(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){var e;this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()&&(this.visible_?this.lastConnectionEstablishedTime_&&(3e4<(new Date).getTime()-this.lastConnectionEstablishedTime_&&(this.reconnectDelay_=1e3),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=(new Date).getTime()),e=(new Date).getTime()-this.lastConnectionAttemptTime_,e=Math.max(0,this.reconnectDelay_-e),e=Math.random()*e,this.log_("Trying to reconnect in "+e+"ms"),this.scheduleConnect_(e),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,1.3*this.reconnectDelay_)),this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=(new Date).getTime(),this.lastConnectionEstablishedTime_=null;var n=this.onDataMessage_.bind(this),r=this.onReady_.bind(this);const u=this.onRealtimeDisconnect_.bind(this);var i=this.id+":"+fc.nextConnectionId_++,s=this.lastSessionId;let e=!1,t=null;var a=function(){t?t.close():(e=!0,u())},o=(this.realtime_={close:a,sendRequest:function(e){y(t,"sendRequest call when we're not connected not allowed."),t.sendRequest(e)}},this.forceTokenRefresh_);this.forceTokenRefresh_=!1;try{var[l,c]=await Promise.all([this.authTokenProvider_.getToken(o),this.appCheckTokenProvider_.getToken(o)]);e?yl("getToken() completed but was canceled"):(yl("getToken() completed. Creating connection."),this.authToken_=l&&l.accessToken,this.appCheckToken_=c&&c.token,t=new Xl(i,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,n,r,u,e=>{wl(e+" ("+this.repoInfo_.toString()+")"),this.interrupt("server_kill")},s))}catch(n){this.log_("Failed to get token: "+n),e||(this.repoInfo_.nodeAdmin&&wl(n),a())}}}interrupt(e){yl("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){yl("Resuming connection for reason: "+e),delete this.interruptReasons_[e],pe(this.interruptReasons_)&&(this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){e-=(new Date).getTime();this.onServerInfoUpdate_({serverTimeOffset:e})}cancelSentTransactions_(){for(let e=0;e<this.outstandingPuts_.length;e++){const t=this.outstandingPuts_[e];t&&"h"in t.request&&t.queued&&(t.onComplete&&t.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}0===this.outstandingPutCount_&&(this.outstandingPuts_=[])}onListenRevoked_(e,t){t=t?t.map(e=>gl(e)).join("$"):"default";const n=this.removeListen_(e,t);n&&n.onComplete&&n.onComplete("permission_denied")}removeListen_(e,t){e=new m(e).toString();let n;if(this.listens.has(e)){const r=this.listens.get(e);n=r.get(t),r.delete(t),0===r.size&&this.listens.delete(e)}else n=void 0;return n}onAuthRevoked_(e,t){yl("Auth token revoked: "+e+"/"+t),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),"invalid_token"!==e&&"permission_denied"!==e||(this.invalidAuthTokenCount_++,3<=this.invalidAuthTokenCount_&&(this.reconnectDelay_=3e4,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,t){yl("App check token revoked: "+e+"/"+t),this.appCheckToken_=null,this.forceTokenRefresh_=!0,"invalid_token"!==e&&"permission_denied"!==e||(this.invalidAppCheckTokenCount_++,3<=this.invalidAppCheckTokenCount_&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace("\n","\nFIREBASE: "))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const t of this.listens.values())for(const n of t.values())this.sendListen_(n);for(let e=0;e<this.outstandingPuts_.length;e++)this.outstandingPuts_[e]&&this.sendPut_(e);for(;this.onDisconnectRequestQueue_.length;){var e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let e=0;e<this.outstandingGets_.length;e++)this.outstandingGets_[e]&&this.sendGet_(e)}sendConnectStats_(){const e={};e["sdk.js."+Jo.replace(/\./g,"-")]=1,W()?e["framework.cordova"]=1:H()&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){var e=tc.getInstance().currentlyOnline();return pe(this.interruptReasons_)&&e}}fc.nextPersistentConnectionId_=0,fc.nextConnectionId_=0;class T{constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new T(e,t)}}class gc{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){e=new T(Tl,e),t=new T(Tl,t);return 0!==this.compare(e,t)}minPost(){return T.MIN}}let mc;class vc extends gc{static get __EMPTY_NODE(){return mc}static set __EMPTY_NODE(e){mc=e}compare(e,t){return kl(e.name,t.name)}isDefinedOn(e){throw K("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return T.MIN}maxPost(){return new T(El,mc)}makePost(e,t){return y("string"==typeof e,"KeyIndex indexValue must always be a string."),new T(e,mc)}toString(){return".key"}}const yc=new vc;class _c{constructor(e,t,n,r,i=null){this.isReverse_=r,this.resultGenerator_=i,this.nodeStack_=[];let s=1;for(;!e.isEmpty();)if(s=t?n(e.key,t):1,r&&(s*=-1),s<0)e=this.isReverse_?e.left:e.right;else{if(0===s){this.nodeStack_.push(e);break}this.nodeStack_.push(e),e=this.isReverse_?e.right:e.left}}getNext(){if(0===this.nodeStack_.length)return null;let e=this.nodeStack_.pop(),t;if(t=this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return t}hasNext(){return 0<this.nodeStack_.length}peek(){if(0===this.nodeStack_.length)return null;var e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}}class wc{constructor(e,t,n,r,i){this.key=e,this.value=t,this.color=null!=n?n:wc.RED,this.left=null!=r?r:bc.EMPTY_NODE,this.right=null!=i?i:bc.EMPTY_NODE}copy(e,t,n,r,i){return new wc(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let r=this;var i=n(e,r.key);return(r=i<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===i?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n))).fixUp_()}removeMin_(){if(this.left.isEmpty())return bc.EMPTY_NODE;let e=this;return(e=(e=e.left.isRed_()||e.left.left.isRed_()?e:e.moveRedLeft_()).copy(null,null,null,e.left.removeMin_(),null)).fixUp_()}remove(e,t){let n,r;if(t(e,(n=this).key)<0)n=(n=n.left.isEmpty()||n.left.isRed_()||n.left.left.isRed_()?n:n.moveRedLeft_()).copy(null,null,null,n.left.remove(e,t),null);else{if(0===t(e,(n=(n=n.left.isRed_()?n.rotateRight_():n).right.isEmpty()||n.right.isRed_()||n.right.left.isRed_()?n:n.moveRedRight_()).key)){if(n.right.isEmpty())return bc.EMPTY_NODE;r=n.right.min_(),n=n.copy(r.key,r.value,null,null,n.right.removeMin_())}n=n.copy(null,null,null,null,n.right.remove(e,t))}return n.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e=(e=(e=e.right.isRed_()&&!e.left.isRed_()?e.rotateLeft_():e).left.isRed_()&&e.left.left.isRed_()?e.rotateRight_():e).left.isRed_()&&e.right.isRed_()?e.colorFlip_():e}moveRedLeft_(){let e=this.colorFlip_();return e=e.right.left.isRed_()?(e=(e=e.copy(null,null,null,null,e.right.rotateRight_())).rotateLeft_()).colorFlip_():e}moveRedRight_(){let e=this.colorFlip_();return e=e.left.left.isRed_()?(e=e.rotateRight_()).colorFlip_():e}rotateLeft_(){var e=this.copy(null,null,wc.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight_(){var e=this.copy(null,null,wc.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip_(){var e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth_(){var e=this.check_();return Math.pow(2,e)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");var e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)}}wc.RED=!0,wc.BLACK=!1;class bc{constructor(e,t=bc.EMPTY_NODE){this.comparator_=e,this.root_=t}insert(e,t){return new bc(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,wc.BLACK,null,null))}remove(e){return new bc(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,wc.BLACK,null,null))}get(e){var t;let n=this.root_;for(;!n.isEmpty();){if(0===(t=this.comparator_(e,n.key)))return n.value;t<0?n=n.left:0<t&&(n=n.right)}return null}getPredecessorKey(e){let t,n=this.root_,r=null;for(;!n.isEmpty();){if(0===(t=this.comparator_(e,n.key))){if(n.left.isEmpty())return r?r.key:null;for(n=n.left;!n.right.isEmpty();)n=n.right;return n.key}t<0?n=n.left:0<t&&(n=(r=n).right)}throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new _c(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new _c(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new _c(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new _c(this.root_,null,this.comparator_,!0,e)}}function Ic(e,t){return kl(e.name,t.name)}function Tc(e,t){return kl(e,t)}bc.EMPTY_NODE=new class{copy(e,t,n,r,i){return this}insert(e,t,n){return new wc(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}};let Ec;function kc(e){return"number"==typeof e?"number:"+Cl(e):"string:"+e}function Sc(e){var t;e.isLeafNode()?(t=e.val(),y("string"==typeof t||"number"==typeof t||"object"==typeof t&&he(t,".sv"),"Priority must be a string or number.")):y(e===Ec||e.isEmpty(),"priority of unexpected type."),y(e===Ec||e.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")}let Cc;class Ac{constructor(e,t=Ac.__childrenNodeConstructor.EMPTY_NODE){this.value_=e,this.priorityNode_=t,this.lazyHash_=null,y(void 0!==this.value_&&null!==this.value_,"LeafNode shouldn't be created with null/undefined value."),Sc(this.priorityNode_)}static set __childrenNodeConstructor(e){Cc=e}static get __childrenNodeConstructor(){return Cc}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(e){return new Ac(this.value_,e)}getImmediateChild(e){return".priority"===e?this.priorityNode_:Ac.__childrenNodeConstructor.EMPTY_NODE}getChild(e){return I(e)?this:".priority"===g(e)?this.priorityNode_:Ac.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,t){return null}updateImmediateChild(e,t){return".priority"===e?this.updatePriority(t):t.isEmpty()&&".priority"!==e?this:Ac.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,t).updatePriority(this.priorityNode_)}updateChild(e,t){var n=g(e);return null===n?t:t.isEmpty()&&".priority"!==n?this:(y(".priority"!==n||1===nc(e),".priority must be the last token in a path"),this.updateImmediateChild(n,Ac.__childrenNodeConstructor.EMPTY_NODE.updateChild(w(e),t)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,t){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(null===this.lazyHash_){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+kc(this.priorityNode_.val())+":");var t=typeof this.value_;e=(e+=t+":")+("number"==t?Cl(this.value_):this.value_),this.lazyHash_=rl(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(e){return e===Ac.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof Ac.__childrenNodeConstructor?-1:(y(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))}compareToLeafNode_(e){var t=typeof e.value_,n=typeof this.value_,r=Ac.VALUE_TYPE_ORDER.indexOf(t),i=Ac.VALUE_TYPE_ORDER.indexOf(n);return y(0<=r,"Unknown leaf type: "+t),y(0<=i,"Unknown leaf type: "+n),r===i?"object"==n?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:i-r}withIndex(){return this}isIndexed(){return!0}equals(e){return e===this||!!e.isLeafNode()&&this.value_===e.value_&&this.priorityNode_.equals(e.priorityNode_)}}Ac.VALUE_TYPE_ORDER=["object","boolean","number","string"];let Nc,Rc;const E=new class extends gc{compare(e,t){const n=e.node.getPriority();var r=t.node.getPriority();return 0===(r=n.compareTo(r))?kl(e.name,t.name):r}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return T.MIN}maxPost(){return new T(El,new Ac("[PRIORITY-POST]",Rc))}makePost(e,t){e=Nc(e);return new T(t,new Ac("[PRIORITY-POST]",e))}toString(){return".priority"}},xc=Math.log(2);class Dc{constructor(e){this.count=parseInt(Math.log(e+1)/xc,10),this.current_=this.count-1;t=this.count;var t=parseInt(Array(t+1).join("1"),2);this.bits_=e+1&t}nextBitIsOne(){var e=!(this.bits_&1<<this.current_);return this.current_--,e}}function Pc(l,e,c,t){l.sort(e);const u=function(e,t){let n,r;if(0==(s=t-e))return null;if(1==s)return n=l[e],r=c?c(n):n,new wc(r,n.node,wc.BLACK,null,null);var i=parseInt(s/2,10)+e,e=u(e,i),s=u(i+1,t);return n=l[i],r=c?c(n):n,new wc(r,n.node,wc.BLACK,e,s)};var n=function(t){let i=null,s=null,a=l.length;function n(e,t){var n=a-e,r=a,e=(a-=e,u(1+n,r)),r=l[n],n=c?c(r):r;n=new wc(n,r.node,t,null,e),i=(i?i.left=n:s=n,n)}for(let e=0;e<t.count;++e){var r=t.nextBitIsOne(),o=Math.pow(2,t.count-(e+1));r?n(o,wc.BLACK):(n(o,wc.BLACK),n(o,wc.RED))}return s}(new Dc(l.length));return new bc(t||e,n)}let Oc;const Mc={};class Lc{constructor(e,t){this.indexes_=e,this.indexSet_=t}static get Default(){return y((Mc,E),"ChildrenNode.ts has not been loaded"),Oc=Oc||new Lc({".priority":Mc},{".priority":E})}get(e){var t=de(this.indexes_,e);if(t)return t instanceof bc?t:null;throw new Error("No index defined for "+e)}hasIndex(e){return he(this.indexSet_,e.toString())}addIndex(e,t){y(e!==yc,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const n=[];let r=!1;const i=t.getIterator(T.Wrap);let s=i.getNext();for(;s;)r=r||e.isDefinedOn(s.node),n.push(s),s=i.getNext();var t=r?Pc(n,e.getCompare()):Mc,a=e.toString();const o=Object.assign({},this.indexSet_),l=(o[a]=e,Object.assign({},this.indexes_));return l[a]=t,new Lc(l,o)}addToIndexes(a,o){var e=fe(this.indexes_,(t,n)=>{const r=de(this.indexSet_,n);if(y(r,"Missing index implementation for "+n),t===Mc){if(r.isDefinedOn(a.node)){const i=[],s=o.getIterator(T.Wrap);let e=s.getNext();for(;e;)e.name!==a.name&&i.push(e),e=s.getNext();return i.push(a),Pc(i,r.getCompare())}return Mc}{n=o.get(a.name);let e=t;return(e=n?e.remove(new T(a.name,n)):e).insert(a,a.node)}});return new Lc(e,this.indexSet_)}removeFromIndexes(n,r){var e=fe(this.indexes_,e=>{if(e===Mc)return e;var t=r.get(n.name);return t?e.remove(new T(n.name,t)):e});return new Lc(e,this.indexSet_)}}let Fc;class k{constructor(e,t,n){this.children_=e,this.priorityNode_=t,this.indexMap_=n,this.lazyHash_=null,this.priorityNode_&&Sc(this.priorityNode_),this.children_.isEmpty()&&y(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}static get EMPTY_NODE(){return Fc=Fc||new k(new bc(Tc),null,Lc.Default)}isLeafNode(){return!1}getPriority(){return this.priorityNode_||Fc}updatePriority(e){return this.children_.isEmpty()?this:new k(this.children_,e,this.indexMap_)}getImmediateChild(e){if(".priority"===e)return this.getPriority();e=this.children_.get(e);return null===e?Fc:e}getChild(e){var t=g(e);return null===t?this:this.getImmediateChild(t).getChild(w(e))}hasChild(e){return null!==this.children_.get(e)}updateImmediateChild(n,r){if(y(r,"We should always be passing snapshot nodes"),".priority"===n)return this.updatePriority(r);{var i=new T(n,r);let e,t;return t=r.isEmpty()?(e=this.children_.remove(n),this.indexMap_.removeFromIndexes(i,this.children_)):(e=this.children_.insert(n,r),this.indexMap_.addToIndexes(i,this.children_)),i=e.isEmpty()?Fc:this.priorityNode_,new k(e,i,t)}}updateChild(e,t){var n=g(e);if(null===n)return t;y(".priority"!==g(e)||1===nc(e),".priority must be the last token in a path");e=this.getImmediateChild(n).updateChild(w(e),t);return this.updateImmediateChild(n,e)}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(n){if(this.isEmpty())return null;const r={};let i=0,s=0,a=!0;if(this.forEachChild(E,(e,t)=>{r[e]=t.val(n),i++,a&&k.INTEGER_REGEXP_.test(e)?s=Math.max(s,Number(e)):a=!1}),!n&&a&&s<2*i){const e=[];for(const t in r)e[t]=r[t];return e}return n&&!this.getPriority().isEmpty()&&(r[".priority"]=this.getPriority().val()),r}hash(){if(null===this.lazyHash_){let n="";this.getPriority().isEmpty()||(n+="priority:"+kc(this.getPriority().val())+":"),this.forEachChild(E,(e,t)=>{t=t.hash();""!==t&&(n+=":"+e+":"+t)}),this.lazyHash_=""===n?"":rl(n)}return this.lazyHash_}getPredecessorChildName(e,t,n){const r=this.resolveIndex_(n);return r?(n=r.getPredecessorKey(new T(e,t)))?n.name:null:this.children_.getPredecessorKey(e)}getFirstChildName(e){const t=this.resolveIndex_(e);return t?(e=t.minKey())&&e.name:this.children_.minKey()}getFirstChild(e){e=this.getFirstChildName(e);return e?new T(e,this.children_.get(e)):null}getLastChildName(e){const t=this.resolveIndex_(e);return t?(e=t.maxKey())&&e.name:this.children_.maxKey()}getLastChild(e){e=this.getLastChildName(e);return e?new T(e,this.children_.get(e)):null}forEachChild(e,t){const n=this.resolveIndex_(e);return n?n.inorderTraversal(e=>t(e.name,e.node)):this.children_.inorderTraversal(t)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(t,n){const e=this.resolveIndex_(n);if(e)return e.getIteratorFrom(t,e=>e);{const r=this.children_.getIteratorFrom(t.name,T.Wrap);let e=r.peek();for(;null!=e&&n.compare(e,t)<0;)r.getNext(),e=r.peek();return r}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(t,n){const e=this.resolveIndex_(n);if(e)return e.getReverseIteratorFrom(t,e=>e);{const r=this.children_.getReverseIteratorFrom(t.name,T.Wrap);let e=r.peek();for(;null!=e&&0<n.compare(e,t);)r.getNext(),e=r.peek();return r}}compareTo(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===qc?-1:0}withIndex(e){if(e===yc||this.indexMap_.hasIndex(e))return this;e=this.indexMap_.addIndex(e,this.children_);return new k(this.children_,this.priorityNode_,e)}isIndexed(e){return e===yc||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode())return!1;{const n=e;if(this.getPriority().equals(n.getPriority())){if(this.children_.count()!==n.children_.count())return!1;{const r=this.getIterator(E),i=n.getIterator(E);let e=r.getNext(),t=i.getNext();for(;e&&t;){if(e.name!==t.name||!e.node.equals(t.node))return!1;e=r.getNext(),t=i.getNext()}return null===e&&null===t}}return!1}}resolveIndex_(e){return e===yc?null:this.indexMap_.get(e.toString())}}k.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;class Uc extends k{constructor(){super(new bc(Tc),k.EMPTY_NODE,Lc.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return k.EMPTY_NODE}isEmpty(){return!1}}const qc=new Uc,Vc=(Object.defineProperties(T,{MIN:{value:new T(Tl,k.EMPTY_NODE)},MAX:{value:new T(El,qc)}}),vc.__EMPTY_NODE=k.EMPTY_NODE,Ac.__childrenNodeConstructor=k,Wp=qc,Ec=Wp,Wp=qc,Rc=Wp,!0);function Bc(i,e=null){if(null===i)return k.EMPTY_NODE;var t;if("object"==typeof i&&".priority"in i&&(e=i[".priority"]),y(null===e||"string"==typeof e||"number"==typeof e||"object"==typeof e&&".sv"in e,"Invalid priority type found: "+typeof e),"object"!=typeof(i="object"==typeof i&&".value"in i&&null!==i[".value"]?i[".value"]:i)||".sv"in i)return t=i,new Ac(t,Bc(e));if(i instanceof Array||!Vc){let r=k.EMPTY_NODE;return Sl(i,(e,t)=>{if(he(i,e)&&"."!==e.substring(0,1)){const n=Bc(t);!n.isLeafNode()&&n.isEmpty()||(r=r.updateImmediateChild(e,n))}}),r.updatePriority(Bc(e))}{const s=[];let r=!1;if(Sl(i,(e,t)=>{if("."!==e.substring(0,1)){const n=Bc(t);n.isEmpty()||(r=r||!n.getPriority().isEmpty(),s.push(new T(e,n)))}}),0===s.length)return k.EMPTY_NODE;var n=Pc(s,Ic,e=>e.name,Tc);return r?(t=Pc(s,E.getCompare()),new k(n,Bc(e),new Lc({".priority":t},{".priority":E}))):new k(n,Bc(e),Lc.Default)}}Nc=Bc;class jc extends gc{constructor(e){super(),this.indexPath_=e,y(!I(e)&&".priority"!==g(e),"Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,t){const n=this.extractChild(e.node);var r=this.extractChild(t.node);return 0===(r=n.compareTo(r))?kl(e.name,t.name):r}makePost(e,t){e=Bc(e),e=k.EMPTY_NODE.updateChild(this.indexPath_,e);return new T(t,e)}maxPost(){var e=k.EMPTY_NODE.updateChild(this.indexPath_,qc);return new T(El,e)}toString(){return ic(this.indexPath_,0).join("/")}}function Kc(t){if(t===""+Dl)return"-";var e=Nl(t);if(null!=e)return""+(e+1);const n=new Array(t.length);for(let e=0;e<n.length;e++)n[e]=t.charAt(e);if(n.length<786)return n.push("-"),n.join("");let r=n.length-1;for(;0<=r&&"z"===n[r];)r--;return-1===r?El:(e=n[r],e=Gc.charAt(Gc.indexOf(e)+1),n[r]=e,n.slice(0,r+1).join(""))}function Wc(t){if(t===""+xl)return Tl;var e=Nl(t);if(null!=e)return""+(e-1);const n=new Array(t.length);for(let e=0;e<n.length;e++)n[e]=t.charAt(e);return"-"===n[n.length-1]?1===n.length?""+Dl:(delete n[n.length-1],n.join("")):(n[n.length-1]=Gc.charAt(Gc.indexOf(n[n.length-1])-1),n.join("")+"z".repeat(786-n.length))}const zc=new class extends gc{compare(e,t){var n=e.node.compareTo(t.node);return 0===n?kl(e.name,t.name):n}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return T.MIN}maxPost(){return T.MAX}makePost(e,t){e=Bc(e);return new T(t,e)}toString(){return".value"}},Gc="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",Hc=function(){let s=0;const a=[];return function(e){var t=e===s;s=e;let n;const r=new Array(8);for(n=7;0<=n;n--)r[n]=Gc.charAt(e%64),e=Math.floor(e/64);y(0===e,"Cannot push at time == 0");let i=r.join("");if(t){for(n=11;0<=n&&63===a[n];n--)a[n]=0;a[n]++}else for(n=0;n<12;n++)a[n]=Math.floor(64*Math.random());for(n=0;n<12;n++)i+=Gc.charAt(a[n]);return y(20===i.length,"nextPushId: Length should be 20."),i}}();function $c(e){return{type:"value",snapshotNode:e}}function Qc(e,t){return{type:"child_added",snapshotNode:t,childName:e}}function Yc(e,t){return{type:"child_removed",snapshotNode:t,childName:e}}function Jc(e,t,n){return{type:"child_changed",snapshotNode:t,childName:e,oldSnap:n}}class Xc{constructor(e){this.index_=e}updateChild(e,t,n,r,i,s){y(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");const a=e.getImmediateChild(t);return a.getChild(r).equals(n.getChild(r))&&a.isEmpty()===n.isEmpty()?e:(null!=s&&(n.isEmpty()?e.hasChild(t)?s.trackChildChange(Yc(t,a)):y(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):a.isEmpty()?s.trackChildChange(Qc(t,n)):s.trackChildChange(Jc(t,n,a))),e.isLeafNode()&&n.isEmpty()?e:e.updateImmediateChild(t,n).withIndex(this.index_))}updateFullNode(r,n,i){return null!=i&&(r.isLeafNode()||r.forEachChild(E,(e,t)=>{n.hasChild(e)||i.trackChildChange(Yc(e,t))}),n.isLeafNode()||n.forEachChild(E,(e,t)=>{if(r.hasChild(e)){const n=r.getImmediateChild(e);n.equals(t)||i.trackChildChange(Jc(e,t,n))}else i.trackChildChange(Qc(e,t))})),n.withIndex(this.index_)}updatePriority(e,t){return e.isEmpty()?k.EMPTY_NODE:e.updatePriority(t)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}class Zc{constructor(e){this.indexedFilter_=new Xc(e.getIndex()),this.index_=e.getIndex(),this.startPost_=Zc.getStartPost_(e),this.endPost_=Zc.getEndPost_(e)}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){return this.index_.compare(this.getStartPost(),e)<=0&&this.index_.compare(e,this.getEndPost())<=0}updateChild(e,t,n,r,i,s){return this.matches(new T(t,n))||(n=k.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,n,r,i,s)}updateFullNode(e,t,n){let r=(t=t.isLeafNode()?k.EMPTY_NODE:t).withIndex(this.index_);r=r.updatePriority(k.EMPTY_NODE);const i=this;return t.forEachChild(E,(e,t)=>{i.matches(new T(e,t))||(r=r.updateImmediateChild(e,k.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,r,n)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){var t;return e.hasStart()?(t=e.getIndexStartName(),e.getIndex().makePost(e.getIndexStartValue(),t)):e.getIndex().minPost()}static getEndPost_(e){var t;return e.hasEnd()?(t=e.getIndexEndName(),e.getIndex().makePost(e.getIndexEndValue(),t)):e.getIndex().maxPost()}}class eu{constructor(e){this.rangedFilter_=new Zc(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft()}updateChild(e,t,n,r,i,s){return this.rangedFilter_.matches(new T(t,n))||(n=k.EMPTY_NODE),e.getImmediateChild(t).equals(n)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,n,r,i,s):this.fullLimitUpdateChild_(e,t,n,i,s)}updateFullNode(e,a,t){let o;if(a.isLeafNode()||a.isEmpty())o=k.EMPTY_NODE.withIndex(this.index_);else if(2*this.limit_<a.numChildren()&&a.isIndexed(this.index_)){o=k.EMPTY_NODE.withIndex(this.index_);let e,t=(e=this.reverse_?a.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):a.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_),0);for(;e.hasNext()&&t<this.limit_;){var n=e.getNext();if(!(this.reverse_?this.index_.compare(this.rangedFilter_.getStartPost(),n)<=0:this.index_.compare(n,this.rangedFilter_.getEndPost())<=0))break;o=o.updateImmediateChild(n.name,n.node),t++}}else{o=(o=a.withIndex(this.index_)).updatePriority(k.EMPTY_NODE);let e,t,n,r;if(this.reverse_){r=o.getReverseIterator(this.index_),e=this.rangedFilter_.getEndPost(),t=this.rangedFilter_.getStartPost();const c=this.index_.getCompare();n=(e,t)=>c(t,e)}else r=o.getIterator(this.index_),e=this.rangedFilter_.getStartPost(),t=this.rangedFilter_.getEndPost(),n=this.index_.getCompare();let i=0,s=!1;for(;r.hasNext();){var l=r.getNext();(s=!s&&n(e,l)<=0?!0:s)&&i<this.limit_&&n(l,t)<=0?i++:o=o.updateImmediateChild(l.name,k.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,o,t)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,t,n,r,i){let s;if(this.reverse_){const d=this.index_.getCompare();s=(e,t)=>d(t,e)}else s=this.index_.getCompare();const a=e;y(a.numChildren()===this.limit_,"");var o=new T(t,n),l=this.reverse_?a.getFirstChild(this.index_):a.getLastChild(this.index_),c=this.rangedFilter_.matches(o);if(a.hasChild(t)){var u=a.getImmediateChild(t);let e=r.getChildAfterChild(this.index_,l,this.reverse_);for(;null!=e&&(e.name===t||a.hasChild(e.name));)e=r.getChildAfterChild(this.index_,e,this.reverse_);var h=null==e?1:s(e,o);if(c&&!n.isEmpty()&&0<=h)return null!=i&&i.trackChildChange(Jc(t,n,u)),a.updateImmediateChild(t,n);{null!=i&&i.trackChildChange(Yc(t,u));const p=a.updateImmediateChild(t,k.EMPTY_NODE);return null!=e&&this.rangedFilter_.matches(e)?(null!=i&&i.trackChildChange(Qc(e.name,e.node)),p.updateImmediateChild(e.name,e.node)):p}}return!n.isEmpty()&&c&&0<=s(l,o)?(null!=i&&(i.trackChildChange(Yc(l.name,l.node)),i.trackChildChange(Qc(t,n))),a.updateImmediateChild(t,n).updateImmediateChild(l.name,k.EMPTY_NODE)):e}}class tu{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=E}hasStart(){return this.startSet_}hasStartAfter(){return this.startAfterSet_}hasEndBefore(){return this.endBeforeSet_}isViewFromLeft(){return""===this.viewFrom_?this.startSet_:"l"===this.viewFrom_}getIndexStartValue(){return y(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return y(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:Tl}hasEnd(){return this.endSet_}getIndexEndValue(){return y(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return y(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:El}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&""!==this.viewFrom_}getLimit(){return y(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===E}copy(){const e=new tu;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function nu(e,t,n){const r=e.copy();return r.startSet_=!0,void 0===t&&(t=null),r.indexStartValue_=t,null!=n?(r.startNameSet_=!0,r.indexStartName_=n):(r.startNameSet_=!1,r.indexStartName_=""),r}function ru(e,t,n){const r=e.copy();return r.endSet_=!0,void 0===t&&(t=null),r.indexEndValue_=t,void 0!==n?(r.endNameSet_=!0,r.indexEndName_=n):(r.endNameSet_=!1,r.indexEndName_=""),r}function iu(e,t){const n=e.copy();return n.index_=t,n}function su(e){const t={};return e.isDefault()||(n=e.index_===E?"$priority":e.index_===zc?"$value":e.index_===yc?"$key":(y(e.index_ instanceof jc,"Unrecognized index type!"),e.index_.toString()),t.orderBy=ce(n),e.startSet_&&(t.startAt=ce(e.indexStartValue_),e.startNameSet_&&(t.startAt+=","+ce(e.indexStartName_))),e.endSet_&&(t.endAt=ce(e.indexEndValue_),e.endNameSet_&&(t.endAt+=","+ce(e.indexEndName_))),e.limitSet_&&(e.isViewFromLeft()?t.limitToFirst=e.limit_:t.limitToLast=e.limit_)),t;var n}function au(t){const n={};if(t.startSet_&&(n.sp=t.indexStartValue_,t.startNameSet_&&(n.sn=t.indexStartName_)),t.endSet_&&(n.ep=t.indexEndValue_,t.endNameSet_&&(n.en=t.indexEndName_)),t.limitSet_){n.l=t.limit_;let e=t.viewFrom_;""===e&&(e=t.isViewFromLeft()?"l":"r"),n.vf=e}return t.index_!==E&&(n.i=t.index_.toString()),n}class ou extends Zl{constructor(e,t,n,r){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=n,this.appCheckTokenProvider_=r,this.log_=hl("p:rest:"),this.listens_={}}reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,t){return void 0!==t?"tag$"+t:(y(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}listen(e,t,r,i){const s=e._path.toString(),a=(this.log_("Listen called for "+s+" "+e._queryIdentifier),ou.getListenId_(e,r)),o={};this.listens_[a]=o;e=su(e._queryParams);this.restRequest_(s+".json",e,(e,t)=>{let n=t;null===(e=404===e?n=null:e)&&this.onDataUpdate_(s,n,!1,r),de(this.listens_,a)===o&&i(e?401===e?"permission_denied":"rest_error:"+e:"ok",null)})}unlisten(e,t){e=ou.getListenId_(e,t);delete this.listens_[e]}get(e){var t=su(e._queryParams);const r=e._path.toString(),i=new re;return this.restRequest_(r+".json",t,(e,t)=>{let n=t;null===(e=404===e?n=null:e)?(this.onDataUpdate_(r,n,!1,null),i.resolve(n)):i.reject(new Error(n))}),i.promise}refreshAuthToken(e){}restRequest_(i,s={},a){return s.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([e,t])=>{e&&e.accessToken&&(s.auth=e.accessToken),t&&t.token&&(s.ac=t.token);const n=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+i+"?ns="+this.repoInfo_.namespace+ve(s),r=(this.log_("Sending REST request for "+n),new XMLHttpRequest);r.onreadystatechange=()=>{if(a&&4===r.readyState){this.log_("REST Response for "+n+" received. status:",r.status,"response:",r.responseText);let e=null;if(200<=r.status&&r.status<300){try{e=le(r.responseText)}catch(e){wl("Failed to parse JSON response for "+n+": "+r.responseText)}a(null,e)}else 401!==r.status&&404!==r.status&&wl("Got unsuccessful REST response for "+n+" Status: "+r.status),a(r.status);a=null}},r.open("GET",n,!0),r.send()})}}class lu{constructor(){this.rootNode_=k.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}}function cu(){return{value:null,children:new Map}}function uu(e,t,n){var r;I(t)?(e.value=n,e.children.clear()):null!==e.value?e.value=e.value.updateChild(t,n):(r=g(t),e.children.has(r)||e.children.set(r,cu()),uu(e.children.get(r),t=w(t),n))}function hu(e,n,r){var i;null!==e.value?r(n,e.value):(i=(e,t)=>{hu(t,new m(n.toString()+"/"+e),r)},e.children.forEach((e,t)=>{i(t,e)}))}class du{constructor(e){this.collection_=e,this.last_=null}get(){var e=this.collection_.get();const n=Object.assign({},e);return this.last_&&Sl(this.last_,(e,t)=>{n[e]=n[e]-t}),this.last_=e,n}}class pu{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new du(e);t=1e4+2e4*Math.random();Al(this.reportStats_.bind(this),Math.floor(t))}reportStats_(){var e=this.statsListener_.get();const n={};let r=!1;Sl(e,(e,t)=>{0<t&&he(this.statsToReport_,e)&&(n[e]=t,r=!0)}),r&&this.server_.reportStats(n),Al(this.reportStats_.bind(this),Math.floor(2*Math.random()*3e5))}}function fu(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function gu(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function mu(e){return{fromUser:!1,fromServer:!0,queryId:e,tagged:!0}}rN=tl={OVERWRITE:0,0:"OVERWRITE",MERGE:1,1:"MERGE",ACK_USER_WRITE:2,2:"ACK_USER_WRITE",LISTEN_COMPLETE:3,3:"LISTEN_COMPLETE"};class vu{constructor(e,t,n){this.path=e,this.affectedTree=t,this.revert=n,this.type=tl.ACK_USER_WRITE,this.source=fu()}operationForChild(e){if(I(this.path)){if(null!=this.affectedTree.value)return y(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;var t=this.affectedTree.subtree(new m(e));return new vu(f(),t,this.revert)}return y(g(this.path)===e,"operationForChild called for unrelated child."),new vu(w(this.path),this.affectedTree,this.revert)}}class yu{constructor(e,t){this.source=e,this.path=t,this.type=tl.LISTEN_COMPLETE}operationForChild(e){return I(this.path)?new yu(this.source,f()):new yu(this.source,w(this.path))}}class _u{constructor(e,t,n){this.source=e,this.path=t,this.snap=n,this.type=tl.OVERWRITE}operationForChild(e){return I(this.path)?new _u(this.source,f(),this.snap.getImmediateChild(e)):new _u(this.source,w(this.path),this.snap)}}class wu{constructor(e,t,n){this.source=e,this.path=t,this.children=n,this.type=tl.MERGE}operationForChild(e){if(I(this.path)){const t=this.children.subtree(new m(e));return t.isEmpty()?null:t.value?new _u(this.source,f(),t.value):new wu(this.source,f(),t)}return y(g(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new wu(this.source,w(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}class bu{constructor(e,t,n){this.node_=e,this.fullyInitialized_=t,this.filtered_=n}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(I(e))return this.isFullyInitialized()&&!this.filtered_;e=g(e);return this.isCompleteForChild(e)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}class Iu{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}}function Tu(r,i,t,e,s,a){const n=e.filter(e=>e.type===t);n.sort((e,t)=>{var n=r;if(null==e.childName||null==t.childName)throw K("Should only compare child_ events.");return e=new T(e.childName,e.snapshotNode),t=new T(t.childName,t.snapshotNode),n.index_.compare(e,t)}),n.forEach(t=>{"value"!==(e=t).type&&"child_removed"!==e.type&&(e.prevName=a.getPredecessorChildName(e.childName,e.snapshotNode,r.index_));const n=e;var e;s.forEach(e=>{e.respondsTo(t.type)&&i.push(e.createEvent(n,r.query_))})})}function Eu(e,t){return{eventCache:e,serverCache:t}}function ku(e,t,n,r){return Eu(new bu(t,n,r),e.serverCache)}function Su(e,t,n,r){return Eu(e.eventCache,new bu(t,n,r))}function Cu(e){return e.eventCache.isFullyInitialized()?e.eventCache.getNode():null}function Au(e){return e.serverCache.isFullyInitialized()?e.serverCache.getNode():null}let Nu;class S{constructor(e,t=(Nu=Nu||new bc(pl),Nu)){this.value=e,this.children=t}static fromObject(e){let n=new S(null);return Sl(e,(e,t)=>{n=n.set(new m(e),t)}),n}isEmpty(){return null===this.value&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(null!=this.value&&t(this.value))return{path:f(),value:this.value};if(I(e))return null;{var n=g(e);const r=this.children.get(n);if(null===r)return null;e=r.findRootMostMatchingPathAndValue(w(e),t);return null==e?null:{path:b(new m(n),e.path),value:e.value}}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(I(e))return this;{var t=g(e);const n=this.children.get(t);return null!==n?n.subtree(w(e)):new S(null)}}set(e,t){if(I(e))return new S(t,this.children);{var n=g(e);const r=this.children.get(n)||new S(null);e=r.set(w(e),t),e=this.children.insert(n,e);return new S(this.value,e)}}remove(t){if(I(t))return this.children.isEmpty()?new S(null):new S(null,this.children);{var n=g(t);const r=this.children.get(n);if(r){const i=r.remove(w(t));let e;return e=i.isEmpty()?this.children.remove(n):this.children.insert(n,i),null===this.value&&e.isEmpty()?new S(null):new S(this.value,e)}return this}}get(e){if(I(e))return this.value;{var t=g(e);const n=this.children.get(t);return n?n.get(w(e)):null}}setTree(e,t){if(I(e))return t;{var n=g(e);const r=this.children.get(n)||new S(null),i=r.setTree(w(e),t);return e=i.isEmpty()?this.children.remove(n):this.children.insert(n,i),new S(this.value,e)}}fold(e){return this.fold_(f(),e)}fold_(n,r){const i={};return this.children.inorderTraversal((e,t)=>{i[e]=t.fold_(b(n,e),r)}),r(n,this.value,i)}findOnPath(e,t){return this.findOnPath_(e,f(),t)}findOnPath_(e,t,n){var r=!!this.value&&n(t,this.value);if(r)return r;if(I(e))return null;{r=g(e);const i=this.children.get(r);return i?i.findOnPath_(w(e),b(t,r),n):null}}foreachOnPath(e,t){return this.foreachOnPath_(e,f(),t)}foreachOnPath_(e,t,n){if(I(e))return this;{this.value&&n(t,this.value);var r=g(e);const i=this.children.get(r);return i?i.foreachOnPath_(w(e),b(t,r),n):new S(null)}}foreach(e){this.foreach_(f(),e)}foreach_(n,r){this.children.inorderTraversal((e,t)=>{t.foreach_(b(n,e),r)}),this.value&&r(n,this.value)}foreachChild(n){this.children.inorderTraversal((e,t)=>{t.value&&n(e,t.value)})}}class Ru{constructor(e){this.writeTree_=e}static empty(){return new Ru(new S(null))}}function xu(t,n,r){if(I(n))return new Ru(new S(r));var i=t.writeTree_.findRootMostValueAndPath(n);if(null==i)return s=new S(r),s=t.writeTree_.setTree(n,s),new Ru(s);{var s=i.path;let e=i.value;return i=ac(s,n),e=e.updateChild(i,r),new Ru(t.writeTree_.set(s,e))}}function Du(e,n,t){let r=e;return Sl(t,(e,t)=>{r=xu(r,b(n,e),t)}),r}function Pu(e,t){if(I(t))return Ru.empty();e=e.writeTree_.setTree(t,new S(null));return new Ru(e)}function Ou(e,t){return null!=Mu(e,t)}function Mu(e,t){var n=e.writeTree_.findRootMostValueAndPath(t);return null!=n?e.writeTree_.get(n.path).getChild(ac(n.path,t)):null}function Lu(e){const n=[],t=e.writeTree_.value;return null!=t?t.isLeafNode()||t.forEachChild(E,(e,t)=>{n.push(new T(e,t))}):e.writeTree_.children.inorderTraversal((e,t)=>{null!=t.value&&n.push(new T(e,t.value))}),n}function Fu(e,t){if(I(t))return e;var n=Mu(e,t);return null!=n?new Ru(new S(n)):new Ru(e.writeTree_.subtree(t))}function Uu(e){return e.writeTree_.isEmpty()}function qu(e,t){return function r(i,e,s){if(null!=e.value)return s.updateChild(i,e.value);{let n=null;return e.children.inorderTraversal((e,t)=>{".priority"===e?(y(null!==t.value,"Priority writes must always be leaf nodes"),n=t.value):s=r(b(i,e),t,s)}),s=s.getChild(i).isEmpty()||null===n?s:s.updateChild(b(i,".priority"),n)}}(f(),e.writeTree_,t)}function Vu(e,t){return Yu(t,e)}function Bu(e){return e.visible}function ju(t,n,r){let i=Ru.empty();for(let e=0;e<t.length;++e){const a=t[e];if(n(a)){var s=a.path;let e;if(a.snap)cc(r,s)?(e=ac(r,s),i=xu(i,e,a.snap)):cc(s,r)&&(e=ac(s,r),i=xu(i,f(),a.snap.getChild(e)));else{if(!a.children)throw K("WriteRecord should have .snap or .children");if(cc(r,s))e=ac(r,s),i=Du(i,e,a.children);else if(cc(s,r))if(I(e=ac(s,r)))i=Du(i,f(),a.children);else{const o=de(a.children,g(e));o&&(s=o.getChild(w(e)),i=xu(i,f(),s))}}}}return i}function Ku(e,t,n,r,i){var s;return r||i?(s=Fu(e.visibleWrites,t),!i&&Uu(s)?n:i||null!=n||Ou(s,f())?qu(ju(e.allWrites,function(e){return(e.visible||i)&&(!r||!~r.indexOf(e.writeId))&&(cc(e.path,t)||cc(t,e.path))},t),n||k.EMPTY_NODE):null):null!=(s=Mu(e.visibleWrites,t))?s:Uu(s=Fu(e.visibleWrites,t))?n:null!=n||Ou(s,f())?qu(s,n||k.EMPTY_NODE):null}function Wu(e,t,n,r){return Ku(e.writeTree,e.treePath,t,n,r)}function zu(e,t){{var r=e.writeTree;e=e.treePath;let n=k.EMPTY_NODE;const i=Mu(r.visibleWrites,e);if(i)return i.isLeafNode()||i.forEachChild(E,(e,t)=>{n=n.updateImmediateChild(e,t)}),n;if(t){const s=Fu(r.visibleWrites,e);return t.forEachChild(E,(e,t)=>{t=qu(Fu(s,new m(e)),t);n=n.updateImmediateChild(e,t)}),Lu(s).forEach(e=>{n=n.updateImmediateChild(e.name,e.node)}),n}return Lu(Fu(r.visibleWrites,e)).forEach(e=>{n=n.updateImmediateChild(e.name,e.node)}),n}}function Gu(e,t,n,r){var i=e.writeTree,e=e.treePath;return y(n||r,"Either existingEventSnap or existingServerSnap must exist"),n=b(e,t),Ou(i.visibleWrites,n)?null:Uu(n=Fu(i.visibleWrites,n))?r.getChild(t):qu(n,r.getChild(t))}function Hu(e,t){return n=e.writeTree,t=b(e.treePath,t),Mu(n.visibleWrites,t);var n}function $u(e,t,n){return r=e.writeTree,e=b(e=e.treePath,t),null!=(i=Mu(r.visibleWrites,e))?i:n.isCompleteForChild(t)?qu(Fu(r.visibleWrites,e),n.getNode().getImmediateChild(t)):null;var r,i}function Qu(e,t){return Yu(b(e.treePath,t),e.writeTree)}function Yu(e,t){return{treePath:e,writeTree:t}}class Ju{constructor(){this.changeMap=new Map}trackChildChange(e){var t=e.type,n=e.childName,r=(y("child_added"===t||"child_changed"===t||"child_removed"===t,"Only child changes supported for tracking"),y(".priority"!==n,"Only non-priority child changes can be tracked."),this.changeMap.get(n));if(r){var i=r.type;if("child_added"===t&&"child_removed"===i)this.changeMap.set(n,Jc(n,e.snapshotNode,r.snapshotNode));else if("child_removed"===t&&"child_added"===i)this.changeMap.delete(n);else if("child_removed"===t&&"child_changed"===i)this.changeMap.set(n,Yc(n,r.oldSnap));else if("child_changed"===t&&"child_added"===i)this.changeMap.set(n,Qc(n,e.snapshotNode));else{if("child_changed"!==t||"child_changed"!==i)throw K("Illegal combination of changes: "+e+" occurred after "+r);this.changeMap.set(n,Jc(n,e.snapshotNode,r.oldSnap))}}else this.changeMap.set(n,e)}getChanges(){return Array.from(this.changeMap.values())}}const Xu=new class{getCompleteChild(e){return null}getChildAfterChild(e,t,n){return null}};class Zu{constructor(e,t,n=null){this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=n}getCompleteChild(e){const t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);var n=null!=this.optCompleteServerCache_?new bu(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return $u(this.writes_,e,n)}getChildAfterChild(e,t,n){var r=null!=this.optCompleteServerCache_?this.optCompleteServerCache_:Au(this.viewCache_);return 0===(r=function(e,n,r,i,s,a){{var o=e.writeTree,l=(e=e.treePath,r),c=i;r=s,i=a;let t;if(o=Fu(o.visibleWrites,e),null!=(e=Mu(o,f())))t=e;else{if(null==n)return[];t=qu(o,n)}if((t=t.withIndex(i)).isEmpty()||t.isLeafNode())return[];{const u=[],h=i.getCompare(),d=r?t.getReverseIteratorFrom(l,i):t.getIteratorFrom(l,i);let e=d.getNext();for(;e&&u.length<c;)0!==h(e,l)&&u.push(e),e=d.getNext();return u}}}(this.writes_,r,t,1,n,e)).length?null:r[0]}}function eh(n,r,i,s,a,o){const l=r.eventCache;if(null!=Hu(s,i))return r;{let e,t;var c,u,h,d;return e=I(i)?(y(r.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),r.serverCache.isFiltered()?(d=zu(s,(d=Au(r))instanceof k?d:k.EMPTY_NODE),n.filter.updateFullNode(r.eventCache.getNode(),d,o)):(c=Wu(s,Au(r)),n.filter.updateFullNode(r.eventCache.getNode(),c,o))):".priority"===(c=g(i))?(y(1===nc(i),"Can't have a priority with additional path components"),null!=(u=Gu(s,i,h=l.getNode(),t=r.serverCache.getNode()))?n.filter.updatePriority(h,u):l.getNode()):(h=w(i),null!=(d=l.isCompleteForChild(c)?(t=r.serverCache.getNode(),null!=(u=Gu(s,i,l.getNode(),t))?l.getNode().getImmediateChild(c).updateChild(h,u):l.getNode().getImmediateChild(c)):$u(s,c,r.serverCache))?n.filter.updateChild(l.getNode(),c,d,h,a,o):l.getNode()),ku(r,e,l.isFullyInitialized()||I(i),n.filter.filtersNodes())}}function th(e,t,n,r,i,s,a,o){const l=t.serverCache;let c;const u=a?e.filter:e.filter.getIndexedFilter();if(I(n))c=u.updateFullNode(l.getNode(),r,null);else if(u.filtersNodes()&&!l.isFiltered()){var h=l.getNode().updateChild(n,r);c=u.updateFullNode(l.getNode(),h,null)}else{a=g(n);if(!l.isCompleteForPath(n)&&1<nc(n))return t;var d=w(n);const p=l.getNode().getImmediateChild(a);h=p.updateChild(d,r),c=".priority"===a?u.updatePriority(l.getNode(),h):u.updateChild(l.getNode(),a,h,d,Xu,null)}return eh(e,d=Su(t,c,l.isFullyInitialized()||I(n),u.filtersNodes()),n,i,new Zu(i,d,s),o)}function nh(t,n,r,i,s,a,o){const l=n.eventCache;let c,e;const u=new Zu(s,n,a);if(I(r))e=t.filter.updateFullNode(n.eventCache.getNode(),i,o),c=ku(n,e,!0,t.filter.filtersNodes());else{s=g(r);if(".priority"===s)e=t.filter.updatePriority(n.eventCache.getNode(),i),c=ku(n,e,l.isFullyInitialized(),l.isFiltered());else{a=w(r);const h=l.getNode().getImmediateChild(s);let e;if(I(a))e=i;else{const d=u.getCompleteChild(s);e=null!=d?".priority"===rc(a)&&d.getChild(sc(a)).isEmpty()?d:d.updateChild(a,i):k.EMPTY_NODE}c=h.equals(e)?n:ku(n,t.filter.updateChild(l.getNode(),s,e,a,u,o),l.isFullyInitialized(),t.filter.filtersNodes())}}return c}function rh(e,t){return e.eventCache.isCompleteForChild(t)}function ih(e,n,t){return t.foreach((e,t)=>{n=n.updateChild(e,t)}),n}function sh(r,i,e,t,s,a,o,l){if(i.serverCache.getNode().isEmpty()&&!i.serverCache.isFullyInitialized())return i;let c=i,n;n=I(e)?t:new S(null).setTree(e,t);const u=i.serverCache.getNode();return n.children.inorderTraversal((e,t)=>{u.hasChild(e)&&(t=ih(0,i.serverCache.getNode().getImmediateChild(e),t),c=th(r,c,new m(e),t,s,a,o,l))}),n.children.inorderTraversal((e,t)=>{var n=!i.serverCache.isCompleteForChild(e)&&null===t.value;u.hasChild(e)||n||(n=ih(0,i.serverCache.getNode().getImmediateChild(e),t),c=th(r,c,new m(e),n,s,a,o,l))}),c}class ah{constructor(e,t){this.query_=e,this.eventRegistrations_=[];const n=this.query_._queryParams,r=new Xc(n.getIndex()),i=(e=n).loadsAllData()?new Xc(e.getIndex()):new(e.hasLimit()?eu:Zc)(e),s=(this.processor_={filter:i},t.serverCache),a=t.eventCache;e=r.updateFullNode(k.EMPTY_NODE,s.getNode(),null),t=i.updateFullNode(k.EMPTY_NODE,a.getNode(),null),e=new bu(e,s.isFullyInitialized(),r.filtersNodes()),t=new bu(t,a.isFullyInitialized(),i.filtersNodes());this.viewCache_=Eu(t,e),this.eventGenerator_=new Iu(this.query_)}get query(){return this.query_}}function oh(e){return 0===e.eventRegistrations_.length}function lh(n,r,t){const i=[];if(t){y(null==r,"A cancel should cancel all event registrations.");const s=n.query._path;n.eventRegistrations_.forEach(e=>{e=e.createCancelEvent(t,s);e&&i.push(e)})}if(r){let t=[];for(let e=0;e<n.eventRegistrations_.length;++e){const a=n.eventRegistrations_[e];if(a.matches(r)){if(r.hasAnyCallback()){t=t.concat(n.eventRegistrations_.slice(e+1));break}}else t.push(a)}n.eventRegistrations_=t}else n.eventRegistrations_=[];return i}function ch(e,t,n,r){t.type===tl.MERGE&&null!==t.source.queryId&&(y(Au(e.viewCache_),"We should always have a full cache before handling merges"),y(Cu(e.viewCache_),"Missing event cache, even though we have a server cache"));const i=e.viewCache_,s=function(e,t,n,r,i){const s=new Ju;let a,o;if(n.type===tl.OVERWRITE){var l=n;a=l.source.fromUser?nh(e,t,l.path,l.snap,r,i,s):(y(l.source.fromServer,"Unknown source."),o=l.source.tagged||t.serverCache.isFiltered()&&!I(l.path),th(e,t,l.path,l.snap,r,i,o,s))}else if(n.type===tl.MERGE)l=n,a=l.source.fromUser?function(n,r,i,e,s,a,o){let l=r;return e.foreach((e,t)=>{e=b(i,e);rh(r,g(e))&&(l=nh(n,l,e,t,s,a,o))}),e.foreach((e,t)=>{e=b(i,e);rh(r,g(e))||(l=nh(n,l,e,t,s,a,o))}),l}(e,t,l.path,l.children,r,i,s):(y(l.source.fromServer,"Unknown source."),o=l.source.tagged||t.serverCache.isFiltered(),sh(e,t,l.path,l.children,r,i,o,s));else if(n.type===tl.ACK_USER_WRITE){var c=n;a=c.revert?function(n,r,i,s,a,o){let l;if(null!=Hu(s,i))return r;{a=new Zu(s,r,a);const u=r.eventCache.getNode();let t;if(I(i)||".priority"===g(i)){var e=r.serverCache.isFullyInitialized()?Wu(s,Au(r)):(c=r.serverCache.getNode(),y(c instanceof k,"serverChildren would be complete if leaf node"),zu(s,c));t=n.filter.updateFullNode(u,e,o)}else{var c=g(i);let e=$u(s,c,r.serverCache);null==e&&r.serverCache.isCompleteForChild(c)&&(e=u.getImmediateChild(c)),(t=null!=e?n.filter.updateChild(u,c,e,w(i),a,o):r.eventCache.getNode().hasChild(c)?n.filter.updateChild(u,c,k.EMPTY_NODE,w(i),a,o):u).isEmpty()&&r.serverCache.isFullyInitialized()&&((l=Wu(s,Au(r))).isLeafNode()&&(t=n.filter.updateFullNode(t,l,o)))}return l=r.serverCache.isFullyInitialized()||null!=Hu(s,f()),ku(r,t,l,n.filter.filtersNodes())}}(e,t,c.path,r,i,s):function(e,t,i,n,s,a,o){if(null!=Hu(s,i))return t;const l=t.serverCache.isFiltered(),c=t.serverCache;if(null!=n.value){if(I(i)&&c.isFullyInitialized()||c.isCompleteForPath(i))return th(e,t,i,c.getNode().getChild(i),s,a,l,o);if(I(i)){let n=new S(null);return c.getNode().forEachChild(yc,(e,t)=>{n=n.set(new m(e),t)}),sh(e,t,i,n,s,a,l,o)}return t}{let r=new S(null);return n.foreach((e,t)=>{var n=b(i,e);c.isCompleteForPath(n)&&(r=r.set(e,c.getNode().getChild(n)))}),sh(e,t,i,r,s,a,l,o)}}(e,t,c.path,c.affectedTree,r,i,s)}else{if(n.type!==tl.LISTEN_COMPLETE)throw K("Unknown operation type: "+n.type);a=function(e,t,n,r,i){const s=t.serverCache,a=Su(t,s.getNode(),s.isFullyInitialized()||I(n),s.isFiltered());return eh(e,a,n,r,Xu,i)}(e,t,n.path,r,s)}c=s.getChanges();{l=t,i=a,e=c;const u=i.eventCache;if(u.isFullyInitialized()){n=u.getNode().isLeafNode()||u.getNode().isEmpty();const h=Cu(l);(0<e.length||!l.eventCache.isFullyInitialized()||n&&!u.getNode().equals(h)||!u.getNode().getPriority().equals(h.getPriority()))&&e.push($c(Cu(i)))}}return{viewCache:a,changes:c}}(e.processor_,i,t,n,r);return n=e.processor_,r=s.viewCache,y(r.eventCache.getNode().isIndexed(n.filter.getIndex()),"Event snap not indexed"),y(r.serverCache.getNode().isIndexed(n.filter.getIndex()),"Server snap not indexed"),y(s.viewCache.serverCache.isFullyInitialized()||!i.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),e.viewCache_=s.viewCache,uh(e,s.changes,s.viewCache.eventCache.getNode(),null)}function uh(e,t,n,r){r=r?[r]:e.eventRegistrations_;{var i=e.eventGenerator_;e=t,t=n,n=r,r=[];const s=[];return e.forEach(e=>{var t;"child_changed"===e.type&&i.index_.indexedValueChanged(e.oldSnap,e.snapshotNode)&&s.push((t=e.childName,{type:"child_moved",snapshotNode:e.snapshotNode,childName:t}))}),Tu(i,r,"child_removed",e,n,t),Tu(i,r,"child_added",e,n,t),Tu(i,r,"child_moved",s,n,t),Tu(i,r,"child_changed",e,n,t),Tu(i,r,"value",e,n,t),r}}let hh;class dh{constructor(){this.views=new Map}}function ph(t,n,r,i){var e=n.source.queryId;if(null!==e)return e=t.views.get(e),y(null!=e,"SyncTree gave us an op for an invalid query."),ch(e,n,r,i);{let e=[];for(const s of t.views.values())e=e.concat(ch(s,n,r,i));return e}}function fh(e,n,r,i,s){var a=n._queryIdentifier;if(a=e.views.get(a))return a;{let e=Wu(r,s?i:null),t;return t=!!e||(e=i instanceof k?zu(r,i):k.EMPTY_NODE,!1),a=Eu(new bu(e,t,!1),new bu(i,s,!1)),new ah(n,a)}}function gh(e){const t=[];for(const n of e.views.values())n.query._queryParams.loadsAllData()||t.push(n);return t}function mh(e,t){let n=null;for(const r of e.views.values())n=n||function(e,t){const n=Au(e.viewCache_);return n&&(e.query._queryParams.loadsAllData()||!I(t)&&!n.getImmediateChild(g(t)).isEmpty())?n.getChild(t):null}(r,t);return n}function vh(e,t){const n=t._queryParams;if(n.loadsAllData())return wh(e);t=t._queryIdentifier;return e.views.get(t)}function yh(e,t){return null!=vh(e,t)}function _h(e){return null!=wh(e)}function wh(e){for(const t of e.views.values())if(t.query._queryParams.loadsAllData())return t;return null}let bh,Ih=1;class Th{constructor(e){this.listenProvider_=e,this.syncPointTree_=new S(null),this.pendingWriteTree_={visibleWrites:Ru.empty(),allWrites:[],lastWriteId:-1},this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function Eh(e,t,n,r,i){var s=e.pendingWriteTree_,a=t,o=n,l=r;return r=i,y(l>s.lastWriteId,"Stacking an older write on top of newer ones"),s.allWrites.push({path:a,snap:o,writeId:l,visible:r=void 0===r||r}),r&&(s.visibleWrites=xu(s.visibleWrites,a,o)),s.lastWriteId=l,i?xh(e,new _u(fu(),t,n)):[]}function kh(e,t,n=!1){var r=function(t,n){for(let e=0;e<t.allWrites.length;e++){var r=t.allWrites[e];if(r.writeId===n)return r}return null}(e.pendingWriteTree_,t);if(function(t,n){var e,r=t.allWrites.findIndex(e=>e.writeId===n);y(0<=r,"removeWrite called with nonexistent writeId.");const i=t.allWrites[r];t.allWrites.splice(r,1);let s=i.visible,a=!1,o=t.allWrites.length-1;for(;s&&0<=o;){var l=t.allWrites[o];l.visible&&(o>=r&&function(e,t){if(e.snap)return cc(e.path,t);for(const n in e.children)if(e.children.hasOwnProperty(n)&&cc(b(e.path,n),t))return 1}(l,i.path)?s=!1:cc(i.path,l.path)&&(a=!0)),o--}return s&&(a?((e=t).visibleWrites=ju(e.allWrites,Bu,f()),0<e.allWrites.length?e.lastWriteId=e.allWrites[e.allWrites.length-1].writeId:e.lastWriteId=-1):i.snap?t.visibleWrites=Pu(t.visibleWrites,i.path):Sl(i.children,e=>{t.visibleWrites=Pu(t.visibleWrites,b(i.path,e))}),1)}(e.pendingWriteTree_,t)){let t=new S(null);return null!=r.snap?t=t.set(f(),!0):Sl(r.children,e=>{t=t.set(new m(e),!0)}),xh(e,new vu(r.path,t,n))}return[]}function Sh(e,t,n){return xh(e,new _u(gu(),t,n))}function Ch(n,e,t,r,i=!1){var s=e._path,a=n.syncPointTree_.get(s);let o=[];if(a&&("default"===e._queryIdentifier||yh(a,e))){var l,c,t=function(e,t,n,r){var i=t._queryIdentifier;const s=[];let a=[];var o=_h(e);if("default"===i)for(var[l,c]of e.views.entries())a=a.concat(lh(c,n,r)),oh(c)&&(e.views.delete(l),c.query._queryParams.loadsAllData()||s.push(c.query));else{const u=e.views.get(i);u&&(a=a.concat(lh(u,n,r)),oh(u)&&(e.views.delete(i),u.query._queryParams.loadsAllData()||s.push(u.query)))}return o&&!_h(e)&&s.push((y(hh,"Reference.ts has not been loaded"),new hh(t._repo,t._path))),{removed:s,events:a}}(a,e,t,r);0===a.views.size&&(n.syncPointTree_=n.syncPointTree_.remove(s));const g=t.removed;if(o=t.events,!i){if(a=-1!==g.findIndex(e=>e._queryParams.loadsAllData()),t=n.syncPointTree_.findOnPath(s,(e,t)=>_h(t)),a&&!t){const m=n.syncPointTree_.subtree(s);if(!m.isEmpty()){var u=m.fold((e,t,r)=>{if(t&&_h(t))return[wh(t)];{let n=[];return t&&(n=gh(t)),Sl(r,(e,t)=>{n=n.concat(t)}),n}});for(let e=0;e<u.length;++e){var h=(d=u[e]).query,d=Dh(n,d);n.listenProvider_.startListening(Uh(h),Ph(n,h),d.hashFn,d.onComplete)}}}!t&&0<g.length&&!r&&(a?n.listenProvider_.stopListening(Uh(e),null):g.forEach(e=>{var t=n.queryToTagMap.get(Oh(e));n.listenProvider_.stopListening(Uh(e),t)}))}var p=n,f=g;for(let e=0;e<f.length;++e){const v=f[e];v._queryParams.loadsAllData()||(l=Oh(v),c=p.queryToTagMap.get(l),p.queryToTagMap.delete(l),p.tagToQueryMap.delete(c))}}return o}function Ah(e,t,n,r){if(null==(r=Mh(e,r)))return[];var i=(s=Lh(r)).path,r=s.queryId,s=ac(i,t);return Fh(e,i,new _u(mu(r),s,n))}function Nh(e,t,n,r=!1){const i=t._path;let s=null,a=!1,o=(e.syncPointTree_.foreachOnPath(i,(e,t)=>{e=ac(e,i);s=s||mh(t,e),a=a||_h(t)}),e.syncPointTree_.get(i));o?(a=a||_h(o),s=s||mh(o,f())):(o=new dh,e.syncPointTree_=e.syncPointTree_.set(i,o));let l;if(null!=s)l=!0;else{l=!1,s=k.EMPTY_NODE;const p=e.syncPointTree_.subtree(i);p.foreachChild((e,t)=>{t=mh(t,f());t&&(s=s.updateImmediateChild(e,t))})}var c,u=yh(o,t),h=(u||t._queryParams.loadsAllData()||(h=Oh(t),y(!e.queryToTagMap.has(h),"View does not exist, but we have a tag"),c=Ih++,e.queryToTagMap.set(h,c),e.tagToQueryMap.set(c,h)),Vu(e.pendingWriteTree_,i));let d=function(e,t,n,r,i,s){r=fh(e,t,r,i,s),e.views.has(t._queryIdentifier)||e.views.set(t._queryIdentifier,r),r.eventRegistrations_.push(n);{s=n;const a=(i=r).viewCache_.eventCache,o=[];if(!a.getNode().isLeafNode()){const l=a.getNode();l.forEachChild(E,(e,t)=>{o.push(Qc(e,t))})}return a.isFullyInitialized()&&o.push($c(a.getNode())),uh(i,o,a.getNode(),s)}}(o,t,n,h,s,l);return u||a||r||(u=vh(o,t),d=d.concat(function(t,e,n){const r=e._path,i=Ph(t,e),s=Dh(t,n),a=t.listenProvider_.startListening(Uh(e),i,s.hashFn,s.onComplete),o=t.syncPointTree_.subtree(r);if(i)y(!_h(o.value),"If we're adding a query, it shouldn't be shadowed");else{var l=o.fold((e,t,r)=>{if(!I(e)&&t&&_h(t))return[wh(t).query];{let n=[];return t&&(n=n.concat(gh(t).map(e=>e.query))),Sl(r,(e,t)=>{n=n.concat(t)}),n}});for(let e=0;e<l.length;++e){var c=l[e];t.listenProvider_.stopListening(Uh(c),Ph(t,c))}}return a}(e,t,u))),d}function Rh(e,n,t){var r=e.pendingWriteTree_,e=e.syncPointTree_.findOnPath(n,(e,t)=>{t=mh(t,ac(e,n));if(t)return t});return Ku(r,n,e,t,!0)}function xh(e,t){return function t(n,r,i,s){if(I(n.path))return function i(s,e,a,o){var t=e.get(f());null==a&&null!=t&&(a=mh(t,f()));let l=[];return e.children.inorderTraversal((e,t)=>{var n=a?a.getImmediateChild(e):null,r=Qu(o,e),e=s.operationForChild(e);e&&(l=l.concat(i(e,t,n,r)))}),t&&(l=l.concat(ph(t,s,o,a))),l}(n,r,i,s);{var a=r.get(f());null==i&&null!=a&&(i=mh(a,f()));let e=[];var o,l=g(n.path),c=n.operationForChild(l),r=r.children.get(l);return r&&c&&(o=i?i.getImmediateChild(l):null,l=Qu(s,l),e=e.concat(t(c,r,o,l))),e=a?e.concat(ph(a,n,s,i)):e}}(t,e.syncPointTree_,null,Vu(e.pendingWriteTree_,f()))}function Dh(a,t){const o=t.query,l=Ph(a,o);return{hashFn:()=>{const e=t.viewCache_.serverCache.getNode()||k.EMPTY_NODE;return e.hash()},onComplete:e=>{if("ok"===e)return l?(i=a,r=o._path,(t=Mh(i,l))?(s=(n=Lh(t)).path,t=n.queryId,n=ac(s,r),Fh(i,s,new yu(mu(t),n))):[]):(r=a,i=o._path,xh(r,new yu(gu(),i)));var t,n,r,i,s=function(e,t){let n="Unknown Error";"too_big"===e?n="The data requested exceeds the maximum size that can be accessed with a single request.":"permission_denied"===e?n="Client doesn't have permission to access the desired data.":"unavailable"===e&&(n="The service is unavailable");const r=new Error(e+" at "+t._path.toString()+": "+n);return r.code=e.toUpperCase(),r}(e,o);return Ch(a,o,null,s)}}}function Ph(e,t){t=Oh(t);return e.queryToTagMap.get(t)}function Oh(e){return e._path.toString()+"$"+e._queryIdentifier}function Mh(e,t){return e.tagToQueryMap.get(t)}function Lh(e){var t=e.indexOf("$");return y(-1!==t&&t<e.length-1,"Bad queryKey."),{queryId:e.substr(t+1),path:new m(e.substr(0,t))}}function Fh(e,t,n){var r=e.syncPointTree_.get(t);return y(r,"Missing sync point for query tag that we're tracking"),ph(r,n,Vu(e.pendingWriteTree_,t),null)}function Uh(e){return e._queryParams.loadsAllData()&&!e._queryParams.isDefault()?(y(bh,"Reference.ts has not been loaded"),new bh(e._repo,e._path)):e}class qh{constructor(e){this.node_=e}getImmediateChild(e){e=this.node_.getImmediateChild(e);return new qh(e)}node(){return this.node_}}class Vh{constructor(e,t){this.syncTree_=e,this.path_=t}getImmediateChild(e){e=b(this.path_,e);return new Vh(this.syncTree_,e)}node(){return Rh(this.syncTree_,this.path_)}}function Bh(e,t,n){{if(!e||"object"!=typeof e)return e;if(y(".sv"in e,"Unexpected leaf node or priority contents"),"string"==typeof e[".sv"]){var r=e[".sv"];if("timestamp"===r)return n.timestamp;y(!1,"Unexpected server value: "+r)}else{if("object"==typeof e[".sv"]){n=e[".sv"],r=t,n.hasOwnProperty("increment")||y(!1,"Unexpected server value: "+JSON.stringify(n,null,2)),"number"!=typeof(t=n.increment)&&y(!1,"Unexpected increment value: "+t);const i=r.node();if(y(null!==i&&void 0!==i,"Expected ChildrenNode.EMPTY_NODE for nulls"),!i.isLeafNode())return t;const s=i;return"number"!=typeof(n=s.getValue())?t:n+t}y(!1,"Unexpected server value: "+JSON.stringify(e,null,2))}}}const jh=function(e,t,n,r){return Wh(t,new Vh(n,e),r)},Kh=function(e,t,n){return Wh(e,new qh(t),n)};function Wh(e,r,i){var t,n=Bh(e.getPriority().val(),r.getImmediateChild(".priority"),i);let s;if(e.isLeafNode()){const a=e;return(t=Bh(a.getValue(),r,i))!==a.getValue()||n!==a.getPriority().val()?new Ac(t,Bc(n)):e}{const o=e;return n!==(s=o).getPriority().val()&&(s=s.updatePriority(new Ac(n))),o.forEachChild(E,(e,t)=>{var n=Wh(t,r.getImmediateChild(e),i);n!==t&&(s=s.updateImmediateChild(e,n))}),s}}class zh{constructor(e="",t=null,n={children:{},childCount:0}){this.name=e,this.parent=t,this.node=n}}function Gh(e,t){let n=t instanceof m?t:new m(t),r=e,i=g(n);for(;null!==i;){var s=de(r.node.children,i)||{children:{},childCount:0};r=new zh(i,r,s),n=w(n),i=g(n)}return r}function Hh(e){return e.node.value}function $h(e,t){e.node.value=t,function e(t){var n,r,i,s;null!==t.parent&&(n=t.parent,r=t.name,i=function(e){return void 0===Hh(e)&&!Qh(e)}(t),s=he(n.node.children,r),i&&s?(delete n.node.children[r],n.node.childCount--,e(n)):i||s||(n.node.children[r]=t.node,n.node.childCount++,e(n)))}(e)}function Qh(e){return 0<e.node.childCount}function Yh(n,r){Sl(n.node.children,(e,t)=>{r(new zh(e,n,t))})}function Jh(e){return new m(null===e.parent?e.name:Jh(e.parent)+"/"+e.name)}function Xh(e,t,n,r){r&&void 0===t||dd(Ee(e,"value"),t,n)}function Zh(e,t,r,n){if(!n||void 0!==t){const o=Ee(e,"values");if(!t||"object"!=typeof t||Array.isArray(t))throw new Error(o+" must be an object containing the children to replace.");const l=[];Sl(t,(e,t)=>{const n=new m(e);if(dd(o,t,b(r,n)),".priority"===rc(n)&&!id(t))throw new Error(o+"contains an invalid value for '"+n.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");l.push(n)});{var i=o;var s=l;let e,t;for(e=0;e<s.length;e++){var a=ic(t=s[e]);for(let e=0;e<a.length;e++)if((".priority"!==a[e]||e!==a.length-1)&&!cd(a[e]))throw new Error(i+"contains an invalid key ("+a[e]+") in path "+t.toString()+'. Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"')}s.sort(oc);let n=null;for(e=0;e<s.length;e++){if(t=s[e],null!==n&&cc(n,t))throw new Error(i+"contains a path "+n.toString()+" that is ancestor of another path "+t.toString());n=t}}}}function ed(e,t,n){if(!n||void 0!==t){if(Il(t))throw new Error(Ee(e,"priority")+"is "+t.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!id(t))throw new Error(Ee(e,"priority")+"must be a valid Firebase priority (a string, finite number, server value, or null).")}}function td(e,t,n,r){if(!(r&&void 0===n||cd(n)))throw new Error(Ee(e,t)+'was an invalid key = "'+n+'".  Firebase keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]").')}function nd(e,t,n,r){n=n&&n.replace(/^\/*\.info(\/|$)/,"/"),pd(e,t,n,r)}function rd(e,t){if(".info"===g(t))throw new Error(e+" failed = Can't modify data under /.info/")}function id(e){return null===e||"string"==typeof e||"number"==typeof e&&!Il(e)||e&&"object"==typeof e&&he(e,".sv")}function sd(e,t){var n=t.path.toString();if("string"!=typeof t.repoInfo.host||0===t.repoInfo.host.length||!cd(t.repoInfo.namespace)&&"localhost"!==t.repoInfo.host.split(":")[0]||0!==n.length&&!hd(n))throw new Error(Ee(e,"url")+'must be a valid firebase URL and the path can\'t contain ".", "#", "$", "[", or "]".')}const ad=/[\[\].#$\/\u0000-\u001F\u007F]/,od=/[\[\].#$\u0000-\u001F\u007F]/,ld=10485760,cd=function(e){return"string"==typeof e&&0!==e.length&&!ad.test(e)},ud=function(e){return"string"==typeof e&&0!==e.length&&!od.test(e)},hd=function(e){return e=e&&e.replace(/^\/*\.info(\/|$)/,"/"),ud(e)},dd=function(s,e,t){const a=t instanceof m?new uc(t,s):t;if(void 0===e)throw new Error(s+"contains undefined "+dc(a));if("function"==typeof e)throw new Error(s+"contains a function "+dc(a)+" with contents = "+e.toString());if(Il(e))throw new Error(s+"contains "+e.toString()+" "+dc(a));if("string"==typeof e&&e.length>ld/3&&Ce(e)>ld)throw new Error(s+"contains a string greater than "+ld+" utf8 bytes "+dc(a)+" ('"+e.substring(0,50)+"...')");if(e&&"object"==typeof e){let r=!1,i=!1;if(Sl(e,(e,t)=>{if(".value"===e)r=!0;else if(".priority"!==e&&".sv"!==e&&(i=!0,!cd(e)))throw new Error(s+" contains an invalid key ("+e+") "+dc(a)+'.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');var n=a;0<n.parts_.length&&(n.byteLength_+=1),n.parts_.push(e),n.byteLength_+=Ce(e),hc(n),dd(s,t,a),e=(t=a).parts_.pop(),t.byteLength_-=Ce(e),0<t.parts_.length&&--t.byteLength_}),r&&i)throw new Error(s+' contains ".value" child '+dc(a)+" in addition to actual children.")}},pd=function(e,t,n,r){if(!(r&&void 0===n||ud(n)))throw new Error(Ee(e,t)+'was an invalid path = "'+n+'". Paths must be non-empty strings and can\'t contain ".", "#", "$", "[", or "]"')};class fd{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function gd(t,n){let r=null;for(let e=0;e<n.length;e++){const s=n[e];var i=s.getPath();null===r||lc(i,r.path)||(t.eventLists_.push(r),r=null),(r=null===r?{events:[],path:i}:r).events.push(s)}r&&t.eventLists_.push(r)}function md(e,t,n){gd(e,n),yd(e,e=>lc(e,t))}function vd(e,t,n){gd(e,n),yd(e,e=>cc(e,t)||cc(t,e))}function yd(t,n){t.recursionDepth_++;let r=!0;for(let e=0;e<t.eventLists_.length;e++){var i,s=t.eventLists_[e];if(s)if(n(s.path)){{i=void 0;var a=t.eventLists_[e];for(let e=0;e<a.events.length;e++){const o=a.events[e];null!==o&&(a.events[e]=null,i=o.getEventRunner(),cl&&yl("event: "+o.toString()),Pl(i))}}t.eventLists_[e]=null}else r=!1}r&&(t.eventLists_=[]),t.recursionDepth_--}const _d="repo_interrupt",wd=25;class bd{constructor(e,t,n,r){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=n,this.appCheckProvider_=r,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new fd,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=cu(),this.transactionQueueTree_=new zh,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function Id(e){const t=e.infoData_.getNode(new m(".info/serverTimeOffset"));e=t.val()||0;return(new Date).getTime()+e}function Td(e){return(e=(e={timestamp:Id(e)})||{}).timestamp=e.timestamp||(new Date).getTime(),e}function Ed(e,t,n,r,i){e.dataUpdateCount++;var s,a,o,l,c,u,h,d,p,f=new m(t);n=e.interceptServerDataCallback_?e.interceptServerDataCallback_(t,n):n;let g=f;0<(p=i?r?(s=fe(n,e=>Bc(e)),o=e.serverSyncTree_,p=f,l=s,(h=Mh(o,i))?(c=(d=Lh(h)).path,u=d.queryId,h=ac(c,p),d=S.fromObject(l),Fh(o,c,new wu(mu(u),h,d))):[]):(s=Bc(n),Ah(e.serverSyncTree_,f,s,i)):r?(a=fe(n,e=>Bc(e)),t=e.serverSyncTree_,i=f,r=a,a=S.fromObject(r),xh(t,new wu(gu(),i,a))):(a=Bc(n),Sh(e.serverSyncTree_,f,a))).length&&(g=Ld(e,f)),vd(e.eventQueue_,g,p)}function kd(e,t){if(Sd(e,"connected",t),!1===t){var r=e;Dd(r,"onDisconnectEvents");const i=Td(r),s=cu();hu(r.onDisconnect_,f(),(e,t)=>{t=jh(e,t,r.serverSyncTree_,i);uu(s,e,t)});let n=[];hu(s,f(),(e,t)=>{n=n.concat(Sh(r.serverSyncTree_,e,t));t=Vd(r,e);Ld(r,t)}),r.onDisconnect_=cu(),vd(r.eventQueue_,f(),n)}}function Sd(e,t,n){t=new m("/.info/"+t),n=Bc(n);e.infoData_.updateSnapshot(t,n),n=Sh(e.infoSyncTree_,t,n),vd(e.eventQueue_,t,n)}function Cd(e){return e.nextWriteId_++}function Ad(r,i,e,t,s){Dd(r,"set",{path:i.toString(),value:e,priority:t});var n=Td(r);const a=Bc(e,t);e=Rh(r.serverSyncTree_,i),n=Kh(a,e,n);const o=Cd(r);n=Eh(r.serverSyncTree_,i,n,o,!0),gd(r.eventQueue_,n),r.server_.put(i.toString(),a.val(!0),(e,t)=>{var n="ok"===e;n||wl("set at "+i+" failed: "+e),n=kh(r.serverSyncTree_,o,!n),vd(r.eventQueue_,i,n),Pd(0,s,e,t)}),n=Vd(r,i),Ld(r,n),vd(r.eventQueue_,n,[])}function Nd(n,r,e,i){const s=Bc(e);n.server_.onDisconnectPut(r.toString(),s.val(!0),(e,t)=>{"ok"===e&&uu(n.onDisconnect_,r,s),Pd(0,i,e,t)})}function Rd(e,t,n){n=".info"===g(t._path)?Ch(e.infoSyncTree_,t,n):Ch(e.serverSyncTree_,t,n);md(e.eventQueue_,t._path,n)}function xd(e){e.persistentConnection_&&e.persistentConnection_.interrupt(_d)}function Dd(e,...t){let n="";e.persistentConnection_&&(n=e.persistentConnection_.id+":"),yl(n,...t)}function Pd(e,r,i,s){r&&Pl(()=>{if("ok"===i)r(null);else{var t=(i||"error").toUpperCase();let e=t;s&&(e+=": "+s);const n=new Error(e);n.code=t,r(n)}})}function Od(e,t,n){return Rh(e.serverSyncTree_,t,n)||k.EMPTY_NODE}function Md(n,e=n.transactionQueueTree_){if(e||qd(n,e),Hh(e)){const l=Ud(n,e);if(y(0<l.length,"Sending zero length transaction queue"),l.every(e=>0===e.status)){var i=n,s=Jh(e),a=l;const c=a.map(e=>e.currentWriteId),u=Od(i,s,c);let t=u;var r=u.hash();for(let e=0;e<a.length;e++){const p=a[e];y(0===p.status,"tryToSendTransactionQueue_: items in queue should all be run."),p.status=1,p.retryCount++;var o=ac(s,p.path);t=t.updateChild(o,p.currentOutputSnapshotRaw)}const h=t.val(!0),d=s;i.server_.put(d.toString(),h,t=>{Dd(i,"transaction put response",{path:d.toString(),status:t});let n=[];if("ok"===t){const r=[];for(let e=0;e<a.length;e++)a[e].status=2,n=n.concat(kh(i.serverSyncTree_,a[e].currentWriteId)),a[e].onComplete&&r.push(()=>a[e].onComplete(null,!0,a[e].currentOutputSnapshotResolved)),a[e].unwatcher();qd(i,Gh(i.transactionQueueTree_,s)),Md(i,i.transactionQueueTree_),vd(i.eventQueue_,s,n);for(let e=0;e<r.length;e++)Pl(r[e])}else{if("datastale"===t)for(let e=0;e<a.length;e++)3===a[e].status?a[e].status=4:a[e].status=0;else{wl("transaction at "+d.toString()+" failed: "+t);for(let e=0;e<a.length;e++)a[e].status=4,a[e].abortReason=t}Ld(i,s)}},r)}}else Qh(e)&&Yh(e,e=>{Md(n,e)})}function Ld(e,t){var t=Fd(e,t),n=Jh(t),i=e,s=Ud(e,t),a=n;if(0!==s.length){const c=[];let r=[];const u=s.filter(e=>0===e.status),h=u.map(e=>e.currentWriteId);for(let n=0;n<s.length;n++){const d=s[n];var o=ac(a,d.path);let e=!1,t;if(y(null!==o,"rerunTransactionsUnderNode_: relativePath should not be null."),4===d.status)e=!0,t=d.abortReason,r=r.concat(kh(i.serverSyncTree_,d.currentWriteId,!0));else if(0===d.status)if(d.retryCount>=wd)e=!0,t="maxretry",r=r.concat(kh(i.serverSyncTree_,d.currentWriteId,!0));else{const p=Od(i,d.path,h);d.currentInputSnapshot=p;var l=s[n].update(p.val());if(void 0!==l){dd("transaction failed: Data returned ",l,d.path);let e=Bc(l);"object"==typeof l&&null!=l&&he(l,".priority")||(e=e.updatePriority(p.getPriority())),o=d.currentWriteId,l=Td(i),l=Kh(e,p,l),d.currentOutputSnapshotRaw=e,d.currentOutputSnapshotResolved=l,d.currentWriteId=Cd(i),h.splice(h.indexOf(o),1),r=(r=r.concat(Eh(i.serverSyncTree_,d.path,l,d.currentWriteId,d.applyLocally))).concat(kh(i.serverSyncTree_,o,!0))}else e=!0,t="nodata",r=r.concat(kh(i.serverSyncTree_,d.currentWriteId,!0))}vd(i.eventQueue_,a,r),r=[],e&&(s[n].status=2,l=s[n].unwatcher,setTimeout(l,Math.floor(0)),s[n].onComplete&&("nodata"===t?c.push(()=>s[n].onComplete(null,!1,s[n].currentInputSnapshot)):c.push(()=>s[n].onComplete(new Error(t),!1,null))))}qd(i,i.transactionQueueTree_);for(let e=0;e<c.length;e++)Pl(c[e]);Md(i,i.transactionQueueTree_)}return n}function Fd(e,t){let n,r=e.transactionQueueTree_;for(n=g(t);null!==n&&void 0===Hh(r);)r=Gh(r,n),t=w(t),n=g(t);return r}function Ud(e,t){const n=[];return function t(n,e,r){var i=Hh(e);if(i)for(let e=0;e<i.length;e++)r.push(i[e]);Yh(e,e=>{t(n,e,r)})}(e,t,n),n.sort((e,t)=>e.order-t.order),n}function qd(t,e){const n=Hh(e);if(n){let t=0;for(let e=0;e<n.length;e++)2!==n[e].status&&(n[t]=n[e],t++);n.length=t,$h(e,0<n.length?n:void 0)}Yh(e,e=>{qd(t,e)})}function Vd(t,n){var r,e=Jh(Fd(t,n)),n=Gh(t.transactionQueueTree_,n);{var i=n;let e=i.parent;for(;null!==e;)r=e,Bd(t,r),e=e.parent}return Bd(t,n),function t(e,n,r,i){r&&!i&&n(e),Yh(e,e=>{t(e,n,!0,i)}),r&&i&&n(e)}(n,e=>{Bd(t,e)}),e}function Bd(r,e){const i=Hh(e);if(i){const s=[];let t=[],n=-1;for(let e=0;e<i.length;e++)3!==i[e].status&&(1===i[e].status?(y(n===e-1,"All SENT items should be at beginning of queue."),n=e,i[e].status=3,i[e].abortReason="set"):(y(0===i[e].status,"Unexpected transaction status in abort"),i[e].unwatcher(),t=t.concat(kh(r.serverSyncTree_,i[e].currentWriteId,!0)),i[e].onComplete&&s.push(i[e].onComplete.bind(null,new Error("set"),!1,null))));-1===n?$h(e,void 0):i.length=n+1,vd(r.eventQueue_,Jh(e),t);for(let e=0;e<s.length;e++)Pl(s[e])}}function jd(e,t){var n=(e=Kd(e)).namespace,r=("firebase.com"===e.domain&&_l(e.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),n&&"undefined"!==n||"localhost"===e.domain||_l("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),e.secure||bl(),"ws"===e.scheme||"wss"===e.scheme);return{repoInfo:new Vl(e.host,e.secure,n,r,t,"",n!==e.subdomain),path:new m(e.pathString)}}const Kd=function(s){let n="",r="",a="",o="",l="",c=!0,u="https",h=443;if("string"==typeof s){let e=s.indexOf("//"),t=(0<=e&&(u=s.substring(0,e-1),s=s.substring(e+2)),s.indexOf("/")),i=(-1===t&&(t=s.length),s.indexOf("?"));-1===i&&(i=s.length),n=s.substring(0,Math.min(t,i)),t<i&&(o=function(){let n="";var r=s.substring(t,i).split("/");for(let t=0;t<r.length;t++)if(0<r[t].length){let e=r[t];try{e=decodeURIComponent(e.replace(/\+/g," "))}catch(e){}n+="/"+e}return n}());var d,p=function(e){const t={};for(const r of(e="?"===e.charAt(0)?e.substring(1):e).split("&")){var n;0!==r.length&&(2===(n=r.split("=")).length?t[decodeURIComponent(n[0])]=decodeURIComponent(n[1]):wl(`Invalid query segment '${r}' in query '${e}'`))}return t}(s.substring(Math.min(s.length,i)));0<=(e=n.indexOf(":"))?(c="https"===u||"wss"===u,h=parseInt(n.substring(e+1),10)):e=n.length;const f=n.slice(0,e);"localhost"===f.toLowerCase()?r="localhost":f.split(".").length<=2?r=f:(d=n.indexOf("."),a=n.substring(0,d).toLowerCase(),r=n.substring(d+1),l=a),"ns"in p&&(l=p.ns)}return{host:n,port:h,domain:r,subdomain:a,secure:c,scheme:u,pathString:o,namespace:l}};class Wd{constructor(e,t,n,r){this.eventType=e,this.eventRegistration=t,this.snapshot=n,this.prevName=r}getPath(){var e=this.snapshot.ref;return("value"===this.eventType?e:e.parent)._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+ce(this.snapshot.exportVal())}}class zd{constructor(e,t,n){this.eventRegistration=e,this.error=t,this.path=n}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}class Gd{constructor(e,t){this.snapshotCallback=e,this.cancelCallback=t}onValue(e,t){this.snapshotCallback.call(null,e,t)}onCancel(e){return y(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||void 0!==this.snapshotCallback.userCallback&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}}class Hd{constructor(e,t){this._repo=e,this._path=t}cancel(){const e=new re;return n=this._repo,r=this._path,i=e.wrapCallback(()=>{}),n.server_.onDisconnectCancel(r.toString(),(e,t)=>{"ok"===e&&!function e(n,t){if(I(t))return n.value=null,n.children.clear(),!0;if(null===n.value)return!(0<n.children.size)||(r=g(t),t=w(t),n.children.has(r)&&e(n.children.get(r),t)&&n.children.delete(r),0===n.children.size);var r;if(n.value.isLeafNode())return!1;{const i=n.value;return n.value=null,i.forEachChild(E,(e,t)=>{uu(n,new m(e),t)}),e(n,t)}}(n.onDisconnect_,r),Pd(0,i,e,t)}),e.promise;var n,r,i}remove(){rd("OnDisconnect.remove",this._path);const e=new re;return Nd(this._repo,this._path,null,e.wrapCallback(()=>{})),e.promise}set(e){rd("OnDisconnect.set",this._path),Xh("OnDisconnect.set",e,this._path,!1);const t=new re;return Nd(this._repo,this._path,e,t.wrapCallback(()=>{})),t.promise}setWithPriority(e,t){rd("OnDisconnect.setWithPriority",this._path),Xh("OnDisconnect.setWithPriority",e,this._path,!1),ed("OnDisconnect.setWithPriority",t,!1);const n=new re;{var r=this._repo,i=this._path,s=n.wrapCallback(()=>{});const a=Bc(e,t);r.server_.onDisconnectPut(i.toString(),a.val(!0),(e,t)=>{"ok"===e&&uu(r.onDisconnect_,i,a),Pd(0,s,e,t)})}return n.promise}update(e){rd("OnDisconnect.update",this._path),Zh("OnDisconnect.update",e,this._path,!1);const t=new re;return n=this._repo,r=this._path,i=e,s=t.wrapCallback(()=>{}),pe(i)?(yl("onDisconnect().update() called with empty data.  Don't do anything."),Pd(0,s,"ok",void 0)):n.server_.onDisconnectMerge(r.toString(),i,(e,t)=>{"ok"===e&&Sl(i,(e,t)=>{t=Bc(t);uu(n.onDisconnect_,b(r,e),t)}),Pd(0,s,e,t)}),t.promise;var n,r,i,s}}class $d{constructor(e,t,n,r){this._repo=e,this._path=t,this._queryParams=n,this._orderByCalled=r}get key(){return I(this._path)?null:rc(this._path)}get ref(){return new Xd(this._repo,this._path)}get _queryIdentifier(){var e;return"{}"===(e=gl(au(this._queryParams)))?"default":e}get _queryObject(){return au(this._queryParams)}isEqual(e){if(!((e=_(e))instanceof $d))return!1;var t=this._repo===e._repo,n=lc(this._path,e._path),e=this._queryIdentifier===e._queryIdentifier;return t&&n&&e}toJSON(){return this.toString()}toString(){return this._repo.toString()+function(t){let n="";for(let e=t.pieceNum_;e<t.pieces_.length;e++)""!==t.pieces_[e]&&(n+="/"+encodeURIComponent(String(t.pieces_[e])));return n||"/"}(this._path)}}function Qd(e,t){if(!0===e._orderByCalled)throw new Error(t+": You can't combine multiple orderBy calls.")}function Yd(e){let t=null,n=null;if(e.hasStart()&&(t=e.getIndexStartValue()),e.hasEnd()&&(n=e.getIndexEndValue()),e.getIndex()===yc){var r="Query: When ordering by key, you may only pass one argument to startAt(), endAt(), or equalTo().",i="Query: When ordering by key, the argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() must be a string.";if(e.hasStart()){if(e.getIndexStartName()!==Tl)throw new Error(r);if("string"!=typeof t)throw new Error(i)}if(e.hasEnd()){if(e.getIndexEndName()!==El)throw new Error(r);if("string"!=typeof n)throw new Error(i)}}else if(e.getIndex()===E){if(null!=t&&!id(t)||null!=n&&!id(n))throw new Error("Query: When ordering by priority, the first argument passed to startAt(), startAfter() endAt(), endBefore(), or equalTo() must be a valid priority value (null, a number, or a string).")}else if(y(e.getIndex()instanceof jc||e.getIndex()===zc,"unknown index type."),null!=t&&"object"==typeof t||null!=n&&"object"==typeof n)throw new Error("Query: First argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() cannot be an object.")}function Jd(e){if(e.hasStart()&&e.hasEnd()&&e.hasLimit()&&!e.hasAnchoredLimit())throw new Error("Query: Can't combine startAt(), startAfter(), endAt(), endBefore(), and limit(). Use limitToFirst() or limitToLast() instead.")}class Xd extends $d{constructor(e,t){super(e,t,new tu,!1)}get parent(){var e=sc(this._path);return null===e?null:new Xd(this._repo,e)}get root(){let e=this;for(;null!==e.parent;)e=e.parent;return e}}class Zd{constructor(e,t,n){this._node=e,this.ref=t,this._index=n}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){var t=new m(e),e=np(this.ref,e);return new Zd(this._node.getChild(t),e,E)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(n){if(this._node.isLeafNode())return!1;const e=this._node;return!!e.forEachChild(this._index,(e,t)=>n(new Zd(t,np(this.ref,e),E)))}hasChild(e){e=new m(e);return!this._node.getChild(e).isEmpty()}hasChildren(){return!this._node.isLeafNode()&&!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}}function ep(e,t){return(e=_(e))._checkNotDeleted("ref"),void 0!==t?np(e._root,t):e._root}function tp(e,t){(e=_(e))._checkNotDeleted("refFromURL");const n=jd(t,e._repo.repoInfo_.nodeAdmin);sd("refFromURL",n);t=n.repoInfo;return e._repo.repoInfo_.isCustomHost()||t.host===e._repo.repoInfo_.host||_l("refFromURL: Host name does not match the current database: (found "+t.host+" but expected "+e._repo.repoInfo_.host+")"),ep(e,n.path.toString())}function np(e,t){return(null===g((e=_(e))._path)?nd:pd)("child","path",t,!1),new Xd(e._repo,b(e._path,t))}function rp(e,t){rd("set",(e=_(e))._path),Xh("set",t,e._path,!1);const n=new re;return Ad(e._repo,e._path,t,null,n.wrapCallback(()=>{})),n.promise}function ip(e,t){Zh("update",t,e._path,!1);const r=new re;{var i=e._repo,s=e._path,a=(e=t,r.wrapCallback(()=>{})),o,l,c,u,h,d;Dd(i,"update",{path:s.toString(),value:e});let n=!0;const p=Td(i),f={};if(Sl(e,(e,t)=>{n=!1,f[e]=jh(b(s,e),Bc(t),i.serverSyncTree_,p)}),n)yl("update() called with empty data.  Don't do anything."),Pd(0,a,"ok",void 0);else{const g=Cd(i);t=i.serverSyncTree_,o=s,l=f,c=g,u=t.pendingWriteTree_,h=o,d=l,y(c>u.lastWriteId,"Stacking an older merge on top of newer ones"),u.allWrites.push({path:h,children:d,writeId:c,visible:!0}),u.visibleWrites=Du(u.visibleWrites,h,d),u.lastWriteId=c,h=S.fromObject(l);d=xh(t,new wu(fu(),o,h));gd(i.eventQueue_,d),i.server_.merge(s.toString(),e,(e,t)=>{(r="ok"===e)||wl("update at "+s+" failed: "+e);var n=kh(i.serverSyncTree_,g,!r),r=0<n.length?Ld(i,s):s;vd(i.eventQueue_,r,n),Pd(0,a,e,t)}),Sl(e,e=>{e=Vd(i,b(s,e));Ld(i,e)}),vd(i.eventQueue_,s,[])}}return r.promise}function sp(t){t=_(t);var e=new Gd(()=>{}),e=new ap(e),n=t._repo,r=t,i=e;return(null!=(e=function(e,t){const n=t._path;let r=null,i=(e.syncPointTree_.foreachOnPath(n,(e,t)=>{e=ac(e,n);r=r||mh(t,e)}),e.syncPointTree_.get(n));i?r=r||mh(i,f()):(i=new dh,e.syncPointTree_=e.syncPointTree_.set(n,i));var s=null!=r;const a=s?new bu(r,!0,!1):null;return e=Vu(e.pendingWriteTree_,t._path),Cu(fh(i,t,e,s?a.getNode():k.EMPTY_NODE,s).viewCache_)}(n.serverSyncTree_,r))?Promise.resolve(e):n.server_.get(r).then(e=>{var t,e=Bc(e).withIndex(r._queryParams.getIndex());return Nh(n.serverSyncTree_,r,i,!0),t=r._queryParams.loadsAllData()?Sh(n.serverSyncTree_,r._path,e):(t=Ph(n.serverSyncTree_,r),Ah(n.serverSyncTree_,r._path,e,t)),vd(n.eventQueue_,r._path,t),Ch(n.serverSyncTree_,r,i,null,!0),e},e=>(Dd(n,"get for query "+ce(r)+" failed: "+e),Promise.reject(new Error(e))))).then(e=>new Zd(e,new Xd(t._repo,t._path),t._queryParams.getIndex()))}class ap{constructor(e){this.callbackContext=e}respondsTo(e){return"value"===e}createEvent(e,t){var n=t._queryParams.getIndex();return new Wd("value",this,new Zd(e.snapshotNode,new Xd(t._repo,t._path),n))}getEventRunner(e){return"cancel"===e.getEventType()?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new zd(this,e,t):null}matches(e){return e instanceof ap&&(!e.callbackContext||!this.callbackContext||e.callbackContext.matches(this.callbackContext))}hasAnyCallback(){return null!==this.callbackContext}}class op{constructor(e,t){this.eventType=e,this.callbackContext=t}respondsTo(e){let t="children_added"===e?"child_added":e;return t="children_removed"===t?"child_removed":t,this.eventType===t}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new zd(this,e,t):null}createEvent(e,t){y(null!=e.childName,"Child events should have a childName.");var n=np(new Xd(t._repo,t._path),e.childName),t=t._queryParams.getIndex();return new Wd(e.type,this,new Zd(e.snapshotNode,n,t),e.prevName)}getEventRunner(e){return"cancel"===e.getEventType()?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,e.prevName)}matches(e){return e instanceof op&&this.eventType===e.eventType&&(!this.callbackContext||!e.callbackContext||this.callbackContext.matches(e.callbackContext))}hasAnyCallback(){return!!this.callbackContext}}function lp(n,e,t,r,i){let s;if("object"==typeof r&&(s=void 0,i=r),"function"==typeof r&&(s=r),i&&i.onlyOnce){const l=t;var a=(e,t)=>{Rd(n._repo,n,o),l(e,t)};a.userCallback=t.userCallback,a.context=t.context,t=a}a=new Gd(t,s||void 0);const o="value"===e?new ap(a):new op(e,a);r=n._repo,i=n,t=o;return t=".info"===g(i._path)?Nh(r.infoSyncTree_,i,t):Nh(r.serverSyncTree_,i,t),md(r.eventQueue_,i._path,t),()=>Rd(n._repo,n,o)}function cp(e,t,n,r){return lp(e,"value",t,n,r)}function up(e,t,n,r){lp(e,"child_added",t,n,r)}function hp(e,t,n,r){lp(e,"child_changed",t,n,r)}function dp(e,t,n,r){lp(e,"child_moved",t,n,r)}function pp(e,t,n,r){lp(e,"child_removed",t,n,r)}function fp(e,t,n){let r=null;n=n?new Gd(n):null;"value"===t?r=new ap(n):t&&(r=new op(t,n)),Rd(e._repo,e,r)}class gp{}class mp extends gp{constructor(e,t){super(),this._value=e,this._key=t}_apply(e){Xh("endAt",this._value,e._path,!0);var t=ru(e._queryParams,this._value,this._key);if(Jd(t),Yd(t),e._queryParams.hasEnd())throw new Error("endAt: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new $d(e._repo,e._path,t,e._orderByCalled)}}class vp extends gp{constructor(e,t){super(),this._value=e,this._key=t}_apply(e){Xh("endBefore",this._value,e._path,!1);var t=function(e,t,n){let r;return(r=e.index_===yc?ru(e,t="string"==typeof t?Wc(t):t,n):ru(e,t,null==n?Tl:Wc(n))).endBeforeSet_=!0,r}(e._queryParams,this._value,this._key);if(Jd(t),Yd(t),e._queryParams.hasEnd())throw new Error("endBefore: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new $d(e._repo,e._path,t,e._orderByCalled)}}class yp extends gp{constructor(e,t){super(),this._value=e,this._key=t}_apply(e){Xh("startAt",this._value,e._path,!0);var t=nu(e._queryParams,this._value,this._key);if(Jd(t),Yd(t),e._queryParams.hasStart())throw new Error("startAt: Starting point was already set (by another call to startAt, startBefore or equalTo).");return new $d(e._repo,e._path,t,e._orderByCalled)}}class _p extends gp{constructor(e,t){super(),this._value=e,this._key=t}_apply(e){Xh("startAfter",this._value,e._path,!1);var t=function(e,t,n){let r;return(r=e.index_===yc?nu(e,t="string"==typeof t?Kc(t):t,n):nu(e,t,null==n?El:Kc(n))).startAfterSet_=!0,r}(e._queryParams,this._value,this._key);if(Jd(t),Yd(t),e._queryParams.hasStart())throw new Error("startAfter: Starting point was already set (by another call to startAt, startAfter, or equalTo).");return new $d(e._repo,e._path,t,e._orderByCalled)}}class wp extends gp{constructor(e){super(),this._limit=e}_apply(e){if(e._queryParams.hasLimit())throw new Error("limitToFirst: Limit was already set (by another call to limitToFirst or limitToLast).");return new $d(e._repo,e._path,function(e,t){const n=e.copy();return n.limitSet_=!0,n.limit_=t,n.viewFrom_="l",n}(e._queryParams,this._limit),e._orderByCalled)}}class bp extends gp{constructor(e){super(),this._limit=e}_apply(e){if(e._queryParams.hasLimit())throw new Error("limitToLast: Limit was already set (by another call to limitToFirst or limitToLast).");return new $d(e._repo,e._path,function(e,t){const n=e.copy();return n.limitSet_=!0,n.limit_=t,n.viewFrom_="r",n}(e._queryParams,this._limit),e._orderByCalled)}}class Ip extends gp{constructor(e){super(),this._path=e}_apply(e){Qd(e,"orderByChild");var t=new m(this._path);if(I(t))throw new Error("orderByChild: cannot pass in empty path. Use orderByValue() instead.");return t=new jc(t),Yd(t=iu(e._queryParams,t)),new $d(e._repo,e._path,t,!0)}}class Tp extends gp{_apply(e){Qd(e,"orderByKey");var t=iu(e._queryParams,yc);return Yd(t),new $d(e._repo,e._path,t,!0)}}class Ep extends gp{_apply(e){Qd(e,"orderByPriority");var t=iu(e._queryParams,E);return Yd(t),new $d(e._repo,e._path,t,!0)}}class kp extends gp{_apply(e){Qd(e,"orderByValue");var t=iu(e._queryParams,zc);return Yd(t),new $d(e._repo,e._path,t,!0)}}class Sp extends gp{constructor(e,t){super(),this._value=e,this._key=t}_apply(e){if(Xh("equalTo",this._value,e._path,!1),e._queryParams.hasStart())throw new Error("equalTo: Starting point was already set (by another call to startAt/startAfter or equalTo).");if(e._queryParams.hasEnd())throw new Error("equalTo: Ending point was already set (by another call to endAt/endBefore or equalTo).");return new mp(this._value,this._key)._apply(new yp(this._value,this._key)._apply(e))}}function Cp(e,...t){let n=_(e);for(const r of t)n=r._apply(n);return n}Wp=Xd,y(!hh,"__referenceConstructor has already been defined"),hh=Wp,Wp=Xd,y(!bh,"__referenceConstructor has already been defined"),bh=Wp;const Ap={};function Np(e,t,n,r,i){let s=r||e.options.databaseURL,a=(void 0===s&&(e.options.projectId||_l("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),yl("Using default host for project ",e.options.projectId),s=e.options.projectId+"-default-rtdb.firebaseio.com"),jd(s,i)),o=a.repoInfo,l,c=void 0;(c="undefined"!=typeof process&&process.env?process.env.FIREBASE_DATABASE_EMULATOR_HOST:c)?(l=!0,s=`http://${c}?ns=`+o.namespace,a=jd(s,i),o=a.repoInfo):l=!a.repoInfo.secure;r=i&&l?new Ll(Ll.OWNER):new Ml(e.name,e.options,t);return sd("Invalid Firebase Database URL",a),I(a.path)||_l("Database URL must point to the root of a Firebase Database (not including a child path)."),r=function(e,t,n,r){let i=Ap[t.name];return i||(i={},Ap[t.name]=i),i[e.toURLString()]&&_l("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),t=new bd(e,!1,n,r),i[e.toURLString()]=t}(o,e,r,new Ol(e.name,n)),new Rp(r,e)}class Rp{constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){if(!this._instanceStarted){var a=this._repoInternal,e=this.app.options.appId,t=this.app.options.databaseAuthVariableOverride,n;if(a.stats_=zl(a.repoInfo_),a.forceRestClient_||function(){const e="object"==typeof window&&window.navigator&&window.navigator.userAgent||"";return 0<=e.search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)}())a.server_=new ou(a.repoInfo_,(e,t,n,r)=>{Ed(a,e,t,n,r)},a.authTokenProvider_,a.appCheckProvider_),setTimeout(()=>kd(a,!0),0);else{if(null!=t){if("object"!=typeof t)throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{ce(t)}catch(e){throw new Error("Invalid authOverride provided: "+e)}}a.persistentConnection_=new fc(a.repoInfo_,e,(e,t,n,r)=>{Ed(a,e,t,n,r)},e=>{kd(a,e)},e=>{var n=a;Sl(e,(e,t)=>{Sd(n,e,t)})},a.authTokenProvider_,a.appCheckProvider_,t),a.server_=a.persistentConnection_}a.authTokenProvider_.addTokenChangeListener(e=>{a.server_.refreshAuthToken(e)}),a.appCheckProvider_.addTokenChangeListener(e=>{a.server_.refreshAppCheckToken(e.token)}),a.statsReporter_=(t=()=>new pu(a.stats_,a.server_),n=(e=a.repoInfo_).toString(),Wl[n]||(Wl[n]=t()),Wl[n]),a.infoData_=new lu,a.infoSyncTree_=new Th({startListening:(e,t,n,r)=>{let i=[];const s=a.infoData_.getNode(e._path);return s.isEmpty()||(i=Sh(a.infoSyncTree_,e._path,s),setTimeout(()=>{r("ok")},0)),i},stopListening:()=>{}}),Sd(a,"connected",!1),a.serverSyncTree_=new Th({startListening:(n,e,t,r)=>(a.server_.listen(n,t,e,(e,t)=>{e=r(e,t);vd(a.eventQueue_,n._path,e)}),[]),stopListening:(e,t)=>{a.server_.unlisten(e,t)}}),this._instanceStarted=!0}return this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new Xd(this._repo,f())),this._rootInternal}_delete(){if(null!==this._rootInternal){{var e=this._repo,t=this.app.name;const n=Ap[t];n&&n[e.key]===e||_l(`Database ${t}(${e.repoInfo_}) has already been deleted.`),xd(e),delete n[e.key]}this._repoInternal=null,this._rootInternal=null}return Promise.resolve()}_checkNotDeleted(e){null===this._rootInternal&&_l("Cannot call "+e+" on a deleted database.")}}function xp(){Jl.IS_TRANSPORT_INITIALIZED&&wl("Transport has already been initialized. Please call this function before calling ref or setting up a listener")}function Dp(){xp(),Hl.forceDisallow()}function Pp(){xp(),Yl.forceDisallow(),Hl.forceAllow()}class Op{constructor(e,t){this.committed=e,this.snapshot=t}toJSON(){return{committed:this.committed,snapshot:this.snapshot.toJSON()}}}function Mp(i,t,e){if(rd("Reference.transaction",(i=_(i))._path),".length"===i.key||".keys"===i.key)throw"Reference.transaction failed: "+i.key+" is a read-only object.";var n=null==(e=null==e?void 0:e.applyLocally)||e;const s=new re;e=cp(i,()=>{});{var r=i._repo,a=i._path;Dd(r,"transaction on "+a);const o={path:a,update:t,onComplete:(e,t,n)=>{var r;e?s.reject(e):(r=new Zd(n,new Xd(i._repo,i._path),E),s.resolve(new Op(t,r)))},status:null,order:ol(),applyLocally:n,retryCount:0,unwatcher:e,abortReason:null,currentWriteId:null,currentInputSnapshot:null,currentOutputSnapshotRaw:null,currentOutputSnapshotResolved:null},l=Od(r,a,void 0);if(o.currentInputSnapshot=l,void 0===(t=o.update(l.val())))o.unwatcher(),o.currentOutputSnapshotRaw=null,o.currentOutputSnapshotResolved=null,o.onComplete&&o.onComplete(null,!1,o.currentInputSnapshot);else{dd("transaction failed: Data returned ",t,o.path),o.status=0;n=Gh(r.transactionQueueTree_,a);const c=Hh(n)||[];c.push(o),$h(n,c);let e;if("object"==typeof t&&null!==t&&he(t,".priority"))e=de(t,".priority"),y(id(e),"Invalid priority returned by transaction. Priority must be a valid string, finite number, server value, or null.");else{const u=Rh(r.serverSyncTree_,a)||k.EMPTY_NODE;e=u.getPriority().val()}n=Td(r),t=Bc(t,e),n=Kh(t,l,n),o.currentOutputSnapshotRaw=t,o.currentOutputSnapshotResolved=n,o.currentWriteId=Cd(r),n=Eh(r.serverSyncTree_,a,n,o.currentWriteId,o.applyLocally),vd(r.eventQueue_,a,n),Md(r,r.transactionQueueTree_)}}return s.promise}function Lp(e){e="FIREBASE WARNING: "+e;Fp.warn(e)}fc.prototype.simpleListen=function(e,t){this.sendRequest("q",{p:e},t)},fc.prototype.echo=function(e,t){this.sendRequest("echo",{d:e},t)},Xo(_t),gt(new o("database",(e,{instanceIdentifier:t})=>Np(e.getProvider("app").getImmediate(),e.getProvider("auth-internal"),e.getProvider("app-check-internal"),t),"PUBLIC").setMultipleInstances(!0)),r(Gn,vo,void 0),r(Gn,vo,"esm2017");const Fp=new Be("@firebase/database-compat");class Up{constructor(e){this._delegate=e}cancel(t){l("OnDisconnect.cancel",0,1,arguments.length),ke("OnDisconnect.cancel","onComplete",t,!0);const e=this._delegate.cancel();return t&&e.then(()=>t(null),e=>t(e)),e}remove(t){l("OnDisconnect.remove",0,1,arguments.length),ke("OnDisconnect.remove","onComplete",t,!0);const e=this._delegate.remove();return t&&e.then(()=>t(null),e=>t(e)),e}set(e,t){l("OnDisconnect.set",1,2,arguments.length),ke("OnDisconnect.set","onComplete",t,!0);const n=this._delegate.set(e);return t&&n.then(()=>t(null),e=>t(e)),n}setWithPriority(e,t,n){l("OnDisconnect.setWithPriority",2,3,arguments.length),ke("OnDisconnect.setWithPriority","onComplete",n,!0);const r=this._delegate.setWithPriority(e,t);return n&&r.then(()=>n(null),e=>n(e)),r}update(t,n){if(l("OnDisconnect.update",1,2,arguments.length),Array.isArray(t)){const r={};for(let e=0;e<t.length;++e)r[""+e]=t[e];t=r,Lp("Passing an Array to firebase.database.onDisconnect().update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}ke("OnDisconnect.update","onComplete",n,!0);const e=this._delegate.update(t);return n&&e.then(()=>n(null),e=>n(e)),e}}class qp{constructor(e,t){this.committed=e,this.snapshot=t}toJSON(){return l("TransactionResult.toJSON",0,1,arguments.length),{committed:this.committed,snapshot:this.snapshot.toJSON()}}}class Vp{constructor(e,t){this._database=e,this._delegate=t}val(){return l("DataSnapshot.val",0,0,arguments.length),this._delegate.val()}exportVal(){return l("DataSnapshot.exportVal",0,0,arguments.length),this._delegate.exportVal()}toJSON(){return l("DataSnapshot.toJSON",0,1,arguments.length),this._delegate.toJSON()}exists(){return l("DataSnapshot.exists",0,0,arguments.length),this._delegate.exists()}child(e){return l("DataSnapshot.child",0,1,arguments.length),e=String(e),pd("DataSnapshot.child","path",e,!1),new Vp(this._database,this._delegate.child(e))}hasChild(e){return l("DataSnapshot.hasChild",1,1,arguments.length),pd("DataSnapshot.hasChild","path",e,!1),this._delegate.hasChild(e)}getPriority(){return l("DataSnapshot.getPriority",0,0,arguments.length),this._delegate.priority}forEach(t){return l("DataSnapshot.forEach",1,1,arguments.length),ke("DataSnapshot.forEach","action",t,!1),this._delegate.forEach(e=>t(new Vp(this._database,e)))}hasChildren(){return l("DataSnapshot.hasChildren",0,0,arguments.length),this._delegate.hasChildren()}get key(){return this._delegate.key}numChildren(){return l("DataSnapshot.numChildren",0,0,arguments.length),this._delegate.size}getRef(){return l("DataSnapshot.ref",0,0,arguments.length),new jp(this._database,this._delegate.ref)}get ref(){return this.getRef()}}class Bp{constructor(e,t){this.database=e,this._delegate=t}on(e,n,t,r){l("Query.on",2,4,arguments.length),ke("Query.on","callback",n,!1);const i=Bp.getCancelAndContextArgs_("Query.on",t,r);var s=(e,t)=>{n.call(i.context,new Vp(this.database,e),t)},a=(s.userCallback=n,s.context=i.context,null==(t=i.cancel)?void 0:t.bind(i.context));switch(e){case"value":return cp(this._delegate,s,a),n;case"child_added":return up(this._delegate,s,a),n;case"child_removed":return pp(this._delegate,s,a),n;case"child_changed":return hp(this._delegate,s,a),n;case"child_moved":return dp(this._delegate,s,a),n;default:throw new Error(Ee("Query.on","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}}off(e,t,n){var r;if(l("Query.off",0,3,arguments.length),void 0!==e)switch(e){case"value":case"child_added":case"child_removed":case"child_changed":case"child_moved":break;default:throw new Error(Ee("Query.off","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}ke("Query.off","callback",t,!0),Se("Query.off","context",n,!0),t?((r=()=>{}).userCallback=t,r.context=n,fp(this._delegate,e,r)):fp(this._delegate,e)}get(){return sp(this._delegate).then(e=>new Vp(this.database,e))}once(e,n,t,r){l("Query.once",1,4,arguments.length),ke("Query.once","callback",n,!0);const i=Bp.getCancelAndContextArgs_("Query.once",t,r),s=new re;var a=(e,t)=>{e=new Vp(this.database,e);n&&n.call(i.context,e,t),s.resolve(e)},o=(a.userCallback=n,a.context=i.context,e=>{i.cancel&&i.cancel.call(i.context,e),s.reject(e)});switch(e){case"value":cp(this._delegate,a,o,{onlyOnce:!0});break;case"child_added":up(this._delegate,a,o,{onlyOnce:!0});break;case"child_removed":pp(this._delegate,a,o,{onlyOnce:!0});break;case"child_changed":hp(this._delegate,a,o,{onlyOnce:!0});break;case"child_moved":dp(this._delegate,a,o,{onlyOnce:!0});break;default:throw new Error(Ee("Query.once","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}return s.promise}limitToFirst(e){return l("Query.limitToFirst",1,1,arguments.length),new Bp(this.database,Cp(this._delegate,function(e){if("number"!=typeof e||Math.floor(e)!==e||e<=0)throw new Error("limitToFirst: First argument must be a positive integer.");return new wp(e)}(e)))}limitToLast(e){return l("Query.limitToLast",1,1,arguments.length),new Bp(this.database,Cp(this._delegate,function(e){if("number"!=typeof e||Math.floor(e)!==e||e<=0)throw new Error("limitToLast: First argument must be a positive integer.");return new bp(e)}(e)))}orderByChild(e){return l("Query.orderByChild",1,1,arguments.length),new Bp(this.database,Cp(this._delegate,function(e){if("$key"===e)throw new Error('orderByChild: "$key" is invalid.  Use orderByKey() instead.');if("$priority"===e)throw new Error('orderByChild: "$priority" is invalid.  Use orderByPriority() instead.');if("$value"===e)throw new Error('orderByChild: "$value" is invalid.  Use orderByValue() instead.');return pd("orderByChild","path",e,!1),new Ip(e)}(e)))}orderByKey(){return l("Query.orderByKey",0,0,arguments.length),new Bp(this.database,Cp(this._delegate,new Tp))}orderByPriority(){return l("Query.orderByPriority",0,0,arguments.length),new Bp(this.database,Cp(this._delegate,new Ep))}orderByValue(){return l("Query.orderByValue",0,0,arguments.length),new Bp(this.database,Cp(this._delegate,new kp))}startAt(e=null,t){return l("Query.startAt",0,2,arguments.length),new Bp(this.database,Cp(this._delegate,([e=null,t]=[e,t],td("startAt","key",t,!0),new yp(e,t))))}startAfter(e=null,t){return l("Query.startAfter",0,2,arguments.length),new Bp(this.database,Cp(this._delegate,(td("startAfter","key",t,!0),new _p(e,t))))}endAt(e=null,t){return l("Query.endAt",0,2,arguments.length),new Bp(this.database,Cp(this._delegate,(td("endAt","key",t,!0),new mp(e,t))))}endBefore(e=null,t){return l("Query.endBefore",0,2,arguments.length),new Bp(this.database,Cp(this._delegate,(td("endBefore","key",t,!0),new vp(e,t))))}equalTo(e,t){return l("Query.equalTo",1,2,arguments.length),new Bp(this.database,Cp(this._delegate,(td("equalTo","key",t,!0),new Sp(e,t))))}toString(){return l("Query.toString",0,0,arguments.length),this._delegate.toString()}toJSON(){return l("Query.toJSON",0,1,arguments.length),this._delegate.toJSON()}isEqual(e){if(l("Query.isEqual",1,1,arguments.length),e instanceof Bp)return this._delegate.isEqual(e._delegate);throw new Error("Query.isEqual failed: First argument must be an instance of firebase.database.Query.")}static getCancelAndContextArgs_(e,t,n){const r={cancel:void 0,context:void 0};if(t&&n)r.cancel=t,ke(e,"cancel",r.cancel,!0),r.context=n,Se(e,"context",r.context,!0);else if(t)if("object"==typeof t&&null!==t)r.context=t;else{if("function"!=typeof t)throw new Error(Ee(e,"cancelOrContext")+" must either be a cancel callback or a context object.");r.cancel=t}return r}get ref(){return new jp(this.database,new Xd(this._delegate._repo,this._delegate._path))}}class jp extends Bp{constructor(e,t){super(e,new $d(t._repo,t._path,new tu,!1)),this.database=e,this._delegate=t}getKey(){return l("Reference.key",0,0,arguments.length),this._delegate.key}child(e){return l("Reference.child",1,1,arguments.length),"number"==typeof e&&(e=String(e)),new jp(this.database,np(this._delegate,e))}getParent(){l("Reference.parent",0,0,arguments.length);var e=this._delegate.parent;return e?new jp(this.database,e):null}getRoot(){return l("Reference.root",0,0,arguments.length),new jp(this.database,this._delegate.root)}set(e,t){l("Reference.set",1,2,arguments.length),ke("Reference.set","onComplete",t,!0);const n=rp(this._delegate,e);return t&&n.then(()=>t(null),e=>t(e)),n}update(t,n){if(l("Reference.update",1,2,arguments.length),Array.isArray(t)){const r={};for(let e=0;e<t.length;++e)r[""+e]=t[e];t=r,Lp("Passing an Array to Firebase.update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}rd("Reference.update",this._delegate._path),ke("Reference.update","onComplete",n,!0);const e=ip(this._delegate,t);return n&&e.then(()=>n(null),e=>n(e)),e}setWithPriority(e,t,n){l("Reference.setWithPriority",2,3,arguments.length),ke("Reference.setWithPriority","onComplete",n,!0);const r=function(e,t,n){if(rd("setWithPriority",e._path),Xh("setWithPriority",t,e._path,!1),ed("setWithPriority",n,!1),".length"===e.key||".keys"===e.key)throw"setWithPriority failed: "+e.key+" is a read-only object.";const r=new re;return Ad(e._repo,e._path,t,n,r.wrapCallback(()=>{})),r.promise}(this._delegate,e,t);return n&&r.then(()=>n(null),e=>n(e)),r}remove(t){l("Reference.remove",0,1,arguments.length),ke("Reference.remove","onComplete",t,!0);rd("remove",(n=this._delegate)._path);const e=rp(n,null);var n;return t&&e.then(()=>t(null),e=>t(e)),e}transaction(e,t,n){if(l("Reference.transaction",1,3,arguments.length),ke("Reference.transaction","transactionUpdate",e,!1),ke("Reference.transaction","onComplete",t,!0),void 0!==n&&"boolean"!=typeof n)throw new Error(Ee("Reference.transaction","applyLocally")+"must be a boolean.");const r=Mp(this._delegate,e,{applyLocally:n}).then(e=>new qp(e.committed,new Vp(this.database,e.snapshot)));return t&&r.then(e=>t(null,e.committed,e.snapshot),e=>t(e,!1,null)),r}setPriority(e,t){l("Reference.setPriority",1,2,arguments.length),ke("Reference.setPriority","onComplete",t,!0);const n=function(e,t){rd("setPriority",(e=_(e))._path),ed("setPriority",t,!1);const n=new re;return Ad(e._repo,b(e._path,".priority"),t,null,n.wrapCallback(()=>{})),n.promise}(this._delegate,e);return t&&n.then(()=>t(null),e=>t(e)),n}push(e,t){l("Reference.push",0,2,arguments.length),ke("Reference.push","onComplete",t,!0);const n=function(e,t){rd("push",(e=_(e))._path),Xh("push",t,e._path,!0);var n=Id(e._repo);const r=np(e,n=Hc(n)),i=np(e,n);let s;return s=null!=t?rp(i,t).then(()=>i):Promise.resolve(i),r.then=s.then.bind(s),r.catch=s.then.bind(s,void 0),r}(this._delegate,e),r=n.then(e=>new jp(this.database,e)),i=(t&&r.then(()=>t(null),e=>t(e)),new jp(this.database,n));return i.then=r.then.bind(r),i.catch=r.catch.bind(r,void 0),i}onDisconnect(){return rd("Reference.onDisconnect",this._delegate._path),new Up(new Hd(this._delegate._repo,this._delegate._path))}get key(){return this.getKey()}get parent(){return this.getParent()}get root(){return this.getRoot()}}class Kp{constructor(e,t){this._delegate=e,this.app=t,this.INTERNAL={delete:()=>this._delegate._delete(),forceWebSockets:Dp,forceLongPolling:Pp}}useEmulator(t,n,r={}){{var[t,n,r,i={}]=[this._delegate,t,n,r];(t=_(t))._checkNotDeleted("useEmulator"),t._instanceStarted&&_l("Cannot call useEmulator() after instance has already been initialized.");var s,a=t._repoInternal;let e=void 0;return a.repoInfo_.nodeAdmin?(i.mockUserToken&&_l('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),e=new Ll(Ll.OWNER)):i.mockUserToken&&(s="string"==typeof i.mockUserToken?i.mockUserToken:ie(i.mockUserToken,t.app.options.projectId),e=new Ll(s)),i=a,t=n,n=r,r=e,i.repoInfo_=new Vl(t+":"+n,!1,i.repoInfo_.namespace,i.repoInfo_.webSocketOnly,i.repoInfo_.nodeAdmin,i.repoInfo_.persistenceKey,i.repoInfo_.includeNamespaceInQueryParams),void(r&&(i.authTokenProvider_=r))}}ref(e){var t;return l("database.ref",0,1,arguments.length),t=e instanceof jp?tp(this._delegate,e.toString()):ep(this._delegate,e),new jp(this,t)}refFromURL(e){l("database.refFromURL",1,1,arguments.length);e=tp(this._delegate,e);return new jp(this,e)}goOffline(){var e;l("database.goOffline",0,0,arguments.length),(e=_(e=this._delegate))._checkNotDeleted("goOffline"),xd(e._repo)}goOnline(){return l("database.goOnline",0,0,arguments.length),(e=_(e=this._delegate))._checkNotDeleted("goOnline"),void((e=e._repo).persistentConnection_&&e.persistentConnection_.resume(_d));var e}}Kp.ServerValue={TIMESTAMP:{".sv":"timestamp"},increment:e=>({".sv":{increment:e}})};var Wp=Object.freeze({__proto__:null,initStandalone:function({app:e,url:t,version:n,customAuthImpl:r,namespace:i,nodeAdmin:s=!1}){Xo(n);const a=new Oe("auth-internal",new Me("database-standalone"));return a.setComponent(new o("auth-internal",()=>r,"PRIVATE")),{instance:new Kp(Np(e,a,void 0,t,s),e),namespace:i}}}),Gn=Kp.ServerValue,Ft=((vo=qt).INTERNAL.registerComponent(new o("database-compat",(e,{instanceIdentifier:t})=>{var n=e.getProvider("app-compat").getImmediate(),e=e.getProvider("database").getImmediate({identifier:t});return new Kp(e,n)},"PUBLIC").setServiceProps({Reference:jp,Query:Bp,Database:Kp,DataSnapshot:Vp,enableLogging:function(e,t){vl(e,t)},INTERNAL:Wp,ServerValue:Gn}).setMultipleInstances(!0)),vo.registerVersion("@firebase/database-compat","0.2.10"),"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{}),C=Ft||self;function zp(){}function Gp(e){var t=typeof e;return"array"==(t="object"!=t?t:e?Array.isArray(e)?"array":t:"null")||"object"==t&&"number"==typeof e.length}function Hp(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}Math.random();function $p(e,t,n){return e.call.apply(e.bind,arguments)}function Qp(t,n,e){if(t)return 2<arguments.length?(r=Array.prototype.slice.call(arguments,2),function(){var e=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(e,r),t.apply(n,e)}):function(){return t.apply(n,arguments)};var r;throw Error()}function Yp(e,t,n){return(Yp=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?$p:Qp).apply(null,arguments)}function Jp(t){var n=Array.prototype.slice.call(arguments,1);return function(){var e=n.slice();return e.push.apply(e,arguments),t.apply(this,e)}}function Xp(e,s){function t(){}t.prototype=s.prototype,e.X=s.prototype,e.prototype=new t,(e.prototype.constructor=e).Wb=function(e,t,n){for(var r=Array(arguments.length-2),i=2;i<arguments.length;i++)r[i-2]=arguments[i];return s.prototype[t].apply(e,r)}}function Zp(){this.s=this.s,this.o=this.o}Zp.prototype.s=!1,Zp.prototype.na=function(){this.s||(this.s=!0,this.M())},Zp.prototype.M=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const ef=Array.prototype.indexOf?function(e,t){return Array.prototype.indexOf.call(e,t,void 0)}:function(t,n){if("string"==typeof t)return"string"!=typeof n||1!=n.length?-1:t.indexOf(n,0);for(let e=0;e<t.length;e++)if(e in t&&t[e]===n)return e;return-1};function tf(t){var n=t.length;if(0<n){const r=Array(n);for(let e=0;e<n;e++)r[e]=t[e];return r}return[]}function nf(t){for(let e=1;e<arguments.length;e++){var n=arguments[e];if(Gp(n)){var r=t.length||0,i=n.length||0;t.length=r+i;for(let e=0;e<i;e++)t[r+e]=n[e]}else t.push(n)}}function rf(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}rf.prototype.h=function(){this.defaultPrevented=!0};var sf=function(){if(!C.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{C.addEventListener("test",zp,t),C.removeEventListener("test",zp,t)}catch(e){}return e}();function af(e){return/^[\s\xa0]*$/.test(e)}var of=String.prototype.trim?function(e){return e.trim()}:function(e){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(e)[1]};function lf(e,t){return e<t?-1:t<e?1:0}function cf(){var e=C.navigator;return(e=e&&e.userAgent)?e:""}function uf(e){return-1!=cf().indexOf(e)}function hf(e){return hf[" "](e),e}hf[" "]=zp;var df,Wp=uf("Opera"),pf=uf("Trident")||uf("MSIE"),Gn=uf("Edge"),ff=Gn||pf,gf=uf("Gecko")&&!(-1!=cf().toLowerCase().indexOf("webkit")&&!uf("Edge"))&&!(uf("Trident")||uf("MSIE"))&&!uf("Edge"),vo=-1!=cf().toLowerCase().indexOf("webkit")&&!uf("Edge");function mf(){var e=C.document;return e?e.documentMode:void 0}var vf="",yf=(yf=cf(),gf?/rv:([^\);]+)(\)|;)/.exec(yf):Gn?/Edge\/([\d\.]+)/.exec(yf):pf?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(yf):vo?/WebKit\/(\S+)/.exec(yf):Wp?/(?:Version)[ \/]?(\S+)/.exec(yf):void 0),_f=((yf&&(vf=yf?yf[1]:""),pf&&null!=(yf=mf())&&yf>parseFloat(vf))?df=String(yf):df=vf,{});var wf=C.document&&pf&&(mf()||parseInt(df,10))||void 0;function bf(e,t){if(rf.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e){var n=this.type=e.type,r=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;if(this.target=e.target||e.srcElement,this.g=t,t=e.relatedTarget){if(gf){e:{try{hf(t.nodeName);var i=!0;break e}catch(e){}i=!1}i||(t=null)}}else"mouseover"==n?t=e.fromElement:"mouseout"==n&&(t=e.toElement);this.relatedTarget=t,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType="string"==typeof e.pointerType?e.pointerType:If[e.pointerType]||"",this.state=e.state,(this.i=e).defaultPrevented&&bf.X.h.call(this)}}Xp(bf,rf);var If={2:"touch",3:"pen",4:"mouse"},Tf=(bf.prototype.h=function(){bf.X.h.call(this);var e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1},"closure_listenable_"+(1e6*Math.random()|0)),Ef=0;function kf(e,t,n,r,i){this.listener=e,this.proxy=null,this.src=t,this.type=n,this.capture=!!r,this.ha=i,this.key=++Ef,this.ba=this.ea=!1}function Sf(e){e.ba=!0,e.listener=null,e.proxy=null,e.src=null,e.ha=null}function Cf(e,t,n){for(const r in e)t.call(n,e[r],r,e)}function Af(e){const t={};for(const n in e)t[n]=e[n];return t}const Nf="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Rf(t){let n,r;for(let e=1;e<arguments.length;e++){for(n in r=arguments[e])t[n]=r[n];for(let e=0;e<Nf.length;e++)n=Nf[e],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}}function xf(e){this.src=e,this.g={},this.h=0}function Df(e,t){var n,r,i,s=t.type;s in e.g&&(n=e.g[s],(i=0<=(r=ef(n,t)))&&Array.prototype.splice.call(n,r,1),i&&(Sf(t),0==e.g[s].length&&(delete e.g[s],e.h--)))}function Pf(e,t,n,r){for(var i=0;i<e.length;++i){var s=e[i];if(!s.ba&&s.listener==t&&s.capture==!!n&&s.ha==r)return i}return-1}xf.prototype.add=function(e,t,n,r,i){var s=e.toString(),a=((e=this.g[s])||(e=this.g[s]=[],this.h++),Pf(e,t,r,i));return-1<a?(t=e[a],n||(t.ea=!1)):((t=new kf(t,this.src,s,!!r,i)).ea=n,e.push(t)),t};var Of="closure_lm_"+(1e6*Math.random()|0),Mf={};function Lf(e,t,n,r,i,s){if(!t)throw Error("Invalid event type");var a=Hp(i)?!!i.capture:!!i,o=Vf(e);if(o||(e[Of]=o=new xf(e)),(n=o.add(t,n,r,a,s)).proxy)return n;if(r=function(){const n=qf;return function e(t){return n.call(e.src,e.listener,t)}}(),(n.proxy=r).src=e,r.listener=n,e.addEventListener)void 0===(i=sf?i:a)&&(i=!1),e.addEventListener(t.toString(),r,i);else if(e.attachEvent)e.attachEvent(Uf(t.toString()),r);else{if(!e.addListener||!e.removeListener)throw Error("addEventListener and attachEvent are unavailable.");e.addListener(r)}return n}function Ff(e){var t,n,r;"number"!=typeof e&&e&&!e.ba&&((t=e.src)&&t[Tf]?Df(t.i,e):(n=e.type,r=e.proxy,t.removeEventListener?t.removeEventListener(n,r,e.capture):t.detachEvent?t.detachEvent(Uf(n),r):t.addListener&&t.removeListener&&t.removeListener(r),(n=Vf(t))?(Df(n,e),0==n.h&&(n.src=null,t[Of]=null)):Sf(e)))}function Uf(e){return e in Mf?Mf[e]:Mf[e]="on"+e}function qf(e,t){var n,r;return!!e.ba||(t=new bf(t,this),n=e.listener,r=e.ha||e.src,e.ea&&Ff(e),n.call(r,t))}function Vf(e){return(e=e[Of])instanceof xf?e:null}var Bf="__closure_events_fn_"+(1e9*Math.random()>>>0);function jf(t){return"function"==typeof t?t:(t[Bf]||(t[Bf]=function(e){return t.handleEvent(e)}),t[Bf])}function Kf(){Zp.call(this),this.i=new xf(this),(this.P=this).I=null}function Wf(e,t){var n,r=e.I;if(r)for(n=[];r;r=r.I)n.push(r);if(e=e.P,r=t.type||t,"string"==typeof t?t=new rf(t,e):t instanceof rf?t.target=t.target||e:(a=t,Rf(t=new rf(r,e),a)),a=!0,n)for(var i=n.length-1;0<=i;i--)var s=t.g=n[i],a=zf(s,r,!0,t)&&a;if(a=zf(s=t.g=e,r,!0,t)&&a,a=zf(s,r,!1,t)&&a,n)for(i=0;i<n.length;i++)a=zf(s=t.g=n[i],r,!1,t)&&a}function zf(e,t,n,r){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();for(var i=!0,s=0;s<t.length;++s){var a,o,l=t[s];l&&!l.ba&&l.capture==n&&(a=l.listener,o=l.ha||l.src,l.ea&&Df(e.i,l),i=!1!==a.call(o,r)&&i)}return i&&!r.defaultPrevented}Xp(Kf,Zp),Kf.prototype[Tf]=!0,Kf.prototype.removeEventListener=function(e,t,n,r){!function e(t,n,r,i,s){if(Array.isArray(n))for(var a=0;a<n.length;a++)e(t,n[a],r,i,s);else i=Hp(i)?!!i.capture:!!i,r=jf(r),t&&t[Tf]?(t=t.i,(n=String(n).toString())in t.g&&-1<(r=Pf(a=t.g[n],r,i,s))&&(Sf(a[r]),Array.prototype.splice.call(a,r,1),0==a.length&&(delete t.g[n],t.h--))):(t=t&&Vf(t))&&(n=t.g[n.toString()],(r=(t=-1)<(t=n?Pf(n,r,i,s):t)?n[t]:null)&&Ff(r))}(this,e,t,n,r)},Kf.prototype.M=function(){if(Kf.X.M.call(this),this.i){var e,t=this.i;for(e in t.g){for(var n=t.g[e],r=0;r<n.length;r++)Sf(n[r]);delete t.g[e],t.h--}}this.I=null},Kf.prototype.N=function(e,t,n,r){return this.i.add(String(e),t,!1,n,r)},Kf.prototype.O=function(e,t,n,r){return this.i.add(String(e),t,!0,n,r)};var Gf,Hf=C.JSON.stringify,$f=new class{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}(()=>new Qf,e=>e.reset());class Qf{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}function Yf(e,t){var n;Gf||(n=C.Promise.resolve(void 0),Gf=function(){n.then(Zf)}),Jf||(Gf(),Jf=!0),Xf.add(e,t)}var Jf=!1,Xf=new class{constructor(){this.h=this.g=null}add(e,t){const n=$f.get();n.set(e,t),this.h?this.h.next=n:this.g=n,this.h=n}};function Zf(){for(var e;e=function(){var e=Xf;let t=null;return e.g&&(t=e.g,e.g=e.g.next,e.g||(e.h=null),t.next=null),t}();){try{e.h.call(e.g)}catch(e){!function(e){C.setTimeout(()=>{throw e},0)}(e)}var t=$f;t.j(e),t.h<100&&(t.h++,e.next=t.g,t.g=e)}Jf=!1}function eg(e,t){Kf.call(this),this.h=e||1,this.g=t||C,this.j=Yp(this.lb,this),this.l=Date.now()}function tg(e){e.ca=!1,e.R&&(e.g.clearTimeout(e.R),e.R=null)}function ng(e,t,n){if("function"==typeof e)n&&(e=Yp(e,n));else{if(!e||"function"!=typeof e.handleEvent)throw Error("Invalid listener argument");e=Yp(e.handleEvent,e)}return 2147483647<Number(t)?-1:C.setTimeout(e,t||0)}Xp(eg,Kf),(e=eg.prototype).ca=!1,e.R=null,e.lb=function(){var e;this.ca&&(0<(e=Date.now()-this.l)&&e<.8*this.h?this.R=this.g.setTimeout(this.j,this.h-e):(this.R&&(this.g.clearTimeout(this.R),this.R=null),Wf(this,"tick"),this.ca&&(tg(this),this.start())))},e.start=function(){this.ca=!0,this.R||(this.R=this.g.setTimeout(this.j,this.h),this.l=Date.now())},e.M=function(){eg.X.M.call(this),tg(this),delete this.g};class rg extends Zp{constructor(e,t){super(),this.m=e,this.j=t,this.h=null,this.i=!1,this.g=null}l(e){this.h=arguments,this.g?this.i=!0:function e(t){t.g=ng(()=>{t.g=null,t.i&&(t.i=!1,e(t))},t.j);var n=t.h;t.h=null,t.m.apply(null,n)}(this)}M(){super.M(),this.g&&(C.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function ig(e){Zp.call(this),this.h=e,this.g={}}Xp(ig,Zp);var sg=[];function ag(e,t,n,r){Array.isArray(n)||(n&&(sg[0]=n.toString()),n=sg);for(var i=0;i<n.length;i++){var s=function e(t,n,r,i,s){if(i&&i.once)return function e(t,n,r,i,s){if(Array.isArray(n)){for(var a=0;a<n.length;a++)e(t,n[a],r,i,s);return null}return r=jf(r),t&&t[Tf]?t.O(n,r,Hp(i)?!!i.capture:!!i,s):Lf(t,n,r,!0,i,s)}(t,n,r,i,s);if(Array.isArray(n)){for(var a=0;a<n.length;a++)e(t,n[a],r,i,s);return null}return r=jf(r),t&&t[Tf]?t.N(n,r,Hp(i)?!!i.capture:!!i,s):Lf(t,n,r,!1,i,s)}(t,n[i],r||e.handleEvent,!1,e.h||e);if(!s)break;e.g[s.key]=s}}function og(e){Cf(e.g,function(e,t){this.g.hasOwnProperty(t)&&Ff(e)},e),e.g={}}function lg(){this.g=!0}function cg(e,t,n,r){e.info(function(){return"XMLHTTP TEXT ("+t+"): "+function(e,t){if(!e.g)return t;if(!t)return null;try{var n=JSON.parse(t);if(n)for(e=0;e<n.length;e++)if(Array.isArray(n[e])){var r=n[e];if(!(r.length<2)){var i=r[1];if(Array.isArray(i)&&!(i.length<1)){var s=i[0];if("noop"!=s&&"stop"!=s&&"close"!=s)for(var a=1;a<i.length;a++)i[a]=""}}}return Hf(n)}catch(e){return t}}(e,n)+(r?" "+r:"")})}ig.prototype.M=function(){ig.X.M.call(this),og(this)},ig.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},lg.prototype.Aa=function(){this.g=!1},lg.prototype.info=function(){};var ug={},hg=null;function dg(){return hg=hg||new Kf}function pg(e){rf.call(this,ug.Pa,e)}function fg(){var e=dg();Wf(e,new pg(e))}function gg(e,t){rf.call(this,ug.STAT_EVENT,e),this.stat=t}function mg(e){var t=dg();Wf(t,new gg(t,e))}function vg(e,t){rf.call(this,ug.Qa,e),this.size=t}function yg(e,t){if("function"!=typeof e)throw Error("Fn must not be null and must be a function");return C.setTimeout(function(){e()},t)}function _g(){}function wg(e){return e.h||(e.h=e.i())}function bg(){}function Ig(){rf.call(this,"d")}function Tg(){rf.call(this,"c")}function Eg(){}function kg(e,t,n,r){this.l=e,this.j=t,this.m=n,this.U=r||1,this.S=new ig(this),this.O=Ag,this.T=new eg(e=ff?125:void 0),this.H=null,this.i=!1,this.s=this.A=this.v=this.K=this.F=this.V=this.B=null,this.D=[],this.g=null,this.C=0,this.o=this.u=null,this.Y=-1,this.I=!1,this.N=0,this.L=null,this.$=this.J=this.Z=this.P=!1,this.h=new Sg}function Sg(){this.i=null,this.g="",this.h=!1}ug.Pa="serverreachability",Xp(pg,rf),ug.STAT_EVENT="statevent",Xp(gg,rf),ug.Qa="timingevent",Xp(vg,rf),Vt={NO_ERROR:0,mb:1,zb:2,yb:3,tb:4,xb:5,Ab:6,Ma:7,TIMEOUT:8,Db:9},nl={rb:"complete",Nb:"success",Na:"error",Ma:"abort",Fb:"ready",Gb:"readystatechange",TIMEOUT:"timeout",Bb:"incrementaldata",Eb:"progress",ub:"downloadprogress",Vb:"uploadprogress"},_g.prototype.h=null,Ft={OPEN:"a",qb:"b",Na:"c",Cb:"d"},Xp(Ig,rf),Xp(Tg,rf),Xp(Eg,_g),Eg.prototype.g=function(){return new XMLHttpRequest},Eg.prototype.i=function(){return{}};var Cg=new Eg,Ag=45e3,Ng={},Rg={};function xg(e,t,n){e.K=1,e.v=$g(Wg(t)),e.s=n,e.P=!0,Dg(e,null)}function Dg(e,t){e.F=Date.now(),Mg(e),e.A=Wg(e.v);var a,o,l,c,u,h,n=e.A,r=e.U;Array.isArray(r)||(r=[String(r)]),om(n.i,"t",r),e.C=0,n=e.l.H,e.h=new Sg,e.g=av(e.l,n?t:null,!e.s),0<e.N&&(e.L=new rg(Yp(e.La,e,e.g),e.N)),ag(e.S,e.g,"readystatechange",e.ib),t=e.H?Af(e.H):{},e.s?(e.u||(e.u="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.da(e.A,e.u,e.s,t)):(e.u="GET",e.g.da(e.A,e.u,null,t)),fg(),a=e.j,o=e.u,l=e.A,c=e.m,u=e.U,h=e.s,a.info(function(){if(a.g)if(h)for(var e="",t=h.split("&"),n=0;n<t.length;n++){var r,i,s=t[n].split("=");1<s.length&&(r=s[0],s=s[1],e=2<=(i=r.split("_")).length&&"type"==i[1]?e+(r+"=")+s+"&":e+(r+"=redacted&"))}else e=null;else e=h;return"XMLHTTP REQ ("+c+") [attempt "+u+"]: "+o+"\n"+l+"\n"+e})}function Pg(e){return e.g&&"GET"==e.u&&2!=e.K&&e.l.Da}function Og(e,t,n){let r=!0,i;for(;!e.I&&e.C<n.length;){if((i=(l=void 0,o=(s=e).C,-1==(l=(a=n).indexOf("\n",o))?Rg:(o=Number(a.substring(o,l)),isNaN(o)?Ng:(l+=1)+o>a.length?Rg:(a=a.substr(l,o),s.C=l+o,a))))==Rg){4==t&&(e.o=4,mg(14),r=!1),cg(e.j,e.m,null,"[Incomplete Response]");break}if(i==Ng){e.o=4,mg(15),cg(e.j,e.m,n,"[Invalid Chunk]"),r=!1;break}cg(e.j,e.m,i,null),Vg(e,i)}var s,a,o,l;Pg(e)&&i!=Rg&&i!=Ng&&(e.h.g="",e.C=0),4!=t||0!=n.length||e.h.h||(e.o=1,mg(16),r=!1),e.i=e.i&&r,r?0<n.length&&!e.$&&(e.$=!0,(t=e.l).g==e&&t.$&&!t.K&&(t.j.info("Great, no buffering proxy detected. Bytes received: "+n.length),Xm(t),t.K=!0,mg(11))):(cg(e.j,e.m,n,"[Invalid Chunked Response]"),qg(e),Ug(e))}function Mg(e){e.V=Date.now()+e.O,Lg(e,e.O)}function Lg(e,t){if(null!=e.B)throw Error("WatchDog timer not null");e.B=yg(Yp(e.gb,e),t)}function Fg(e){e.B&&(C.clearTimeout(e.B),e.B=null)}function Ug(e){0==e.l.G||e.I||tv(e.l,e)}function qg(e){Fg(e);var t=e.L;t&&"function"==typeof t.na&&t.na(),e.L=null,tg(e.T),og(e.S),e.g&&(t=e.g,e.g=null,t.abort(),t.na())}function Vg(e,t){try{var n=e.l;if(0!=n.G&&(n.g==e||fm(n.h,e)))if(!e.J&&fm(n.h,e)&&3==n.G){try{var r=n.Fa.g.parse(t)}catch(e){r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){e:if(!n.u){if(n.g){if(!(n.g.F+3e3<e.F))break e;ev(n),Wm(n)}Jm(n),mg(18)}}else n.Ba=i[1],0<n.Ba-n.T&&i[2]<37500&&n.L&&0==n.A&&!n.v&&(n.v=yg(Yp(n.cb,n),6e3));if(pm(n.h)<=1&&n.ja){try{n.ja()}catch(e){}n.ja=void 0}}else rv(n,11)}else if(!e.J&&n.g!=e||ev(n),!af(t))for(i=n.Fa.g.parse(t),t=0;t<i.length;t++){var s=i[t];if(n.T=s[0],s=s[1],2==n.G)if("c"==s[0]){n.I=s[1],n.ka=s[2];var a=s[3],o=(null!=a&&(n.ma=a,n.j.info("VER="+n.ma)),s[4]);null!=o&&(n.Ca=o,n.j.info("SVER="+n.Ca));var l,c,u=s[5];null!=u&&"number"==typeof u&&0<u&&(r=1.5*u,n.J=r,n.j.info("backChannelRequestTimeoutMs_="+r)),r=n;const f=e.g;if(f){const g=f.g?f.g.getResponseHeader("X-Client-Wire-Protocol"):null;!g||(l=r.h).g||-1==g.indexOf("spdy")&&-1==g.indexOf("quic")&&-1==g.indexOf("h2")||(l.j=l.l,l.g=new Set,l.h&&(gm(l,l.h),l.h=null)),r.D&&(c=f.g?f.g.getResponseHeader("X-HTTP-Session-Id"):null)&&(r.za=c,A(r.F,r.D,c))}n.G=3,n.l&&n.l.xa(),n.$&&(n.P=Date.now()-e.F,n.j.info("Handshake RTT: "+n.P+"ms"));var h,d,p=e;(r=n).sa=sv(r,r.H?r.ka:null,r.V),p.J?(mm(r.h,p),h=p,(d=r.J)&&h.setTimeout(d),h.B&&(Fg(h),Mg(h)),r.g=p):Ym(r),0<n.i.length&&Gm(n)}else"stop"!=s[0]&&"close"!=s[0]||rv(n,7);else 3==n.G&&("stop"==s[0]||"close"==s[0]?"stop"==s[0]?rv(n,7):Km(n):"noop"!=s[0]&&n.l&&n.l.wa(s),n.A=0)}fg()}catch(e){}}function Bg(e,t){if(e.forEach&&"function"==typeof e.forEach)e.forEach(t,void 0);else if(Gp(e)||"string"==typeof e)Array.prototype.forEach.call(e,t,void 0);else for(var n=function(e){if(e.oa&&"function"==typeof e.oa)return e.oa();if(!e.W||"function"!=typeof e.W){if("undefined"!=typeof Map&&e instanceof Map)return Array.from(e.keys());if(!("undefined"!=typeof Set&&e instanceof Set)){if(Gp(e)||"string"==typeof e){var t=[];e=e.length;for(var n=0;n<e;n++)t.push(n);return t}t=[],n=0;for(const r in e)t[n++]=r;return t}}}(e),r=function(e){if(e.W&&"function"==typeof e.W)return e.W();if("undefined"!=typeof Map&&e instanceof Map||"undefined"!=typeof Set&&e instanceof Set)return Array.from(e.values());if("string"==typeof e)return e.split("");if(Gp(e)){for(var t=[],n=e.length,r=0;r<n;r++)t.push(e[r]);return t}for(r in t=[],n=0,e)t[n++]=e[r];return t}(e),i=r.length,s=0;s<i;s++)t.call(void 0,r[s],n&&n[s],e)}(e=kg.prototype).setTimeout=function(e){this.O=e},e.ib=function(e){e=e.target;const t=this.L;t&&3==Fm(e)?t.l():this.La(e)},e.La=function(e){try{if(e==this.g)e:{var t=Fm(this.g),n=this.g.Ea();if(this.g.aa(),!(t<3)&&(3!=t||ff||this.g&&(this.h.h||this.g.fa()||Um(this.g)))){this.I||4!=t||7==n||fg(),Fg(this);var r=this.g.aa();this.Y=r;t:if(Pg(this)){var i=Um(this.g),s=(e="",i.length),a=4==Fm(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){qg(this),Ug(this);var o="";break t}this.h.i=new C.TextDecoder}for(n=0;n<s;n++)this.h.h=!0,e+=this.h.i.decode(i[n],{stream:a&&n==s-1});i.splice(0,s),this.h.g+=e,this.C=0,o=this.h.g}else o=this.g.fa();if(this.i=200==r,h=this.j,d=this.u,p=this.A,f=this.m,g=this.U,m=t,v=r,h.info(function(){return"XMLHTTP RESP ("+f+") [ attempt "+g+"]: "+d+"\n"+p+"\n"+m+" "+v}),this.i){if(this.Z&&!this.J){t:{if(this.g){var l,c=this.g;if((l=c.g?c.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!af(l)){var u=l;break t}}u=null}if(!(r=u)){this.i=!1,this.o=3,mg(12),qg(this),Ug(this);break e}cg(this.j,this.m,r,"Initial handshake response via X-HTTP-Initial-Response"),this.J=!0,Vg(this,r)}this.P?(Og(this,t,o),ff&&this.i&&3==t&&(ag(this.S,this.T,"tick",this.hb),this.T.start())):(cg(this.j,this.m,o,null),Vg(this,o)),4==t&&qg(this),this.i&&!this.I&&(4==t?tv(this.l,this):(this.i=!1,Mg(this)))}else 400==r&&0<o.indexOf("Unknown SID")?(this.o=3,mg(12)):(this.o=0,mg(13)),qg(this),Ug(this)}}}catch(e){}var h,d,p,f,g,m,v},e.hb=function(){var e,t;this.g&&(e=Fm(this.g),t=this.g.fa(),this.C<t.length&&(Fg(this),Og(this,e,t),this.i&&4!=e&&Mg(this)))},e.cancel=function(){this.I=!0,qg(this)},e.gb=function(){this.B=null;var e,t,n=Date.now();0<=n-this.V?(e=this.j,t=this.A,e.info(function(){return"TIMEOUT: "+t}),2!=this.K&&(fg(),mg(17)),qg(this),this.o=2,Ug(this)):Lg(this,this.V-n)};var jg=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Kg(e,t){var n;this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,e instanceof Kg?(this.h=void 0!==t?t:e.h,zg(this,e.j),this.s=e.s,this.g=e.g,Gg(this,e.m),this.l=e.l,t=e.i,(n=new rm).i=t.i,t.g&&(n.g=new Map(t.g),n.h=t.h),Hg(this,n),this.o=e.o):e&&(n=String(e).match(jg))?(this.h=!!t,zg(this,n[1]||"",!0),this.s=Qg(n[2]||""),this.g=Qg(n[3]||"",!0),Gg(this,n[4]),this.l=Qg(n[5]||"",!0),Hg(this,n[6]||"",!0),this.o=Qg(n[7]||"")):(this.h=!!t,this.i=new rm(null,this.h))}function Wg(e){return new Kg(e)}function zg(e,t,n){e.j=n?Qg(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function Gg(e,t){if(t){if(t=Number(t),isNaN(t)||t<0)throw Error("Bad port number "+t);e.m=t}else e.m=null}function Hg(e,t,n){var r,i;t instanceof rm?(e.i=t,r=e.i,(i=e.h)&&!r.j&&(im(r),r.i=null,r.g.forEach(function(e,t){var n=t.toLowerCase();t!=n&&(sm(this,t),om(this,n,e))},r)),r.j=i):(n||(t=Yg(t,tm)),e.i=new rm(t,e.h))}function A(e,t,n){e.i.set(t,n)}function $g(e){return A(e,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),e}function Qg(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function Yg(e,t,n){return"string"==typeof e?(e=encodeURI(e).replace(t,Jg),n?e.replace(/%25([0-9a-fA-F]{2})/g,"%$1"):e):null}function Jg(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}Kg.prototype.toString=function(){var e=[],t=this.j,n=(t&&e.push(Yg(t,Xg,!0),":"),this.g);return!n&&"file"!=t||(e.push("//"),(t=this.s)&&e.push(Yg(t,Xg,!0),"@"),e.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.m)&&e.push(":",String(n))),(n=this.l)&&(this.g&&"/"!=n.charAt(0)&&e.push("/"),e.push(Yg(n,"/"==n.charAt(0)?em:Zg,!0))),(n=this.i.toString())&&e.push("?",n),(n=this.o)&&e.push("#",Yg(n,nm)),e.join("")};var Xg=/[#\/\?@]/g,Zg=/[#\?:]/g,em=/[#\?]/g,tm=/[#\?@]/g,nm=/#/g;function rm(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function im(e){if(!e.g&&(e.g=new Map,e.h=0,e.i)){var t=e.i;if(t){t=t.split("&");for(var n=0;n<t.length;n++){var r,i=t[n].indexOf("="),s=null;0<=i?(r=t[n].substring(0,i),s=t[n].substring(i+1)):r=t[n],i=r,s=s?decodeURIComponent(s.replace(/\+/g," ")):"",e.add(decodeURIComponent(i.replace(/\+/g," ")),s)}}}}function sm(e,t){im(e),t=lm(e,t),e.g.has(t)&&(e.i=null,e.h-=e.g.get(t).length,e.g.delete(t))}function am(e,t){return im(e),t=lm(e,t),e.g.has(t)}function om(e,t,n){sm(e,t),0<n.length&&(e.i=null,e.g.set(lm(e,t),tf(n)),e.h+=n.length)}function lm(e,t){return t=String(t),e.j?t.toLowerCase():t}(e=rm.prototype).add=function(e,t){im(this),this.i=null,e=lm(this,e);var n=this.g.get(e);return n||this.g.set(e,n=[]),n.push(t),this.h+=1,this},e.forEach=function(n,r){im(this),this.g.forEach(function(e,t){e.forEach(function(e){n.call(r,e,t,this)},this)},this)},e.oa=function(){im(this);const e=Array.from(this.g.values()),n=Array.from(this.g.keys()),r=[];for(let t=0;t<n.length;t++){var i=e[t];for(let e=0;e<i.length;e++)r.push(n[t])}return r},e.W=function(t){im(this);let n=[];if("string"==typeof t)am(this,t)&&(n=n.concat(this.g.get(lm(this,t))));else{t=Array.from(this.g.values());for(let e=0;e<t.length;e++)n=n.concat(t[e])}return n},e.set=function(e,t){return im(this),this.i=null,am(this,e=lm(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},e.get=function(e,t){return e&&0<(e=this.W(e)).length?String(e[0]):t},e.toString=function(){if(this.i)return this.i;if(!this.g)return"";const e=[],t=Array.from(this.g.keys());for(var n=0;n<t.length;n++)for(var r=t[n],i=encodeURIComponent(String(r)),s=this.W(r),r=0;r<s.length;r++){var a=i;""!==s[r]&&(a+="="+encodeURIComponent(String(s[r]))),e.push(a)}return this.i=e.join("&")};var cm,um=class{constructor(e,t){this.h=e,this.g=t}};function hm(e){this.l=e||10,e=C.PerformanceNavigationTiming?0<(e=C.performance.getEntriesByType("navigation")).length&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):!!(C.g&&C.g.Ga&&C.g.Ga()&&C.g.Ga().$b),this.j=e?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function dm(e){return e.h||e.g&&e.g.size>=e.j}function pm(e){return e.h?1:e.g?e.g.size:0}function fm(e,t){return e.h?e.h==t:e.g&&e.g.has(t)}function gm(e,t){e.g?e.g.add(t):e.h=t}function mm(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function vm(t){if(null!=t.h)return t.i.concat(t.h.D);if(null==t.g||0===t.g.size)return tf(t.i);{let e=t.i;for(const n of t.g.values())e=e.concat(n.D);return e}}function ym(){}function _m(){this.g=new ym}function wm(e,t,n,r,i){try{t.onload=null,t.onerror=null,t.onabort=null,t.ontimeout=null,i(r)}catch(e){}}function bm(e){this.l=e.ac||null,this.j=e.jb||!1}function Im(e,t){Kf.call(this),this.D=e,this.u=t,this.m=void 0,this.readyState=Tm,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}hm.prototype.cancel=function(){if(this.i=vm(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const e of this.g.values())e.cancel();this.g.clear()}},ym.prototype.stringify=function(e){return C.JSON.stringify(e,void 0)},ym.prototype.parse=function(e){return C.JSON.parse(e,void 0)},Xp(bm,_g),bm.prototype.g=function(){return new Im(this.l,this.j)},bm.prototype.i=(cm={},function(){return cm}),Xp(Im,Kf);var Tm=0;function Em(e){e.j.read().then(e.Ta.bind(e)).catch(e.ga.bind(e))}function km(e){e.readyState=4,e.l=null,e.j=null,e.A=null,Sm(e)}function Sm(e){e.onreadystatechange&&e.onreadystatechange.call(e)}(e=Im.prototype).open=function(e,t){if(this.readyState!=Tm)throw this.abort(),Error("Error reopening a connection");this.C=e,this.B=t,this.readyState=1,Sm(this)},e.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const t={headers:this.v,method:this.C,credentials:this.m,cache:void 0};e&&(t.body=e),(this.D||C).fetch(new Request(this.B,t)).then(this.Wa.bind(this),this.ga.bind(this))},e.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,km(this)),this.readyState=Tm},e.Wa=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,Sm(this)),this.g&&(this.readyState=3,Sm(this),this.g)))if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Ua.bind(this),this.ga.bind(this));else if(void 0!==C.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;Em(this)}else e.text().then(this.Va.bind(this),this.ga.bind(this))},e.Ta=function(e){var t;this.g&&(this.u&&e.value?this.response.push(e.value):this.u||(t=e.value||new Uint8Array(0),(t=this.A.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)),(e.done?km:Sm)(this),3==this.readyState&&Em(this))},e.Va=function(e){this.g&&(this.response=this.responseText=e,km(this))},e.Ua=function(e){this.g&&(this.response=e,km(this))},e.ga=function(){this.g&&km(this)},e.setRequestHeader=function(e,t){this.v.append(e,t)},e.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},e.getAllResponseHeaders=function(){if(!this.h)return"";const e=[],t=this.h.entries();for(var n=t.next();!n.done;)n=n.value,e.push(n[0]+": "+n[1]),n=t.next();return e.join("\r\n")},Object.defineProperty(Im.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}});var Cm=C.JSON.parse;function Am(e){Kf.call(this),this.headers=new Map,this.u=e||null,this.h=!1,this.C=this.g=null,this.H="",this.m=0,this.j="",this.l=this.F=this.v=this.D=!1,this.B=0,this.A=null,this.J=Nm,this.K=this.L=!1}Xp(Am,Kf);var Nm="",Rm=/^https?$/i,xm=["POST","PUT"];function Dm(e,t){e.h=!1,e.g&&(e.l=!0,e.g.abort(),e.l=!1),e.j=t,e.m=5,Pm(e),Mm(e)}function Pm(e){e.D||(e.D=!0,Wf(e,"complete"),Wf(e,"error"))}function Om(e){if(e.h&&(!e.C[1]||4!=Fm(e)||2!=e.aa()))if(e.v&&4==Fm(e))ng(e.Ha,0,e);else if(Wf(e,"readystatechange"),4==Fm(e)){e.h=!1;try{var t,n,r,i,s=e.aa();switch(s){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var a=!0;break;default:a=!1}if((t=a)||((n=0===s)&&(!(i=String(e.H).match(jg)[1]||null)&&C.self&&C.self.location&&(i=(r=C.self.location.protocol).substr(0,r.length-1)),n=!Rm.test(i?i.toLowerCase():"")),t=n),t)Wf(e,"complete"),Wf(e,"success");else{e.m=6;try{var o=2<Fm(e)?e.g.statusText:""}catch(e){o=""}e.j=o+" ["+e.aa()+"]",Pm(e)}}finally{Mm(e)}}}function Mm(e,t){if(e.g){Lm(e);const n=e.g,r=e.C[0]?zp:null;e.g=null,e.C=null,t||Wf(e,"ready");try{n.onreadystatechange=r}catch(e){}}}function Lm(e){e.g&&e.K&&(e.g.ontimeout=null),e.A&&(C.clearTimeout(e.A),e.A=null)}function Fm(e){return e.g?e.g.readyState:0}function Um(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.J){case Nm:case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch(e){return null}}function qm(e){let n="";return Cf(e,function(e,t){n=(n=n+t+":")+e+"\r\n"}),n}function Vm(e,t,n){e:{for(r in n){var r=!1;break e}r=!0}r||(n=qm(n),"string"==typeof e?null!=n&&encodeURIComponent(String(n)):A(e,t,n))}function Bm(e,t,n){return n&&n.internalChannelParams&&n.internalChannelParams[e]||t}function jm(e){this.Ca=0,this.i=[],this.j=new lg,this.ka=this.sa=this.F=this.V=this.g=this.za=this.D=this.ia=this.o=this.S=this.s=null,this.ab=this.U=0,this.Za=Bm("failFast",!1,e),this.L=this.v=this.u=this.m=this.l=null,this.Y=!0,this.pa=this.Ba=this.T=-1,this.Z=this.A=this.C=0,this.Xa=Bm("baseRetryDelayMs",5e3,e),this.bb=Bm("retryDelaySeedMs",1e4,e),this.$a=Bm("forwardChannelMaxRetries",2,e),this.ta=Bm("forwardChannelRequestTimeoutMs",2e4,e),this.ra=e&&e.xmlHttpFactory||void 0,this.Da=e&&e.Zb||!1,this.J=void 0,this.H=e&&e.supportsCrossDomainXhr||!1,this.I="",this.h=new hm(e&&e.concurrentRequestLimit),this.Fa=new _m,this.O=e&&e.fastHandshake||!1,this.N=e&&e.encodeInitMessageHeaders||!1,this.O&&this.N&&(this.N=!1),this.Ya=e&&e.Xb||!1,e&&e.Aa&&this.j.Aa(),e&&e.forceLongPolling&&(this.Y=!1),this.$=!this.O&&this.Y&&e&&e.detectBufferingProxy||!1,this.ja=void 0,this.P=0,this.K=!1,this.la=this.B=null}function Km(e){var t,n;zm(e),3==e.G&&(t=e.U++,A(n=Wg(e.F),"SID",e.I),A(n,"RID",t),A(n,"TYPE","terminate"),$m(e,n),(t=new kg(e,e.j,t,void 0)).K=2,t.v=$g(Wg(n)),n=!1,!(n=C.navigator&&C.navigator.sendBeacon?C.navigator.sendBeacon(t.v.toString(),""):n)&&C.Image&&((new Image).src=t.v,n=!0),n||(t.g=av(t.l,null),t.g.da(t.v)),t.F=Date.now(),Mg(t)),iv(e)}function Wm(e){e.g&&(Xm(e),e.g.cancel(),e.g=null)}function zm(e){Wm(e),e.u&&(C.clearTimeout(e.u),e.u=null),ev(e),e.h.cancel(),e.m&&("number"==typeof e.m&&C.clearTimeout(e.m),e.m=null)}function Gm(e){dm(e.h)||e.m||(e.m=!0,Yf(e.Ja,e),e.C=0)}function Hm(e,t){var n=t?t.m:e.U++,r=Wg(e.F);A(r,"SID",e.I),A(r,"RID",n),A(r,"AID",e.T),$m(e,r),e.o&&e.s&&Vm(r,e.o,e.s),n=new kg(e,e.j,n,e.C+1),null===e.o&&(n.H=e.s),t&&(e.i=t.D.concat(e.i)),t=Qm(e,n,1e3),n.setTimeout(Math.round(.5*e.ta)+Math.round(.5*e.ta*Math.random())),gm(e.h,n),xg(n,r,t)}function $m(e,n){e.ia&&Cf(e.ia,function(e,t){A(n,t,e)}),e.l&&Bg({},function(e,t){A(n,t,e)})}function Qm(r,e,i){i=Math.min(r.i.length,i);var s=r.l?Yp(r.l.Ra,r.l,r):null;e:{var a=r.i;let n=-1;for(;;){const c=["count="+i];-1==n?0<i?(n=a[0].h,c.push("ofs="+n)):n=0:c.push("ofs="+n);let t=!0;for(let e=0;e<i;e++){var o=a[e].h,l=a[e].g;if((o-=n)<0)n=Math.max(0,a[e].h-100),t=!1;else try{!function(e,r){const i="req"+o+"_"||"";try{Bg(e,function(e,t){let n=e;Hp(e)&&(n=Hf(e)),r.push(i+t+"="+encodeURIComponent(n))})}catch(e){throw r.push(i+"type="+encodeURIComponent("_badmap")),e}}(l,c)}catch(r){s&&s(l)}}if(t){s=c.join("&");break e}}}return r=r.i.splice(0,i),e.D=r,s}function Ym(e){e.g||e.u||(e.Z=1,Yf(e.Ia,e),e.A=0)}function Jm(e){return!(e.g||e.u||3<=e.A)&&(e.Z++,e.u=yg(Yp(e.Ia,e),nv(e,e.A)),e.A++,1)}function Xm(e){null!=e.B&&(C.clearTimeout(e.B),e.B=null)}function Zm(e){e.g=new kg(e,e.j,"rpc",e.Z),null===e.o&&(e.g.H=e.s),e.g.N=0;var t=Wg(e.sa),n=(A(t,"RID","rpc"),A(t,"SID",e.I),A(t,"CI",e.L?"0":"1"),A(t,"AID",e.T),A(t,"TYPE","xmlhttp"),$m(e,t),e.o&&e.s&&Vm(t,e.o,e.s),e.J&&e.g.setTimeout(e.J),e.g);e=e.ka,n.K=1,n.v=$g(Wg(t)),n.s=null,n.P=!0,Dg(n,e)}function ev(e){null!=e.v&&(C.clearTimeout(e.v),e.v=null)}function tv(e,t){var n,r,i,s=null;if(e.g==t){ev(e),Xm(e),e.g=null;var a=2}else{if(!fm(e.h,t))return;s=t.D,mm(e.h,t),a=1}if(0!=e.G)if(e.pa=t.Y,t.i)1==a?(s=t.s?t.s.length:0,t=Date.now()-t.F,n=e.C,Wf(a=dg(),new vg(a,s)),Gm(e)):Ym(e);else if(3==(n=t.o)||0==n&&0<e.pa||(1!=a||(i=t,pm((r=e).h)>=r.h.j-(r.m?1:0)||(r.m?(r.i=i.D.concat(r.i),0):1==r.G||2==r.G||r.C>=(r.Za?0:r.$a)||(r.m=yg(Yp(r.Ja,r,i),nv(r,r.C)),r.C++,0))))&&(2!=a||!Jm(e)))switch(s&&0<s.length&&(t=e.h,t.i=t.i.concat(s)),n){case 1:rv(e,5);break;case 4:rv(e,10);break;case 3:rv(e,6);break;default:rv(e,2)}}function nv(e,t){let n=e.Xa+Math.floor(Math.random()*e.bb);return e.l||(n*=2),n*t}function rv(e,t){if(e.j.info("Error code "+t),2==t){n=null,e.l&&(n=null),r=Yp(e.kb,e),n||(n=new Kg("//www.google.com/images/cleardot.gif"),C.location&&"http"==C.location.protocol||zg(n,"https"),$g(n));var n=n.toString(),r,i=new lg;if(C.Image){const s=new Image;s.onload=Jp(wm,i,s,"TestLoadImage: loaded",!0,r),s.onerror=Jp(wm,i,s,"TestLoadImage: error",!1,r),s.onabort=Jp(wm,i,s,"TestLoadImage: abort",!1,r),s.ontimeout=Jp(wm,i,s,"TestLoadImage: timeout",!1,r),C.setTimeout(function(){s.ontimeout&&s.ontimeout()},1e4),s.src=n}else r(!1)}else mg(2);e.G=0,e.l&&e.l.va(t),iv(e),zm(e)}function iv(e){var t;e.G=0,e.la=[],e.l&&(0==(t=vm(e.h)).length&&0==e.i.length||(nf(e.la,t),nf(e.la,e.i),e.h.i.length=0,tf(e.i),e.i.length=0),e.l.ua())}function sv(e,t,n){var r,i,s=n instanceof Kg?Wg(n):new Kg(n,void 0);return""!=s.g?(t&&(s.g=t+"."+s.g),Gg(s,s.m)):(s=(r=C.location).protocol,t=t?t+"."+r.hostname:r.hostname,r=+r.port,i=new Kg(null,void 0),s&&zg(i,s),t&&(i.g=t),r&&Gg(i,r),n&&(i.l=n),s=i),n=e.D,t=e.za,n&&t&&A(s,n,t),A(s,"VER",e.ma),$m(e,s),s}function av(e,t,n){if(t&&!e.H)throw Error("Can't create secondary domain capable XhrIo object.");return(t=n&&e.Da&&!e.ra?new Am(new bm({jb:!0})):new Am(e.ra)).Ka(e.H),t}function ov(){}function lv(){if(pf&&!(10<=Number(wf)))throw Error("Environmental error: no available transport.")}function cv(e,t){Kf.call(this),this.g=new jm(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.s=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.ya&&(e?e["X-WebChannel-Client-Profile"]=t.ya:e={"X-WebChannel-Client-Profile":t.ya}),this.g.S=e,(e=t&&t.Yb)&&!af(e)&&(this.g.o=e),this.A=t&&t.supportsCrossDomainXhr||!1,this.v=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!af(t)&&(this.g.D=t,null!==(e=this.h)&&t in e&&t in(e=this.h)&&delete e[t]),this.j=new dv(this)}function uv(e){Ig.call(this);var t=e.__sm__;if(t){e:{for(const n in t){e=n;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function hv(){Tg.call(this),this.status=1}function dv(e){this.g=e}(e=Am.prototype).Ka=function(e){this.L=e},e.da=function(e,t,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.H+"; newUri="+e);t=t?t.toUpperCase():"GET",this.H=e,this.j="",this.m=0,this.D=!1,this.h=!0,this.g=(this.u||Cg).g(),this.C=this.u?wg(this.u):wg(Cg),this.g.onreadystatechange=Yp(this.Ha,this);try{this.F=!0,this.g.open(t,String(e),!0),this.F=!1}catch(e){return void Dm(this,e)}if(e=n||"",n=new Map(this.headers),r)if(Object.getPrototypeOf(r)===Object.prototype)for(var i in r)n.set(i,r[i]);else{if("function"!=typeof r.keys||"function"!=typeof r.get)throw Error("Unknown input type for opt_headers: "+String(r));for(const u of r.keys())n.set(u,r.get(u))}r=Array.from(n.keys()).find(e=>"content-type"==e.toLowerCase()),i=C.FormData&&e instanceof C.FormData,0<=ef(xm,t)&&!r&&!i&&n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(var[s,a]of n)this.g.setRequestHeader(s,a);this.J&&(this.g.responseType=this.J),"withCredentials"in this.g&&this.g.withCredentials!==this.L&&(this.g.withCredentials=this.L);try{Lm(this),0<this.B&&((this.K=(c=this.g,pf&&(o=function(){let t=0;var n=of(String(df)).split("."),r=of("9").split("."),i=Math.max(n.length,r.length);for(let e=0;0==t&&e<i;e++)for(var s=n[e]||"",a=r[e]||"";s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],a=/(\d*)(\D*)(.*)/.exec(a)||["","","",""],(0!=s[0].length||0!=a[0].length)&&(t=lf(0==s[1].length?0:parseInt(s[1],10),0==a[1].length?0:parseInt(a[1],10))||lf(0==s[2].length,0==a[2].length)||lf(s[2],a[2]),s=s[3],a=a[3],0==t););return 0<=t},l=_f,Object.prototype.hasOwnProperty.call(l,9)?l[9]:l[9]=o())&&"number"==typeof c.timeout&&void 0!==c.ontimeout))?(this.g.timeout=this.B,this.g.ontimeout=Yp(this.qa,this)):this.A=ng(this.qa,this.B,this)),this.v=!0,this.g.send(e),this.v=!1}catch(e){Dm(this,e)}var o,l,c},e.qa=function(){this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,Wf(this,"timeout"),this.abort(8))},e.abort=function(e){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=e||7,Wf(this,"complete"),Wf(this,"abort"),Mm(this))},e.M=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),Mm(this,!0)),Am.X.M.call(this)},e.Ha=function(){this.s||(this.F||this.v||this.l?Om(this):this.fb())},e.fb=function(){Om(this)},e.aa=function(){try{return 2<Fm(this)?this.g.status:-1}catch(e){return-1}},e.fa=function(){try{return this.g?this.g.responseText:""}catch(e){return""}},e.Sa=function(e){var t;if(this.g)return t=this.g.responseText,e&&0==t.indexOf(e)&&(t=t.substring(e.length)),Cm(t)},e.Ea=function(){return this.m},e.Oa=function(){return"string"==typeof this.j?this.j:String(this.j)},(e=jm.prototype).ma=8,e.G=1,e.Ja=function(t){if(this.m)if(this.m=null,1==this.G){if(!t){this.U=Math.floor(1e5*Math.random()),t=this.U++;const s=new kg(this,this.j,t,void 0);let e=this.s;if(this.S&&(e?Rf(e=Af(e),this.S):e=this.S),null!==this.o||this.N||(s.H=e,e=null),this.O)e:{for(var n=0,r=0;r<this.i.length;r++){var i=this.i[r];if(void 0===(i="__data__"in i.g&&"string"==typeof(i=i.g.__data__)?i.length:void 0))break;if(4096<(n+=i)){n=r;break e}if(4096===n||r===this.i.length-1){n=r+1;break e}}n=1e3}else n=1e3;n=Qm(this,s,n),A(r=Wg(this.F),"RID",t),A(r,"CVER",22),this.D&&A(r,"X-HTTP-Session-Id",this.D),$m(this,r),e&&(this.N?n="headers="+encodeURIComponent(String(qm(e)))+"&"+n:this.o&&Vm(r,this.o,e)),gm(this.h,s),this.Ya&&A(r,"TYPE","init"),this.O?(A(r,"$req",n),A(r,"SID","null"),s.Z=!0,xg(s,r,null)):xg(s,r,n),this.G=2}}else 3==this.G&&(t?Hm(this,t):0==this.i.length||dm(this.h)||Hm(this))},e.Ia=function(){var e;this.u=null,Zm(this),this.$&&!(this.K||null==this.g||this.P<=0)&&(e=2*this.P,this.j.info("BP detection timer enabled: "+e),this.B=yg(Yp(this.eb,this),e))},e.eb=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.L=!1,this.K=!0,mg(10),Wm(this),Zm(this))},e.cb=function(){null!=this.v&&(this.v=null,Wm(this),Jm(this),mg(19))},e.kb=function(e){e?(this.j.info("Successfully pinged google.com"),mg(2)):(this.j.info("Failed to ping google.com"),mg(1))},(e=ov.prototype).xa=function(){},e.wa=function(){},e.va=function(){},e.ua=function(){},e.Ra=function(){},lv.prototype.g=function(e,t){return new cv(e,t)},Xp(cv,Kf),cv.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.H=!0);var e=this.g,t=this.l,n=this.h||void 0;mg(0),e.V=t,e.ia=n||{},e.L=e.Y,e.F=sv(e,null,e.V),Gm(e)},cv.prototype.close=function(){Km(this.g)},cv.prototype.u=function(e){var t,n=this.g;"string"==typeof e?((t={}).__data__=e,e=t):this.v&&((t={}).__data__=Hf(e),e=t),n.i.push(new um(n.ab++,e)),3==n.G&&Gm(n)},cv.prototype.M=function(){this.g.l=null,delete this.j,Km(this.g),delete this.g,cv.X.M.call(this)},Xp(uv,Ig),Xp(hv,Tg),Xp(dv,ov),dv.prototype.xa=function(){Wf(this.g,"a")},dv.prototype.wa=function(e){Wf(this.g,new uv(e))},dv.prototype.va=function(e){Wf(this.g,new hv)},dv.prototype.ua=function(){Wf(this.g,"b")},lv.prototype.createWebChannel=lv.prototype.g,cv.prototype.send=cv.prototype.u,cv.prototype.open=cv.prototype.m,Vt.NO_ERROR=0,Vt.TIMEOUT=8,Vt.HTTP_ERROR=6,nl.COMPLETE="complete",(bg.EventType=Ft).OPEN="a",Ft.CLOSE="b",Ft.ERROR="c",Ft.MESSAGE="d",Kf.prototype.listen=Kf.prototype.N,Am.prototype.listenOnce=Am.prototype.O,Am.prototype.getLastError=Am.prototype.Oa,Am.prototype.getLastErrorCode=Am.prototype.Ea,Am.prototype.getStatus=Am.prototype.aa,Am.prototype.getResponseJson=Am.prototype.Sa,Am.prototype.getResponseText=Am.prototype.fa,Am.prototype.send=Am.prototype.da,Am.prototype.setWithCredentials=Am.prototype.Ka;var pv,fv,gv=dg,mv=Vt,vv=nl,yv=ug,_v=bm,wv=bg,bv=Am,Gn="@firebase/firestore";class Iv{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Iv.UNAUTHENTICATED=new Iv(null),Iv.GOOGLE_CREDENTIALS=new Iv("google-credentials-uid"),Iv.FIRST_PARTY=new Iv("first-party-uid"),Iv.MOCK_USER=new Iv("mock-user");let Tv="9.14.0";const Ev=new Be("@firebase/firestore");function kv(){return Ev.logLevel}function p(e,...t){Ev.logLevel<=h.DEBUG&&(t=t.map(Av),Ev.debug(`Firestore (${Tv}): `+e,...t))}function Sv(e,...t){Ev.logLevel<=h.ERROR&&(t=t.map(Av),Ev.error(`Firestore (${Tv}): `+e,...t))}function Cv(e,...t){Ev.logLevel<=h.WARN&&(t=t.map(Av),Ev.warn(`Firestore (${Tv}): `+e,...t))}function Av(t){if("string"==typeof t)return t;try{return JSON.stringify(t)}catch(e){return t}}function N(e="Unexpected state"){e=`FIRESTORE (${Tv}) INTERNAL ASSERTION FAILED: `+e;throw Sv(e),new Error(e)}function R(e){e||N()}const x={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class D extends se{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: `+this.message}}class Nv{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class Rv{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization","Bearer "+e)}}class xv{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(Iv.UNAUTHENTICATED))}shutdown(){}}class Dv{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class Pv{constructor(e){this.t=e,this.currentUser=Iv.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,n){let r=this.i;const i=e=>this.i!==r?(r=this.i,n(e)):Promise.resolve();let s=new Nv;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new Nv,t.enqueueRetryable(()=>i(this.currentUser))};const a=()=>{const e=s;t.enqueueRetryable(async()=>{await e.promise,await i(this.currentUser)})},o=e=>{p("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.auth.addAuthTokenListener(this.o),a()};this.t.onInit(e=>o(e)),setTimeout(()=>{var e;this.auth||((e=this.t.getImmediate({optional:!0}))?o(e):(p("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new Nv))},0),a()}getToken(){const t=this.i,e=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(e).then(e=>this.i!==t?(p("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):e?(R("string"==typeof e.accessToken),new Rv(e.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){var e=this.auth&&this.auth.getUid();return R(null===e||"string"==typeof e),new Iv(e)}}class Ov{constructor(e,t,n,r){this.h=e,this.l=t,this.m=n,this.g=r,this.type="FirstParty",this.user=Iv.FIRST_PARTY,this.p=new Map}I(){return this.g?this.g():(R(!("object"!=typeof this.h||null===this.h||!this.h.auth||!this.h.auth.getAuthHeaderValueForFirstParty)),this.h.auth.getAuthHeaderValueForFirstParty([]))}get headers(){this.p.set("X-Goog-AuthUser",this.l);var e=this.I();return e&&this.p.set("Authorization",e),this.m&&this.p.set("X-Goog-Iam-Authorization-Token",this.m),this.p}}class Mv{constructor(e,t,n,r){this.h=e,this.l=t,this.m=n,this.g=r}getToken(){return Promise.resolve(new Ov(this.h,this.l,this.m,this.g))}start(e,t){e.enqueueRetryable(()=>t(Iv.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class Lv{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&0<e.length&&this.headers.set("x-firebase-appcheck",this.value)}}class Fv{constructor(e){this.T=e,this.forceRefresh=!1,this.appCheck=null,this.A=null}start(t,n){const r=e=>{null!=e.error&&p("FirebaseAppCheckTokenProvider","Error getting App Check token; using placeholder token instead. Error: "+e.error.message);var t=e.token!==this.A;return this.A=e.token,p("FirebaseAppCheckTokenProvider",`Received ${t?"new":"existing"} token.`),t?n(e.token):Promise.resolve()},i=(this.o=e=>{t.enqueueRetryable(()=>r(e))},e=>{p("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.appCheck.addTokenListener(this.o)});this.T.onInit(e=>i(e)),setTimeout(()=>{var e;this.appCheck||((e=this.T.getImmediate({optional:!0}))?i(e):p("FirebaseAppCheckTokenProvider","AppCheck not yet detected"))},0)}getToken(){var e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(e=>e?(R("string"==typeof e.token),this.A=e.token,new Lv(e.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}class Uv{static R(){var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=Math.floor(256/t.length)*t.length;let r="";for(;r.length<20;){var i=function(){const e="undefined"!=typeof self&&(self.crypto||self.msCrypto),t=new Uint8Array(40);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(t);else for(let e=0;e<40;e++)t[e]=Math.floor(256*Math.random());return t}();for(let e=0;e<i.length;++e)r.length<20&&i[e]<n&&(r+=t.charAt(i[e]%t.length))}return r}}function P(e,t){return e<t?-1:t<e?1:0}function qv(e,n,r){return e.length===n.length&&e.every((e,t)=>r(e,n[t]))}function Vv(e){return e+"\0"}class Bv{constructor(e,t){if(this.seconds=e,(this.nanoseconds=t)<0)throw new D(x.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(1e9<=t)throw new D(x.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new D(x.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(253402300800<=e)throw new D(x.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return Bv.fromMillis(Date.now())}static fromDate(e){return Bv.fromMillis(e.getTime())}static fromMillis(e){var t=Math.floor(e/1e3),e=Math.floor(1e6*(e-1e3*t));return new Bv(t,e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?P(this.nanoseconds,e.nanoseconds):P(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){var e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class O{constructor(e){this.timestamp=e}static fromTimestamp(e){return new O(e)}static min(){return new O(new Bv(0,0))}static max(){return new O(new Bv(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class jv{constructor(e,t,n){void 0===t?t=0:t>e.length&&N(),void 0===n?n=e.length-t:n>e.length-t&&N(),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return 0===jv.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof jv?e.forEach(e=>{t.push(e)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return this.construct(this.segments,this.offset+(e=void 0===e?1:e),this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(t){if(t.length<this.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}isImmediateParentOf(t){if(this.length+1!==t.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}forEach(n){for(let e=this.offset,t=this.limit();e<t;e++)n(this.segments[e])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,n){const r=Math.min(t.length,n.length);for(let e=0;e<r;e++){const r=t.get(e),i=n.get(e);if(r<i)return-1;if(r>i)return 1}return t.length<n.length?-1:t.length>n.length?1:0}}class M extends jv{construct(e,t,n){return new M(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...e){const t=[];for(const n of e){if(0<=n.indexOf("//"))throw new D(x.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter(e=>0<e.length))}return new M(t)}static emptyPath(){return new M([])}}const Kv=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Wv extends jv{construct(e,t,n){return new Wv(e,t,n)}static isValidIdentifier(e){return Kv.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),e=Wv.isValidIdentifier(e)?e:"`"+e+"`")).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new Wv(["__name__"])}static fromServerFormat(e){const t=[];let n="",r=0;var i=()=>{if(0===n.length)throw new D(x.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""};let s=!1;for(;r<e.length;){const t=e[r];if("\\"===t){if(r+1===e.length)throw new D(x.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const t=e[r+1];if("\\"!==t&&"."!==t&&"`"!==t)throw new D(x.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=t,r+=2}else"`"===t?s=!s:"."!==t||s?n+=t:i(),r++}if(i(),s)throw new D(x.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Wv(t)}static emptyPath(){return new Wv([])}}class L{constructor(e){this.path=e}static fromPath(e){return new L(M.fromString(e))}static fromName(e){return new L(M.fromString(e).popFirst(5))}static empty(){return new L(M.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return 2<=this.path.length&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===M.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return M.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new L(new M(e.slice()))}}class zv{constructor(e,t,n,r){this.indexId=e,this.collectionGroup=t,this.fields=n,this.indexState=r}}function Gv(e){return e.fields.find(e=>2===e.kind)}function Hv(e){return e.fields.filter(e=>2!==e.kind)}zv.UNKNOWN_ID=-1;class $v{constructor(e,t){this.fieldPath=e,this.kind=t}}class Qv{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new Qv(0,Xv.min())}}function Yv(e,t){var n=e.toTimestamp().seconds,e=e.toTimestamp().nanoseconds+1,e=O.fromTimestamp(1e9===e?new Bv(n+1,0):new Bv(n,e));return new Xv(e,L.empty(),t)}function Jv(e){return new Xv(e.readTime,e.key,-1)}class Xv{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new Xv(O.min(),L.empty(),-1)}static max(){return new Xv(O.max(),L.empty(),-1)}}function Zv(e,t){let n=e.readTime.compareTo(t.readTime);return 0!==n?n:0!==(n=L.comparator(e.documentKey,t.documentKey))?n:P(e.largestBatchId,t.largestBatchId)}const ey="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class ty{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}async function ny(e){if(e.code!==x.FAILED_PRECONDITION||e.message!==ey)throw e;p("LocalStore","Unexpectedly lost primary lease")}class F{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)},e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)})}catch(e){return this.next(void 0,e)}next(r,i){return this.callbackAttached&&N(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(i,this.error):this.wrapSuccess(r,this.result):new F((t,n)=>{this.nextCallback=e=>{this.wrapSuccess(r,e).next(t,n)},this.catchCallback=e=>{this.wrapFailure(i,e).next(t,n)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{var t=e();return t instanceof F?t:F.resolve(t)}catch(e){return F.reject(e)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):F.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):F.reject(t)}static resolve(n){return new F((e,t)=>{e(n)})}static reject(n){return new F((e,t)=>{t(n)})}static waitFor(e){return new F((t,n)=>{let r=0,i=0,s=!1;e.forEach(e=>{++r,e.next(()=>{++i,s&&i===r&&t()},e=>n(e))}),s=!0,i===r&&t()})}static or(e){let t=F.resolve(!1);for(const n of e)t=t.next(e=>e?F.resolve(e):n());return t}static forEach(e,n){const r=[];return e.forEach((e,t)=>{r.push(n.call(this,e,t))}),this.waitFor(r)}static mapArray(o,l){return new F((t,n)=>{const r=o.length,i=new Array(r);let s=0;for(let e=0;e<r;e++){const a=e;l(o[a]).next(e=>{i[a]=e,++s===r&&t(i)},e=>n(e))}})}static doWhile(r,i){return new F((e,t)=>{const n=()=>{!0===r()?i().next(()=>{n()},t):e()};n()})}}class ry{constructor(t,e){this.action=t,this.transaction=e,this.aborted=!1,this.P=new Nv,this.transaction.oncomplete=()=>{this.P.resolve()},this.transaction.onabort=()=>{e.error?this.P.reject(new ay(t,e.error)):this.P.resolve()},this.transaction.onerror=e=>{e=hy(e.target.error);this.P.reject(new ay(t,e))}}static open(e,t,n,r){try{return new ry(t,e.transaction(r,n))}catch(e){throw new ay(t,e)}}get v(){return this.P.promise}abort(e){e&&this.P.reject(e),this.aborted||(p("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}V(){const e=this.transaction;this.aborted||"function"!=typeof e.commit||e.commit()}store(e){e=this.transaction.objectStore(e);return new ly(e)}}class iy{constructor(e,t,n){this.name=e,this.version=t,this.S=n,12.2===iy.D(d())&&Sv("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return p("SimpleDb","Removing database:",e),cy(window.indexedDB.deleteDatabase(e)).toPromise()}static C(){if(!Y())return!1;if(iy.N())return!0;const e=d(),t=iy.D(e),n=0<t&&t<10,r=iy.k(e),i=0<r&&r<4.5;return!(0<e.indexOf("MSIE ")||0<e.indexOf("Trident/")||0<e.indexOf("Edge/")||n||i)}static N(){var e;return"undefined"!=typeof process&&"YES"===(null==(e=process.env)?void 0:e.O)}static M(e,t){return e.store(t)}static D(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(n)}static k(e){const t=e.match(/Android ([\d.]+)/i),n=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(n)}async F(i){return this.db||(p("SimpleDb","Opening database:",this.name),this.db=await new Promise((t,n)=>{const r=indexedDB.open(this.name,this.version);r.onsuccess=e=>{e=e.target.result;t(e)},r.onblocked=()=>{n(new ay(i,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},r.onerror=e=>{e=e.target.error;"VersionError"===e.name?n(new D(x.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):"InvalidStateError"===e.name?n(new D(x.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+e)):n(new ay(i,e))},r.onupgradeneeded=e=>{p("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',e.oldVersion);var t=e.target.result;this.S.$(t,r.transaction,e.oldVersion,this.version).next(()=>{p("SimpleDb","Database upgrade to version "+this.version+" complete")})}})),this.B&&(this.db.onversionchange=e=>this.B(e)),this.db}L(t){this.B=t,this.db&&(this.db.onversionchange=e=>t(e))}async runTransaction(e,t,n,r){var i="readonly"===t;let s=0;for(;;){++s;try{this.db=await this.F(e);const t=ry.open(this.db,e,i?"readonly":"readwrite",n),s=r(t).next(e=>(t.V(),e)).catch(e=>(t.abort(e),F.reject(e))).toPromise();return s.catch(()=>{}),await t.v,s}catch(e){const t=e,n="FirebaseError"!==t.name&&s<3;if(p("SimpleDb","Transaction failed with error:",t.message,"Retrying:",n),this.close(),!n)return Promise.reject(t)}}}close(){this.db&&this.db.close(),this.db=void 0}}class sy{constructor(e){this.U=e,this.q=!1,this.K=null}get isDone(){return this.q}get G(){return this.K}set cursor(e){this.U=e}done(){this.q=!0}j(e){this.K=e}delete(){return cy(this.U.delete())}}class ay extends D{constructor(e,t){super(x.UNAVAILABLE,`IndexedDB transaction '${e}' failed: `+t),this.name="IndexedDbTransactionError"}}function oy(e){return"IndexedDbTransactionError"===e.name}class ly{constructor(e){this.store=e}put(e,t){return cy(void 0!==t?(p("SimpleDb","PUT",this.store.name,e,t),this.store.put(t,e)):(p("SimpleDb","PUT",this.store.name,"<auto-key>",e),this.store.put(e)))}add(e){return p("SimpleDb","ADD",this.store.name,e,e),cy(this.store.add(e))}get(t){return cy(this.store.get(t)).next(e=>(p("SimpleDb","GET",this.store.name,t,e=void 0===e?null:e),e))}delete(e){return p("SimpleDb","DELETE",this.store.name,e),cy(this.store.delete(e))}count(){return p("SimpleDb","COUNT",this.store.name),cy(this.store.count())}W(e,n){var t=this.options(e,n);if(t.index||"function"!=typeof this.store.getAll){const e=this.cursor(t),n=[];return this.H(e,(e,t)=>{n.push(t)}).next(()=>n)}{const e=this.store.getAll(t.range);return new F((t,n)=>{e.onerror=e=>{n(e.target.error)},e.onsuccess=e=>{t(e.target.result)}})}}J(e,t){const r=this.store.getAll(e,null===t?void 0:t);return new F((t,n)=>{r.onerror=e=>{n(e.target.error)},r.onsuccess=e=>{t(e.target.result)}})}Y(e,t){p("SimpleDb","DELETE ALL",this.store.name);const n=this.options(e,t);n.X=!1;e=this.cursor(n);return this.H(e,(e,t,n)=>n.delete())}Z(e,t){let n;t?n=e:(n={},t=e);e=this.cursor(n);return this.H(e,t)}tt(r){const e=this.cursor({});return new F((n,t)=>{e.onerror=e=>{e=hy(e.target.error);t(e)},e.onsuccess=e=>{const t=e.target.result;t?r(t.primaryKey,t.value).next(e=>{e?t.continue():n()}):n()}})}H(e,s){const a=[];return new F((i,t)=>{e.onerror=e=>{t(e.target.error)},e.onsuccess=e=>{const t=e.target.result;if(t){const n=new sy(t),r=s(t.primaryKey,t.value,n);if(r instanceof F){const e=r.catch(e=>(n.done(),F.reject(e)));a.push(e)}n.isDone?i():null===n.G?t.continue():t.continue(n.G)}else i()}}).next(()=>F.waitFor(a))}options(e,t){let n;return void 0!==e&&("string"==typeof e?n=e:t=e),{index:n,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const n=this.store.index(e.index);return e.X?n.openKeyCursor(e.range,t):n.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function cy(e){return new F((t,n)=>{e.onsuccess=e=>{e=e.target.result;t(e)},e.onerror=e=>{e=hy(e.target.error);n(e)}})}let uy=!1;function hy(e){const t=iy.D(d());if(12.2<=t&&t<13){const t="An internal error was encountered in the Indexed Database server";if(0<=e.message.indexOf(t)){const e=new D("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return uy||(uy=!0,setTimeout(()=>{throw e},0)),e}}return e}class dy{constructor(e,t){this.asyncQueue=e,this.et=t,this.task=null}start(){this.nt(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return null!==this.task}nt(e){p("IndexBackiller",`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,async()=>{this.task=null;try{p("IndexBackiller","Documents written: "+await this.et.st())}catch(e){oy(e)?p("IndexBackiller","Ignoring IndexedDB error during index backfill: ",e):await ny(e)}await this.nt(6e4)})}}class py{constructor(e,t){this.localStore=e,this.persistence=t}async st(t=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",e=>this.it(e,t))}it(e,t){const n=new Set;let r=t,i=!0;return F.doWhile(()=>!0===i&&0<r,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(t=>null===t||n.has(t)?void(i=!1):(p("IndexBackiller","Processing collection: "+t),this.rt(e,t,r).next(e=>{r-=e,n.add(t)})))).next(()=>t-r)}rt(r,i,e){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(r,i).next(n=>this.localStore.localDocuments.getNextDocuments(r,i,n,e).next(e=>{const t=e.changes;return this.localStore.indexManager.updateIndexEntries(r,t).next(()=>this.ot(n,e)).next(e=>(p("IndexBackiller","Updating offset: "+e),this.localStore.indexManager.updateCollectionGroup(r,i,e))).next(()=>t.size)}))}ot(e,t){let n=e;return t.changes.forEach((e,t)=>{t=Jv(t);0<Zv(t,n)&&(n=t)}),new Xv(n.readTime,n.documentKey,Math.max(t.batchId,e.largestBatchId))}}class fy{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this.ut(e),this.ct=e=>t.writeSequenceNumber(e))}ut(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){var e=++this.previousValue;return this.ct&&this.ct(e),e}}function gy(e){let t=0;for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t++;return t}function my(e,t){for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function vy(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}fy.at=-1;class yy{constructor(e,t){this.comparator=e,this.root=t||wy.EMPTY}insert(e,t){return new yy(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,wy.BLACK,null,null))}remove(e){return new yy(this.comparator,this.root.remove(e,this.comparator).copy(null,null,wy.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){var n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:0<n&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){var r=this.comparator(e,n.key);if(0===r)return t+n.left.size;n=r<0?n.left:(t+=n.left.size+1,n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(n){this.inorderTraversal((e,t)=>(n(e,t),!1))}toString(){const n=[];return this.inorderTraversal((e,t)=>(n.push(e+":"+t),!1)),`{${n.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new _y(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new _y(this.root,e,this.comparator,!1)}getReverseIterator(){return new _y(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new _y(this.root,e,this.comparator,!0)}}class _y{constructor(e,t,n,r){this.isReverse=r,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?n(e.key,t):1,t&&r&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(0===i){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();var t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return 0<this.nodeStack.length}peek(){if(0===this.nodeStack.length)return null;var e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class wy{constructor(e,t,n,r,i){this.key=e,this.value=t,this.color=null!=n?n:wy.RED,this.left=null!=r?r:wy.EMPTY,this.right=null!=i?i:wy.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,r,i){return new wy(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let r=this;var i=n(e,r.key);return(r=i<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===i?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n))).fixUp()}removeMin(){if(this.left.isEmpty())return wy.EMPTY;let e=this;return(e=(e=e.left.isRed()||e.left.left.isRed()?e:e.moveRedLeft()).copy(null,null,null,e.left.removeMin(),null)).fixUp()}remove(e,t){let n,r=this;if(t(e,r.key)<0)r=(r=r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()?r:r.moveRedLeft()).copy(null,null,null,r.left.remove(e,t),null);else{if(0===t(e,(r=(r=r.left.isRed()?r.rotateRight():r).right.isEmpty()||r.right.isRed()||r.right.left.isRed()?r:r.moveRedRight()).key)){if(r.right.isEmpty())return wy.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e=(e=(e=e.right.isRed()&&!e.left.isRed()?e.rotateLeft():e).left.isRed()&&e.left.left.isRed()?e.rotateRight():e).left.isRed()&&e.right.isRed()?e.colorFlip():e}moveRedLeft(){let e=this.colorFlip();return e=e.right.left.isRed()?(e=(e=e.copy(null,null,null,null,e.right.rotateRight())).rotateLeft()).colorFlip():e}moveRedRight(){let e=this.colorFlip();return e=e.left.left.isRed()?(e=e.rotateRight()).colorFlip():e}rotateLeft(){var e=this.copy(null,null,wy.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){var e=this.copy(null,null,wy.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){var e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){var e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw N();if(this.right.isRed())throw N();var e=this.left.check();if(e!==this.right.check())throw N();return e+(this.isRed()?0:1)}}wy.EMPTY=null,wy.RED=!0,wy.BLACK=!1,wy.EMPTY=new class{constructor(){this.size=0}get key(){throw N()}get value(){throw N()}get color(){throw N()}get left(){throw N()}get right(){throw N()}copy(e,t,n,r,i){return this}insert(e,t,n){return new wy(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class U{constructor(e){this.comparator=e,this.data=new yy(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(n){this.data.inorderTraversal((e,t)=>(n(e),!1))}forEachInRange(e,t){const n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){var r=n.getNext();if(0<=this.comparator(r.key,e[1]))return;t(r.key)}}forEachWhile(e,t){let n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new by(this.data.getIterator())}getIteratorFrom(e){return new by(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(e=>{t=t.add(e)}),t}isEqual(e){if(!(e instanceof U))return!1;if(this.size!==e.size)return!1;const t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){const e=t.getNext().key,r=n.getNext().key;if(0!==this.comparator(e,r))return!1}return!0}toArray(){const t=[];return this.forEach(e=>{t.push(e)}),t}toString(){const t=[];return this.forEach(e=>t.push(e)),"SortedSet("+t.toString()+")"}copy(e){const t=new U(this.comparator);return t.data=e,t}}class by{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function Iy(e){return e.hasNext()?e.getNext():void 0}class Ty{constructor(e){(this.fields=e).sort(Wv.comparator)}static empty(){return new Ty([])}unionWith(e){let t=new U(Wv.comparator);for(const e of this.fields)t=t.add(e);for(const n of e)t=t.add(n);return new Ty(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return qv(this.fields,e.fields,(e,t)=>e.isEqual(t))}}class Ey{constructor(e){this.binaryString=e}static fromBase64String(e){e=atob(e);return new Ey(e)}static fromUint8Array(e){e=function(t){let n="";for(let e=0;e<t.length;++e)n+=String.fromCharCode(t[e]);return n}(e);return new Ey(e)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return e=this.binaryString,btoa(e);var e}toUint8Array(){{var t=this.binaryString;const n=new Uint8Array(t.length);for(let e=0;e<t.length;e++)n[e]=t.charCodeAt(e);return n}}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return P(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Ey.EMPTY_BYTE_STRING=new Ey("");const ky=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Sy(t){if(R(!!t),"string"!=typeof t)return{seconds:Cy(t.seconds),nanos:Cy(t.nanos)};{let e=0;var n=ky.exec(t);R(!!n),n[1]&&(n=(n[1]+"000000000").substr(0,9),e=Number(n));const r=new Date(t);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}}function Cy(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function Ay(e){return"string"==typeof e?Ey.fromBase64String(e):Ey.fromUint8Array(e)}function Ny(e){return"server_timestamp"===(null==(e=((null==(e=null==e?void 0:e.mapValue)?void 0:e.fields)||{}).__type__)?void 0:e.stringValue)}function Ry(e){e=Sy(e.mapValue.fields.__local_write_time__.timestampValue);return new Bv(e.seconds,e.nanos)}class xy{constructor(e,t,n,r,i,s,a,o){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=r,this.ssl=i,this.forceLongPolling=s,this.autoDetectLongPolling=a,this.useFetchStreams=o}}class Dy{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new Dy("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(e){return e instanceof Dy&&e.projectId===this.projectId&&e.database===this.database}}function Py(e){return null==e}function Oy(e){return 0===e&&1/e==-1/0}function My(e){return"number"==typeof e&&Number.isInteger(e)&&!Oy(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}const Ly={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},Fy={nullValue:"NULL_VALUE"};function Uy(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?Ny(e)?4:Jy(e)?9007199254740991:10:N()}function qy(e,t){if(e===t)return!0;var n,r=Uy(e);if(r!==Uy(t))return!1;switch(r){case 0:case 9007199254740991:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return Ry(e).isEqual(Ry(t));case 3:var i=t;if("string"==typeof e.timestampValue&&"string"==typeof i.timestampValue&&e.timestampValue.length===i.timestampValue.length)return e.timestampValue===i.timestampValue;var s=Sy(e.timestampValue),i=Sy(i.timestampValue);return s.seconds===i.seconds&&s.nanos===i.nanos;case 5:return e.stringValue===t.stringValue;case 6:return n=t,Ay(e.bytesValue).isEqual(Ay(n.bytesValue));case 7:return e.referenceValue===t.referenceValue;case 8:return s=t,Cy((n=e).geoPointValue.latitude)===Cy(s.geoPointValue.latitude)&&Cy(n.geoPointValue.longitude)===Cy(s.geoPointValue.longitude);case 2:return i=t,"integerValue"in(n=e)&&"integerValue"in i?Cy(n.integerValue)===Cy(i.integerValue):"doubleValue"in n&&"doubleValue"in i&&((n=Cy(n.doubleValue))===(i=Cy(i.doubleValue))?Oy(n)===Oy(i):isNaN(n)&&isNaN(i));case 9:return qv(e.arrayValue.values||[],t.arrayValue.values||[],qy);case 10:{var a=e;const o=a.mapValue.fields||{},l=t.mapValue.fields||{};if(gy(o)!==gy(l))return!1;for(const a in o)if(o.hasOwnProperty(a)&&(void 0===l[a]||!qy(o[a],l[a])))return!1;return!0;return}default:return N()}}function Vy(e,t){return void 0!==(e.values||[]).find(e=>qy(e,t))}function By(e,t){if(e===t)return 0;var n=Uy(e),r=Uy(t);if(n!==r)return P(n,r);switch(n){case 0:case 9007199254740991:return 0;case 1:return P(e.booleanValue,t.booleanValue);case 2:return p=t,(i=Cy(e.integerValue||e.doubleValue))<(c=Cy(p.integerValue||p.doubleValue))?-1:c<i?1:i===c?0:isNaN(i)?isNaN(c)?0:-1:1;case 3:return jy(e.timestampValue,t.timestampValue);case 4:return jy(Ry(e),Ry(t));case 5:return P(e.stringValue,t.stringValue);case 6:{var i=e.bytesValue;var s=t.bytesValue;const m=Ay(i),v=Ay(s);return m.compareTo(v);return}case 7:var s=e.referenceValue,a=t.referenceValue,o=s.split("/"),l=a.split("/");for(let e=0;e<o.length&&e<l.length;e++){const a=P(o[e],l[e]);if(0!==a)return a}return P(o.length,l.length);case 8:return a=e.geoPointValue,p=t.geoPointValue,0!==(c=P(Cy(a.latitude),Cy(p.latitude)))?c:P(Cy(a.longitude),Cy(p.longitude));case 9:var c=e.arrayValue,u=t.arrayValue,h=c.values||[],d=u.values||[];for(let e=0;e<h.length&&e<d.length;++e){const u=By(h[e],d[e]);if(u)return u}return P(h.length,d.length);case 10:{var p=e.mapValue;var f=t.mapValue;if(p===Ly.mapValue&&f===Ly.mapValue)return 0;if(p===Ly.mapValue)return 1;if(f===Ly.mapValue)return-1;const y=p.fields||{},_=Object.keys(y),w=f.fields||{},b=Object.keys(w);_.sort(),b.sort();for(let e=0;e<_.length&&e<b.length;++e){const f=P(_[e],b[e]);if(0!==f)return f;var g=By(y[_[e]],w[b[e]]);if(0!==g)return g}return P(_.length,b.length);return}default:throw N()}}function jy(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return P(e,t);var e=Sy(e),t=Sy(t),n=P(e.seconds,t.seconds);return 0!==n?n:P(e.nanos,t.nanos)}function Ky(e){return function n(r){{if("nullValue"in r)return"null";if("booleanValue"in r)return""+r.booleanValue;if("integerValue"in r)return""+r.integerValue;if("doubleValue"in r)return""+r.doubleValue;if("timestampValue"in r)return`time(${(e=Sy(r.timestampValue)).seconds},${e.nanos})`;if("stringValue"in r)return r.stringValue;if("bytesValue"in r)return Ay(r.bytesValue).toBase64();if("referenceValue"in r)return t=r.referenceValue,L.fromName(t).toString();if("geoPointValue"in r)return`geo(${(t=r.geoPointValue).latitude},${t.longitude})`;if("arrayValue"in r){let e="[",t=!0;for(const s of r.arrayValue.values||[])t?t=!1:e+=",",e+=n(s);return e+"]"}if("mapValue"in r){var i=r.mapValue;let e="{",t=!0;for(const a of Object.keys(i.fields||{}).sort())t?t=!1:e+=",",e+=a+":"+n(i.fields[a]);return e+"}"}return N()}var e,t}(e)}function Wy(e,t){return{referenceValue:`projects/${e.projectId}/databases/${e.database}/documents/`+t.path.canonicalString()}}function zy(e){return e&&"integerValue"in e}function Gy(e){return!!e&&"arrayValue"in e}function Hy(e){return e&&"nullValue"in e}function $y(e){return e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function Qy(e){return e&&"mapValue"in e}function Yy(t){if(t.geoPointValue)return{geoPointValue:Object.assign({},t.geoPointValue)};if(t.timestampValue&&"object"==typeof t.timestampValue)return{timestampValue:Object.assign({},t.timestampValue)};if(t.mapValue){const n={mapValue:{fields:{}}};return my(t.mapValue.fields,(e,t)=>n.mapValue.fields[e]=Yy(t)),n}if(t.arrayValue){const r={arrayValue:{values:[]}};for(let e=0;e<(t.arrayValue.values||[]).length;++e)r.arrayValue.values[e]=Yy(t.arrayValue.values[e]);return r}return Object.assign({},t)}function Jy(e){return"__max__"===(((e.mapValue||{}).fields||{}).__type__||{}).stringValue}function Xy(e,t){var n=By(e.value,t.value);return 0!==n?n:e.inclusive&&!t.inclusive?-1:!e.inclusive&&t.inclusive?1:0}function Zy(e,t){var n=By(e.value,t.value);return 0!==n?n:e.inclusive&&!t.inclusive?1:!e.inclusive&&t.inclusive?-1:0}class e_{constructor(e){this.value=e}static empty(){return new e_({mapValue:{}})}field(n){if(n.isEmpty())return this.value;{let t=this.value;for(let e=0;e<n.length-1;++e)if(!Qy(t=(t.mapValue.fields||{})[n.get(e)]))return null;return(t=(t.mapValue.fields||{})[n.lastSegment()])||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Yy(t)}setAll(e){let n=Wv.emptyPath(),r={},i=[];e.forEach((e,t)=>{if(!n.isImmediateParentOf(t)){const e=this.getFieldsMap(n);this.applyChanges(e,r,i),r={},i=[],n=t.popLast()}e?r[t.lastSegment()]=Yy(e):i.push(t.lastSegment())});e=this.getFieldsMap(n);this.applyChanges(e,r,i)}delete(e){const t=this.field(e.popLast());Qy(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return qy(this.value,e.value)}getFieldsMap(n){let r=this.value;r.mapValue.fields||(r.mapValue={fields:{}});for(let t=0;t<n.length;++t){let e=r.mapValue.fields[n.get(t)];Qy(e)&&e.mapValue.fields||(e={mapValue:{fields:{}}},r.mapValue.fields[n.get(t)]=e),r=e}return r.mapValue.fields}applyChanges(n,e,t){my(e,(e,t)=>n[e]=t);for(const e of t)delete n[e]}clone(){return new e_(Yy(this.value))}}class q{constructor(e,t,n,r,i,s){this.key=e,this.documentType=t,this.version=n,this.readTime=r,this.data=i,this.documentState=s}static newInvalidDocument(e){return new q(e,0,O.min(),O.min(),e_.empty(),0)}static newFoundDocument(e,t,n){return new q(e,1,t,O.min(),n,0)}static newNoDocument(e,t){return new q(e,2,t,O.min(),e_.empty(),0)}static newUnknownDocument(e,t){return new q(e,3,t,O.min(),e_.empty(),2)}convertToFoundDocument(e,t){return this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=e_.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=e_.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=O.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof q&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new q(this.key,this.documentType,this.version,this.readTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class t_{constructor(e,t=null,n=[],r=[],i=null,s=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=s,this.endAt=a,this.ht=null}}function n_(e,t=null,n=[],r=[],i=null,s=null,a=null){return new t_(e,t,n,r,i,s,a)}function r_(e){const t=e;if(null===t.ht){let e=t.path.canonicalString();null!==t.collectionGroup&&(e+="|cg:"+t.collectionGroup),e=(e=(e+="|f:")+t.filters.map(e=>{return(e=e).field.canonicalString()+e.op.toString()+Ky(e.value)}).join(",")+"|ob:")+t.orderBy.map(e=>{return e.field.canonicalString()+e.dir}).join(","),Py(t.limit)||(e=(e+="|l:")+t.limit),t.startAt&&(e=(e=(e+="|lb:")+(t.startAt.inclusive?"b:":"a:"))+t.startAt.position.map(e=>Ky(e)).join(",")),t.endAt&&(e=(e=(e+="|ub:")+(t.endAt.inclusive?"a:":"b:"))+t.endAt.position.map(e=>Ky(e)).join(",")),t.ht=e}return t.ht}function i_(t,n){if(t.limit!==n.limit)return!1;if(t.orderBy.length!==n.orderBy.length)return!1;for(let e=0;e<t.orderBy.length;e++)if(r=t.orderBy[e],i=n.orderBy[e],r.dir!==i.dir||!r.field.isEqual(i.field))return!1;var r,i,s,a;if(t.filters.length!==n.filters.length)return!1;for(let e=0;e<t.filters.length;e++)if(s=t.filters[e],a=n.filters[e],s.op!==a.op||!s.field.isEqual(a.field)||!qy(s.value,a.value))return!1;return t.collectionGroup===n.collectionGroup&&!!t.path.isEqual(n.path)&&!!b_(t.startAt,n.startAt)&&b_(t.endAt,n.endAt)}function s_(e){return L.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}function a_(e,t){return e.filters.filter(e=>e instanceof c_&&e.field.isEqual(t))}function o_(t,n,r){let i=Fy,s=!0;for(const r of a_(t,n)){let e=Fy,t=!0;switch(r.op){case"<":case"<=":e="nullValue"in(a=r.value)?Fy:"booleanValue"in a?{booleanValue:!1}:"integerValue"in a||"doubleValue"in a?{doubleValue:NaN}:"timestampValue"in a?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in a?{stringValue:""}:"bytesValue"in a?{bytesValue:""}:"referenceValue"in a?Wy(Dy.empty(),L.empty()):"geoPointValue"in a?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in a?{arrayValue:{}}:"mapValue"in a?{mapValue:{}}:N();break;case"==":case"in":case">=":e=r.value;break;case">":e=r.value,t=!1;break;case"!=":case"not-in":e=Fy}Xy({value:i,inclusive:s},{value:e,inclusive:t})<0&&(i=e,s=t)}var a;if(null!==r)for(let e=0;e<t.orderBy.length;++e)if(t.orderBy[e].field.isEqual(n)){const t=r.position[e];Xy({value:i,inclusive:s},{value:t,inclusive:r.inclusive})<0&&(i=t,s=r.inclusive);break}return{value:i,inclusive:s}}function l_(t,n,r){let i=Ly,s=!0;for(const r of a_(t,n)){let e=Ly,t=!0;switch(r.op){case">=":case">":e="nullValue"in(a=r.value)?{booleanValue:!1}:"booleanValue"in a?{doubleValue:NaN}:"integerValue"in a||"doubleValue"in a?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in a?{stringValue:""}:"stringValue"in a?{bytesValue:""}:"bytesValue"in a?Wy(Dy.empty(),L.empty()):"referenceValue"in a?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in a?{arrayValue:{}}:"arrayValue"in a?{mapValue:{}}:"mapValue"in a?Ly:N(),t=!1;break;case"==":case"in":case"<=":e=r.value;break;case"<":e=r.value,t=!1;break;case"!=":case"not-in":e=Ly}0<Zy({value:i,inclusive:s},{value:e,inclusive:t})&&(i=e,s=t)}var a;if(null!==r)for(let e=0;e<t.orderBy.length;++e)if(t.orderBy[e].field.isEqual(n)){const t=r.position[e];0<Zy({value:i,inclusive:s},{value:t,inclusive:r.inclusive})&&(i=t,s=r.inclusive);break}return{value:i,inclusive:s}}class c_ extends class{}{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?"in"===t||"not-in"===t?this.lt(e,t,n):new u_(e,t,n):"array-contains"===t?new f_(e,n):"in"===t?new g_(e,n):"not-in"===t?new m_(e,n):"array-contains-any"===t?new v_(e,n):new c_(e,t,n)}static lt(e,t,n){return new("in"===t?h_:d_)(e,n)}matches(e){e=e.data.field(this.field);return"!="===this.op?null!==e&&this.ft(By(e,this.value)):null!==e&&Uy(this.value)===Uy(e)&&this.ft(By(e,this.value))}ft(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return 0<e;case">=":return 0<=e;default:return N()}}dt(){return 0<=["<","<=",">",">=","!=","not-in"].indexOf(this.op)}}class u_ extends c_{constructor(e,t,n){super(e,t,n),this.key=L.fromName(n.referenceValue)}matches(e){e=L.comparator(e.key,this.key);return this.ft(e)}}class h_ extends c_{constructor(e,t){super(e,"in",t),this.keys=p_(0,t)}matches(t){return this.keys.some(e=>e.isEqual(t.key))}}class d_ extends c_{constructor(e,t){super(e,"not-in",t),this.keys=p_(0,t)}matches(t){return!this.keys.some(e=>e.isEqual(t.key))}}function p_(e,t){return((null==(t=t.arrayValue)?void 0:t.values)||[]).map(e=>L.fromName(e.referenceValue))}class f_ extends c_{constructor(e,t){super(e,"array-contains",t)}matches(e){e=e.data.field(this.field);return Gy(e)&&Vy(e.arrayValue,this.value)}}class g_ extends c_{constructor(e,t){super(e,"in",t)}matches(e){e=e.data.field(this.field);return null!==e&&Vy(this.value.arrayValue,e)}}class m_ extends c_{constructor(e,t){super(e,"not-in",t)}matches(e){if(Vy(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;e=e.data.field(this.field);return null!==e&&!Vy(this.value.arrayValue,e)}}class v_ extends c_{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!Gy(t)||!t.arrayValue.values)&&t.arrayValue.values.some(e=>Vy(this.value.arrayValue,e))}}class y_{constructor(e,t){this.position=e,this.inclusive=t}}class __{constructor(e,t="asc"){this.field=e,this.dir=t}}function w_(t,n,r){let i=0;for(let e=0;e<t.position.length;e++){const s=n[e],a=t.position[e];if(i=s.field.isKeyField()?L.comparator(L.fromName(a.referenceValue),r.key):By(a,r.data.field(s.field)),"desc"===s.dir&&(i*=-1),0!==i)break}return i}function b_(t,n){if(null===t)return null===n;if(null===n)return!1;if(t.inclusive!==n.inclusive||t.position.length!==n.position.length)return!1;for(let e=0;e<t.position.length;e++)if(!qy(t.position[e],n.position[e]))return!1;return!0}class I_{constructor(e,t=null,n=[],r=[],i=null,s="F",a=null,o=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=s,this.startAt=a,this.endAt=o,this._t=null,this.wt=null,this.startAt,this.endAt}}function T_(e,t,n,r,i,s,a,o){return new I_(e,t,n,r,i,s,a,o)}function E_(e){return new I_(e)}function k_(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}function S_(e){return 0<e.explicitOrderBy.length?e.explicitOrderBy[0].field:null}function C_(e){for(const t of e.filters)if(t.dt())return t.field;return null}function A_(e){return null!==e.collectionGroup}function N_(t){const n=t;if(null===n._t){n._t=[];const t=C_(n),e=S_(n);if(null!==t&&null===e)t.isKeyField()||n._t.push(new __(t)),n._t.push(new __(Wv.keyField(),"asc"));else{let e=!1;for(const r of n.explicitOrderBy)n._t.push(r),r.field.isKeyField()&&(e=!0);if(!e){const t=0<n.explicitOrderBy.length?n.explicitOrderBy[n.explicitOrderBy.length-1].dir:"asc";n._t.push(new __(Wv.keyField(),t))}}}return n._t}function R_(e){const t=e;if(!t.wt)if("F"===t.limitType)t.wt=n_(t.path,t.collectionGroup,N_(t),t.filters,t.limit,t.startAt,t.endAt);else{const e=[];for(const i of N_(t)){const t="desc"===i.dir?"asc":"desc";e.push(new __(i.field,t))}var n=t.endAt?new y_(t.endAt.position,t.endAt.inclusive):null,r=t.startAt?new y_(t.startAt.position,t.startAt.inclusive):null;t.wt=n_(t.path,t.collectionGroup,e,t.filters,t.limit,n,r)}return t.wt}function x_(e,t,n){return new I_(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}function D_(e,t){return i_(R_(e),R_(t))&&e.limitType===t.limitType}function P_(e){return r_(R_(e))+"|lt:"+e.limitType}function O_(e){return`Query(target=${function(e){let t=e.path.canonicalString();return null!==e.collectionGroup&&(t+=" collectionGroup="+e.collectionGroup),0<e.filters.length&&(t+=`, filters: [${e.filters.map(e=>{return`${(e=e).field.canonicalString()} ${e.op} `+Ky(e.value)}).join(", ")}]`),Py(e.limit)||(t+=", limit: "+e.limit),0<e.orderBy.length&&(t+=`, orderBy: [${e.orderBy.map(e=>{return`${e.field.canonicalString()} (${e.dir})`}).join(", ")}]`),e.startAt&&(t=(t=(t+=", startAt: ")+(e.startAt.inclusive?"b:":"a:"))+e.startAt.position.map(e=>Ky(e)).join(",")),`Target(${t=e.endAt?(t=(t+=", endAt: ")+(e.endAt.inclusive?"a:":"b:"))+e.endAt.position.map(e=>Ky(e)).join(","):t})`}(R_(e))}; limitType=${e.limitType})`}function M_(n,e){return e.isFoundDocument()&&(a=(s=e).key.path,null!==(i=n).collectionGroup?s.key.hasCollectionId(i.collectionGroup)&&i.path.isPrefixOf(a):L.isDocumentKey(i.path)?i.path.isEqual(a):i.path.isImmediateParentOf(a))&&function(e){for(const t of n.explicitOrderBy)if(!t.field.isKeyField()&&null===e.data.field(t.field))return;return 1}(e)&&function(e){for(const t of n.filters)if(!t.matches(e))return;return 1}(e)&&(i=e,(!(e=n).startAt||(r=w_(t=e.startAt,N_(e),i),t.inclusive?r<=0:r<0))&&(!e.endAt||(r=w_(t=e.endAt,N_(e),i),t.inclusive?0<=r:0<r)));var t,r,i,s,a}function L_(e){return e.collectionGroup||(e.path.length%2==1?e.path.lastSegment():e.path.get(e.path.length-2))}function F_(i){return(e,t)=>{let n=!1;for(const r of N_(i)){const i=function(e,t,n){var r,i=e.field.isKeyField()?L.comparator(t.key,n.key):(r=e.field,n=n,t=t.data.field(r),n=n.data.field(r),null!==t&&null!==n?By(t,n):N());switch(e.dir){case"asc":return i;case"desc":return-1*i;default:return N()}}(r,e,t);if(0!==i)return i;n=n||r.field.isKeyField()}return 0}}function U_(e,t){if(e.gt){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Oy(t)?"-0":t}}function q_(e){return{integerValue:""+e}}function V_(e,t){return My(t)?q_(t):U_(e,t)}class B_{constructor(){this._=void 0}}function j_(e,t){return e instanceof $_?zy(e=t)||e&&"doubleValue"in e?t:{integerValue:0}:null}class K_ extends B_{}class W_ extends B_{constructor(e){super(),this.elements=e}}function z_(e,t){const n=Y_(t);for(const t of e.elements)n.some(e=>qy(e,t))||n.push(t);return{arrayValue:{values:n}}}class G_ extends B_{constructor(e){super(),this.elements=e}}function H_(e,t){let n=Y_(t);for(const t of e.elements)n=n.filter(e=>!qy(e,t));return{arrayValue:{values:n}}}class $_ extends B_{constructor(e,t){super(),this.It=e,this.yt=t}}function Q_(e){return Cy(e.integerValue||e.doubleValue)}function Y_(e){return Gy(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}class J_{constructor(e,t){this.field=e,this.transform=t}}class X_{constructor(e,t){this.version=e,this.transformResults=t}}class Z_{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new Z_}static exists(e){return new Z_(void 0,e)}static updateTime(e){return new Z_(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function ew(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class tw{}function nw(e,n){if(!e.hasLocalMutations||n&&0===n.fields.length)return null;if(null===n)return e.isNoDocument()?new uw(e.key,Z_.none()):new sw(e.key,e.data,Z_.none());{const i=e.data,s=e_.empty();let t=new U(Wv.comparator);for(var r of n.fields)if(!t.has(r)){let e=i.field(r);null===e&&1<r.length&&(r=r.popLast(),e=i.field(r)),null===e?s.delete(r):s.set(r,e),t=t.add(r)}return new aw(e.key,s,new Ty(t.toArray()),Z_.none())}}function rw(e,t,n,r){if(e instanceof sw){var i=e,s=t,a=n,o=r;if(!ew(i.precondition,s))return a;const l=i.value.clone(),c=cw(i.fieldTransforms,o,s);return l.setAll(c),s.convertToFoundDocument(s.version,l).setHasLocalMutations(),null}if(e instanceof aw){a=e,i=t,o=n,s=r;if(!ew(a.precondition,i))return o;const u=cw(a.fieldTransforms,s,i),h=i.data;return h.setAll(ow(a)),h.setAll(u),i.convertToFoundDocument(i.version,h).setHasLocalMutations(),null===o?null:o.unionWith(a.fieldMask.fields).unionWith(a.fieldTransforms.map(e=>e.field))}return ew(e.precondition,t)?(t.convertToNoDocument(t.version).setHasLocalMutations(),null):n}function iw(e,t){return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&(n=e.fieldTransforms,r=t.fieldTransforms,!!(void 0===n&&void 0===r||n&&r&&qv(n,r,(e,t)=>{return e.field.isEqual(t.field)&&(e=e.transform,t=t.transform,e instanceof W_&&t instanceof W_||e instanceof G_&&t instanceof G_?qv(e.elements,t.elements,qy):e instanceof $_&&t instanceof $_?qy(e.yt,t.yt):e instanceof K_&&t instanceof K_)}))&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask)));var n,r}class sw extends tw{constructor(e,t,n,r=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}}class aw extends tw{constructor(e,t,n,r,i=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=r,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function ow(n){const r=new Map;return n.fieldMask.fields.forEach(e=>{var t;e.isEmpty()||(t=n.data.field(e),r.set(e,t))}),r}function lw(t,n,r){const i=new Map;R(t.length===r.length);for(let e=0;e<r.length;e++){var s=t[e],a=s.transform,o=n.data.field(s.field);i.set(s.field,(s=a,a=o,o=r[e],s instanceof W_?z_(s,a):s instanceof G_?H_(s,a):o))}return i}function cw(e,t,n){const r=new Map;for(const c of e){const e=c.transform,u=n.data.field(c.field);r.set(c.field,(i=e,s=u,a=t,0,i instanceof K_?function(){const e={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:a.seconds,nanos:a.nanoseconds}}}};return s&&(e.fields.__previous_value__=s),{mapValue:e}}():i instanceof W_?z_(i,s):i instanceof G_?H_(i,s):(l=Q_(o=j_(i,s))+Q_(i.yt),zy(o)&&zy(i.yt)?q_(l):U_(i.It,l))))}var i,s,a,o,l;return r}class uw extends tw{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class hw extends tw{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class dw{constructor(e){this.count=e}}function pw(e){switch(e){default:return N(),0;case x.CANCELLED:case x.UNKNOWN:case x.DEADLINE_EXCEEDED:case x.RESOURCE_EXHAUSTED:case x.INTERNAL:case x.UNAVAILABLE:case x.UNAUTHENTICATED:return;case x.INVALID_ARGUMENT:case x.NOT_FOUND:case x.ALREADY_EXISTS:case x.PERMISSION_DENIED:case x.FAILED_PRECONDITION:case x.ABORTED:case x.OUT_OF_RANGE:case x.UNIMPLEMENTED:case x.DATA_LOSS:return 1}}function fw(e){if(void 0===e)return Sv("GRPC error has no .code"),x.UNKNOWN;switch(e){case pv.OK:return x.OK;case pv.CANCELLED:return x.CANCELLED;case pv.UNKNOWN:return x.UNKNOWN;case pv.DEADLINE_EXCEEDED:return x.DEADLINE_EXCEEDED;case pv.RESOURCE_EXHAUSTED:return x.RESOURCE_EXHAUSTED;case pv.INTERNAL:return x.INTERNAL;case pv.UNAVAILABLE:return x.UNAVAILABLE;case pv.UNAUTHENTICATED:return x.UNAUTHENTICATED;case pv.INVALID_ARGUMENT:return x.INVALID_ARGUMENT;case pv.NOT_FOUND:return x.NOT_FOUND;case pv.ALREADY_EXISTS:return x.ALREADY_EXISTS;case pv.PERMISSION_DENIED:return x.PERMISSION_DENIED;case pv.FAILED_PRECONDITION:return x.FAILED_PRECONDITION;case pv.ABORTED:return x.ABORTED;case pv.OUT_OF_RANGE:return x.OUT_OF_RANGE;case pv.UNIMPLEMENTED:return x.UNIMPLEMENTED;case pv.DATA_LOSS:return x.DATA_LOSS;default:return N()}}Vt=pv={OK:0,0:"OK",CANCELLED:1,1:"CANCELLED",UNKNOWN:2,2:"UNKNOWN",INVALID_ARGUMENT:3,3:"INVALID_ARGUMENT",DEADLINE_EXCEEDED:4,4:"DEADLINE_EXCEEDED",NOT_FOUND:5,5:"NOT_FOUND",ALREADY_EXISTS:6,6:"ALREADY_EXISTS",PERMISSION_DENIED:7,7:"PERMISSION_DENIED",UNAUTHENTICATED:16,16:"UNAUTHENTICATED",RESOURCE_EXHAUSTED:8,8:"RESOURCE_EXHAUSTED",FAILED_PRECONDITION:9,9:"FAILED_PRECONDITION",ABORTED:10,10:"ABORTED",OUT_OF_RANGE:11,11:"OUT_OF_RANGE",UNIMPLEMENTED:12,12:"UNIMPLEMENTED",INTERNAL:13,13:"INTERNAL",UNAVAILABLE:14,14:"UNAVAILABLE",DATA_LOSS:15,15:"DATA_LOSS"};class gw{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n)for(const[t,r]of n)if(this.equalsFn(t,e))return r}has(e){return void 0!==this.get(e)}set(t,n){const e=this.mapKeyFn(t),r=this.inner[e];if(void 0===r)return this.inner[e]=[[t,n]],void this.innerSize++;for(let e=0;e<r.length;e++)if(this.equalsFn(r[e][0],t))return void(r[e]=[t,n]);r.push([t,n]),this.innerSize++}delete(t){const n=this.mapKeyFn(t),r=this.inner[n];if(void 0===r)return!1;for(let e=0;e<r.length;e++)if(this.equalsFn(r[e][0],t))return 1===r.length?delete this.inner[n]:r.splice(e,1),this.innerSize--,!0;return!1}forEach(r){my(this.inner,(e,t)=>{for(const[e,n]of t)r(e,n)})}isEmpty(){return vy(this.inner)}size(){return this.innerSize}}const mw=new yy(L.comparator),vw=new yy(L.comparator);function yw(...e){let t=vw;for(const n of e)t=t.insert(n.key,n);return t}function _w(e){let n=vw;return e.forEach((e,t)=>n=n.insert(e,t.overlayedDocument)),n}function ww(){return new gw(e=>e.toString(),(e,t)=>e.isEqual(t))}const bw=new yy(L.comparator),Iw=new U(L.comparator);function V(...e){let t=Iw;for(const n of e)t=t.add(n);return t}const Tw=new U(P);class Ew{constructor(e,t,n,r,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,n){const r=new Map;return r.set(e,kw.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new Ew(O.min(),r,Tw,mw,V())}}class kw{constructor(e,t,n,r,i){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new kw(n,t,V(),V(),V())}}class Sw{constructor(e,t,n,r){this.Tt=e,this.removedTargetIds=t,this.key=n,this.Et=r}}class Cw{constructor(e,t){this.targetId=e,this.At=t}}class Aw{constructor(e,t,n=Ey.EMPTY_BYTE_STRING,r=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=r}}class Nw{constructor(){this.Rt=0,this.bt=Dw(),this.Pt=Ey.EMPTY_BYTE_STRING,this.vt=!1,this.Vt=!0}get current(){return this.vt}get resumeToken(){return this.Pt}get St(){return 0!==this.Rt}get Dt(){return this.Vt}Ct(e){0<e.approximateByteSize()&&(this.Vt=!0,this.Pt=e)}xt(){let n=V(),r=V(),i=V();return this.bt.forEach((e,t)=>{switch(t){case 0:n=n.add(e);break;case 2:r=r.add(e);break;case 1:i=i.add(e);break;default:N()}}),new kw(this.Pt,this.vt,n,r,i)}Nt(){this.Vt=!1,this.bt=Dw()}kt(e,t){this.Vt=!0,this.bt=this.bt.insert(e,t)}Ot(e){this.Vt=!0,this.bt=this.bt.remove(e)}Mt(){this.Rt+=1}Ft(){--this.Rt}$t(){this.Vt=!0,this.vt=!0}}class Rw{constructor(e){this.Bt=e,this.Lt=new Map,this.Ut=mw,this.qt=xw(),this.Kt=new U(P)}Gt(e){for(const t of e.Tt)e.Et&&e.Et.isFoundDocument()?this.Qt(t,e.Et):this.jt(t,e.key,e.Et);for(const n of e.removedTargetIds)this.jt(n,e.key,e.Et)}Wt(n){this.forEachTarget(n,e=>{const t=this.zt(e);switch(n.state){case 0:this.Ht(e)&&t.Ct(n.resumeToken);break;case 1:t.Ft(),t.St||t.Nt(),t.Ct(n.resumeToken);break;case 2:t.Ft(),t.St||this.removeTarget(e);break;case 3:this.Ht(e)&&(t.$t(),t.Ct(n.resumeToken));break;case 4:this.Ht(e)&&(this.Jt(e),t.Ct(n.resumeToken));break;default:N()}})}forEachTarget(e,n){0<e.targetIds.length?e.targetIds.forEach(n):this.Lt.forEach((e,t)=>{this.Ht(t)&&n(t)})}Yt(e){const t=e.targetId,n=e.At.count,r=this.Xt(t);if(r){const e=r.target;if(s_(e))if(0===n){const n=new L(e.path);this.jt(t,n,q.newNoDocument(n,O.min()))}else R(1===n);else this.Zt(t)!==n&&(this.Jt(t),this.Kt=this.Kt.add(t))}}te(r){const i=new Map;this.Lt.forEach((e,t)=>{var n=this.Xt(t);if(n){if(e.current&&s_(n.target)){const i=new L(n.target.path);null!==this.Ut.get(i)||this.ee(t,i)||this.jt(t,i,q.newNoDocument(i,r))}e.Dt&&(i.set(t,e.xt()),e.Nt())}});let s=V();this.qt.forEach((e,t)=>{let n=!0;t.forEachWhile(e=>{e=this.Xt(e);return!e||2===e.purpose||(n=!1)}),n&&(s=s.add(e))}),this.Ut.forEach((e,t)=>t.setReadTime(r));var e=new Ew(r,i,this.Kt,this.Ut,s);return this.Ut=mw,this.qt=xw(),this.Kt=new U(P),e}Qt(e,t){var n;this.Ht(e)&&(n=this.ee(e,t.key)?2:0,this.zt(e).kt(t.key,n),this.Ut=this.Ut.insert(t.key,t),this.qt=this.qt.insert(t.key,this.ne(t.key).add(e)))}jt(e,t,n){if(this.Ht(e)){const r=this.zt(e);this.ee(e,t)?r.kt(t,1):r.Ot(t),this.qt=this.qt.insert(t,this.ne(t).delete(e)),n&&(this.Ut=this.Ut.insert(t,n))}}removeTarget(e){this.Lt.delete(e)}Zt(e){var t=this.zt(e).xt();return this.Bt.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Mt(e){this.zt(e).Mt()}zt(e){let t=this.Lt.get(e);return t||(t=new Nw,this.Lt.set(e,t)),t}ne(e){let t=this.qt.get(e);return t||(t=new U(P),this.qt=this.qt.insert(e,t)),t}Ht(e){var t=null!==this.Xt(e);return t||p("WatchChangeAggregator","Detected inactive target",e),t}Xt(e){var t=this.Lt.get(e);return t&&t.St?null:this.Bt.se(e)}Jt(t){this.Lt.set(t,new Nw),this.Bt.getRemoteKeysForTarget(t).forEach(e=>{this.jt(t,e,null)})}ee(e,t){return this.Bt.getRemoteKeysForTarget(e).has(t)}}function xw(){return new yy(L.comparator)}function Dw(){return new yy(L.comparator)}const Pw={asc:"ASCENDING",desc:"DESCENDING"},Ow={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"};class Mw{constructor(e,t){this.databaseId=e,this.gt=t}}function Lw(e,t){return e.gt?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function Fw(e,t){return e.gt?t.toBase64():t.toUint8Array()}function Uw(e){return R(!!e),O.fromTimestamp((e=Sy(e),new Bv(e.seconds,e.nanos)))}function qw(e,t){return new M(["projects",e.projectId,"databases",e.database]).child("documents").child(t).canonicalString()}function Vw(e){e=M.fromString(e);return R(nb(e)),e}function Bw(e,t){return qw(e.databaseId,t.path)}function jw(e,t){const n=Vw(t);if(n.get(1)!==e.databaseId.projectId)throw new D(x.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+e.databaseId.projectId);if(n.get(3)!==e.databaseId.database)throw new D(x.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+e.databaseId.database);return new L(Gw(n))}function Kw(e,t){return qw(e.databaseId,t)}function Ww(e){e=Vw(e);return 4===e.length?M.emptyPath():Gw(e)}function zw(e){return new M(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function Gw(e){return R(4<e.length&&"documents"===e.get(4)),e.popFirst(5)}function Hw(e,t,n){return{name:Bw(e,t),fields:n.value.mapValue.fields}}function $w(e,t,n){const r=jw(e,t.name),i=Uw(t.updateTime),s=new e_({mapValue:{fields:t.fields}}),a=q.newFoundDocument(r,i,s);return n&&a.setHasCommittedMutations(),n?a.setHasCommittedMutations():a}function Qw(e,t){let n;if(t instanceof sw)n={update:Hw(e,t.key,t.value)};else if(t instanceof uw)n={delete:Bw(e,t.key)};else if(t instanceof aw)n={update:Hw(e,t.key,t.data),updateMask:function(e){const t=[];return e.fields.forEach(e=>t.push(e.canonicalString())),{fieldPaths:t}}(t.fieldMask)};else{if(!(t instanceof hw))return N();n={verify:Bw(e,t.key)}}return 0<t.fieldTransforms.length&&(n.updateTransforms=t.fieldTransforms.map(e=>{var t=e.transform;if(t instanceof K_)return{fieldPath:e.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(t instanceof W_)return{fieldPath:e.field.canonicalString(),appendMissingElements:{values:t.elements}};if(t instanceof G_)return{fieldPath:e.field.canonicalString(),removeAllFromArray:{values:t.elements}};if(t instanceof $_)return{fieldPath:e.field.canonicalString(),increment:t.yt};throw N()})),t.precondition.isNone||(n.currentDocument=void 0!==(r=t.precondition).updateTime?{updateTime:Lw(e,(t=r.updateTime).toTimestamp())}:void 0!==r.exists?{exists:r.exists}:N()),n;var r}function Yw(r,t){const e=t.currentDocument?void 0!==(i=t.currentDocument).updateTime?Z_.updateTime(Uw(i.updateTime)):void 0!==i.exists?Z_.exists(i.exists):Z_.none():Z_.none(),n=t.updateTransforms?t.updateTransforms.map(t=>{{var n=r;let e=null;if("setToServerValue"in t)R("REQUEST_TIME"===t.setToServerValue),e=new K_;else if("appendMissingElements"in t){const n=t.appendMissingElements.values||[];e=new W_(n)}else if("removeAllFromArray"in t){const n=t.removeAllFromArray.values||[];e=new G_(n)}else"increment"in t?e=new $_(n,t.increment):N();return n=Wv.fromServerFormat(t.fieldPath),new J_(n,e)}}):[];if(t.update){t.update.name;var i=jw(r,t.update.name),s=new e_({mapValue:{fields:t.update.fields}});if(t.updateMask){const r=function(){const e=t.updateMask.fieldPaths||[];return new Ty(e.map(e=>Wv.fromServerFormat(e)))}();return new aw(i,s,r,e,n)}return new sw(i,s,e,n)}if(t.delete){const n=jw(r,t.delete);return new uw(n,e)}if(t.verify){const n=jw(r,t.verify);return new hw(n,e)}return N()}function Jw(e,t){return{documents:[Kw(e,t.path)]}}function Xw(e,t){const n={structuredQuery:{}},r=t.path;null!==t.collectionGroup?(n.parent=Kw(e,r),n.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(n.parent=Kw(e,r.popLast()),n.structuredQuery.from=[{collectionId:r.lastSegment()}]);var i,s=function(e){if(0!==e.length)return 1===(e=e.map(e=>{var t;if("=="===e.op){if($y(e.value))return{unaryFilter:{field:eb(e.field),op:"IS_NAN"}};if(Hy(e.value))return{unaryFilter:{field:eb(e.field),op:"IS_NULL"}}}else if("!="===e.op){if($y(e.value))return{unaryFilter:{field:eb(e.field),op:"IS_NOT_NAN"}};if(Hy(e.value))return{unaryFilter:{field:eb(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:eb(e.field),op:(t=e.op,Ow[t]),value:e.value}}})).length?e[0]:{compositeFilter:{op:"AND",filters:e}}}(t.filters);return s&&(n.structuredQuery.where=s),(s=function(e){if(0!==e.length)return e.map(e=>{return{field:eb(e.field),direction:(e=e.dir,Pw[e])}})}(t.orderBy))&&(n.structuredQuery.orderBy=s),i=t.limit,null!==(s=e.gt||Py(i)?i:{value:i})&&(n.structuredQuery.limit=s),t.startAt&&(n.structuredQuery.startAt={before:(s=t.startAt).inclusive,values:s.position}),t.endAt&&(n.structuredQuery.endAt={before:!(t=t.endAt).inclusive,values:t.position}),n}function Zw(e){let t=Ww(e.parent);const n=e.structuredQuery,r=n.from?n.from.length:0;let i=null;var s,a,o,l;0<r&&(R(1===r),(s=n.from[0]).allDescendants?i=s.collectionId:t=t.child(s.collectionId));let c=[],u=(n.where&&(c=function t(e){return e?void 0!==e.unaryFilter?[function(e){switch(e.unaryFilter.op){case"IS_NAN":var t=tb(e.unaryFilter.field);return c_.create(t,"==",{doubleValue:NaN});case"IS_NULL":return t=tb(e.unaryFilter.field),c_.create(t,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":var n=tb(e.unaryFilter.field);return c_.create(n,"!=",{doubleValue:NaN});case"IS_NOT_NULL":return n=tb(e.unaryFilter.field),c_.create(n,"!=",{nullValue:"NULL_VALUE"});default:return N()}}(e)]:void 0!==e.fieldFilter?[(n=e,c_.create(tb(n.fieldFilter.field),function(){switch(n.fieldFilter.op){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return N()}}(),n.fieldFilter.value))]:void 0!==e.compositeFilter?e.compositeFilter.filters.map(e=>t(e)).reduce((e,t)=>e.concat(t)):N():[];var n}(n.where)),[]),h=(n.orderBy&&(u=n.orderBy.map(e=>{var t=e;return new __(tb(t.field),function(){switch(t.direction){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}())})),null),d=(n.limit&&(h=Py(s="object"==typeof(e=n.limit)?e.value:e)?null:s),null),p=(n.startAt&&(d=(l=!!(a=n.startAt).before,o=a.values||[],new y_(o,l))),null);return n.endAt&&(p=(o=!(a=n.endAt).before,l=a.values||[],new y_(l,o))),T_(t,i,u,c,h,"F",d,p)}function eb(e){return{fieldPath:e.canonicalString()}}function tb(e){return Wv.fromServerFormat(e.fieldPath)}function nb(e){return 4<=e.length&&"projects"===e.get(0)&&"databases"===e.get(2)}function rb(t){let i="";for(let e=0;e<t.length;e++)0<i.length&&(i=ib(i)),i=function(t){let n=i;const r=t.length;for(let e=0;e<r;e++){const r=t.charAt(e);switch(r){case"\0":n+="";break;case"":n+="";break;default:n+=r}}return n}(t.get(e));return ib(i)}function ib(e){return e+""}function sb(n){const r=n.length;if(R(2<=r),2===r)return R(""===n.charAt(0)&&""===n.charAt(1)),M.emptyPath();r;const i=[];let s="";for(let t=0;t<r;){const r=n.indexOf("",t);switch((r<0||r>a)&&N(),n.charAt(r+1)){case"":const a=n.substring(t,r);let e;0===s.length?e=a:(s+=a,e=s,s=""),i.push(e);break;case"":s=s+n.substring(t,r)+"\0";break;case"":s+=n.substring(t,r+1);break;default:N()}t=r+2}return new M(i)}const ab=["userId","batchId"];function ob(e,t){return[e,rb(t)]}function lb(e,t,n){return[e,rb(t),n]}const cb={},ub=["prefixPath","collectionGroup","readTime","documentId"],hb=["prefixPath","collectionGroup","documentId"],db=["collectionGroup","readTime","prefixPath","documentId"],pb=["canonicalId","targetId"],fb=["targetId","path"],gb=["path","targetId"],mb=["collectionId","parent"],vb=["indexId","uid"],yb=["uid","sequenceNumber"],_b=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],wb=["indexId","uid","orderedDocumentKey"],bb=["userId","collectionPath","documentId"],Ib=["userId","collectionPath","largestBatchId"],Tb=["userId","collectionGroup","largestBatchId"],Eb=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],kb=[...Eb,"documentOverlays"],Sb=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],Cb=Sb,Ab=[...Cb,"indexConfiguration","indexState","indexEntries"];class Nb extends ty{constructor(e,t){super(),this.ie=e,this.currentSequenceNumber=t}}function Rb(e,t){return iy.M(e.ie,t)}class xb{constructor(e,t,n,r){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=r}applyToRemoteDocument(t,e){var n=e.mutationResults;for(let e=0;e<this.mutations.length;e++){const c=this.mutations[e];if(c.key.isEqual(t.key)){r=void 0;i=void 0;s=void 0;a=void 0;o=void 0;l=void 0;a=void 0;o=void 0;l=void 0;var r=c;var i=t;var s=n[e];if(r instanceof sw){var a=r,o=i,l=s;const u=a.value.clone(),h=lw(a.fieldTransforms,o,l.transformResults);u.setAll(h),o.convertToFoundDocument(l.version,u).setHasCommittedMutations()}else if(r instanceof aw){a=r,o=i,l=s;if(ew(a.precondition,o)){const d=lw(a.fieldTransforms,o,l.transformResults),p=o.data;p.setAll(ow(a)),p.setAll(d),o.convertToFoundDocument(l.version,p).setHasCommittedMutations()}else o.convertToUnknownDocument(l.version)}else i.convertToNoDocument(s.version).setHasCommittedMutations()}}}applyToLocalView(e,t){for(const n of this.baseMutations)n.key.isEqual(e.key)&&(t=rw(n,e,t,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(t=rw(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(s,a){const o=ww();return this.mutations.forEach(e=>{const t=s.get(e.key),n=t.overlayedDocument;let r=this.applyToLocalView(n,t.mutatedFields);r=a.has(e.key)?null:r;var i=nw(n,r);null!==i&&o.set(e.key,i),n.isValidDocument()||n.convertToNoDocument(O.min())}),o}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),V())}isEqual(e){return this.batchId===e.batchId&&qv(this.mutations,e.mutations,(e,t)=>iw(e,t))&&qv(this.baseMutations,e.baseMutations,(e,t)=>iw(e,t))}}class Db{constructor(e,t,n,r){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=r}static from(e,t,n){R(e.mutations.length===n.length);let r=bw;var i=e.mutations;for(let e=0;e<i.length;e++)r=r.insert(i[e].key,n[e].version);return new Db(e,t,n,r)}}class Pb{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}class Ob{constructor(e,t,n,r,i=O.min(),s=O.min(),a=Ey.EMPTY_BYTE_STRING){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=s,this.resumeToken=a}withSequenceNumber(e){return new Ob(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)}withResumeToken(e,t){return new Ob(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e)}withLastLimboFreeSnapshotVersion(e){return new Ob(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken)}}class Mb{constructor(e){this.re=e}}function Lb(e,t){const n=t.key,r={prefixPath:n.getCollectionPath().popLast().toArray(),collectionGroup:n.collectionGroup,documentId:n.path.lastSegment(),readTime:Fb(t.readTime),hasCommittedMutations:t.hasCommittedMutations};if(t.isFoundDocument())r.document={name:Bw(i=e.re,(e=t).key),fields:e.data.value.mapValue.fields,updateTime:Lw(i,e.version.toTimestamp())};else if(t.isNoDocument())r.noDocument={path:n.path.toArray(),readTime:Ub(t.version)};else{if(!t.isUnknownDocument())return N();r.unknownDocument={path:n.path.toArray(),version:Ub(t.version)}}var i;return r}function Fb(e){e=e.toTimestamp();return[e.seconds,e.nanoseconds]}function Ub(e){e=e.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function qb(e){e=new Bv(e.seconds,e.nanoseconds);return O.fromTimestamp(e)}function Vb(t,n){const r=(n.baseMutations||[]).map(e=>Yw(t.re,e));for(let e=0;e<n.mutations.length-1;++e){const r=n.mutations[e];if(e+1<n.mutations.length&&void 0!==n.mutations[e+1].transform){const i=n.mutations[e+1];r.updateTransforms=i.transform.fieldTransforms,n.mutations.splice(e+1,1),++e}}const i=n.mutations.map(e=>Yw(t.re,e)),e=Bv.fromMillis(n.localWriteTimeMs);return new xb(n.batchId,e,r,i)}function Bb(e){var t=qb(e.readTime),n=void 0!==e.lastLimboFreeSnapshotVersion?qb(e.lastLimboFreeSnapshotVersion):O.min(),r=void 0!==e.query.documents?(R(1===(r=e.query).documents.length),R_(E_(Ww(r.documents[0])))):R_(Zw(e.query));return new Ob(r,e.targetId,0,e.lastListenSequenceNumber,t,n,Ey.fromBase64String(e.resumeToken))}function jb(e,t){var n=Ub(t.snapshotVersion),r=Ub(t.lastLimboFreeSnapshotVersion),e=(s_(t.target)?Jw:Xw)(e.re,t.target),i=t.resumeToken.toBase64();return{targetId:t.targetId,canonicalId:r_(t.target),readTime:n,resumeToken:i,lastListenSequenceNumber:t.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:e}}function Kb(e){var t=Zw({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?x_(t,t.limit,"L"):t}function Wb(e,t){return new Pb(t.largestBatchId,Yw(e.re,t.overlayMutation))}function zb(e,t){var n=t.path.lastSegment();return[e,rb(t.path.popLast()),n]}function Gb(e,t,n,r){return{indexId:e,uid:t.uid||"",sequenceNumber:n,readTime:Ub(r.readTime),documentKey:rb(r.documentKey.path),largestBatchId:r.largestBatchId}}class Hb{getBundleMetadata(e,t){return $b(e).get(t).next(e=>{if(e)return{id:(e=e).bundleId,createTime:qb(e.createTime),version:e.version}})}saveBundleMetadata(e,t){return $b(e).put({bundleId:(e=t).id,createTime:Ub(Uw(e.createTime)),version:e.version})}getNamedQuery(e,t){return Qb(e).get(t).next(e=>{if(e)return{name:(e=e).name,query:Kb(e.bundledQuery),readTime:qb(e.readTime)}})}saveNamedQuery(e,t){return Qb(e).put({name:t.name,readTime:Ub(Uw(t.readTime)),bundledQuery:t.bundledQuery})}}function $b(e){return Rb(e,"bundles")}function Qb(e){return Rb(e,"namedQueries")}class Yb{constructor(e,t){this.It=e,this.userId=t}static oe(e,t){t=t.uid||"";return new Yb(e,t)}getOverlay(e,t){return Jb(e).get(zb(this.userId,t)).next(e=>e?Wb(this.It,e):null)}getOverlays(e,t){const n=ww();return F.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&n.set(t,e)})).next(()=>n)}saveOverlays(n,r,e){const i=[];return e.forEach((e,t)=>{t=new Pb(r,t);i.push(this.ue(n,t))}),F.waitFor(i)}removeOverlaysForBatchId(t,e,n){const r=new Set,i=(e.forEach(e=>r.add(rb(e.getCollectionPath()))),[]);return r.forEach(e=>{e=IDBKeyRange.bound([this.userId,e,n],[this.userId,e,n+1],!1,!0);i.push(Jb(t).Y("collectionPathOverlayIndex",e))}),F.waitFor(i)}getOverlaysForCollection(e,t,n){const r=ww(),i=rb(t),s=IDBKeyRange.bound([this.userId,i,n],[this.userId,i,Number.POSITIVE_INFINITY],!0);return Jb(e).W("collectionPathOverlayIndex",s).next(e=>{for(const t of e){const e=Wb(this.It,t);r.set(e.getKey(),e)}return r})}getOverlaysForCollectionGroup(e,t,n,i){const s=ww();let a;n=IDBKeyRange.bound([this.userId,t,n],[this.userId,t,Number.POSITIVE_INFINITY],!0);return Jb(e).Z({index:"collectionGroupOverlayIndex",range:n},(e,t,n)=>{const r=Wb(this.It,t);s.size()<i||r.largestBatchId===a?(s.set(r.getKey(),r),a=r.largestBatchId):n.done()}).next(()=>s)}ue(e,t){return Jb(e).put(function(e,t,n){var[,r,i]=zb(t,n.mutation.key);return{userId:t,collectionPath:r,documentId:i,collectionGroup:n.mutation.key.getCollectionGroup(),largestBatchId:n.largestBatchId,overlayMutation:Qw(e.re,n.mutation)}}(this.It,this.userId,t))}}function Jb(e){return Rb(e,"documentOverlays")}class Xb{constructor(){}ce(e,t){this.ae(e,t),t.he()}ae(e,t){var n,r;"nullValue"in e?this.le(t,5):"booleanValue"in e?(this.le(t,10),t.fe(e.booleanValue?1:0)):"integerValue"in e?(this.le(t,15),t.fe(Cy(e.integerValue))):"doubleValue"in e?(n=Cy(e.doubleValue),isNaN(n)?this.le(t,13):(this.le(t,15),Oy(n)?t.fe(0):t.fe(n))):"timestampValue"in e?(r=e.timestampValue,this.le(t,20),"string"==typeof r?t.de(r):(t.de(""+(r.seconds||"")),t.fe(r.nanos||0))):"stringValue"in e?(this._e(e.stringValue,t),this.we(t)):"bytesValue"in e?(this.le(t,30),t.me(Ay(e.bytesValue)),this.we(t)):"referenceValue"in e?this.ge(e.referenceValue,t):"geoPointValue"in e?(r=e.geoPointValue,this.le(t,45),t.fe(r.latitude||0),t.fe(r.longitude||0)):"mapValue"in e?Jy(e)?this.le(t,Number.MAX_SAFE_INTEGER):(this.ye(e.mapValue,t),this.we(t)):"arrayValue"in e?(this.pe(e.arrayValue,t),this.we(t)):N()}_e(e,t){this.le(t,25),this.Ie(e,t)}Ie(e,t){t.de(e)}ye(e,t){var n=e.fields||{};this.le(t,55);for(const e of Object.keys(n))this._e(e,t),this.ae(n[e],t)}pe(e,t){var n=e.values||[];this.le(t,50);for(const e of n)this.ae(e,t)}ge(e,t){this.le(t,37),L.fromName(e).path.forEach(e=>{this.le(t,60),this.Ie(e,t)})}le(e,t){e.fe(t)}we(e){e.fe(2)}}function Zb(e){e=64-function(t){let n=0;for(let e=0;e<8;++e){var r=function(e){if(0===e)return 8;let t=0;return e>>4==0&&(t+=4,e<<=4),e>>6==0&&(t+=2,e<<=2),e>>7==0&&(t+=1),t}(255&t[e]);if(n+=r,8!==r)break}return n}(e);return Math.ceil(e/8)}Xb.Te=new Xb;class eI{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Ee(e){const t=e[Symbol.iterator]();let n=t.next();for(;!n.done;)this.Ae(n.value),n=t.next();this.Re()}be(e){const t=e[Symbol.iterator]();let n=t.next();for(;!n.done;)this.Pe(n.value),n=t.next();this.ve()}Ve(e){for(const t of e){const e=t.charCodeAt(0);if(e<128)this.Ae(e);else if(e<2048)this.Ae(960|e>>>6),this.Ae(128|63&e);else if(t<"\ud800"||"\udbff"<t)this.Ae(480|e>>>12),this.Ae(128|63&e>>>6),this.Ae(128|63&e);else{const e=t.codePointAt(0);this.Ae(240|e>>>18),this.Ae(128|63&e>>>12),this.Ae(128|63&e>>>6),this.Ae(128|63&e)}}this.Re()}Se(e){for(const t of e){const e=t.charCodeAt(0);if(e<128)this.Pe(e);else if(e<2048)this.Pe(960|e>>>6),this.Pe(128|63&e);else if(t<"\ud800"||"\udbff"<t)this.Pe(480|e>>>12),this.Pe(128|63&e>>>6),this.Pe(128|63&e);else{const e=t.codePointAt(0);this.Pe(240|e>>>18),this.Pe(128|63&e>>>12),this.Pe(128|63&e>>>6),this.Pe(128|63&e)}}this.ve()}De(t){var n=this.Ce(t),t=Zb(n);this.xe(1+t),this.buffer[this.position++]=255&t;for(let e=n.length-t;e<n.length;++e)this.buffer[this.position++]=255&n[e]}Ne(t){var n=this.Ce(t),t=Zb(n);this.xe(1+t),this.buffer[this.position++]=~(255&t);for(let e=n.length-t;e<n.length;++e)this.buffer[this.position++]=~(255&n[e])}ke(){this.Oe(255),this.Oe(255)}Me(){this.Fe(255),this.Fe(255)}reset(){this.position=0}seed(e){this.xe(e.length),this.buffer.set(e,this.position),this.position+=e.length}$e(){return this.buffer.slice(0,this.position)}Ce(e){const t=function(e){const t=new DataView(new ArrayBuffer(8));return t.setFloat64(0,e,!1),new Uint8Array(t.buffer)}(e),n=0!=(128&t[0]);t[0]^=n?255:128;for(let e=1;e<t.length;++e)t[e]^=n?255:0;return t}Ae(e){e&=255;0==e?(this.Oe(0),this.Oe(255)):255==e?(this.Oe(255),this.Oe(0)):this.Oe(e)}Pe(e){var t=255&e;0==t?(this.Fe(0),this.Fe(255)):255==t?(this.Fe(255),this.Fe(0)):this.Fe(e)}Re(){this.Oe(0),this.Oe(1)}ve(){this.Fe(0),this.Fe(1)}Oe(e){this.xe(1),this.buffer[this.position++]=e}Fe(e){this.xe(1),this.buffer[this.position++]=~e}xe(t){t+=this.position;if(!(t<=this.buffer.length)){let e=2*this.buffer.length;e<t&&(e=t);const n=new Uint8Array(e);n.set(this.buffer),this.buffer=n}}}class tI{constructor(e){this.Be=e}me(e){this.Be.Ee(e)}de(e){this.Be.Ve(e)}fe(e){this.Be.De(e)}he(){this.Be.ke()}}class nI{constructor(e){this.Be=e}me(e){this.Be.be(e)}de(e){this.Be.Se(e)}fe(e){this.Be.Ne(e)}he(){this.Be.Me()}}class rI{constructor(){this.Be=new eI,this.Le=new tI(this.Be),this.Ue=new nI(this.Be)}seed(e){this.Be.seed(e)}qe(e){return 0===e?this.Le:this.Ue}$e(){return this.Be.$e()}reset(){this.Be.reset()}}class iI{constructor(e,t,n,r){this.indexId=e,this.documentKey=t,this.arrayValue=n,this.directionalValue=r}Ke(){const e=this.directionalValue.length,t=0===e||255===this.directionalValue[e-1]?e+1:e,n=new Uint8Array(t);return n.set(this.directionalValue,0),t!==e?n.set([0],this.directionalValue.length):++n[n.length-1],new iI(this.indexId,this.documentKey,this.arrayValue,n)}}function sI(e,t){let n=e.indexId-t.indexId;return 0!==n?n:0!==(n=aI(e.arrayValue,t.arrayValue))?n:0!==(n=aI(e.directionalValue,t.directionalValue))?n:L.comparator(e.documentKey,t.documentKey)}function aI(t,n){for(let e=0;e<t.length&&e<n.length;++e){var r=t[e]-n[e];if(0!=r)return r}return t.length-n.length}class oI{constructor(e){this.collectionId=null!=e.collectionGroup?e.collectionGroup:e.path.lastSegment(),this.Ge=e.orderBy,this.Qe=[];for(const t of e.filters){const e=t;e.dt()?this.je=e:this.Qe.push(e)}}We(e){var t=Gv(e);if(void 0!==t&&!this.ze(t))return!1;var n=Hv(e);let r=0,i=0;for(;r<n.length&&this.ze(n[r]);++r);if(r===n.length)return!0;if(void 0!==this.je){const e=n[r];if(!this.He(this.je,e)||!this.Je(this.Ge[i++],e))return!1;++r}for(;r<n.length;++r){const e=n[r];if(i>=this.Ge.length||!this.Je(this.Ge[i++],e))return!1}return!0}ze(e){for(const t of this.Qe)if(this.He(t,e))return!0;return!1}He(e,t){if(void 0===e||!e.field.isEqual(t.fieldPath))return!1;e="array-contains"===e.op||"array-contains-any"===e.op;return 2===t.kind==e}Je(e,t){return!!e.field.isEqual(t.fieldPath)&&(0===t.kind&&"asc"===e.dir||1===t.kind&&"desc"===e.dir)}}class lI{constructor(){this.Ye=new cI}addToCollectionParentIndex(e,t){return this.Ye.add(t),F.resolve()}getCollectionParents(e,t){return F.resolve(this.Ye.getEntries(t))}addFieldIndex(e,t){return F.resolve()}deleteFieldIndex(e,t){return F.resolve()}getDocumentsMatchingTarget(e,t){return F.resolve(null)}getIndexType(e,t){return F.resolve(0)}getFieldIndexes(e,t){return F.resolve([])}getNextCollectionGroupToUpdate(e){return F.resolve(null)}getMinOffset(e,t){return F.resolve(Xv.min())}getMinOffsetFromCollectionGroup(e,t){return F.resolve(Xv.min())}updateCollectionGroup(e,t,n){return F.resolve()}updateIndexEntries(e,t){return F.resolve()}}class cI{constructor(){this.index={}}add(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t]||new U(M.comparator),i=!r.has(n);return this.index[t]=r.add(n),i}has(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t];return r&&r.has(n)}getEntries(e){return(this.index[e]||new U(M.comparator)).toArray()}}const uI=new Uint8Array(0);class hI{constructor(e,t){this.user=e,this.databaseId=t,this.Xe=new cI,this.Ze=new gw(e=>r_(e),(e,t)=>i_(e,t)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(this.Xe.has(t))return F.resolve();var n=t.lastSegment(),r=t.popLast();return e.addOnCommittedListener(()=>{this.Xe.add(t)}),r={collectionId:n,parent:rb(r)},dI(e).put(r)}getCollectionParents(e,n){const r=[],t=IDBKeyRange.bound([n,""],[Vv(n),""],!1,!0);return dI(e).W(t).next(e=>{for(const t of e){if(t.collectionId!==n)break;r.push(sb(t.parent))}return r})}addFieldIndex(e,t){const n=fI(e),r={indexId:t.indexId,collectionGroup:t.collectionGroup,fields:t.fields.map(e=>[e.fieldPath.canonicalString(),e.kind])},i=(delete r.indexId,n.add(r));if(t.indexState){const n=gI(e);return i.next(e=>{n.put(Gb(e,this.user,t.indexState.sequenceNumber,t.indexState.offset))})}return i.next()}deleteFieldIndex(e,t){const n=fI(e),r=gI(e),i=pI(e);return n.delete(t.indexId).next(()=>r.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}getDocumentsMatchingTarget(e,c){const u=pI(e);let h=!0;const n=new Map;return F.forEach(this.tn(c),t=>this.en(e,t).next(e=>{h=h&&!!e,n.set(t,e)})).next(()=>{if(h){let l=V();const h=[];return F.forEach(n,(e,t)=>{p("IndexedDbIndexManager",`Using index ${o=e,`id=${o.indexId}|cg=${o.collectionGroup}|f=`+o.fields.map(e=>e.fieldPath+":"+e.kind).join(",")} to execute `+r_(c));var n=function(e,t){var n=Gv(t);if(void 0===n)return null;for(const t of a_(e,n.fieldPath))switch(t.op){case"array-contains-any":return t.value.arrayValue.values||[];case"array-contains":return[t.value]}return null}(t,e),r=function(e,t){const n=new Map;for(const r of Hv(t))for(const t of a_(e,r.fieldPath))switch(t.op){case"==":case"in":n.set(r.fieldPath.canonicalString(),t.value);break;case"not-in":case"!=":return n.set(r.fieldPath.canonicalString(),t.value),Array.from(n.values())}return null}(t,e),i=function(e,t){const n=[];let r=!0;for(const i of Hv(t)){const t=(0===i.kind?o_:l_)(e,i.fieldPath,e.startAt);n.push(t.value),r=r&&t.inclusive}return new y_(n,r)}(t,e),s=function(e,t){const n=[];let r=!0;for(const i of Hv(t)){const t=(0===i.kind?l_:o_)(e,i.fieldPath,e.endAt);n.push(t.value),r=r&&t.inclusive}return new y_(n,r)}(t,e),a=this.nn(e,t,i),o=this.nn(e,t,s),r=this.sn(e,t,r),r=this.rn(e.indexId,n,a,i.inclusive,o,s.inclusive,r);return F.forEach(r,e=>u.J(e,c.limit).next(e=>{e.forEach(e=>{e=L.fromSegments(e.documentKey);l.has(e)||(l=l.add(e),h.push(e))})}))}).next(()=>h)}return F.resolve(null)})}tn(e){return this.Ze.get(e)||(this.Ze.set(e,e=[e]),e)}rn(t,n,r,i,s,a,o){const l=(null!=n?n.length:1)*Math.max(r.length,s.length),c=l/(null!=n?n.length:1),u=[];for(let e=0;e<l;++e){const l=n?this.on(n[e/c]):uI,h=this.un(t,l,r[e%c],i),d=this.cn(t,l,s[e%c],a),p=o.map(e=>this.un(t,l,e,!0));u.push(...this.createRange(h,d,p))}return u}un(e,t,n,r){const i=new iI(e,L.empty(),t,n);return r?i:i.Ke()}cn(e,t,n,r){const i=new iI(e,L.empty(),t,n);return r?i.Ke():i}en(e,t){const r=new oI(t),n=null!=t.collectionGroup?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,n).next(e=>{let t=null;for(const n of e)r.We(n)&&(!t||n.fields.length>t.fields.length)&&(t=n);return t})}getIndexType(e,t){let n=2;return F.forEach(this.tn(t),t=>this.en(e,t).next(e=>{e?0!==n&&e.fields.length<function(e){let t=new U(Wv.comparator),n=!1;for(const r of e.filters){const e=r;e.field.isKeyField()||("array-contains"===e.op||"array-contains-any"===e.op?n=!0:t=t.add(e.field))}for(const n of e.orderBy)n.field.isKeyField()||(t=t.add(n.field));return t.size+(n?1:0)}(t)&&(n=1):n=0})).next(()=>n)}an(e,t){const n=new rI;for(const i of Hv(e)){const e=t.data.field(i.fieldPath);if(null==e)return null;var r=n.qe(i.kind);Xb.Te.ce(e,r)}return n.$e()}on(e){const t=new rI;return Xb.Te.ce(e,t.qe(0)),t.$e()}hn(e,t){const n=new rI;return Xb.Te.ce(Wy(this.databaseId,t),n.qe(0===(t=Hv(e)).length?0:t[t.length-1].kind)),n.$e()}sn(e,t,n){if(null===n)return[];let r=[],i=(r.push(new rI),0);for(const s of Hv(e)){const e=n[i++];for(const n of r)if(this.ln(t,s.fieldPath)&&Gy(e))r=this.fn(r,s,e);else{const t=n.qe(s.kind);Xb.Te.ce(e,t)}}return this.dn(r)}nn(e,t,n){return this.sn(e,t,n.position)}dn(t){const n=[];for(let e=0;e<t.length;++e)n[e]=t[e].$e();return n}fn(e,t,n){const r=[...e],i=[];for(const e of n.arrayValue.values||[])for(const n of r){const r=new rI;r.seed(n.$e()),Xb.Te.ce(e,r.qe(t.kind)),i.push(r)}return i}ln(e,t){return!!e.filters.find(e=>e instanceof c_&&e.field.isEqual(t)&&("in"===e.op||"not-in"===e.op))}getFieldIndexes(e,t){const n=fI(e),s=gI(e);return(t?n.W("collectionGroupIndex",IDBKeyRange.bound(t,t)):n.W()).next(e=>{const i=[];return F.forEach(e,r=>s.get([r.indexId,this.uid]).next(e=>{var t,n;i.push((t=r,e=e?new Qv(e.sequenceNumber,new Xv(qb(e.readTime),new L(sb(e.documentKey)),e.largestBatchId)):Qv.empty(),n=t.fields.map(([e,t])=>new $v(Wv.fromServerFormat(e),t)),new zv(t.indexId,t.collectionGroup,n,e)))})).next(()=>i)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(e=>0===e.length?null:(e.sort((e,t)=>{var n=e.indexState.sequenceNumber-t.indexState.sequenceNumber;return 0!=n?n:P(e.collectionGroup,t.collectionGroup)}),e[0].collectionGroup))}updateCollectionGroup(e,n,r){const i=fI(e),s=gI(e);return this._n(e).next(t=>i.W("collectionGroupIndex",IDBKeyRange.bound(n,n)).next(e=>F.forEach(e,e=>s.put(Gb(e.indexId,this.user,t,r)))))}updateIndexEntries(i,e){const n=new Map;return F.forEach(e,(t,r)=>{var e=n.get(t.collectionGroup);return(e?F.resolve(e):this.getFieldIndexes(i,t.collectionGroup)).next(e=>(n.set(t.collectionGroup,e),F.forEach(e,n=>this.wn(i,t,n).next(e=>{var t=this.mn(r,n);return e.isEqual(t)?F.resolve():this.gn(i,r,n,e,t)}))))})}yn(e,t,n,r){return pI(e).put({indexId:r.indexId,uid:this.uid,arrayValue:r.arrayValue,directionalValue:r.directionalValue,orderedDocumentKey:this.hn(n,t.key),documentKey:t.key.path.toArray()})}pn(e,t,n,r){return pI(e).delete([r.indexId,this.uid,r.arrayValue,r.directionalValue,this.hn(n,t.key),t.key.path.toArray()])}wn(e,n,r){const t=pI(e);let i=new U(sI);return t.Z({index:"documentKeyIndex",range:IDBKeyRange.only([r.indexId,this.uid,this.hn(r,n)])},(e,t)=>{i=i.add(new iI(r.indexId,n,t.arrayValue,t.directionalValue))}).next(()=>i)}mn(e,t){let n=new U(sI);var r=this.an(t,e);if(null==r)return n;const i=Gv(t);if(null!=i){var s=e.data.field(i.fieldPath);if(Gy(s))for(const i of s.arrayValue.values||[])n=n.add(new iI(t.indexId,e.key,this.on(i),r))}else n=n.add(new iI(t.indexId,e.key,uI,r));return n}gn(t,i,s,e,a){p("IndexedDbIndexManager","Updating index entries for document '%s'",i.key);const o=[];{var l=sI,c=e=>{o.push(this.yn(t,i,s,e))},u=e=>{o.push(this.pn(t,i,s,e))},h=e.getIterator(),d=a.getIterator();let n=Iy(h),r=Iy(d);for(;n||r;){let e=!1,t=!1;if(n&&r){const c=l(n,r);c<0?t=!0:0<c&&(e=!0)}else null!=n?t=!0:e=!0;e?(c(r),r=Iy(d)):t?(u(n),n=Iy(h)):(n=Iy(h),r=Iy(d))}}return F.waitFor(o)}_n(e){let r=1;return gI(e).Z({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(e,t,n)=>{n.done(),r=t.sequenceNumber+1}).next(()=>r)}createRange(e,t,n){n=n.sort((e,t)=>sI(e,t)).filter((e,t,n)=>!t||0!==sI(e,n[t-1]));const r=[];r.push(e);for(const i of n){const n=sI(i,e),s=sI(i,t);if(0===n)r[0]=e.Ke();else if(0<n&&s<0)r.push(i),r.push(i.Ke());else if(0<s)break}r.push(t);const i=[];for(let e=0;e<r.length;e+=2)i.push(IDBKeyRange.bound([r[e].indexId,this.uid,r[e].arrayValue,r[e].directionalValue,uI,[]],[r[e+1].indexId,this.uid,r[e+1].arrayValue,r[e+1].directionalValue,uI,[]]));return i}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(mI)}getMinOffset(t,e){return F.mapArray(this.tn(e),e=>this.en(t,e).next(e=>e||N())).next(mI)}}function dI(e){return Rb(e,"collectionParents")}function pI(e){return Rb(e,"indexEntries")}function fI(e){return Rb(e,"indexConfiguration")}function gI(e){return Rb(e,"indexState")}function mI(t){R(0!==t.length);let n=t[0].indexState.offset,r=n.largestBatchId;for(let e=1;e<t.length;e++){var i=t[e].indexState.offset;Zv(i,n)<0&&(n=i),r<i.largestBatchId&&(r=i.largestBatchId)}return new Xv(n.readTime,n.documentKey,r)}const vI={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class yI{constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}static withCacheSize(e){return new yI(e,yI.DEFAULT_COLLECTION_PERCENTILE,yI.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}function _I(e,t,n){const r=e.store("mutations"),i=e.store("documentMutations"),s=[],a=IDBKeyRange.only(n.batchId);let o=0;const l=r.Z({range:a},(e,t,n)=>(o++,n.delete())),c=(s.push(l.next(()=>{R(1===o)})),[]);for(const e of n.mutations){const r=lb(t,e.key.path,n.batchId);s.push(i.delete(r)),c.push(e.key)}return F.waitFor(s).next(()=>c)}function wI(e){if(!e)return 0;let t;if(e.document)t=e.document;else if(e.unknownDocument)t=e.unknownDocument;else{if(!e.noDocument)throw N();t=e.noDocument}return JSON.stringify(t).length}yI.DEFAULT_COLLECTION_PERCENTILE=10,yI.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,yI.DEFAULT=new yI(41943040,yI.DEFAULT_COLLECTION_PERCENTILE,yI.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),yI.DISABLED=new yI(-1,0,0);class bI{constructor(e,t,n,r){this.userId=e,this.It=t,this.indexManager=n,this.referenceDelegate=r,this.In={}}static oe(e,t,n,r){R(""!==e.uid);e=e.isAuthenticated()?e.uid:"";return new bI(e,t,n,r)}checkEmpty(e){let r=!0;var t=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return TI(e).Z({index:"userMutationsIndex",range:t},(e,t,n)=>{r=!1,n.done()}).next(()=>r)}addMutationBatch(u,h,d,p){const f=EI(u),g=TI(u);return g.add({}).next(e=>{R("number"==typeof e);const t=new xb(e,h,d,p),n=(i=this.It,s=this.userId,o=(a=t).baseMutations.map(e=>Qw(i.re,e)),l=a.mutations.map(e=>Qw(i.re,e)),{userId:s,batchId:a.batchId,localWriteTimeMs:a.localWriteTime.toMillis(),baseMutations:o,mutations:l}),r=[];var i,s,a,o,l;let c=new U((e,t)=>P(e.canonicalString(),t.canonicalString()));for(const u of p){const h=lb(this.userId,u.key.path,e);c=c.add(u.key.path.popLast()),r.push(g.put(n)),r.push(f.put(h,cb))}return c.forEach(e=>{r.push(this.indexManager.addToCollectionParentIndex(u,e))}),u.addOnCommittedListener(()=>{this.In[e]=t.keys()}),F.waitFor(r).next(()=>t)})}lookupMutationBatch(e,t){return TI(e).get(t).next(e=>e?(R(e.userId===this.userId),Vb(this.It,e)):null)}Tn(e,t){return this.In[t]?F.resolve(this.In[t]):this.lookupMutationBatch(e,t).next(e=>{return e?(e=e.keys(),this.In[t]=e):null})}getNextMutationBatchAfterBatchId(e,t){const r=t+1,n=IDBKeyRange.lowerBound([this.userId,r]);let i=null;return TI(e).Z({index:"userMutationsIndex",range:n},(e,t,n)=>{t.userId===this.userId&&(R(t.batchId>=r),i=Vb(this.It,t)),n.done()}).next(()=>i)}getHighestUnacknowledgedBatchId(e){var t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let r=-1;return TI(e).Z({index:"userMutationsIndex",range:t,reverse:!0},(e,t,n)=>{r=t.batchId,n.done()}).next(()=>r)}getAllMutationBatches(e){var t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return TI(e).W("userMutationsIndex",t).next(e=>e.map(e=>Vb(this.It,e)))}getAllMutationBatchesAffectingDocumentKey(s,a){const e=ob(this.userId,a.path),t=IDBKeyRange.lowerBound(e),o=[];return EI(s).Z({range:t},(e,t,n)=>{var[e,r,i]=e,r=sb(r);if(e===this.userId&&a.path.isEqual(r))return TI(s).get(i).next(e=>{if(!e)throw N();R(e.userId===this.userId),o.push(Vb(this.It,e))});n.done()}).next(()=>o)}getAllMutationBatchesAffectingDocumentKeys(t,e){let a=new U(P);const n=[];return e.forEach(s=>{var e=ob(this.userId,s.path),e=IDBKeyRange.lowerBound(e),e=EI(t).Z({range:e},(e,t,n)=>{var[e,r,i]=e,r=sb(r);e===this.userId&&s.path.isEqual(r)?a=a.add(i):n.done()});n.push(e)}),F.waitFor(n).next(()=>this.En(t,a))}getAllMutationBatchesAffectingQuery(e,t){const s=t.path,a=s.length+1,n=ob(this.userId,s),r=IDBKeyRange.lowerBound(n);let o=new U(P);return EI(e).Z({range:r},(e,t,n)=>{var[e,r,i]=e,r=sb(r);e===this.userId&&s.isPrefixOf(r)?r.length===a&&(o=o.add(i)):n.done()}).next(()=>this.En(e,o))}En(t,e){const n=[],r=[];return e.forEach(e=>{r.push(TI(t).get(e).next(e=>{if(null===e)throw N();R(e.userId===this.userId),n.push(Vb(this.It,e))}))}),F.waitFor(r).next(()=>n)}removeMutationBatch(t,n){return _I(t.ie,this.userId,n).next(e=>(t.addOnCommittedListener(()=>{this.An(n.batchId)}),F.forEach(e,e=>this.referenceDelegate.markPotentiallyOrphaned(t,e))))}An(e){delete this.In[e]}performConsistencyCheck(t){return this.checkEmpty(t).next(e=>{if(!e)return F.resolve();e=IDBKeyRange.lowerBound([this.userId]);const r=[];return EI(t).Z({range:e},(e,t,n)=>{if(e[0]===this.userId){const t=sb(e[1]);r.push(t)}else n.done()}).next(()=>{R(0===r.length)})})}containsKey(e,t){return II(e,this.userId,t)}Rn(e){return kI(e).get(this.userId).next(e=>e||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}}function II(e,i,t){const n=ob(i,t.path),s=n[1],r=IDBKeyRange.lowerBound(n);let a=!1;return EI(e).Z({range:r,X:!0},(e,t,n)=>{var[e,r]=e;e===i&&r===s&&(a=!0),n.done()}).next(()=>a)}function TI(e){return Rb(e,"mutations")}function EI(e){return Rb(e,"documentMutations")}function kI(e){return Rb(e,"mutationQueues")}class SI{constructor(e){this.bn=e}next(){return this.bn+=2,this.bn}static Pn(){return new SI(0)}static vn(){return new SI(-1)}}class CI{constructor(e,t){this.referenceDelegate=e,this.It=t}allocateTargetId(n){return this.Vn(n).next(e=>{const t=new SI(e.highestTargetId);return e.highestTargetId=t.next(),this.Sn(n,e).next(()=>e.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.Vn(e).next(e=>O.fromTimestamp(new Bv(e.lastRemoteSnapshotVersion.seconds,e.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.Vn(e).next(e=>e.highestListenSequenceNumber)}setTargetsMetadata(t,n,r){return this.Vn(t).next(e=>(e.highestListenSequenceNumber=n,r&&(e.lastRemoteSnapshotVersion=r.toTimestamp()),n>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=n),this.Sn(t,e)))}addTargetData(t,n){return this.Dn(t,n).next(()=>this.Vn(t).next(e=>(e.targetCount+=1,this.Cn(n,e),this.Sn(t,e))))}updateTargetData(e,t){return this.Dn(e,t)}removeTargetData(t,e){return this.removeMatchingKeysForTargetId(t,e.targetId).next(()=>AI(t).delete(e.targetId)).next(()=>this.Vn(t)).next(e=>(R(0<e.targetCount),--e.targetCount,this.Sn(t,e)))}removeTargets(n,r,i){let s=0;const a=[];return AI(n).Z((e,t)=>{t=Bb(t);t.sequenceNumber<=r&&null===i.get(t.targetId)&&(s++,a.push(this.removeTargetData(n,t)))}).next(()=>F.waitFor(a)).next(()=>s)}forEachTarget(e,n){return AI(e).Z((e,t)=>{t=Bb(t);n(t)})}Vn(e){return NI(e).get("targetGlobalKey").next(e=>(R(null!==e),e))}Sn(e,t){return NI(e).put("targetGlobalKey",t)}Dn(e,t){return AI(e).put(jb(this.It,t))}Cn(e,t){let n=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,n=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,n=!0),n}getTargetCount(e){return this.Vn(e).next(e=>e.targetCount)}getTargetData(e,r){var t=r_(r),t=IDBKeyRange.bound([t,Number.NEGATIVE_INFINITY],[t,Number.POSITIVE_INFINITY]);let i=null;return AI(e).Z({range:t,index:"queryTargetsIndex"},(e,t,n)=>{t=Bb(t);i_(r,t.target)&&(i=t,n.done())}).next(()=>i)}addMatchingKeys(n,e,r){const i=[],s=RI(n);return e.forEach(e=>{var t=rb(e.path);i.push(s.put({targetId:r,path:t})),i.push(this.referenceDelegate.addReference(n,r,e))}),F.waitFor(i)}removeMatchingKeys(n,e,r){const i=RI(n);return F.forEach(e,e=>{var t=rb(e.path);return F.waitFor([i.delete([r,t]),this.referenceDelegate.removeReference(n,r,e)])})}removeMatchingKeysForTargetId(e,t){const n=RI(e),r=IDBKeyRange.bound([t],[t+1],!1,!0);return n.delete(r)}getMatchingKeysForTargetId(e,t){const n=IDBKeyRange.bound([t],[t+1],!1,!0),r=RI(e);let i=V();return r.Z({range:n,X:!0},(e,t,n)=>{e=sb(e[1]),e=new L(e);i=i.add(e)}).next(()=>i)}containsKey(e,t){t=rb(t.path),t=IDBKeyRange.bound([t],[Vv(t)],!1,!0);let r=0;return RI(e).Z({index:"documentTargetsIndex",X:!0,range:t},([e],t,n)=>{0!==e&&(r++,n.done())}).next(()=>0<r)}se(e,t){return AI(e).get(t).next(e=>e?Bb(e):null)}}function AI(e){return Rb(e,"targets")}function NI(e){return Rb(e,"targetGlobal")}function RI(e){return Rb(e,"targetDocuments")}function xI([e,t],[n,r]){e=P(e,n);return 0===e?P(t,r):e}class DI{constructor(e){this.xn=e,this.buffer=new U(xI),this.Nn=0}kn(){return++this.Nn}On(e){var t=[e,this.kn()];if(this.buffer.size<this.xn)this.buffer=this.buffer.add(t);else{const e=this.buffer.last();xI(t,e)<0&&(this.buffer=this.buffer.delete(e).add(t))}}get maxValue(){return this.buffer.last()[0]}}class PI{constructor(e,t,n){this.garbageCollector=e,this.asyncQueue=t,this.localStore=n,this.Mn=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.Fn(6e4)}stop(){this.Mn&&(this.Mn.cancel(),this.Mn=null)}get started(){return null!==this.Mn}Fn(e){p("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.Mn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.Mn=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(e){oy(e)?p("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",e):await ny(e)}await this.Fn(3e5)})}}class OI{constructor(e,t){this.$n=e,this.params=t}calculateTargetCount(e,t){return this.$n.Bn(e).next(e=>Math.floor(t/100*e))}nthSequenceNumber(e,t){if(0===t)return F.resolve(fy.at);const n=new DI(t);return this.$n.forEachTarget(e,e=>n.On(e.sequenceNumber)).next(()=>this.$n.Ln(e,e=>n.On(e))).next(()=>n.maxValue)}removeTargets(e,t,n){return this.$n.removeTargets(e,t,n)}removeOrphanedDocuments(e,t){return this.$n.removeOrphanedDocuments(e,t)}collect(t,n){return-1===this.params.cacheSizeCollectionThreshold?(p("LruGarbageCollector","Garbage collection skipped; disabled"),F.resolve(vI)):this.getCacheSize(t).next(e=>e<this.params.cacheSizeCollectionThreshold?(p("LruGarbageCollector",`Garbage collection skipped; Cache size ${e} is lower than threshold `+this.params.cacheSizeCollectionThreshold),vI):this.Un(t,n))}getCacheSize(e){return this.$n.getCacheSize(e)}Un(t,n){let r,i,s,a,o,l,c;const u=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next(e=>(i=e>this.params.maximumSequenceNumbersToCollect?(p("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from `+e),this.params.maximumSequenceNumbersToCollect):e,a=Date.now(),this.nthSequenceNumber(t,i))).next(e=>(r=e,o=Date.now(),this.removeTargets(t,r,n))).next(e=>(s=e,l=Date.now(),this.removeOrphanedDocuments(t,r))).next(e=>(c=Date.now(),kv()<=h.DEBUG&&p("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${a-u}ms
	Determined least recently used ${i} in `+(o-a)+"ms\n"+`	Removed ${s} targets in `+(l-o)+"ms\n"+`	Removed ${e} documents in `+(c-l)+"ms\n"+`Total Duration: ${c-u}ms`),F.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:s,documentsRemoved:e})))}}class MI{constructor(e,t){this.db=e,this.garbageCollector=(e=this,new OI(e,t))}Bn(e){const n=this.qn(e);return this.db.getTargetCache().getTargetCount(e).next(t=>n.next(e=>t+e))}qn(e){let t=0;return this.Ln(e,e=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}Ln(e,n){return this.Kn(e,(e,t)=>n(t))}addReference(e,t,n){return LI(e,n)}removeReference(e,t,n){return LI(e,n)}removeTargets(e,t,n){return this.db.getTargetCache().removeTargets(e,t,n)}markPotentiallyOrphaned(e,t){return LI(e,t)}Gn(t,n){let r=!1;return kI(t).tt(e=>II(t,e,n).next(e=>(e&&(r=!0),F.resolve(!e)))).next(()=>r)}removeOrphanedDocuments(n,r){const i=this.db.getRemoteDocumentCache().newChangeBuffer(),s=[];let a=0;return this.Kn(n,(t,e)=>{if(e<=r){const r=this.Gn(n,t).next(e=>{if(!e)return a++,i.getEntry(n,t).next(()=>(i.removeEntry(t,O.min()),RI(n).delete([0,rb(t.path)])))});s.push(r)}}).next(()=>F.waitFor(s)).next(()=>i.apply(n)).next(()=>a)}removeTarget(e,t){t=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,t)}updateLimboDocument(e,t){return LI(e,t)}Kn(e,r){const t=RI(e);let i,s=fy.at;return t.Z({index:"documentTargetsIndex"},([e],{path:t,sequenceNumber:n})=>{0===e?(s!==fy.at&&r(new L(sb(i)),s),s=n,i=t):s=fy.at}).next(()=>{s!==fy.at&&r(new L(sb(i)),s)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function LI(e,t){return RI(e).put((e=e.currentSequenceNumber,{targetId:0,path:rb(t.path),sequenceNumber:e}))}class FI{constructor(){this.changes=new gw(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,q.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();var n=this.changes.get(t);return void 0!==n?F.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class UI{constructor(e){this.It=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,n){return jI(e).put(n)}removeEntry(e,n,t){return jI(e).delete(function(e){const t=n.path.toArray();return[t.slice(0,t.length-2),t[t.length-2],Fb(e),t[t.length-1]]}(t))}updateMetadata(t,n){return this.getMetadata(t).next(e=>(e.byteSize+=n,this.Qn(t,e)))}getEntry(e,n){let r=q.newInvalidDocument(n);return jI(e).Z({index:"documentKeyIndex",range:IDBKeyRange.only(KI(n))},(e,t)=>{r=this.jn(n,t)}).next(()=>r)}Wn(e,n){let r={size:0,document:q.newInvalidDocument(n)};return jI(e).Z({index:"documentKeyIndex",range:IDBKeyRange.only(KI(n))},(e,t)=>{r={document:this.jn(n,t),size:wI(t)}}).next(()=>r)}getEntries(e,t){let n=mw;return this.zn(e,t,(e,t)=>{t=this.jn(e,t);n=n.insert(e,t)}).next(()=>n)}Hn(e,t){let r=mw,i=new yy(L.comparator);return this.zn(e,t,(e,t)=>{var n=this.jn(e,t);r=r.insert(e,n),i=i.insert(e,wI(t))}).next(()=>({documents:r,Jn:i}))}zn(e,t,i){if(t.isEmpty())return F.resolve();let n=new U(zI);t.forEach(e=>n=n.add(e));const r=IDBKeyRange.bound(KI(n.first()),KI(n.last())),s=n.getIterator();let a=s.getNext();return jI(e).Z({index:"documentKeyIndex",range:r},(e,t,n)=>{for(var r=L.fromSegments([...t.prefixPath,t.collectionGroup,t.documentId]);a&&zI(a,r)<0;)i(a,null),a=s.getNext();a&&a.isEqual(r)&&(i(a,t),a=s.hasNext()?s.getNext():null),a?n.j(KI(a)):n.done()}).next(()=>{for(;a;)i(a,null),a=s.hasNext()?s.getNext():null})}getAllFromCollection(e,t,n){n=[t.popLast().toArray(),t.lastSegment(),Fb(n.readTime),n.documentKey.path.isEmpty()?"":n.documentKey.path.lastSegment()],t=[t.popLast().toArray(),t.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return jI(e).W(IDBKeyRange.bound(n,t,!0)).next(e=>{let t=mw;for(const n of e){const e=this.jn(L.fromSegments(n.prefixPath.concat(n.collectionGroup,n.documentId)),n);t=t.insert(e.key,e)}return t})}getAllFromCollectionGroup(e,t,n,r){let i=mw;n=WI(t,n),t=WI(t,Xv.max());return jI(e).Z({index:"collectionGroupIndex",range:IDBKeyRange.bound(n,t,!0)},(e,t,n)=>{t=this.jn(L.fromSegments(t.prefixPath.concat(t.collectionGroup,t.documentId)),t);(i=i.insert(t.key,t)).size===r&&n.done()}).next(()=>i)}newChangeBuffer(e){return new VI(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(e=>e.byteSize)}getMetadata(e){return BI(e).get("remoteDocumentGlobalKey").next(e=>(R(!!e),e))}Qn(e,t){return BI(e).put("remoteDocumentGlobalKey",t)}jn(e,t){if(t){const e=function(e,t){let n;if(t.document)n=$w(e.re,t.document,!!t.hasCommittedMutations);else if(t.noDocument){const e=L.fromSegments(t.noDocument.path),r=qb(t.noDocument.readTime);n=q.newNoDocument(e,r),t.hasCommittedMutations&&n.setHasCommittedMutations()}else{if(!t.unknownDocument)return N();{const e=L.fromSegments(t.unknownDocument.path),i=qb(t.unknownDocument.version);n=q.newUnknownDocument(e,i)}}return t.readTime&&n.setReadTime((t=t.readTime,e=new Bv(t[0],t[1]),O.fromTimestamp(e))),n}(this.It,t);if(!e.isNoDocument()||!e.version.isEqual(O.min()))return e}return q.newInvalidDocument(e)}}function qI(e){return new UI(e)}class VI extends FI{constructor(e,t){super(),this.Yn=e,this.trackRemovals=t,this.Xn=new gw(e=>e.toString(),(e,t)=>e.isEqual(t))}applyChanges(s){const a=[];let o=0,l=new U((e,t)=>P(e.canonicalString(),t.canonicalString()));return this.changes.forEach((e,t)=>{var n=this.Xn.get(e);if(a.push(this.Yn.removeEntry(s,e,n.readTime)),t.isValidDocument()){var r=Lb(this.Yn.It,t),i=(l=l.add(e.path.popLast()),wI(r));o+=i-n.size,a.push(this.Yn.addEntry(s,e,r))}else if(o-=n.size,this.trackRemovals){const o=Lb(this.Yn.It,t.convertToNoDocument(O.min()));a.push(this.Yn.addEntry(s,e,o))}}),l.forEach(e=>{a.push(this.Yn.indexManager.addToCollectionParentIndex(s,e))}),a.push(this.Yn.updateMetadata(s,o)),F.waitFor(a)}getFromCache(e,t){return this.Yn.Wn(e,t).next(e=>(this.Xn.set(t,{size:e.size,readTime:e.document.readTime}),e.document))}getAllFromCache(e,t){return this.Yn.Hn(e,t).next(({documents:n,Jn:e})=>(e.forEach((e,t)=>{this.Xn.set(e,{size:t,readTime:n.get(e).readTime})}),n))}}function BI(e){return Rb(e,"remoteDocumentGlobal")}function jI(e){return Rb(e,"remoteDocumentsV14")}function KI(e){const t=e.path.toArray();return[t.slice(0,t.length-2),t[t.length-2],t[t.length-1]]}function WI(e,t){const n=t.documentKey.path.toArray();return[e,Fb(t.readTime),n.slice(0,n.length-2),0<n.length?n[n.length-1]:""]}function zI(e,t){var n=e.path.toArray(),r=t.path.toArray();let i=0;for(let e=0;e<n.length-2&&e<r.length-2;++e)if(i=P(n[e],r[e]))return i;return(i=P(n.length,r.length))||((i=P(n[n.length-2],r[r.length-2]))||P(n[n.length-1],r[r.length-1]))}class GI{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class HI{constructor(e,t,n,r){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=r}getDocument(t,n){let r=null;return this.documentOverlayCache.getOverlay(t,n).next(e=>(r=e,this.getBaseDocument(t,n,r))).next(e=>(null!==r&&rw(r.mutation,e,Ty.empty(),Bv.now()),e))}getDocuments(t,e){return this.remoteDocumentCache.getEntries(t,e).next(e=>this.getLocalViewOfDocuments(t,e,V()).next(()=>e))}getLocalViewOfDocuments(e,t,n=V()){const r=ww();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,n).next(e=>{let n=yw();return e.forEach((e,t)=>{n=n.insert(e,t.overlayedDocument)}),n}))}getOverlayedDocuments(e,t){const n=ww();return this.populateOverlays(e,n,t).next(()=>this.computeViews(e,t,n,V()))}populateOverlays(e,n,t){const r=[];return t.forEach(e=>{n.has(e)||r.push(e)}),this.documentOverlayCache.getOverlays(e,r).next(e=>{e.forEach((e,t)=>{n.set(e,t)})})}computeViews(e,t,r,i){let s=mw;const a=ww(),n=ww();return t.forEach((e,t)=>{const n=r.get(t.key);i.has(t.key)&&(void 0===n||n.mutation instanceof aw)?s=s.insert(t.key,t):void 0!==n&&(a.set(t.key,n.mutation.getFieldMask()),rw(n.mutation,t,n.mutation.getFieldMask(),Bv.now()))}),this.recalculateAndSaveOverlays(e,s).next(e=>(e.forEach((e,t)=>a.set(e,t)),t.forEach((e,t)=>{return n.set(e,new GI(t,null!=(t=a.get(e))?t:null))}),n))}recalculateAndSaveOverlays(s,a){const o=ww();let l=new yy((e,t)=>e-t),c=V();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(s,a).next(e=>{for(const r of e)r.keys().forEach(e=>{var t,n=a.get(e);null!==n&&(t=o.get(e)||Ty.empty(),t=r.applyToLocalView(n,t),o.set(e,t),t=(l.get(r.batchId)||V()).add(e),l=l.insert(r.batchId,t))})}).next(()=>{const e=[],t=l.getReverseIterator();for(;t.hasNext();){const l=t.getNext(),n=l.key,r=l.value,i=ww();r.forEach(e=>{var t;c.has(e)||(null!==(t=nw(a.get(e),o.get(e)))&&i.set(e,t),c=c.add(e))}),e.push(this.documentOverlayCache.saveOverlays(s,n,i))}return F.waitFor(e)}).next(()=>o)}recalculateAndSaveOverlaysForDocumentKeys(t,e){return this.remoteDocumentCache.getEntries(t,e).next(e=>this.recalculateAndSaveOverlays(t,e))}getDocumentsMatchingQuery(e,t,n){return r=t,L.isDocumentKey(r.path)&&null===r.collectionGroup&&0===r.filters.length?this.getDocumentsMatchingDocumentQuery(e,t.path):A_(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n):this.getDocumentsMatchingCollectionQuery(e,t,n);var r}getNextDocuments(s,t,a,o){return this.remoteDocumentCache.getAllFromCollectionGroup(s,t,a,o).next(n=>{const e=0<o-n.size?this.documentOverlayCache.getOverlaysForCollectionGroup(s,t,a.largestBatchId,o-n.size):F.resolve(ww());let r=-1,i=n;return e.next(e=>F.forEach(e,(t,e)=>(r<e.largestBatchId&&(r=e.largestBatchId),n.get(t)?F.resolve():this.getBaseDocument(s,t,e).next(e=>{i=i.insert(t,e)}))).next(()=>this.populateOverlays(s,e,n)).next(()=>this.computeViews(s,i,e,V())).next(e=>({batchId:r,changes:_w(e)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new L(t)).next(e=>{let t=yw();return t=e.isFoundDocument()?t.insert(e.key,e):t})}getDocumentsMatchingCollectionGroupQuery(n,r,i){const s=r.collectionGroup;let a=yw();return this.indexManager.getCollectionParents(n,s).next(e=>F.forEach(e,e=>{t=r,e=e.child(s);var t,e=new I_(e,null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt);return this.getDocumentsMatchingCollectionQuery(n,e,i).next(e=>{e.forEach((e,t)=>{a=a.insert(e,t)})})}).next(()=>a))}getDocumentsMatchingCollectionQuery(t,s,n){let a;return this.remoteDocumentCache.getAllFromCollection(t,s.path,n).next(e=>(a=e,this.documentOverlayCache.getOverlaysForCollection(t,s.path,n.largestBatchId))).next(r=>{r.forEach((e,t)=>{t=t.getKey();null===a.get(t)&&(a=a.insert(t,q.newInvalidDocument(t)))});let i=yw();return a.forEach((e,t)=>{var n=r.get(e);void 0!==n&&rw(n.mutation,t,Ty.empty(),Bv.now()),M_(s,t)&&(i=i.insert(e,t))}),i})}getBaseDocument(e,t,n){return null===n||1===n.mutation.type?this.remoteDocumentCache.getEntry(e,t):F.resolve(q.newInvalidDocument(t))}}class $I{constructor(e){this.It=e,this.Zn=new Map,this.ts=new Map}getBundleMetadata(e,t){return F.resolve(this.Zn.get(t))}saveBundleMetadata(e,t){return this.Zn.set(t.id,{id:t.id,version:t.version,createTime:Uw(t.createTime)}),F.resolve()}getNamedQuery(e,t){return F.resolve(this.ts.get(t))}saveNamedQuery(e,t){return this.ts.set(t.name,{name:t.name,query:Kb(t.bundledQuery),readTime:Uw(t.readTime)}),F.resolve()}}class QI{constructor(){this.overlays=new yy(L.comparator),this.es=new Map}getOverlay(e,t){return F.resolve(this.overlays.get(t))}getOverlays(e,t){const n=ww();return F.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&n.set(t,e)})).next(()=>n)}saveOverlays(n,r,e){return e.forEach((e,t)=>{this.ue(n,r,t)}),F.resolve()}removeOverlaysForBatchId(e,t,n){const r=this.es.get(n);return void 0!==r&&(r.forEach(e=>this.overlays=this.overlays.remove(e)),this.es.delete(n)),F.resolve()}getOverlaysForCollection(e,t,n){const r=ww(),i=t.length+1,s=new L(t.child("")),a=this.overlays.getIteratorFrom(s);for(;a.hasNext();){const e=a.getNext().value,s=e.getKey();if(!t.isPrefixOf(s.path))break;s.path.length===i&&e.largestBatchId>n&&r.set(e.getKey(),e)}return F.resolve(r)}getOverlaysForCollectionGroup(t,e,n,r){let i=new yy((e,t)=>e-t);const s=this.overlays.getIterator();for(;s.hasNext();){const t=s.getNext().value;if(t.getKey().getCollectionGroup()===e&&t.largestBatchId>n){let e=i.get(t.largestBatchId);null===e&&(e=ww(),i=i.insert(t.largestBatchId,e)),e.set(t.getKey(),t)}}const a=ww(),o=i.getIterator();for(;o.hasNext()&&(o.getNext().value.forEach((e,t)=>a.set(e,t)),!(a.size()>=r)););return F.resolve(a)}ue(e,t,n){var r=this.overlays.get(n.key);if(null!==r){const e=this.es.get(r.largestBatchId).delete(n.key);this.es.set(r.largestBatchId,e)}this.overlays=this.overlays.insert(n.key,new Pb(t,n));let i=this.es.get(t);void 0===i&&(i=V(),this.es.set(t,i)),this.es.set(t,i.add(n.key))}}class YI{constructor(){this.ns=new U(JI.ss),this.rs=new U(JI.os)}isEmpty(){return this.ns.isEmpty()}addReference(e,t){e=new JI(e,t);this.ns=this.ns.add(e),this.rs=this.rs.add(e)}us(e,t){e.forEach(e=>this.addReference(e,t))}removeReference(e,t){this.cs(new JI(e,t))}hs(e,t){e.forEach(e=>this.removeReference(e,t))}ls(e){const t=new L(new M([])),n=new JI(t,e),r=new JI(t,e+1),i=[];return this.rs.forEachInRange([n,r],e=>{this.cs(e),i.push(e.key)}),i}fs(){this.ns.forEach(e=>this.cs(e))}cs(e){this.ns=this.ns.delete(e),this.rs=this.rs.delete(e)}ds(e){var t=new L(new M([])),n=new JI(t,e),t=new JI(t,e+1);let r=V();return this.rs.forEachInRange([n,t],e=>{r=r.add(e.key)}),r}containsKey(e){var t=new JI(e,0);return null!==(t=this.ns.firstAfterOrEqual(t))&&e.isEqual(t.key)}}class JI{constructor(e,t){this.key=e,this._s=t}static ss(e,t){return L.comparator(e.key,t.key)||P(e._s,t._s)}static os(e,t){return P(e._s,t._s)||L.comparator(e.key,t.key)}}class XI{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.ws=1,this.gs=new U(JI.ss)}checkEmpty(e){return F.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,n,r){var i=this.ws,t=(this.ws++,0<this.mutationQueue.length&&this.mutationQueue[this.mutationQueue.length-1],new xb(i,t,n,r));this.mutationQueue.push(t);for(const t of r)this.gs=this.gs.add(new JI(t.key,i)),this.indexManager.addToCollectionParentIndex(e,t.key.path.popLast());return F.resolve(t)}lookupMutationBatch(e,t){return F.resolve(this.ys(t))}getNextMutationBatchAfterBatchId(e,t){t=(t=this.ps(t+1))<0?0:t;return F.resolve(this.mutationQueue.length>t?this.mutationQueue[t]:null)}getHighestUnacknowledgedBatchId(){return F.resolve(0===this.mutationQueue.length?-1:this.ws-1)}getAllMutationBatches(e){return F.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const n=new JI(t,0),r=new JI(t,Number.POSITIVE_INFINITY),i=[];return this.gs.forEachInRange([n,r],e=>{e=this.ys(e._s);i.push(e)}),F.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new U(P);return t.forEach(e=>{var t=new JI(e,0),e=new JI(e,Number.POSITIVE_INFINITY);this.gs.forEachInRange([t,e],e=>{n=n.add(e._s)})}),F.resolve(this.Is(n))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,r=n.length+1;let i=n;L.isDocumentKey(i)||(i=i.child(""));t=new JI(new L(i),0);let s=new U(P);return this.gs.forEachWhile(e=>{var t=e.key.path;return!!n.isPrefixOf(t)&&(t.length===r&&(s=s.add(e._s)),!0)},t),F.resolve(this.Is(s))}Is(e){const t=[];return e.forEach(e=>{e=this.ys(e);null!==e&&t.push(e)}),t}removeMutationBatch(n,r){R(0===this.Ts(r.batchId,"removed")),this.mutationQueue.shift();let i=this.gs;return F.forEach(r.mutations,e=>{var t=new JI(e.key,r.batchId);return i=i.delete(t),this.referenceDelegate.markPotentiallyOrphaned(n,e.key)}).next(()=>{this.gs=i})}An(e){}containsKey(e,t){var n=new JI(t,0),n=this.gs.firstAfterOrEqual(n);return F.resolve(t.isEqual(n&&n.key))}performConsistencyCheck(e){return this.mutationQueue.length,F.resolve()}Ts(e,t){return this.ps(e)}ps(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}ys(e){e=this.ps(e);return e<0||e>=this.mutationQueue.length?null:this.mutationQueue[e]}}class ZI{constructor(e){this.Es=e,this.docs=new yy(L.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const n=t.key,r=this.docs.get(n),i=r?r.size:0,s=this.Es(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:s}),this.size+=s-i,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){var t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const n=this.docs.get(t);return F.resolve(n?n.document.mutableCopy():q.newInvalidDocument(t))}getEntries(e,t){let n=mw;return t.forEach(e=>{const t=this.docs.get(e);n=n.insert(e,t?t.document.mutableCopy():q.newInvalidDocument(e))}),F.resolve(n)}getAllFromCollection(e,t,n){let r=mw;const i=new L(t.child("")),s=this.docs.getIteratorFrom(i);for(;s.hasNext();){const{key:e,value:{document:i}}=s.getNext();if(!t.isPrefixOf(e.path))break;e.path.length>t.length+1||Zv(Jv(i),n)<=0||(r=r.insert(i.key,i.mutableCopy()))}return F.resolve(r)}getAllFromCollectionGroup(e,t,n,r){N()}As(e,t){return F.forEach(this.docs,e=>t(e))}newChangeBuffer(e){return new eT(this)}getSize(e){return F.resolve(this.size)}}class eT extends FI{constructor(e){super(),this.Yn=e}applyChanges(n){const r=[];return this.changes.forEach((e,t)=>{t.isValidDocument()?r.push(this.Yn.addEntry(n,t)):this.Yn.removeEntry(e)}),F.waitFor(r)}getFromCache(e,t){return this.Yn.getEntry(e,t)}getAllFromCache(e,t){return this.Yn.getEntries(e,t)}}class tT{constructor(e){this.persistence=e,this.Rs=new gw(e=>r_(e),i_),this.lastRemoteSnapshotVersion=O.min(),this.highestTargetId=0,this.bs=0,this.Ps=new YI,this.targetCount=0,this.vs=SI.Pn()}forEachTarget(e,n){return this.Rs.forEach((e,t)=>n(t)),F.resolve()}getLastRemoteSnapshotVersion(e){return F.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return F.resolve(this.bs)}allocateTargetId(e){return this.highestTargetId=this.vs.next(),F.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.bs&&(this.bs=t),F.resolve()}Dn(e){this.Rs.set(e.target,e);var t=e.targetId;t>this.highestTargetId&&(this.vs=new SI(t),this.highestTargetId=t),e.sequenceNumber>this.bs&&(this.bs=e.sequenceNumber)}addTargetData(e,t){return this.Dn(t),this.targetCount+=1,F.resolve()}updateTargetData(e,t){return this.Dn(t),F.resolve()}removeTargetData(e,t){return this.Rs.delete(t.target),this.Ps.ls(t.targetId),--this.targetCount,F.resolve()}removeTargets(n,r,i){let s=0;const a=[];return this.Rs.forEach((e,t)=>{t.sequenceNumber<=r&&null===i.get(t.targetId)&&(this.Rs.delete(e),a.push(this.removeMatchingKeysForTargetId(n,t.targetId)),s++)}),F.waitFor(a).next(()=>s)}getTargetCount(e){return F.resolve(this.targetCount)}getTargetData(e,t){t=this.Rs.get(t)||null;return F.resolve(t)}addMatchingKeys(e,t,n){return this.Ps.us(t,n),F.resolve()}removeMatchingKeys(t,e,n){this.Ps.hs(e,n);const r=this.persistence.referenceDelegate,i=[];return r&&e.forEach(e=>{i.push(r.markPotentiallyOrphaned(t,e))}),F.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.Ps.ls(t),F.resolve()}getMatchingKeysForTargetId(e,t){t=this.Ps.ds(t);return F.resolve(t)}containsKey(e,t){return F.resolve(this.Ps.containsKey(t))}}class nT{constructor(e,t){this.Vs={},this.overlays={},this.Ss=new fy(0),this.Ds=!1,this.Ds=!0,this.referenceDelegate=e(this),this.Cs=new tT(this),this.indexManager=new lI,this.remoteDocumentCache=(e=e=>this.referenceDelegate.xs(e),new ZI(e)),this.It=new Mb(t),this.Ns=new $I(this.It)}start(){return Promise.resolve()}shutdown(){return this.Ds=!1,Promise.resolve()}get started(){return this.Ds}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new QI,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.Vs[e.toKey()];return n||(n=new XI(t,this.referenceDelegate),this.Vs[e.toKey()]=n),n}getTargetCache(){return this.Cs}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ns}runTransaction(e,t,n){p("MemoryPersistence","Starting transaction:",e);const r=new rT(this.Ss.next());return this.referenceDelegate.ks(),n(r).next(e=>this.referenceDelegate.Os(r).next(()=>e)).toPromise().then(e=>(r.raiseOnCommittedEvent(),e))}Ms(t,n){return F.or(Object.values(this.Vs).map(e=>()=>e.containsKey(t,n)))}}class rT extends ty{constructor(e){super(),this.currentSequenceNumber=e}}class iT{constructor(e){this.persistence=e,this.Fs=new YI,this.$s=null}static Bs(e){return new iT(e)}get Ls(){if(this.$s)return this.$s;throw N()}addReference(e,t,n){return this.Fs.addReference(n,t),this.Ls.delete(n.toString()),F.resolve()}removeReference(e,t,n){return this.Fs.removeReference(n,t),this.Ls.add(n.toString()),F.resolve()}markPotentiallyOrphaned(e,t){return this.Ls.add(t.toString()),F.resolve()}removeTarget(e,t){this.Fs.ls(t.targetId).forEach(e=>this.Ls.add(e.toString()));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next(e=>{e.forEach(e=>this.Ls.add(e.toString()))}).next(()=>n.removeTargetData(e,t))}ks(){this.$s=new Set}Os(n){const r=this.persistence.getRemoteDocumentCache().newChangeBuffer();return F.forEach(this.Ls,e=>{const t=L.fromPath(e);return this.Us(n,t).next(e=>{e||r.removeEntry(t,O.min())})}).next(()=>(this.$s=null,r.apply(n)))}updateLimboDocument(e,t){return this.Us(e,t).next(e=>{e?this.Ls.delete(t.toString()):this.Ls.add(t.toString())})}xs(e){return 0}Us(e,t){return F.or([()=>F.resolve(this.Fs.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ms(e,t)])}}class sT{constructor(e){this.It=e}$(t,e,n,r){const s=new ry("createOrUpgrade",e);var i;n<1&&1<=r&&(t.createObjectStore("owner"),(i=t).createObjectStore("mutationQueues",{keyPath:"userId"}),i.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",ab,{unique:!0}),i.createObjectStore("documentMutations"),aT(t),t.createObjectStore("remoteDocuments"));let a=F.resolve();return n<3&&3<=r&&(0!==n&&((i=t).deleteObjectStore("targetDocuments"),i.deleteObjectStore("targets"),i.deleteObjectStore("targetGlobal"),aT(t)),a=a.next(()=>{{const e=s.store("targetGlobal"),t={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:O.min().toTimestamp(),targetCount:0};return e.put("targetGlobalKey",t)}})),n<4&&4<=r&&(a=(a=0!==n?a.next(()=>{var r=t,i=s;return i.store("mutations").W().next(e=>{r.deleteObjectStore("mutations"),r.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",ab,{unique:!0});const t=i.store("mutations"),n=e.map(e=>t.put(e));return F.waitFor(n)})}):a).next(()=>{t.createObjectStore("clientMetadata",{keyPath:"clientId"})})),n<5&&5<=r&&(a=a.next(()=>this.qs(s))),n<6&&6<=r&&(a=a.next(()=>(t.createObjectStore("remoteDocumentGlobal"),this.Ks(s)))),n<7&&7<=r&&(a=a.next(()=>this.Gs(s))),n<8&&8<=r&&(a=a.next(()=>this.Qs(t,s))),n<9&&9<=r&&(a=a.next(()=>{var e;(e=t).objectStoreNames.contains("remoteDocumentChanges")&&e.deleteObjectStore("remoteDocumentChanges")})),n<10&&10<=r&&(a=a.next(()=>this.js(s))),n<11&&11<=r&&(a=a.next(()=>{t.createObjectStore("bundles",{keyPath:"bundleId"}),t.createObjectStore("namedQueries",{keyPath:"name"})})),n<12&&12<=r&&(a=a.next(()=>{{const e=t.createObjectStore("documentOverlays",{keyPath:bb});return e.createIndex("collectionPathOverlayIndex",Ib,{unique:!1}),void e.createIndex("collectionGroupOverlayIndex",Tb,{unique:!1})}})),n<13&&13<=r&&(a=a.next(()=>{{const e=t.createObjectStore("remoteDocumentsV14",{keyPath:ub});return e.createIndex("documentKeyIndex",hb),void e.createIndex("collectionGroupIndex",db)}}).next(()=>this.Ws(t,s)).next(()=>t.deleteObjectStore("remoteDocuments"))),n<14&&14<=r&&(a=a.next(()=>this.zs(t,s))),a=n<15&&15<=r?a.next(()=>{var e=t;e.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),e.createObjectStore("indexState",{keyPath:vb}).createIndex("sequenceNumberIndex",yb,{unique:!1}),e.createObjectStore("indexEntries",{keyPath:_b}).createIndex("documentKeyIndex",wb,{unique:!1})}):a}Ks(t){let n=0;return t.store("remoteDocuments").Z((e,t)=>{n+=wI(t)}).next(()=>{var e={byteSize:n};return t.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",e)})}qs(n){const e=n.store("mutationQueues"),r=n.store("mutations");return e.W().next(e=>F.forEach(e,t=>{var e=IDBKeyRange.bound([t.userId,-1],[t.userId,t.lastAcknowledgedBatchId]);return r.W("userMutationsIndex",e).next(e=>F.forEach(e,e=>{R(e.userId===t.userId);e=Vb(this.It,e);return _I(n,t.userId,e).next(()=>{})}))}))}Gs(e){const a=e.store("targetDocuments"),t=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next(i=>{const s=[];return t.Z((e,t)=>{const n=new M(e),r=[0,rb(n)];s.push(a.get(r).next(e=>e?F.resolve():(e=>a.put({targetId:0,path:rb(e),sequenceNumber:i.highestListenSequenceNumber}))(n)))}).next(()=>F.waitFor(s))})}Qs(e,t){e.createObjectStore("collectionParents",{keyPath:mb});const n=t.store("collectionParents"),r=new cI,i=e=>{if(r.add(e)){const t=e.lastSegment(),r=e.popLast();return n.put({collectionId:t,parent:rb(r)})}};return t.store("remoteDocuments").Z({X:!0},(e,t)=>{const n=new M(e);return i(n.popLast())}).next(()=>t.store("documentMutations").Z({X:!0},([,e],t)=>{const n=sb(e);return i(n.popLast())}))}js(e){const n=e.store("targets");return n.Z((e,t)=>{t=Bb(t),t=jb(this.It,t);return n.put(t)})}Ws(e,s){const t=s.store("remoteDocuments"),a=[];return t.Z((e,t)=>{const n=s.store("remoteDocumentsV14"),r=((i=t).document?new L(M.fromString(i.document.name).popFirst(5)):i.noDocument?L.fromSegments(i.noDocument.path):i.unknownDocument?L.fromSegments(i.unknownDocument.path):N()).path.toArray();var i={prefixPath:r.slice(0,r.length-2),collectionGroup:r[r.length-2],documentId:r[r.length-1],readTime:t.readTime||[0,0],unknownDocument:t.unknownDocument,noDocument:t.noDocument,document:t.document,hasCommittedMutations:!!t.hasCommittedMutations};a.push(n.put(i))}).next(()=>F.waitFor(a))}zs(e,i){const t=i.store("mutations"),s=qI(this.It),a=new nT(iT.Bs,this.It.re);return t.W().next(e=>{const r=new Map;return e.forEach(e=>{var t;let n=null!=(t=r.get(e.userId))?t:V();Vb(this.It,e).keys().forEach(e=>n=n.add(e)),r.set(e.userId,n)}),F.forEach(r,(e,t)=>{var t=new Iv(t),n=Yb.oe(this.It,t),r=a.getIndexManager(t),t=bI.oe(t,this.It,r,a.referenceDelegate);return new HI(s,t,n,r).recalculateAndSaveOverlaysForDocumentKeys(new Nb(i,fy.at),e).next()})})}}function aT(e){e.createObjectStore("targetDocuments",{keyPath:fb}).createIndex("documentTargetsIndex",gb,{unique:!0}),e.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",pb,{unique:!0}),e.createObjectStore("targetGlobal")}const oT="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class lT{constructor(e,t,n,r,i,s,a,o,l,c,u=15){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=n,this.Hs=i,this.window=s,this.document=a,this.Js=l,this.Ys=c,this.Xs=u,this.Ss=null,this.Ds=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Zs=null,this.inForeground=!1,this.ti=null,this.ei=null,this.ni=Number.NEGATIVE_INFINITY,this.si=e=>Promise.resolve(),!lT.C())throw new D(x.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new MI(this,r),this.ii=t+"main",this.It=new Mb(o),this.ri=new iy(this.ii,this.Xs,new sT(this.It)),this.Cs=new CI(this.referenceDelegate,this.It),this.remoteDocumentCache=qI(this.It),this.Ns=new Hb,this.window&&this.window.localStorage?this.oi=this.window.localStorage:(this.oi=null,!1===c&&Sv("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.ui().then(()=>{if(this.isPrimary||this.allowTabSynchronization)return this.ci(),this.ai(),this.hi(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.Cs.getHighestSequenceNumber(e));throw new D(x.FAILED_PRECONDITION,oT)}).then(e=>{this.Ss=new fy(e,this.Js)}).then(()=>{this.Ds=!0}).catch(e=>(this.ri&&this.ri.close(),Promise.reject(e)))}li(t){return this.si=async e=>{if(this.started)return t(e)},t(this.isPrimary)}setDatabaseDeletedListener(t){this.ri.L(async e=>{null===e.newVersion&&await t()})}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.Hs.enqueueAndForget(async()=>{this.started&&await this.ui()}))}ui(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",t=>uT(t).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.fi(t).next(e=>{e||(this.isPrimary=!1,this.Hs.enqueueRetryable(()=>this.si(!1)))})}).next(()=>this.di(t)).next(e=>this.isPrimary&&!e?this._i(t).next(()=>!1):!!e&&this.wi(t).next(()=>!0))).catch(e=>{if(oy(e))return p("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(this.allowTabSynchronization)return p("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1;throw e}).then(e=>{this.isPrimary!==e&&this.Hs.enqueueRetryable(()=>this.si(e)),this.isPrimary=e})}fi(e){return cT(e).get("owner").next(e=>F.resolve(this.mi(e)))}gi(e){return uT(e).delete(this.clientId)}async yi(){if(this.isPrimary&&!this.pi(this.ni,18e5)){this.ni=Date.now();var e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",e=>{const r=Rb(e,"clientMetadata");return r.W().next(e=>{const t=this.Ii(e,18e5),n=e.filter(e=>-1===t.indexOf(e));return F.forEach(n,e=>r.delete(e.clientId)).next(()=>n)})}).catch(()=>[]);if(this.oi)for(const t of e)this.oi.removeItem(this.Ti(t.clientId))}}hi(){this.ei=this.Hs.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.ui().then(()=>this.yi()).then(()=>this.hi()))}mi(e){return!!e&&e.ownerId===this.clientId}di(t){return this.Ys?F.resolve(!0):cT(t).get("owner").next(e=>{if(null!==e&&this.pi(e.leaseTimestampMs,5e3)&&!this.Ei(e.ownerId)){if(this.mi(e)&&this.networkEnabled)return!0;if(!this.mi(e)){if(e.allowTabSynchronization)return!1;throw new D(x.FAILED_PRECONDITION,oT)}}return!(!this.networkEnabled||!this.inForeground)||uT(t).W().next(e=>void 0===this.Ii(e,5e3).find(e=>{if(this.clientId!==e.clientId){var t=!this.networkEnabled&&e.networkEnabled,n=!this.inForeground&&e.inForeground,e=this.networkEnabled===e.networkEnabled;if(t||n&&e)return!0}return!1}))}).next(e=>(this.isPrimary!==e&&p("IndexedDbPersistence",`Client ${e?"is":"is not"} eligible for a primary lease.`),e))}async shutdown(){this.Ds=!1,this.Ai(),this.ei&&(this.ei.cancel(),this.ei=null),this.Ri(),this.bi(),await this.ri.runTransaction("shutdown","readwrite",["owner","clientMetadata"],e=>{const t=new Nb(e,fy.at);return this._i(t).next(()=>this.gi(t))}),this.ri.close(),this.Pi()}Ii(e,t){return e.filter(e=>this.pi(e.updateTimeMs,t)&&!this.Ei(e.clientId))}vi(){return this.runTransaction("getActiveClients","readonly",e=>uT(e).W().next(e=>this.Ii(e,18e5).map(e=>e.clientId)))}get started(){return this.Ds}getMutationQueue(e,t){return bI.oe(e,this.It,t,this.referenceDelegate)}getTargetCache(){return this.Cs}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new hI(e,this.It.re.databaseId)}getDocumentOverlayCache(e){return Yb.oe(this.It,e)}getBundleCache(){return this.Ns}runTransaction(t,n,r){p("IndexedDbPersistence","Starting transaction:",t);var e="readonly"===n?"readonly":"readwrite",i=15===(i=this.Xs)?Ab:14===i?Cb:13===i?Sb:12===i?kb:11===i?Eb:void N();let s;return this.ri.runTransaction(t,e,i,e=>(s=new Nb(e,this.Ss?this.Ss.next():fy.at),"readwrite-primary"===n?this.fi(s).next(e=>!!e||this.di(s)).next(e=>{if(e)return r(s);throw Sv(`Failed to obtain primary lease for action '${t}'.`),this.isPrimary=!1,this.Hs.enqueueRetryable(()=>this.si(!1)),new D(x.FAILED_PRECONDITION,ey)}).next(e=>this.wi(s).next(()=>e)):this.Vi(s).next(()=>r(s)))).then(e=>(s.raiseOnCommittedEvent(),e))}Vi(e){return cT(e).get("owner").next(e=>{if(null!==e&&this.pi(e.leaseTimestampMs,5e3)&&!this.Ei(e.ownerId)&&!this.mi(e)&&!(this.Ys||this.allowTabSynchronization&&e.allowTabSynchronization))throw new D(x.FAILED_PRECONDITION,oT)})}wi(e){var t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return cT(e).put("owner",t)}static C(){return iy.C()}_i(e){const t=cT(e);return t.get("owner").next(e=>this.mi(e)?(p("IndexedDbPersistence","Releasing primary lease."),t.delete("owner")):F.resolve())}pi(e,t){var n=Date.now();return!(e<n-t||n<e&&(Sv(`Detected an update time that is in the future: ${e} > `+n),1))}ci(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.ti=()=>{this.Hs.enqueueAndForget(()=>(this.inForeground="visible"===this.document.visibilityState,this.ui()))},this.document.addEventListener("visibilitychange",this.ti),this.inForeground="visible"===this.document.visibilityState)}Ri(){this.ti&&(this.document.removeEventListener("visibilitychange",this.ti),this.ti=null)}ai(){var e;"function"==typeof(null==(e=this.window)?void 0:e.addEventListener)&&(this.Zs=()=>{this.Ai(),!z()&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")&&navigator.appVersion.match(/Version\/1[45]/)&&this.Hs.enterRestrictedMode(!0),this.Hs.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Zs))}bi(){this.Zs&&(this.window.removeEventListener("pagehide",this.Zs),this.Zs=null)}Ei(e){var t;try{var n=null!==(null==(t=this.oi)?void 0:t.getItem(this.Ti(e)));return p("IndexedDbPersistence",`Client '${e}' ${n?"is":"is not"} zombied in LocalStorage`),n}catch(e){return Sv("IndexedDbPersistence","Failed to get zombied client id.",e),!1}}Ai(){if(this.oi)try{this.oi.setItem(this.Ti(this.clientId),String(Date.now()))}catch(e){Sv("Failed to set zombie client id.",e)}}Pi(){if(this.oi)try{this.oi.removeItem(this.Ti(this.clientId))}catch(e){}}Ti(e){return`firestore_zombie_${this.persistenceKey}_`+e}}function cT(e){return Rb(e,"owner")}function uT(e){return Rb(e,"clientMetadata")}function hT(e,t){let n=e.projectId;return e.isDefaultDatabase||(n+="."+e.database),"firestore/"+t+"/"+n+"/"}class dT{constructor(e,t,n,r){this.targetId=e,this.fromCache=t,this.Si=n,this.Di=r}static Ci(e,t){let n=V(),r=V();for(const e of t.docChanges)switch(e.type){case 0:n=n.add(e.doc.key);break;case 1:r=r.add(e.doc.key)}return new dT(e,t.fromCache,n,r)}}class pT{constructor(){this.xi=!1}initialize(e,t){this.Ni=e,this.indexManager=t,this.xi=!0}getDocumentsMatchingQuery(t,n,r,i){return this.ki(t,n).next(e=>e||this.Oi(t,n,i,r)).next(e=>e||this.Mi(t,n))}ki(i,s){if(k_(s))return F.resolve(null);let t=R_(s);return this.indexManager.getIndexType(i,t).next(e=>0===e?null:(null!==s.limit&&1===e&&(s=x_(s,null,"F"),t=R_(s)),this.indexManager.getDocumentsMatchingTarget(i,t).next(e=>{const r=V(...e);return this.Ni.getDocuments(i,r).next(n=>this.indexManager.getMinOffset(i,t).next(e=>{var t=this.Fi(s,n);return this.$i(s,t,r,e.readTime)?this.ki(i,x_(s,null,"F")):this.Bi(i,t,s,e)}))})))}Oi(t,n,r,i){return k_(n)||i.isEqual(O.min())?this.Mi(t,n):this.Ni.getDocuments(t,r).next(e=>{e=this.Fi(n,e);return this.$i(n,e,r,i)?this.Mi(t,n):(kv()<=h.DEBUG&&p("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),O_(n)),this.Bi(t,e,n,Yv(i,-1)))})}Fi(n,e){let r=new U(F_(n));return e.forEach((e,t)=>{M_(n,t)&&(r=r.add(t))}),r}$i(e,t,n,r){if(null===e.limit)return!1;if(n.size!==t.size)return!0;const i="F"===e.limitType?t.last():t.first();return!!i&&(i.hasPendingWrites||0<i.version.compareTo(r))}Mi(e,t){return kv()<=h.DEBUG&&p("QueryEngine","Using full collection scan to execute query:",O_(t)),this.Ni.getDocumentsMatchingQuery(e,t,Xv.min())}Bi(e,n,t,r){return this.Ni.getDocumentsMatchingQuery(e,t,r).next(t=>(n.forEach(e=>{t=t.insert(e.key,e)}),t))}}class fT{constructor(e,t,n,r){this.persistence=e,this.Li=t,this.It=r,this.Ui=new yy(P),this.qi=new gw(e=>r_(e),i_),this.Ki=new Map,this.Gi=e.getRemoteDocumentCache(),this.Cs=e.getTargetCache(),this.Ns=e.getBundleCache(),this.Qi(n)}Qi(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new HI(this.Gi,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Gi.setIndexManager(this.indexManager),this.Li.initialize(this.localDocuments,this.indexManager)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",e=>t.collect(e,this.Ui))}}function gT(e,t,n,r){return new fT(e,t,n,r)}async function mT(e,t){const a=e;return a.persistence.runTransaction("Handle user change","readonly",i=>{let s;return a.mutationQueue.getAllMutationBatches(i).next(e=>(s=e,a.Qi(t),a.mutationQueue.getAllMutationBatches(i))).next(e=>{const t=[],n=[];let r=V();for(const i of s){t.push(i.batchId);for(const e of i.mutations)r=r.add(e.key)}for(const i of e){n.push(i.batchId);for(const e of i.mutations)r=r.add(e.key)}return a.localDocuments.getDocuments(i,r).next(e=>({ji:e,removedBatchIds:t,addedBatchIds:n}))})})}function vT(e){const t=e;return t.persistence.runTransaction("Get last remote snapshot version","readonly",e=>t.Cs.getLastRemoteSnapshotVersion(e))}function yT(e,s,t){let n=V(),a=V();return t.forEach(e=>n=n.add(e)),s.getEntries(e,n).next(r=>{let i=mw;return t.forEach((e,t)=>{const n=r.get(e);t.isFoundDocument()!==n.isFoundDocument()&&(a=a.add(e)),t.isNoDocument()&&t.version.isEqual(O.min())?(s.removeEntry(e,t.readTime),i=i.insert(e,t)):!n.isValidDocument()||0<t.version.compareTo(n.version)||0===t.version.compareTo(n.version)&&n.hasPendingWrites?(s.addEntry(t),i=i.insert(e,t)):p("LocalStore","Ignoring outdated watch update for ",e,". Current version:",n.version," Watch version:",t.version)}),{Wi:i,zi:a}})}function _T(e,r){const i=e;return i.persistence.runTransaction("Allocate target","readwrite",t=>{let n;return i.Cs.getTargetData(t,r).next(e=>e?(n=e,F.resolve(n)):i.Cs.allocateTargetId(t).next(e=>(n=new Ob(r,e,0,t.currentSequenceNumber),i.Cs.addTargetData(t,n).next(()=>n))))}).then(e=>{var t=i.Ui.get(e.targetId);return(null===t||0<e.snapshotVersion.compareTo(t.snapshotVersion))&&(i.Ui=i.Ui.insert(e.targetId,e),i.qi.set(r,e.targetId)),e})}async function wT(e,t,n){const r=e,i=r.Ui.get(t),s=n?"readwrite":"readwrite-primary";try{n||await r.persistence.runTransaction("Release target",s,e=>r.persistence.referenceDelegate.removeTarget(e,i))}catch(e){if(!oy(e))throw e;p("LocalStore",`Failed to update sequence numbers for target ${t}: `+e)}r.Ui=r.Ui.remove(t),r.qi.delete(i.target)}function bT(e,n,r){const i=e;let s=O.min(),a=V();return i.persistence.runTransaction("Execute query","readonly",t=>function(e,t,n){const r=e,i=r.qi.get(n);return void 0!==i?F.resolve(r.Ui.get(i)):r.Cs.getTargetData(t,n)}(i,t,R_(n)).next(e=>{if(e)return s=e.lastLimboFreeSnapshotVersion,i.Cs.getMatchingKeysForTargetId(t,e.targetId).next(e=>{a=e})}).next(()=>i.Li.getDocumentsMatchingQuery(t,n,r?s:O.min(),r?a:V())).next(e=>(ET(i,L_(n),e),{documents:e,Hi:a})))}function IT(e,t){const n=e,r=n.Cs,i=n.Ui.get(t);return i?Promise.resolve(i.target):n.persistence.runTransaction("Get target data","readonly",e=>r.se(e,t).next(e=>e?e.target:null))}function TT(e,t){const n=e,r=n.Ki.get(t)||O.min();return n.persistence.runTransaction("Get new document changes","readonly",e=>n.Gi.getAllFromCollectionGroup(e,t,Yv(r,-1),Number.MAX_SAFE_INTEGER)).then(e=>(ET(n,t,e),e))}function ET(e,t,n){let r=e.Ki.get(t)||O.min();n.forEach((e,t)=>{0<t.readTime.compareTo(r)&&(r=t.readTime)}),e.Ki.set(t,r)}function kT(e,t){return`firestore_clients_${e}_`+t}function ST(e,t,n){let r=`firestore_mutations_${e}_`+n;return t.isAuthenticated()&&(r+="_"+t.uid),r}function CT(e,t){return`firestore_targets_${e}_`+t}class AT{constructor(e,t,n,r){this.user=e,this.batchId=t,this.state=n,this.error=r}static Zi(e,t,n){var r=JSON.parse(n);let i,s="object"==typeof r&&-1!==["pending","acknowledged","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error);return s&&r.error&&((s="string"==typeof r.error.message&&"string"==typeof r.error.code)&&(i=new D(r.error.code,r.error.message))),s?new AT(e,t,r.state,i):(Sv("SharedClientState",`Failed to parse mutation state for ID '${t}': `+n),null)}tr(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class NT{constructor(e,t,n){this.targetId=e,this.state=t,this.error=n}static Zi(e,t){var n=JSON.parse(t);let r,i="object"==typeof n&&-1!==["not-current","current","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error);return i&&n.error&&((i="string"==typeof n.error.message&&"string"==typeof n.error.code)&&(r=new D(n.error.code,n.error.message))),i?new NT(e,n.state,r):(Sv("SharedClientState",`Failed to parse target state for ID '${e}': `+t),null)}tr(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class RT{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Zi(e,t){var n=JSON.parse(t);let r="object"==typeof n&&n.activeTargetIds instanceof Array,i=Tw;for(let e=0;r&&e<n.activeTargetIds.length;++e)r=My(n.activeTargetIds[e]),i=i.add(n.activeTargetIds[e]);return r?new RT(e,i):(Sv("SharedClientState",`Failed to parse client data for instance '${e}': `+t),null)}}class xT{constructor(e,t){this.clientId=e,this.onlineState=t}static Zi(e){var t=JSON.parse(e);return"object"==typeof t&&-1!==["Unknown","Online","Offline"].indexOf(t.onlineState)&&"string"==typeof t.clientId?new xT(t.clientId,t.onlineState):(Sv("SharedClientState","Failed to parse online state: "+e),null)}}class DT{constructor(){this.activeTargetIds=Tw}er(e){this.activeTargetIds=this.activeTargetIds.add(e)}nr(e){this.activeTargetIds=this.activeTargetIds.delete(e)}tr(){var e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class PT{constructor(e,t,n,r,i){this.window=e,this.Hs=t,this.persistenceKey=n,this.sr=r,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.ir=this.rr.bind(this),this.ur=new yy(P),this.started=!1,this.cr=[];e=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.ar=kT(this.persistenceKey,this.sr),this.hr="firestore_sequence_number_"+this.persistenceKey,this.ur=this.ur.insert(this.sr,new DT),this.lr=new RegExp(`^firestore_clients_${e}_([^_]*)$`),this.dr=new RegExp(`^firestore_mutations_${e}_(\\d+)(?:_(.*))?$`),this._r=new RegExp(`^firestore_targets_${e}_(\\d+)$`),this.wr="firestore_online_state_"+this.persistenceKey,this.mr="firestore_bundle_loaded_v2_"+this.persistenceKey,this.window.addEventListener("storage",this.ir)}static C(e){return!(!e||!e.localStorage)}async start(){const e=await this.syncEngine.vi();for(const n of e)if(n!==this.sr){const e=this.getItem(kT(this.persistenceKey,n));var t;e&&(t=RT.Zi(n,e))&&(this.ur=this.ur.insert(t.clientId,t))}this.gr();const n=this.storage.getItem(this.wr);if(n){const e=this.yr(n);e&&this.pr(e)}for(const e of this.cr)this.rr(e);this.cr=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0}writeSequenceNumber(e){this.setItem(this.hr,JSON.stringify(e))}getAllActiveQueryTargets(){return this.Ir(this.ur)}isActiveQueryTarget(n){let r=!1;return this.ur.forEach((e,t)=>{t.activeTargetIds.has(n)&&(r=!0)}),r}addPendingMutation(e){this.Tr(e,"pending")}updateMutationState(e,t,n){this.Tr(e,t,n),this.Er(e)}addLocalQueryTarget(e){let t="not-current";var n;return!this.isActiveQueryTarget(e)||(n=this.storage.getItem(CT(this.persistenceKey,e)))&&(n=NT.Zi(e,n))&&(t=n.state),this.Ar.er(e),this.gr(),t}removeLocalQueryTarget(e){this.Ar.nr(e),this.gr()}isLocalQueryTarget(e){return this.Ar.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(CT(this.persistenceKey,e))}updateQueryState(e,t,n){this.Rr(e,t,n)}handleUserChange(e,t,n){t.forEach(e=>{this.Er(e)}),this.currentUser=e,n.forEach(e=>{this.addPendingMutation(e)})}setOnlineState(e){this.br(e)}notifyBundleLoaded(e){this.Pr(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.ir),this.removeItem(this.ar),this.started=!1)}getItem(e){var t=this.storage.getItem(e);return p("SharedClientState","READ",e,t),t}setItem(e,t){p("SharedClientState","SET",e,t),this.storage.setItem(e,t)}removeItem(e){p("SharedClientState","REMOVE",e),this.storage.removeItem(e)}rr(e){const i=e;i.storageArea===this.storage&&(p("SharedClientState","EVENT",i.key,i.newValue),i.key!==this.ar?this.Hs.enqueueRetryable(async()=>{var e;if(this.started){if(null!==i.key){if(this.lr.test(i.key))return null==i.newValue?(e=this.vr(i.key),this.Vr(e,null)):(e=this.Sr(i.key,i.newValue))?this.Vr(e.clientId,e):void 0;if(this.dr.test(i.key)){if(null!==i.newValue){var t=this.Dr(i.key,i.newValue);if(t)return this.Cr(t)}}else if(this._r.test(i.key)){if(null!==i.newValue&&(t=this.Nr(i.key,i.newValue)))return this.kr(t)}else if(i.key===this.wr){if(null!==i.newValue){var n=this.yr(i.newValue);if(n)return this.pr(n)}}else if(i.key===this.hr)(n=function(e){let t=fy.at;if(null!=e)try{var n=JSON.parse(e);R("number"==typeof n),t=n}catch(e){Sv("SharedClientState","Failed to read sequence number from WebStorage",e)}return t}(i.newValue))!==fy.at&&this.sequenceNumberHandler(n);else if(i.key===this.mr){const r=this.Or(i.newValue);await Promise.all(r.map(e=>this.syncEngine.Mr(e)))}}}else this.cr.push(i)}):Sv("Received WebStorage notification for local change. Another client might have garbage-collected our state"))}get Ar(){return this.ur.get(this.sr)}gr(){this.setItem(this.ar,this.Ar.tr())}Tr(e,t,n){const r=new AT(this.currentUser,e,t,n),i=ST(this.persistenceKey,this.currentUser,e);this.setItem(i,r.tr())}Er(e){e=ST(this.persistenceKey,this.currentUser,e);this.removeItem(e)}br(e){e={clientId:this.sr,onlineState:e};this.storage.setItem(this.wr,JSON.stringify(e))}Rr(e,t,n){const r=CT(this.persistenceKey,e),i=new NT(e,t,n);this.setItem(r,i.tr())}Pr(e){e=JSON.stringify(Array.from(e));this.setItem(this.mr,e)}vr(e){e=this.lr.exec(e);return e?e[1]:null}Sr(e,t){e=this.vr(e);return RT.Zi(e,t)}Dr(e,t){var e=this.dr.exec(e),n=Number(e[1]),e=void 0!==e[2]?e[2]:null;return AT.Zi(new Iv(e),n,t)}Nr(e,t){e=this._r.exec(e),e=Number(e[1]);return NT.Zi(e,t)}yr(e){return xT.Zi(e)}Or(e){return JSON.parse(e)}async Cr(e){if(e.user.uid===this.currentUser.uid)return this.syncEngine.Fr(e.batchId,e.state,e.error);p("SharedClientState","Ignoring mutation for non-active user "+e.user.uid)}kr(e){return this.syncEngine.$r(e.targetId,e.state,e.error)}Vr(e,t){const n=t?this.ur.insert(e,t):this.ur.remove(e),r=this.Ir(this.ur),i=this.Ir(n),s=[],a=[];return i.forEach(e=>{r.has(e)||s.push(e)}),r.forEach(e=>{i.has(e)||a.push(e)}),this.syncEngine.Br(s,a).then(()=>{this.ur=n})}pr(e){this.ur.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}Ir(e){let n=Tw;return e.forEach((e,t)=>{n=n.unionWith(t.activeTargetIds)}),n}}class OT{constructor(){this.Lr=new DT,this.Ur={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e){return this.Lr.er(e),this.Ur[e]||"not-current"}updateQueryState(e,t,n){this.Ur[e]=t}removeLocalQueryTarget(e){this.Lr.nr(e)}isLocalQueryTarget(e){return this.Lr.activeTargetIds.has(e)}clearQueryState(e){delete this.Ur[e]}getAllActiveQueryTargets(){return this.Lr.activeTargetIds}isActiveQueryTarget(e){return this.Lr.activeTargetIds.has(e)}start(){return this.Lr=new DT,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class MT{qr(e){}shutdown(){}}class LT{constructor(){this.Kr=()=>this.Gr(),this.Qr=()=>this.jr(),this.Wr=[],this.zr()}qr(e){this.Wr.push(e)}shutdown(){window.removeEventListener("online",this.Kr),window.removeEventListener("offline",this.Qr)}zr(){window.addEventListener("online",this.Kr),window.addEventListener("offline",this.Qr)}Gr(){p("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.Wr)e(0)}jr(){p("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.Wr)e(1)}static C(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}const FT={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class UT{constructor(e){this.Hr=e.Hr,this.Jr=e.Jr}Yr(e){this.Xr=e}Zr(e){this.eo=e}onMessage(e){this.no=e}close(){this.Jr()}send(e){this.Hr(e)}so(){this.Xr()}io(e){this.eo(e)}ro(e){this.no(e)}}class qT extends class{constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;var t=e.ssl?"https":"http";this.oo=t+"://"+e.host,this.uo="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}get co(){return!1}ao(t,e,n,r,i){const s=this.ho(t,e);p("RestConnection","Sending: ",s,n);e={};return this.lo(e,r,i),this.fo(t,s,e,n).then(e=>(p("RestConnection","Received: ",e),e),e=>{throw Cv("RestConnection",t+" failed with error: ",e,"url: ",s,"request:",n),e})}_o(e,t,n,r,i,s){return this.ao(e,t,n,r,i)}lo(n,e,t){n["X-Goog-Api-Client"]="gl-js/ fire/"+Tv,n["Content-Type"]="text/plain",this.databaseInfo.appId&&(n["X-Firebase-GMPID"]=this.databaseInfo.appId),e&&e.headers.forEach((e,t)=>n[t]=e),t&&t.headers.forEach((e,t)=>n[t]=e)}ho(e,t){e=FT[e];return this.oo+`/v1/${t}:`+e}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams}fo(l,t,n,r){return new Promise((s,a)=>{const o=new bv;o.setWithCredentials(!0),o.listenOnce(vv.COMPLETE,()=>{var t,n;try{switch(o.getLastErrorCode()){case mv.NO_ERROR:var e=o.getResponseJson();p("Connection","XHR received:",JSON.stringify(e)),s(e);break;case mv.TIMEOUT:p("Connection",'RPC "'+l+'" timed out'),a(new D(x.DEADLINE_EXCEEDED,"Request time out"));break;case mv.HTTP_ERROR:var r=o.getStatus();if(p("Connection",'RPC "'+l+'" failed with status:',r,"response text:",o.getResponseText()),0<r){let e=o.getResponseJson();var i=null==(t=e=Array.isArray(e)?e[0]:e)?void 0:t.error;if(i&&i.status&&i.message){n=i.status.toLowerCase().replace(/_/g,"-");const l=0<=Object.values(x).indexOf(n)?n:x.UNKNOWN;a(new D(l,i.message))}else a(new D(x.UNKNOWN,"Server responded with status "+o.getStatus()))}else a(new D(x.UNAVAILABLE,"Connection failed."));break;default:N()}}finally{p("Connection",'RPC "'+l+'" completed.')}});var e=JSON.stringify(r);o.send(t,"POST",e,n,15)})}wo(e,t,n){const r=[this.oo,"/","google.firestore.v1.Firestore","/",e,"/channel"],i=new lv,s=gv(),a={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/`+this.databaseId.database},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.useFetchStreams&&(a.xmlHttpFactory=new _v({})),this.lo(a.initMessageHeaders,t,n),a.encodeInitMessageHeaders=!0;e=r.join("");p("Connection","Creating WebChannel: "+e,a);const o=i.createWebChannel(e,a);let l=!1,c=!1;const u=new UT({Hr:e=>{c?p("Connection","Not sending because WebChannel is closed:",e):(l||(p("Connection","Opening WebChannel transport."),o.open(),l=!0),p("Connection","WebChannel sending:",e),o.send(e))},Jr:()=>o.close()}),h=(e,t,n)=>{e.listen(t,e=>{try{n(e)}catch(e){setTimeout(()=>{throw e},0)}})};return h(o,wv.EventType.OPEN,()=>{c||p("Connection","WebChannel transport opened.")}),h(o,wv.EventType.CLOSE,()=>{c||(c=!0,p("Connection","WebChannel transport closed"),u.io())}),h(o,wv.EventType.ERROR,e=>{c||(c=!0,Cv("Connection","WebChannel transport errored:",e),u.io(new D(x.UNAVAILABLE,"The operation could not be completed")))}),h(o,wv.EventType.MESSAGE,n=>{if(!c){var n=n.data[0],r=(R(!!n),n.error||(null==(r=n[0])?void 0:r.error));if(r){p("Connection","WebChannel received error:",r);const n=r.status;let e=function(e){e=pv[e];if(void 0!==e)return fw(e)}(n),t=r.message;void 0===e&&(e=x.INTERNAL,t="Unknown error status: "+n+" with message "+r.message),c=!0,u.io(new D(e,t)),o.close()}else p("Connection","WebChannel received:",n),u.ro(n)}}),h(s,yv.STAT_EVENT,e=>{10===e.stat?p("Connection","Detected buffering proxy"):11===e.stat&&p("Connection","Detected no buffering proxy")}),setTimeout(()=>{u.so()},0),u}}function VT(){return"undefined"!=typeof window?window:null}function BT(){return"undefined"!=typeof document?document:null}function jT(e){return new Mw(e,!0)}class KT{constructor(e,t,n=1e3,r=1.5,i=6e4){this.Hs=e,this.timerId=t,this.mo=n,this.yo=r,this.po=i,this.Io=0,this.To=null,this.Eo=Date.now(),this.reset()}reset(){this.Io=0}Ao(){this.Io=this.po}Ro(e){this.cancel();var t=Math.floor(this.Io+this.bo()),n=Math.max(0,Date.now()-this.Eo),r=Math.max(0,t-n);0<r&&p("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.Io} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.To=this.Hs.enqueueAfterDelay(this.timerId,r,()=>(this.Eo=Date.now(),e())),this.Io*=this.yo,this.Io<this.mo&&(this.Io=this.mo),this.Io>this.po&&(this.Io=this.po)}Po(){null!==this.To&&(this.To.skipDelay(),this.To=null)}cancel(){null!==this.To&&(this.To.cancel(),this.To=null)}bo(){return(Math.random()-.5)*this.Io}}class WT{constructor(e,t,n,r,i,s,a,o){this.Hs=e,this.vo=n,this.Vo=r,this.connection=i,this.authCredentialsProvider=s,this.appCheckCredentialsProvider=a,this.listener=o,this.state=0,this.So=0,this.Do=null,this.Co=null,this.stream=null,this.xo=new KT(e,t)}No(){return 1===this.state||5===this.state||this.ko()}ko(){return 2===this.state||3===this.state}start(){4!==this.state?this.auth():this.Oo()}async stop(){this.No()&&await this.close(0)}Mo(){this.state=0,this.xo.reset()}Fo(){this.ko()&&null===this.Do&&(this.Do=this.Hs.enqueueAfterDelay(this.vo,6e4,()=>this.$o()))}Bo(e){this.Lo(),this.stream.send(e)}async $o(){if(this.ko())return this.close(0)}Lo(){this.Do&&(this.Do.cancel(),this.Do=null)}Uo(){this.Co&&(this.Co.cancel(),this.Co=null)}async close(e,t){this.Lo(),this.Uo(),this.xo.cancel(),this.So++,4!==e?this.xo.reset():t&&t.code===x.RESOURCE_EXHAUSTED?(Sv(t.toString()),Sv("Using maximum backoff delay to prevent overloading the backend."),this.xo.Ao()):t&&t.code===x.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.qo(),this.stream.close(),this.stream=null),this.state=e,await this.listener.Zr(t)}qo(){}auth(){this.state=1;const e=this.Ko(this.So),n=this.So;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([e,t])=>{this.So===n&&this.Go(e,t)},t=>{e(()=>{var e=new D(x.UNKNOWN,"Fetching auth token failed: "+t.message);return this.Qo(e)})})}Go(e,t){const n=this.Ko(this.So);this.stream=this.jo(e,t),this.stream.Yr(()=>{n(()=>(this.state=2,this.Co=this.Hs.enqueueAfterDelay(this.Vo,1e4,()=>(this.ko()&&(this.state=3),Promise.resolve())),this.listener.Yr()))}),this.stream.Zr(e=>{n(()=>this.Qo(e))}),this.stream.onMessage(e=>{n(()=>this.onMessage(e))})}Oo(){this.state=5,this.xo.Ro(async()=>{this.state=0,this.start()})}Qo(e){return p("PersistentStream","close with error: "+e),this.stream=null,this.close(4,e)}Ko(t){return e=>{this.Hs.enqueueAndForget(()=>this.So===t?e():(p("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class zT extends WT{constructor(e,t,n,r,i,s){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,r,s),this.It=i}jo(e,t){return this.connection.wo("Listen",e,t)}onMessage(e){this.xo.reset();var t=function(e,t){let n;if("targetChange"in t){t.targetChange;var r="NO_CHANGE"===(p=t.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===p?1:"REMOVE"===p?2:"CURRENT"===p?3:"RESET"===p?4:N(),i=t.targetChange.targetIds||[],s=(p=t.targetChange.resumeToken,e.gt?(R(void 0===p||"string"==typeof p),Ey.fromBase64String(p||"")):(R(void 0===p||p instanceof Uint8Array),Ey.fromUint8Array(p||new Uint8Array))),a=t.targetChange.cause,o=a&&(o=void 0===(p=a).code?x.UNKNOWN:fw(p.code),new D(o,p.message||""));n=new Aw(r,i,s,o||null)}else if("documentChange"in t){t.documentChange;(u=t.documentChange).document,u.document.name,u.document.updateTime;var o=jw(e,u.document.name),l=Uw(u.document.updateTime),c=new e_({mapValue:{fields:u.document.fields}}),l=q.newFoundDocument(o,l,c),c=u.targetIds||[],u=u.removedTargetIds||[];n=new Sw(c,u,l.key,l)}else if("documentDelete"in t)t.documentDelete,(c=t.documentDelete).document,u=jw(e,c.document),l=c.readTime?Uw(c.readTime):O.min(),l=q.newNoDocument(u,l),c=c.removedTargetIds||[],n=new Sw([],c,l.key,l);else if("documentRemove"in t){t.documentRemove;(d=t.documentRemove).document;var h=jw(e,d.document),d=d.removedTargetIds||[];n=new Sw([],d,h,null)}else{if(!("filter"in t))return N();{t.filter;const e=t.filter;e.targetId,d=e.count||0,h=new dw(d),d=e.targetId,n=new Cw(d,h)}}var p;return n}(this.It,e),e=function(e){if(!("targetChange"in e))return O.min();e=e.targetChange;return e.targetIds&&e.targetIds.length||!e.readTime?O.min():Uw(e.readTime)}(e);return this.listener.Wo(t,e)}zo(e){const t={};t.database=zw(this.It),t.addTarget=function(e,t){let n;var r=t.target;return(n=s_(r)?{documents:Jw(e,r)}:{query:Xw(e,r)}).targetId=t.targetId,0<t.resumeToken.approximateByteSize()?n.resumeToken=Fw(e,t.resumeToken):0<t.snapshotVersion.compareTo(O.min())&&(n.readTime=Lw(e,t.snapshotVersion.toTimestamp())),n}(this.It,e);this.It,n=e;var n,e=null==(e=function(){switch(n.purpose){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return N()}}())?null:{"goog-listen-tags":e};e&&(t.labels=e),this.Bo(t)}Ho(e){const t={};t.database=zw(this.It),t.removeTarget=e,this.Bo(t)}}class GT extends WT{constructor(e,t,n,r,i,s){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,r,s),this.It=i,this.Jo=!1}get Yo(){return this.Jo}start(){this.Jo=!1,this.lastStreamToken=void 0,super.start()}qo(){this.Jo&&this.Xo([])}jo(e,t){return this.connection.wo("Write",e,t)}onMessage(e){var t,n,r;return R(!!e.streamToken),this.lastStreamToken=e.streamToken,this.Jo?(this.xo.reset(),n=e.writeResults,r=e.commitTime,n=n&&0<n.length?(R(void 0!==r),n.map(t=>{{var n=r;let e=t.updateTime?Uw(t.updateTime):Uw(n);return e.isEqual(O.min())&&(e=Uw(n)),new X_(e,t.transformResults||[])}})):[],t=Uw(e.commitTime),this.listener.Zo(t,n)):(R(!e.writeResults||0===e.writeResults.length),this.Jo=!0,this.listener.tu())}eu(){const e={};e.database=zw(this.It),this.Bo(e)}Xo(e){e={streamToken:this.lastStreamToken,writes:e.map(e=>Qw(this.It,e))};this.Bo(e)}}class HT extends class{}{constructor(e,t,n,r){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.It=r,this.nu=!1}su(){if(this.nu)throw new D(x.FAILED_PRECONDITION,"The client has already been terminated.")}ao(n,r,i){return this.su(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([e,t])=>this.connection.ao(n,r,i,e,t)).catch(e=>{throw"FirebaseError"===e.name?(e.code===x.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new D(x.UNKNOWN,e.toString())})}_o(n,r,i,s){return this.su(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([e,t])=>this.connection._o(n,r,i,e,t,s)).catch(e=>{throw"FirebaseError"===e.name?(e.code===x.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new D(x.UNKNOWN,e.toString())})}terminate(){this.nu=!0}}class $T{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.iu=0,this.ru=null,this.ou=!0}uu(){0===this.iu&&(this.cu("Unknown"),this.ru=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.ru=null,this.au("Backend didn't respond within 10 seconds."),this.cu("Offline"),Promise.resolve())))}hu(e){"Online"===this.state?this.cu("Unknown"):(this.iu++,1<=this.iu&&(this.lu(),this.au("Connection failed 1 times. Most recent error: "+e.toString()),this.cu("Offline")))}set(e){this.lu(),this.iu=0,"Online"===e&&(this.ou=!1),this.cu(e)}cu(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}au(e){e=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.ou?(Sv(e),this.ou=!1):p("OnlineStateTracker",e)}lu(){null!==this.ru&&(this.ru.cancel(),this.ru=null)}}class QT{constructor(e,t,n,r,i){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.fu=[],this.du=new Map,this._u=new Set,this.wu=[],this.mu=i,this.mu.qr(e=>{n.enqueueAndForget(async()=>{if(iE(this)){p("RemoteStore","Restarting streams for network reachability change.");{var e;const t=this;t._u.add(4),await JT(t),t.gu.set("Unknown"),t._u.delete(4),await YT(t)}}})}),this.gu=new $T(n,r)}}async function YT(e){if(iE(e))for(const t of e.wu)await t(!0)}async function JT(e){for(const t of e.wu)await t(!1)}function XT(e,t){const n=e;n.du.has(t.targetId)||(n.du.set(t.targetId,t),rE(n)?nE(n):pE(n).ko()&&eE(n,t))}function ZT(e,t){const n=e,r=pE(n);n.du.delete(t),r.ko()&&tE(n,t),0===n.du.size&&(r.ko()?r.Fo():iE(n)&&n.gu.set("Unknown"))}function eE(e,t){e.yu.Mt(t.targetId),pE(e).zo(t)}function tE(e,t){e.yu.Mt(t),pE(e).Ho(t)}function nE(t){t.yu=new Rw({getRemoteKeysForTarget:e=>t.remoteSyncer.getRemoteKeysForTarget(e),se:e=>t.du.get(e)||null}),pE(t).start(),t.gu.uu()}function rE(e){return iE(e)&&!pE(e).No()&&0<e.du.size}function iE(e){return 0===e._u.size}function sE(e){e.yu=void 0}async function aE(e,t,n){if(!oy(t))throw t;e._u.add(1),await JT(e),e.gu.set("Offline"),n=n||(()=>vT(e.localStore)),e.asyncQueue.enqueueRetryable(async()=>{p("RemoteStore","Retrying IndexedDB access"),await n(),e._u.delete(1),await YT(e)})}function oE(t,n){return n().catch(e=>aE(t,e,n))}async function lE(e){const t=e,n=fE(t);let r=0<t.fu.length?t.fu[t.fu.length-1].batchId:-1;for(;iE(a=t)&&a.fu.length<10;)try{const e=await function(e,t){const n=e;return n.persistence.runTransaction("Get next mutation batch","readonly",e=>(void 0===t&&(t=-1),n.mutationQueue.getNextMutationBatchAfterBatchId(e,t)))}(t.localStore,r);if(null===e){0===t.fu.length&&n.Fo();break}r=e.batchId;{var i=t;var s=e;i.fu.push(s);const o=fE(i);o.ko()&&o.Yo&&o.Xo(s.mutations)}}catch(e){await aE(t,e)}var a;cE(t)&&uE(t)}function cE(e){return iE(e)&&!fE(e).No()&&0<e.fu.length}function uE(e){fE(e).start()}async function hE(e,t){const n=e;n.asyncQueue.verifyOperationInProgress(),p("RemoteStore","RemoteStore received new credentials");e=iE(n);n._u.add(3),await JT(n),e&&n.gu.set("Unknown"),await n.remoteSyncer.handleCredentialChange(t),n._u.delete(3),await YT(n)}async function dE(e,t){const n=e;t?(n._u.delete(2),await YT(n)):(n._u.add(2),await JT(n),n.gu.set("Unknown"))}function pE(t){return t.pu||(t.pu=function(e,t,n){const r=e;return r.su(),new zT(t,r.connection,r.authCredentials,r.appCheckCredentials,r.It,n)}(t.datastore,t.asyncQueue,{Yr:async function(n){n.du.forEach((e,t)=>{eE(n,e)})}.bind(null,t),Zr:async function(e,t){sE(e),rE(e)?(e.gu.hu(t),nE(e)):e.gu.set("Unknown")}.bind(null,t),Wo:async function(e,t,n){if(e.gu.set("Online"),t instanceof Aw&&2===t.state&&t.cause)try{var r=e,i=t.cause;for(const o of t.targetIds)r.du.has(o)&&(await r.remoteSyncer.rejectListen(o,i),r.du.delete(o),r.yu.removeTarget(o))}catch(n){p("RemoteStore","Failed to remove targets %s: %s ",t.targetIds.join(","),n),await aE(e,n)}else if(t instanceof Sw?e.yu.Gt(t):t instanceof Cw?e.yu.Yt(t):e.yu.Wt(t),!n.isEqual(O.min()))try{const t=await vT(e.localStore);if(0<=n.compareTo(t)){var s=e,a=n;const l=s.yu.te(a);void await(l.targetChanges.forEach((e,t)=>{if(0<e.resumeToken.approximateByteSize()){const n=s.du.get(t);n&&s.du.set(t,n.withResumeToken(e.resumeToken,a))}}),l.targetMismatches.forEach(e=>{const t=s.du.get(e);t&&(s.du.set(e,t.withResumeToken(Ey.EMPTY_BYTE_STRING,t.snapshotVersion)),tE(s,e),e=new Ob(t.target,e,1,t.sequenceNumber),eE(s,e))}),s.remoteSyncer.applyRemoteEvent(l))}}catch(t){p("RemoteStore","Failed to raise snapshot:",t),await aE(e,t)}}.bind(null,t)}),t.wu.push(async e=>{e?(t.pu.Mo(),rE(t)?nE(t):t.gu.set("Unknown")):(await t.pu.stop(),sE(t))})),t.pu}function fE(t){return t.Iu||(t.Iu=function(e,t,n){const r=e;return r.su(),new GT(t,r.connection,r.authCredentials,r.appCheckCredentials,r.It,n)}(t.datastore,t.asyncQueue,{Yr:async function(e){fE(e).eu()}.bind(null,t),Zr:async function(e,t){if(t&&fE(e).Yo){var n=e,r=t,i;if(pw(i=r.code)&&i!==x.ABORTED){const i=n.fu.shift();fE(n).Mo(),await oE(n,()=>n.remoteSyncer.rejectFailedWrite(i.batchId,r)),await lE(n)}await 0}cE(e)&&uE(e)}.bind(null,t),tu:async function(e){const t=fE(e);for(const n of e.fu)t.Xo(n.mutations)}.bind(null,t),Zo:async function(e,t,n){const r=e.fu.shift(),i=Db.from(r,t,n);await oE(e,()=>e.remoteSyncer.applySuccessfulWrite(i)),await lE(e)}.bind(null,t)}),t.wu.push(async e=>{e?(t.Iu.Mo(),await lE(t)):(await t.Iu.stop(),0<t.fu.length&&(p("RemoteStore",`Stopping write stream with ${t.fu.length} pending writes`),t.fu=[]))})),t.Iu}class gE{constructor(e,t,n,r,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new Nv,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(e=>{})}static createAndSchedule(e,t,n,r,i){const s=Date.now()+n,a=new gE(e,t,s,r,i);return a.start(n),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new D(x.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function mE(e,t){if(Sv("AsyncQueue",t+": "+e),oy(e))return new D(x.UNAVAILABLE,t+": "+e);throw e}class vE{constructor(n){this.comparator=n?(e,t)=>n(e,t)||L.comparator(e.key,t.key):(e,t)=>L.comparator(e.key,t.key),this.keyedMap=yw(),this.sortedSet=new yy(this.comparator)}static emptySet(e){return new vE(e.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){e=this.keyedMap.get(e);return e?this.sortedSet.indexOf(e):-1}get size(){return this.sortedSet.size}forEach(n){this.sortedSet.inorderTraversal((e,t)=>(n(e),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){var t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof vE))return!1;if(this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){const e=t.getNext().key,r=n.getNext().key;if(!e.isEqual(r))return!1}return!0}toString(){const t=[];return this.forEach(e=>{t.push(e.toString())}),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"}copy(e,t){const n=new vE;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}class yE{constructor(){this.Tu=new yy(L.comparator)}track(e){var t=e.doc.key,n=this.Tu.get(t);!n||0!==e.type&&3===n.type?this.Tu=this.Tu.insert(t,e):3===e.type&&1!==n.type?this.Tu=this.Tu.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.Tu=this.Tu.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.Tu=this.Tu.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.Tu=this.Tu.remove(t):1===e.type&&2===n.type?this.Tu=this.Tu.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.Tu=this.Tu.insert(t,{type:2,doc:e.doc}):N()}Eu(){const n=[];return this.Tu.inorderTraversal((e,t)=>{n.push(t)}),n}}class _E{constructor(e,t,n,r,i,s,a,o,l){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=s,this.syncStateChanged=a,this.excludesMetadataChanges=o,this.hasCachedResults=l}static fromInitialDocuments(e,t,n,r,i){const s=[];return t.forEach(e=>{s.push({type:0,doc:e})}),new _E(e,t,vE.emptySet(t),s,n,r,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&D_(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let e=0;e<t.length;e++)if(t[e].type!==n[e].type||!t[e].doc.isEqual(n[e].doc))return!1;return!0}}class wE{constructor(){this.Au=void 0,this.listeners=[]}}class bE{constructor(){this.queries=new gw(e=>P_(e),D_),this.onlineState="Unknown",this.Ru=new Set}}async function IE(e,t){const n=e,r=t.query;let i=!1,s=n.queries.get(r);if(s||(i=!0,s=new wE),i)try{s.Au=await n.onListen(r)}catch(e){const n=mE(e,`Initialization of query '${O_(t.query)}' failed`);return void t.onError(n)}n.queries.set(r,s),s.listeners.push(t),t.bu(n.onlineState),s.Au&&t.Pu(s.Au)&&EE(n)}async function TE(e,t){const n=e,r=t.query;let i=!1;const s=n.queries.get(r);if(s){const e=s.listeners.indexOf(t);0<=e&&(s.listeners.splice(e,1),i=0===s.listeners.length)}if(i)return n.queries.delete(r),n.onUnlisten(r)}function EE(e){e.Ru.forEach(e=>{e.next()})}class kE{constructor(e,t,n){this.query=e,this.vu=t,this.Vu=!1,this.Su=null,this.onlineState="Unknown",this.options=n||{}}Pu(e){if(!this.options.includeMetadataChanges){const t=[];for(const n of e.docChanges)3!==n.type&&t.push(n);e=new _E(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Vu?this.Du(e)&&(this.vu.next(e),t=!0):this.Cu(e,this.onlineState)&&(this.xu(e),t=!0),this.Su=e,t}onError(e){this.vu.error(e)}bu(e){this.onlineState=e;let t=!1;return this.Su&&!this.Vu&&this.Cu(this.Su,e)&&(this.xu(this.Su),t=!0),t}Cu(e,t){return!e.fromCache||(!this.options.Nu||!("Offline"!==t))&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}Du(e){if(0<e.docChanges.length)return!0;var t=this.Su&&this.Su.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges}xu(e){e=_E.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Vu=!0,this.vu.next(e)}}class SE{constructor(e,t){this.ku=e,this.byteLength=t}Ou(){return"metadata"in this.ku}}class CE{constructor(e){this.It=e}Ji(e){return jw(this.It,e)}Yi(e){return e.metadata.exists?$w(this.It,e.document,!1):q.newNoDocument(this.Ji(e.metadata.name),this.Xi(e.metadata.readTime))}Xi(e){return Uw(e)}}class AE{constructor(e,t,n){this.Mu=e,this.localStore=t,this.It=n,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=NE(e)}Fu(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.ku.namedQuery)this.queries.push(e.ku.namedQuery);else if(e.ku.documentMetadata){this.documents.push({metadata:e.ku.documentMetadata}),e.ku.documentMetadata.exists||++t;const n=M.fromString(e.ku.documentMetadata.name);this.collectionGroups.add(n.get(n.length-2))}else e.ku.document&&(this.documents[this.documents.length-1].document=e.ku.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}$u(e){const t=new Map,n=new CE(this.It);for(const i of e)if(i.metadata.queries){const e=n.Ji(i.metadata.name);for(const n of i.metadata.queries){var r=(t.get(n)||V()).add(e);t.set(n,r)}}return t}async complete(){const e=await async function(e,t,n,r){const i=e;let s=V(),a=mw;for(const e of n){const n=t.Ji(e.metadata.name),c=(e.document&&(s=s.add(n)),t.Yi(e));c.setReadTime(t.Xi(e.metadata.readTime)),a=a.insert(n,c)}const o=i.Gi.newChangeBuffer({trackRemovals:!0}),l=await _T(i,R_(E_(M.fromString("__bundle__/docs/"+r))));return i.persistence.runTransaction("Apply bundle documents","readwrite",t=>yT(t,o,a).next(e=>(o.apply(t),e)).next(e=>i.Cs.removeMatchingKeysForTargetId(t,l.targetId).next(()=>i.Cs.addMatchingKeys(t,s,l.targetId)).next(()=>i.localDocuments.getLocalViewOfDocuments(t,e.Wi,e.zi)).next(()=>e.Wi)))}(this.localStore,new CE(this.It),this.documents,this.Mu.id),t=this.$u(this.documents);for(const e of this.queries)await async function(e,n,r=V()){const i=await _T(e,R_(Kb(n.bundledQuery))),s=e;return s.persistence.runTransaction("Save named query","readwrite",e=>{var t=Uw(n.readTime);return 0<=i.snapshotVersion.compareTo(t)?s.Ns.saveNamedQuery(e,n):(t=i.withResumeToken(Ey.EMPTY_BYTE_STRING,t),s.Ui=s.Ui.insert(t.targetId,t),s.Cs.updateTargetData(e,t).next(()=>s.Cs.removeMatchingKeysForTargetId(e,i.targetId)).next(()=>s.Cs.addMatchingKeys(e,r,i.targetId)).next(()=>s.Ns.saveNamedQuery(e,n)))})}(this.localStore,e,t.get(e.name));return this.progress.taskState="Success",{progress:this.progress,Bu:this.collectionGroups,Lu:e}}}function NE(e){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:e.totalDocuments,totalBytes:e.totalBytes}}class RE{constructor(e){this.key=e}}class xE{constructor(e){this.key=e}}class DE{constructor(e,t){this.query=e,this.Uu=t,this.qu=null,this.hasCachedResults=!1,this.current=!1,this.Ku=V(),this.mutatedKeys=V(),this.Gu=F_(e),this.Qu=new vE(this.Gu)}get ju(){return this.Uu}Wu(e,t){const o=t?t.zu:new yE,l=(t||this).Qu;let c=(t||this).mutatedKeys,u=l,h=!1;const d="F"===this.query.limitType&&l.size===this.query.limit?l.last():null,p="L"===this.query.limitType&&l.size===this.query.limit?l.first():null;if(e.inorderTraversal((e,t)=>{const n=l.get(e),r=M_(this.query,t)?t:null,i=!!n&&this.mutatedKeys.has(n.key),s=!!r&&(r.hasLocalMutations||this.mutatedKeys.has(r.key)&&r.hasCommittedMutations);let a=!1;n&&r?n.data.isEqual(r.data)?i!==s&&(o.track({type:3,doc:r}),a=!0):this.Hu(n,r)||(o.track({type:2,doc:r}),a=!0,(d&&0<this.Gu(r,d)||p&&this.Gu(r,p)<0)&&(h=!0)):!n&&r?(o.track({type:0,doc:r}),a=!0):n&&!r&&(o.track({type:1,doc:n}),a=!0,(d||p)&&(h=!0)),a&&(c=r?(u=u.add(r),s?c.add(e):c.delete(e)):(u=u.delete(e),c.delete(e)))}),null!==this.query.limit)for(;u.size>this.query.limit;){const e="F"===this.query.limitType?u.last():u.first();u=u.delete(e.key),c=c.delete(e.key),o.track({type:1,doc:e})}return{Qu:u,zu:o,$i:h,mutatedKeys:c}}Hu(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n){var r=this.Qu;this.Qu=e.Qu,this.mutatedKeys=e.mutatedKeys;const i=e.zu.Eu();i.sort((e,t)=>function(e,t){var n=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return N()}};return n(e)-n(t)}(e.type,t.type)||this.Gu(e.doc,t.doc)),this.Ju(n);var t=t?this.Yu():[],s=0===this.Ku.size&&this.current?1:0,a=s!==this.qu;return this.qu=s,0!==i.length||a?{snapshot:new _E(this.query,e.Qu,r,i,e.mutatedKeys,0==s,a,!1,!!n&&0<n.resumeToken.approximateByteSize()),Xu:t}:{Xu:t}}bu(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({Qu:this.Qu,zu:new yE,mutatedKeys:this.mutatedKeys,$i:!1},!1)):{Xu:[]}}Zu(e){return!this.Uu.has(e)&&!!this.Qu.has(e)&&!this.Qu.get(e).hasLocalMutations}Ju(e){e&&(e.addedDocuments.forEach(e=>this.Uu=this.Uu.add(e)),e.modifiedDocuments.forEach(e=>{}),e.removedDocuments.forEach(e=>this.Uu=this.Uu.delete(e)),this.current=e.current)}Yu(){if(!this.current)return[];const t=this.Ku,n=(this.Ku=V(),this.Qu.forEach(e=>{this.Zu(e.key)&&(this.Ku=this.Ku.add(e.key))}),[]);return t.forEach(e=>{this.Ku.has(e)||n.push(new xE(e))}),this.Ku.forEach(e=>{t.has(e)||n.push(new RE(e))}),n}tc(e){this.Uu=e.Hi,this.Ku=V();e=this.Wu(e.documents);return this.applyChanges(e,!0)}ec(){return _E.fromInitialDocuments(this.query,this.Qu,this.mutatedKeys,0===this.qu,this.hasCachedResults)}}class PE{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class OE{constructor(e){this.key=e,this.nc=!1}}class ME{constructor(e,t,n,r,i,s){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=s,this.sc={},this.ic=new gw(e=>P_(e),D_),this.rc=new Map,this.oc=new Set,this.uc=new yy(L.comparator),this.cc=new Map,this.ac=new YI,this.hc={},this.lc=new Map,this.fc=SI.vn(),this.onlineState="Unknown",this.dc=void 0}get isPrimaryClient(){return!0===this.dc}}async function LE(n,e,t,r,i){n._c=(e,i,t)=>async function(e,t,n){let r=t.view.Wu(i);r.$i&&(r=await bT(e.localStore,t.query,!1).then(({documents:e})=>t.view.Wu(e,r)));n=n&&n.targetChanges.get(t.targetId),n=t.view.applyChanges(r,e.isPrimaryClient,n);return KE(e,t.targetId,n.Xu),n.snapshot}(n,e,t);const s=await bT(n.localStore,e,!0),a=new DE(e,s.Hi),o=a.Wu(s.documents),l=kw.createSynthesizedTargetChangeForCurrentChange(t,r&&"Offline"!==n.onlineState,i),c=a.applyChanges(o,n.isPrimaryClient,l);KE(n,t,c.Xu);r=new PE(e,t,a);return n.ic.set(e,r),n.rc.has(t)?n.rc.get(t).push(e):n.rc.set(t,[e]),c.snapshot}async function FE(e,t){const r=e;try{const e=await function(e,c){const u=e,h=c.snapshotVersion;let d=u.Ui;return u.persistence.runTransaction("Apply remote event","readwrite-primary",o=>{const e=u.Gi.newChangeBuffer({trackRemovals:!0}),l=(d=u.Ui,[]);c.targetChanges.forEach((t,n)=>{const r=d.get(n);if(r){l.push(u.Cs.removeMatchingKeys(o,t.removedDocuments,n).next(()=>u.Cs.addMatchingKeys(o,t.addedDocuments,n)));let e=r.withSequenceNumber(o.currentSequenceNumber);var i,s,a;c.targetMismatches.has(n)?e=e.withResumeToken(Ey.EMPTY_BYTE_STRING,O.min()).withLastLimboFreeSnapshotVersion(O.min()):0<t.resumeToken.approximateByteSize()&&(e=e.withResumeToken(t.resumeToken,h)),d=d.insert(n,e),i=r,s=e,a=t,0!==i.resumeToken.approximateByteSize()&&!(3e8<=s.snapshotVersion.toMicroseconds()-i.snapshotVersion.toMicroseconds()||0<a.addedDocuments.size+a.modifiedDocuments.size+a.removedDocuments.size)||l.push(u.Cs.updateTargetData(o,e))}});let t=mw,n=V();if(c.documentUpdates.forEach(e=>{c.resolvedLimboDocuments.has(e)&&l.push(u.persistence.referenceDelegate.updateLimboDocument(o,e))}),l.push(yT(o,e,c.documentUpdates).next(e=>{t=e.Wi,n=e.zi})),!h.isEqual(O.min())){const c=u.Cs.getLastRemoteSnapshotVersion(o).next(e=>u.Cs.setTargetsMetadata(o,o.currentSequenceNumber,h));l.push(c)}return F.waitFor(l).next(()=>e.apply(o)).next(()=>u.localDocuments.getLocalViewOfDocuments(o,t,n)).next(()=>t)}).then(e=>(u.Ui=d,e))}(r.localStore,t);t.targetChanges.forEach((e,t)=>{const n=r.cc.get(t);n&&(R(e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size<=1),0<e.addedDocuments.size?n.nc=!0:0<e.modifiedDocuments.size?R(n.nc):0<e.removedDocuments.size&&(R(n.nc),n.nc=!1))}),await zE(r,e,t)}catch(e){await ny(e)}}function UE(n,r,e){const t=n;if(t.isPrimaryClient&&0===e||!t.isPrimaryClient&&1===e){const n=[];t.ic.forEach((e,t)=>{t=t.view.bu(r);t.snapshot&&n.push(t.snapshot)});{e=t.eventManager;var i=r;const s=e;s.onlineState=i;let n=!1;s.queries.forEach((e,t)=>{for(const e of t.listeners)e.bu(i)&&(n=!0)}),n&&EE(s)}n.length&&t.sc.Wo(n),t.onlineState=r,t.isPrimaryClient&&t.sharedClientState.setOnlineState(r)}}function qE(e,t){(e.lc.get(t)||[]).forEach(e=>{e.resolve()}),e.lc.delete(t)}function VE(e,t,n){const r=e;let i=r.hc[r.currentUser.toKey()];if(i){const e=i.get(t);e&&(n?e.reject(n):e.resolve(),i=i.remove(t)),r.hc[r.currentUser.toKey()]=i}}function BE(t,e,n=null){t.sharedClientState.removeLocalQueryTarget(e);for(const r of t.rc.get(e))t.ic.delete(r),n&&t.sc.wc(r,n);t.rc.delete(e),t.isPrimaryClient&&t.ac.ls(e).forEach(e=>{t.ac.containsKey(e)||jE(t,e)})}function jE(e,t){e.oc.delete(t.path.canonicalString());var n=e.uc.get(t);null!==n&&(ZT(e.remoteStore,n),e.uc=e.uc.remove(t),e.cc.delete(n),WE(e))}function KE(e,t,n){for(const i of n)if(i instanceof RE){e.ac.addReference(i.key,t);{var r=e;const s=i.key,a=s.path.canonicalString();r.uc.get(s)||r.oc.has(a)||(p("SyncEngine","New document in limbo: "+s),r.oc.add(a),WE(r))}}else i instanceof xE?(p("SyncEngine","Document no longer in limbo: "+i.key),e.ac.removeReference(i.key,t),e.ac.containsKey(i.key)||jE(e,i.key)):N()}function WE(e){for(;0<e.oc.size&&e.uc.size<e.maxConcurrentLimboResolutions;){var t=e.oc.values().next().value,n=(e.oc.delete(t),new L(M.fromString(t))),t=e.fc.next();e.cc.set(t,new OE(n)),e.uc=e.uc.insert(n,t),XT(e.remoteStore,new Ob(R_(E_(n.path)),t,2,fy.at))}}async function zE(e,n,r){const i=e,s=[],a=[],o=[];if(!i.ic.isEmpty()){i.ic.forEach((e,t)=>{o.push(i._c(t,n,r).then(e=>{(e||r)&&i.isPrimaryClient&&i.sharedClientState.updateQueryState(t.targetId,null!=e&&e.fromCache?"not-current":"current"),e&&(s.push(e),e=dT.Ci(t.targetId,e),a.push(e))}))}),await Promise.all(o),i.sc.Wo(s);{var t=i.localStore,l=a;const c=t;try{await c.persistence.runTransaction("notifyLocalViewChanges","readwrite",n=>F.forEach(l,t=>F.forEach(t.Si,e=>c.persistence.referenceDelegate.addReference(n,t.targetId,e)).next(()=>F.forEach(t.Di,e=>c.persistence.referenceDelegate.removeReference(n,t.targetId,e)))))}catch(t){if(!oy(t))throw t;p("LocalStore","Failed to update sequence numbers: "+t)}for(const t of l){const l=t.targetId;if(!t.fromCache){const t=c.Ui.get(l),u=t.snapshotVersion,h=t.withLastLimboFreeSnapshotVersion(u);c.Ui=c.Ui.insert(l,h)}}}}}async function GE(t,n){const r=t,i=[],s=[];for(const t of n){let e;var a=r.rc.get(t);if(a&&0!==a.length){e=await _T(r.localStore,R_(a[0]));for(const t of a){const n=r.ic.get(t),u=(o=n,0,c=await bT((l=r).localStore,o.query,!0),c=o.view.tc(c),l.isPrimaryClient&&KE(l,o.targetId,c.Xu),await c);u.snapshot&&s.push(u.snapshot)}}else{a=await IT(r.localStore,t);e=await _T(r.localStore,a),await LE(r,HE(a),t,!1,e.resumeToken)}i.push(e)}var o,l,c;return r.sc.Wo(s),i}function HE(e){return T_(e.path,e.collectionGroup,e.orderBy,e.filters,e.limit,"F",e.startAt,e.endAt)}function $E(e){const t=e;return t.remoteStore.remoteSyncer.applyRemoteEvent=FE.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=function(e,t){const n=e,r=n.cc.get(t);if(r&&r.nc)return V().add(r.key);{let e=V();const r=n.rc.get(t);if(!r)return e;for(const t of r){const r=n.ic.get(t);e=e.unionWith(r.view.ju)}return e}}.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=async function(e,t,n){const r=e,i=(r.sharedClientState.updateQueryState(t,"rejected",n),r.cc.get(t)),s=i&&i.key;if(s){let e=new yy(L.comparator);e=e.insert(s,q.newNoDocument(s,O.min()));const n=V().add(s),i=new Ew(O.min(),new Map,new U(P),e,n);await FE(r,i),r.uc=r.uc.remove(s),r.cc.delete(t),WE(r)}else await wT(r.localStore,t,!1).then(()=>BE(r,t,n)).catch(ny)}.bind(null,t),t.sc.Wo=function(e,t){const n=e;let r=!1;for(const e of t){const t=e.query,i=n.queries.get(t);if(i){for(const t of i.listeners)t.Pu(e)&&(r=!0);i.Au=e}}r&&EE(n)}.bind(null,t.eventManager),t.sc.wc=function(e,t,n){const r=e,i=r.queries.get(t);if(i)for(const e of i.listeners)e.onError(n);r.queries.delete(t)}.bind(null,t.eventManager),t}function QE(e){const t=e;return t.remoteStore.remoteSyncer.applySuccessfulWrite=async function(e,t){const n=e,r=t.batch.batchId;try{const e=await function(e,r){const i=e;return i.persistence.runTransaction("Acknowledge batch","readwrite-primary",e=>{const t=r.batch.keys(),n=i.Gi.newChangeBuffer({trackRemovals:!0});return function(e,t,r,i){const s=r.batch,n=s.keys();let a=F.resolve();return n.forEach(n=>{a=a.next(()=>i.getEntry(t,n)).next(e=>{var t=r.docVersions.get(n);R(null!==t),e.version.compareTo(t)<0&&(s.applyToRemoteDocument(e,r),e.isValidDocument()&&(e.setReadTime(r.commitVersion),i.addEntry(e)))})}),a.next(()=>e.mutationQueue.removeMutationBatch(t,s))}(i,e,r,n).next(()=>n.apply(e)).next(()=>i.mutationQueue.performConsistencyCheck(e)).next(()=>i.documentOverlayCache.removeOverlaysForBatchId(e,t,r.batch.batchId)).next(()=>i.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,function(t){let n=V();for(let e=0;e<t.mutationResults.length;++e)0<t.mutationResults[e].transformResults.length&&(n=n.add(t.batch.mutations[e].key));return n}(r))).next(()=>i.localDocuments.getDocuments(e,t))})}(n.localStore,t);VE(n,r,null),qE(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),await zE(n,e)}catch(e){await ny(e)}}.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=async function(e,t,n){const r=e;try{const e=await function(e,r){const i=e;return i.persistence.runTransaction("Reject batch","readwrite-primary",t=>{let n;return i.mutationQueue.lookupMutationBatch(t,r).next(e=>(R(null!==e),n=e.keys(),i.mutationQueue.removeMutationBatch(t,e))).next(()=>i.mutationQueue.performConsistencyCheck(t)).next(()=>i.documentOverlayCache.removeOverlaysForBatchId(t,n,r)).next(()=>i.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(t,n)).next(()=>i.localDocuments.getDocuments(t,n))})}(r.localStore,t);VE(r,t,n),qE(r,t),r.sharedClientState.updateMutationState(t,"rejected",n),await zE(r,e)}catch(n){await ny(n)}}.bind(null,t),t}class YE{constructor(){this.synchronizeTabs=!1}async initialize(e){this.It=jT(e.databaseInfo.databaseId),this.sharedClientState=this.gc(e),this.persistence=this.yc(e),await this.persistence.start(),this.localStore=this.Ic(e),this.gcScheduler=this.Tc(e,this.localStore),this.indexBackfillerScheduler=this.Ec(e,this.localStore)}Tc(e,t){return null}Ec(e,t){return null}Ic(e){return gT(this.persistence,new pT,e.initialUser,this.It)}yc(e){return new nT(iT.Bs,this.It)}gc(e){return new OT}async terminate(){this.gcScheduler&&this.gcScheduler.stop(),await this.sharedClientState.shutdown(),await this.persistence.shutdown()}}class JE extends YE{constructor(e,t,n){super(),this.Ac=e,this.cacheSizeBytes=t,this.forceOwnership=n,this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.Ac.initialize(this,e),await QE(this.Ac.syncEngine),await lE(this.Ac.remoteStore),await this.persistence.li(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))}Ic(e){return gT(this.persistence,new pT,e.initialUser,this.It)}Tc(e,t){var n=this.persistence.referenceDelegate.garbageCollector;return new PI(n,e.asyncQueue,t)}Ec(e,t){t=new py(t,this.persistence);return new dy(e.asyncQueue,t)}yc(e){var t=hT(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),n=void 0!==this.cacheSizeBytes?yI.withCacheSize(this.cacheSizeBytes):yI.DEFAULT;return new lT(this.synchronizeTabs,t,e.clientId,n,e.asyncQueue,VT(),BT(),this.It,this.sharedClientState,!!this.forceOwnership)}gc(e){return new OT}}class XE extends JE{constructor(e,t){super(e,t,!1),this.Ac=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}async initialize(e){await super.initialize(e);e=this.Ac.syncEngine;this.sharedClientState instanceof PT&&(this.sharedClientState.syncEngine={Fr:async function(e,t,n,r){var i=await function(e,n){const r=e,i=r.mutationQueue;return r.persistence.runTransaction("Lookup mutation documents","readonly",t=>i.Tn(t,n).next(e=>e?r.localDocuments.getDocuments(t,e):F.resolve(null)))}(e.localStore,t);null!==i?("pending"===n?await lE(e.remoteStore):"acknowledged"===n||"rejected"===n?(VE(e,t,r||null),qE(e,t),e.localStore.mutationQueue.An(t)):N(),await zE(e,i)):p("SyncEngine","Cannot apply mutation batch with id: "+t)}.bind(null,e),$r:async function(e,t,n,r){const i=e;if(i.dc)p("SyncEngine","Ignoring unexpected query state notification.");else{var s=i.rc.get(t);if(s&&0<s.length)switch(n){case"current":case"not-current":{const e=await TT(i.localStore,L_(s[0])),r=Ew.createSynthesizedRemoteEventForCurrentChange(t,"current"===n,Ey.EMPTY_BYTE_STRING);await zE(i,e,r);break}case"rejected":await wT(i.localStore,t,!0),BE(i,t,r);break;default:N()}}}.bind(null,e),Br:async function(e,t,n){const r=$E(e);if(r.dc){for(const e of t)if(r.rc.has(e))p("SyncEngine","Adding an already active target "+e);else{const t=await IT(r.localStore,e),n=await _T(r.localStore,t);await LE(r,HE(t),n.targetId,!1,n.resumeToken),XT(r.remoteStore,n)}for(const e of n)r.rc.has(e)&&await wT(r.localStore,e,!1).then(()=>{ZT(r.remoteStore,e),BE(r,e)}).catch(ny)}}.bind(null,e),vi:function(e){return e.localStore.persistence.vi()}.bind(null,e),Mr:async function(e,t){const n=e;return TT(n.localStore,t).then(e=>zE(n,e))}.bind(null,e)},await this.sharedClientState.start()),await this.persistence.li(async e=>{{var r=this.Ac.syncEngine,t=e;const i=r;if($E(i),QE(i),!0===t&&!0!==i.dc){const r=i.sharedClientState.getAllActiveQueryTargets(),t=await GE(i,r.toArray());i.dc=!0,await dE(i.remoteStore,!0);for(const r of t)XT(i.remoteStore,r)}else if(!1===t&&!1!==i.dc){const r=[];let n=Promise.resolve();i.rc.forEach((e,t)=>{i.sharedClientState.isLocalQueryTarget(t)?r.push(t):n=n.then(()=>(BE(i,t),wT(i.localStore,t,!0))),ZT(i.remoteStore,t)}),await n,await GE(i,r);{const s=i;s.cc.forEach((e,t)=>{ZT(s.remoteStore,t)}),s.ac.fs(),s.cc=new Map,s.uc=new yy(L.comparator)}i.dc=!1,await dE(i.remoteStore,!1)}}await 0,this.gcScheduler&&(e&&!this.gcScheduler.started?this.gcScheduler.start():e||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(e&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():e||this.indexBackfillerScheduler.stop())})}gc(e){var t=VT();if(!PT.C(t))throw new D(x.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");var n=hT(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new PT(t,e.asyncQueue,n,e.clientId,e.initialUser)}}class ZE{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>UE(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=async function(e,t){const n=e;var r;n.currentUser.isEqual(t)||(p("SyncEngine","User change. New user:",t.toKey()),r=await mT(n.localStore,t),n.currentUser=t,(e=n).lc.forEach(e=>{e.forEach(e=>{e.reject(new D(x.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),e.lc.clear(),n.sharedClientState.handleUserChange(t,r.removedBatchIds,r.addedBatchIds),await zE(n,r.ji))}.bind(null,this.syncEngine),await dE(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return new bE}createDatastore(e){var t=jT(e.databaseInfo.databaseId),n=(n=e.databaseInfo,new qT(n)),r=e.authCredentials,i=e.appCheckCredentials;return e=t,new HT(r,i,n,e)}createRemoteStore(e){return t=this.localStore,n=this.datastore,e=e.asyncQueue,r=e=>UE(this.syncEngine,e,0),i=new(LT.C()?LT:MT),new QT(t,n,e,r,i);var t,n,r,i}createSyncEngine(e,t){{var n=this.localStore,r=this.remoteStore,i=this.eventManager,s=this.sharedClientState,a=e.initialUser;e=e.maxConcurrentLimboResolutions;const o=new ME(n,r,i,s,a,e);return t&&(o.dc=!0),o}}terminate(){return async function(e){const t=e;p("RemoteStore","RemoteStore shutting down."),t._u.add(5),await JT(t),t.mu.shutdown(),t.gu.set("Unknown")}(this.remoteStore)}}function e0(e,t,n){if(!n)throw new D(x.INVALID_ARGUMENT,`Function ${e}() cannot be called with an empty ${t}.`)}function t0(e,t,n,r){if(!0===t&&!0===r)throw new D(x.INVALID_ARGUMENT,e+` and ${n} cannot be used together.`)}function n0(e){if(!L.isDocumentKey(e))throw new D(x.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${e} has ${e.length}.`)}function r0(e){if(L.isDocumentKey(e))throw new D(x.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${e} has ${e.length}.`)}function i0(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return 20<e.length&&(e=e.substring(0,20)+"..."),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"!=typeof e)return"function"==typeof e?"a function":N();if(e instanceof Array)return"an array";e=e.constructor?e.constructor.name:null;return e?`a custom ${e} object`:"an object"}function B(e,t){if((e="_delegate"in e?e._delegate:e)instanceof t)return e;if(t.name===e.constructor.name)throw new D(x.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");e=i0(e);throw new D(x.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: `+e)}function s0(e,t){if(t<=0)throw new D(x.INVALID_ARGUMENT,`Function ${e}() requires a positive number, but it was: ${t}.`)}const a0=new Map;class o0{constructor(e){var t;if(void 0===e.host){if(void 0!==e.ssl)throw new D(x.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=null==(t=e.ssl)||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,void 0===e.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new D(x.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.useFetchStreams=!!e.useFetchStreams,t0("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling)}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class l0{constructor(e,t,n,r){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new o0({}),this._settingsFrozen=!1}get app(){if(this._app)return this._app;throw new D(x.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available")}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new D(x.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new o0(e),void 0!==e.credentials&&(this._authCredentials=function(e){if(!e)return new xv;switch(e.type){case"gapi":var t=e.client;return new Mv(t,e.sessionIndex||"0",e.iamToken||null,e.authTokenFactory||null);case"provider":return e.client;default:throw new D(x.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){{var e=this;const t=a0.get(e);t&&(p("ComponentProvider","Removing Datastore"),a0.delete(e),t.terminate())}return Promise.resolve()}}class j{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new u0(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new j(this.firestore,e,this._key)}}class c0{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new c0(this.firestore,e,this._query)}}class u0 extends c0{constructor(e,t,n){super(e,t,E_(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new j(this.firestore,null,new L(e))}withConverter(e){return new u0(this.firestore,e,this._path)}}function h0(e,t,...n){var r;if(e=_(e),e0("collection","path",t),e instanceof l0)return r0(r=M.fromString(t,...n)),new u0(e,null,r);if(e instanceof j||e instanceof u0)return r0(r=e._path.child(M.fromString(t,...n))),new u0(e.firestore,null,r);throw new D(x.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore")}function d0(e,t,...n){var r;if(e=_(e),e0("doc","path",t=1===arguments.length?Uv.R():t),e instanceof l0)return n0(r=M.fromString(t,...n)),new j(e,null,new L(r));if(e instanceof j||e instanceof u0)return n0(r=e._path.child(M.fromString(t,...n))),new j(e.firestore,e instanceof u0?e.converter:null,new L(r));throw new D(x.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore")}function p0(e,t){return e=_(e),t=_(t),(e instanceof j||e instanceof u0)&&(t instanceof j||t instanceof u0)&&e.firestore===t.firestore&&e.path===t.path&&e.converter===t.converter}function f0(e,t){return e=_(e),t=_(t),e instanceof c0&&t instanceof c0&&e.firestore===t.firestore&&D_(e._query,t._query)&&e.converter===t.converter}function g0(t,n=10240){let r=0;return{async read(){var e;return r<t.byteLength?(e={value:t.slice(r,r+n),done:!1},r+=n,e):{done:!0}},async cancel(){},releaseLock(){},closed:Promise.reject("unimplemented")}}class m0{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.Rc(this.observer.next,e)}error(e){this.observer.error?this.Rc(this.observer.error,e):Sv("Uncaught Error in snapshot listener:",e.toString())}bc(){this.muted=!0}Rc(e,t){this.muted||setTimeout(()=>{this.muted||e(t)},0)}}class v0{constructor(e,t){this.Pc=e,this.It=t,this.metadata=new Nv,this.buffer=new Uint8Array,this.vc=new TextDecoder("utf-8"),this.Vc().then(e=>{e&&e.Ou()?this.metadata.resolve(e.ku.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is
             `+JSON.stringify(null==e?void 0:e.ku)))},e=>this.metadata.reject(e))}close(){return this.Pc.cancel()}async getMetadata(){return this.metadata.promise}async mc(){return await this.getMetadata(),this.Vc()}async Vc(){var e=await this.Sc();if(null===e)return null;var t=this.vc.decode(e),n=Number(t);return isNaN(n)&&this.Dc(`length string (${t}) is not valid number`),t=await this.Cc(n),new SE(JSON.parse(t),e.length+n)}xc(){return this.buffer.findIndex(e=>e==="{".charCodeAt(0))}async Sc(){for(;this.xc()<0&&!await this.Nc(););if(0===this.buffer.length)return null;var e=this.xc(),t=(e<0&&this.Dc("Reached the end of bundle when a length string is expected."),this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t}async Cc(e){for(;this.buffer.length<e;)await this.Nc()&&this.Dc("Reached the end of bundle when more is expected.");var t=this.vc.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t}Dc(e){throw this.Pc.cancel(),new Error("Invalid bundle format: "+e)}async Nc(){var e=await this.Pc.read();if(!e.done){const t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done}}class y0{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}async lookup(e){if(this.ensureCommitNotCalled(),0<this.mutations.length)throw new D(x.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");const t=await async function(e,t){const a=e,n=zw(a.It)+"/documents",r={documents:t.map(e=>Bw(a.It,e))},i=await a._o("BatchGetDocuments",n,r,t.length),o=new Map,s=(i.forEach(e=>{s=a.It;const t="found"in e?(n=s,R(!!(r=e).found),r.found.name,r.found.updateTime,n=jw(n,r.found.name),i=Uw(r.found.updateTime),r=new e_({mapValue:{fields:r.found.fields}}),q.newFoundDocument(n,i,r)):"missing"in e?function(e,t){R(!!t.missing),R(!!t.readTime);e=jw(e,t.missing),t=Uw(t.readTime);return q.newNoDocument(e,t)}(s,e):N();var n,r,i,s;o.set(t.key.toString(),t)}),[]);return t.forEach(e=>{e=o.get(e.toString());R(!!e),s.push(e)}),s}(this.datastore,e);return t.forEach(e=>this.recordVersion(e)),t}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(e){this.lastWriteError=e}this.writtenDocs.add(e.toString())}delete(e){this.write(new uw(e,this.precondition(e))),this.writtenDocs.add(e.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastWriteError)throw this.lastWriteError;const t=this.readVersions;this.mutations.forEach(e=>{t.delete(e.key.toString())}),t.forEach((e,t)=>{t=L.fromPath(t);this.mutations.push(new hw(t,this.precondition(t)))});{var e=this.datastore,n=this.mutations;const r=e,i=zw(r.It)+"/documents",s={writes:n.map(e=>Qw(r.It,e))};await r.ao("Commit",i,s)}await 0,this.committed=!0}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw N();t=O.min()}var n=this.readVersions.get(e.key.toString());if(n){if(!t.isEqual(n))throw new D(x.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){const t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(O.min())?Z_.exists(!1):Z_.updateTime(t):Z_.none()}preconditionForUpdate(e){const t=this.readVersions.get(e.toString());if(this.writtenDocs.has(e.toString())||!t)return Z_.exists(!0);if(t.isEqual(O.min()))throw new D(x.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Z_.updateTime(t)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}class _0{constructor(e,t,n,r,i){this.asyncQueue=e,this.datastore=t,this.options=n,this.updateFunction=r,this.deferred=i,this.kc=n.maxAttempts,this.xo=new KT(this.asyncQueue,"transaction_retry")}run(){--this.kc,this.Oc()}Oc(){this.xo.Ro(async()=>{const t=new y0(this.datastore),e=this.Mc(t);e&&e.then(e=>{this.asyncQueue.enqueueAndForget(()=>t.commit().then(()=>{this.deferred.resolve(e)}).catch(e=>{this.Fc(e)}))}).catch(e=>{this.Fc(e)})})}Mc(e){try{var t=this.updateFunction(e);return!Py(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(e){return this.deferred.reject(e),null}}Fc(e){0<this.kc&&this.$c(e)?(--this.kc,this.asyncQueue.enqueueAndForget(()=>(this.Oc(),Promise.resolve()))):this.deferred.reject(e)}$c(e){if("FirebaseError"!==e.name)return!1;e=e.code;return"aborted"===e||"failed-precondition"===e||"already-exists"===e||!pw(e)}}class w0{constructor(e,t,n,r){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=r,this.user=Iv.UNAUTHENTICATED,this.clientId=Uv.R(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(n,async e=>{p("FirestoreClient","Received user=",e.uid),await this.authCredentialListener(e),this.user=e}),this.appCheckCredentials.start(n,e=>(p("FirestoreClient","Received new app check token=",e),this.appCheckCredentialListener(e,this.user)))}async getConfiguration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new D(x.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();const n=new Nv;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this.onlineComponents&&await this.onlineComponents.terminate(),this.offlineComponents&&await this.offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),n.resolve()}catch(e){var t=mE(e,"Failed to shutdown persistence");n.reject(t)}}),n.promise}}async function b0(e,t){e.asyncQueue.verifyOperationInProgress(),p("FirestoreClient","Initializing OfflineComponentProvider");var n=await e.getConfiguration();await t.initialize(n);let r=n.initialUser;e.setCredentialChangeListener(async e=>{r.isEqual(e)||(await mT(t.localStore,e),r=e)}),t.persistence.setDatabaseDeletedListener(()=>e.terminate()),e.offlineComponents=t}async function I0(e,n){e.asyncQueue.verifyOperationInProgress();var t=await T0(e),r=(p("FirestoreClient","Initializing OnlineComponentProvider"),await e.getConfiguration());await n.initialize(t,r),e.setCredentialChangeListener(e=>hE(n.remoteStore,e)),e.setAppCheckTokenChangeListener((e,t)=>hE(n.remoteStore,t)),e.onlineComponents=n}async function T0(e){return e.offlineComponents||(p("FirestoreClient","Using default OfflineComponentProvider"),await b0(e,new YE)),e.offlineComponents}async function E0(e){return e.onlineComponents||(p("FirestoreClient","Using default OnlineComponentProvider"),await I0(e,new ZE)),e.onlineComponents}function k0(e){return T0(e).then(e=>e.persistence)}function S0(e){return T0(e).then(e=>e.localStore)}function C0(e){return E0(e).then(e=>e.remoteStore)}function A0(e){return E0(e).then(e=>e.syncEngine)}async function N0(e){const t=await E0(e),n=t.eventManager;return n.onListen=async function(e,t){const n=$E(e);let r,i;const s=n.ic.get(t);if(s)r=s.targetId,n.sharedClientState.addLocalQueryTarget(r),i=s.view.ec();else{const e=await _T(n.localStore,R_(t)),s=(n.isPrimaryClient&&XT(n.remoteStore,e),n.sharedClientState.addLocalQueryTarget(e.targetId));r=e.targetId,i=await LE(n,t,r,"current"===s,e.resumeToken)}return i}.bind(null,t.syncEngine),n.onUnlisten=async function(e,t){const n=e,r=n.ic.get(t),i=n.rc.get(r.targetId);if(1<i.length)return n.rc.set(r.targetId,i.filter(e=>!D_(e,t))),void n.ic.delete(t);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(r.targetId),n.sharedClientState.isActiveQueryTarget(r.targetId)||await wT(n.localStore,r.targetId,!1).then(()=>{n.sharedClientState.clearQueryState(r.targetId),ZT(n.remoteStore,r.targetId),BE(n,r.targetId)}).catch(ny)):(BE(n,r.targetId),await wT(n.localStore,r.targetId,!0))}.bind(null,t.syncEngine),n}function R0(t,l,c={}){const u=new Nv;return t.asyncQueue.enqueueAndForget(async()=>{{var n=await N0(t),r=t.asyncQueue,i=l,s=c,a=u;const e=new m0({next:e=>{r.enqueueAndForget(()=>TE(n,o));var t=e.docs.has(i);!t&&e.fromCache?a.reject(new D(x.UNAVAILABLE,"Failed to get document because the client is offline.")):t&&e.fromCache&&s&&"server"===s.source?a.reject(new D(x.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):a.resolve(e)},error:e=>a.reject(e)}),o=new kE(E_(i.path),e,{includeMetadataChanges:!0,Nu:!0});return IE(n,o)}}),u.promise}function x0(o,l,c={}){const u=new Nv;return o.asyncQueue.enqueueAndForget(async()=>{{var t=await N0(o),n=o.asyncQueue,e=l,r=c,i=u;const s=new m0({next:e=>{n.enqueueAndForget(()=>TE(t,a)),e.fromCache&&"server"===r.source?i.reject(new D(x.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(e)},error:e=>i.reject(e)}),a=new kE(e,s,{includeMetadataChanges:!0,Nu:!0});return IE(t,a)}}),u.promise}function D0(r,e,t,i){e=jT(e),t=function(e){if(e instanceof Uint8Array)return g0(e,void 0);if(e instanceof ArrayBuffer)return g0(new Uint8Array(e),void 0);if(e instanceof ReadableStream)return e.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}("string"==typeof t?(new TextEncoder).encode(t):t);const s=new v0(t,e);r.asyncQueue.enqueueAndForget(async()=>{{var e=await A0(r),t=s;const n=e;return void async function(t,n,r){try{var i=await n.getMetadata();if(await function(e,t){const n=e,r=Uw(t.createTime);return n.persistence.runTransaction("hasNewerBundle","readonly",e=>n.Ns.getBundleMetadata(e,t.id)).then(e=>!!e&&0<=e.createTime.compareTo(r))}(t.localStore,i))return await n.close(),r._completeWith({taskState:"Success",documentsLoaded:i.totalDocuments,bytesLoaded:i.totalBytes,totalDocuments:i.totalDocuments,totalBytes:i.totalBytes}),Promise.resolve(new Set);r._updateProgress(NE(i));const a=new AE(i,t.localStore,n.It);let e=await n.mc();for(;e;){const t=await a.Fu(e);t&&r._updateProgress(t),e=await n.mc()}var s=await a.complete();return await zE(t,s.Lu,void 0),await function(e,t){const n=e;return n.persistence.runTransaction("Save bundle","readwrite",e=>n.Ns.saveBundleMetadata(e,t))}(t.localStore,i),r._completeWith(s.progress),Promise.resolve(s.Bu)}catch(t){return Cv("SyncEngine","Loading bundle failed with "+t),r._failWith(t),Promise.resolve(new Set)}}(n,t,i).then(e=>{n.sharedClientState.notifyBundleLoaded(e)})}})}class P0{constructor(){this.Bc=Promise.resolve(),this.Lc=[],this.Uc=!1,this.qc=[],this.Kc=null,this.Gc=!1,this.Qc=!1,this.jc=[],this.xo=new KT(this,"async_queue_retry"),this.Wc=()=>{var e=BT();e&&p("AsyncQueue","Visibility state changed to "+e.visibilityState),this.xo.Po()};const e=BT();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.Wc)}get isShuttingDown(){return this.Uc}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.zc(),this.Hc(e)}enterRestrictedMode(e){if(!this.Uc){this.Uc=!0,this.Qc=e||!1;const t=BT();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.Wc)}}enqueue(e){if(this.zc(),this.Uc)return new Promise(()=>{});const t=new Nv;return this.Hc(()=>this.Uc&&this.Qc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Lc.push(e),this.Jc()))}async Jc(){if(0!==this.Lc.length){try{await this.Lc[0](),this.Lc.shift(),this.xo.reset()}catch(e){if(!oy(e))throw e;p("AsyncQueue","Operation failed with retryable error: "+e)}0<this.Lc.length&&this.xo.Ro(()=>this.Jc())}}Hc(e){var t=this.Bc.then(()=>(this.Gc=!0,e().catch(e=>{throw this.Kc=e,this.Gc=!1,Sv("INTERNAL UNHANDLED ERROR: ",function(e){let t=e.message||"";return t=e.stack?e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack:t}(e)),e}).then(e=>(this.Gc=!1,e))));return this.Bc=t}enqueueAfterDelay(e,t,n){this.zc(),-1<this.jc.indexOf(e)&&(t=0);e=gE.createAndSchedule(this,e,t,n,e=>this.Yc(e));return this.qc.push(e),e}zc(){this.Kc&&N()}verifyOperationInProgress(){}async Xc(){for(var e;await(e=this.Bc),e!==this.Bc;);}Zc(e){for(const t of this.qc)if(t.timerId===e)return!0;return!1}ta(t){return this.Xc().then(()=>{this.qc.sort((e,t)=>e.targetTimeMs-t.targetTimeMs);for(const e of this.qc)if(e.skipDelay(),"all"!==t&&e.timerId===t)break;return this.Xc()})}ea(e){this.jc.push(e)}Yc(e){e=this.qc.indexOf(e);this.qc.splice(e,1)}}function O0(e){var t=e;if("object"==typeof t&&null!==t){var n=t;for(const t of["next","error","complete"])if(t in n&&"function"==typeof n[t])return 1}}class M0{constructor(){this._progressObserver={},this._taskCompletionResolver=new Nv,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,n){this._progressObserver={next:e,error:t,complete:n}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}class L0 extends l0{constructor(e,t,n,r){super(e,t,n,r),this.type="firestore",this._queue=new P0,this._persistenceKey=(null==r?void 0:r.name)||"[DEFAULT]"}_terminate(){return this._firestoreClient||U0(this),this._firestoreClient.terminate()}}function F0(e){return e._firestoreClient||U0(e),e._firestoreClient.verifyNotTerminated(),e._firestoreClient}function U0(e){var t,n,r,i,s=e._freezeSettings(),s=(t=e._databaseId,n=(null==(n=e._app)?void 0:n.options.appId)||"",r=e._persistenceKey,i=s,new xy(t,n,r,i.host,i.ssl,i.experimentalForceLongPolling,i.experimentalAutoDetectLongPolling,i.useFetchStreams));e._firestoreClient=new w0(e._authCredentials,e._appCheckCredentials,e._queue,s)}function q0(e,n,r){const i=new Nv;return e.asyncQueue.enqueue(async()=>{try{await b0(e,r),await I0(e,n),i.resolve()}catch(e){const n=e;if(!("FirebaseError"===(t=n).name?t.code===x.FAILED_PRECONDITION||t.code===x.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code))throw n;Cv("Error enabling offline persistence. Falling back to persistence disabled: "+n),i.reject(n)}var t}).then(()=>i.promise)}function V0(e){return(r=F0(e=B(e,L0))).asyncQueue.enqueue(async()=>{const e=await k0(r),t=await C0(r);e.setNetworkEnabled(!0);{const n=t;return n._u.delete(0),YT(n)}});var r}function B0(t,e){return r=F0(t=B(t,L0)),i=e,r.asyncQueue.enqueue(async()=>{{var e=await S0(r),t=i;const n=e;return n.persistence.runTransaction("Get named query","readonly",e=>n.Ns.getNamedQuery(e,t))}}).then(e=>e?new c0(t,null,e.query):null);var r,i}function j0(e){if(e._initialized||e._terminated)throw new D(x.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}class K0{constructor(e){this._byteString=e}static fromBase64String(e){try{return new K0(Ey.fromBase64String(e))}catch(e){throw new D(x.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(e){return new K0(Ey.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class W0{constructor(...t){for(let e=0;e<t.length;++e)if(0===t[e].length)throw new D(x.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Wv(t)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class z0{constructor(e){this._methodName=e}}class G0{constructor(e,t){if(!isFinite(e)||e<-90||90<e)throw new D(x.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||180<t)throw new D(x.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return P(this._lat,e._lat)||P(this._long,e._long)}}const H0=/^__.*__$/;class $0{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return null!==this.fieldMask?new aw(e,this.data,this.fieldMask,t,this.fieldTransforms):new sw(e,this.data,t,this.fieldTransforms)}}class Q0{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return new aw(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function Y0(e){switch(e){case 0:case 2:case 1:return 1;case 3:case 4:return;default:throw N()}}class J0{constructor(e,t,n,r,i,s){this.settings=e,this.databaseId=t,this.It=n,this.ignoreUndefinedProperties=r,void 0===i&&this.na(),this.fieldTransforms=i||[],this.fieldMask=s||[]}get path(){return this.settings.path}get sa(){return this.settings.sa}ia(e){return new J0(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.It,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}ra(e){var t;const n=null==(t=this.path)?void 0:t.child(e),r=this.ia({path:n,oa:!1});return r.ua(e),r}ca(e){var t;const n=null==(t=this.path)?void 0:t.child(e),r=this.ia({path:n,oa:!1});return r.na(),r}aa(e){return this.ia({path:void 0,oa:!0})}ha(e){return vk(e,this.settings.methodName,this.settings.la||!1,this.path,this.settings.fa)}contains(t){return void 0!==this.fieldMask.find(e=>t.isPrefixOf(e))||void 0!==this.fieldTransforms.find(e=>t.isPrefixOf(e.field))}na(){if(this.path)for(let e=0;e<this.path.length;e++)this.ua(this.path.get(e))}ua(e){if(0===e.length)throw this.ha("Document fields must not be empty");if(Y0(this.sa)&&H0.test(e))throw this.ha('Document fields cannot begin and end with "__"')}}class X0{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.It=n||jT(e)}da(e,t,n,r=!1){return new J0({sa:e,methodName:t,fa:n,path:Wv.emptyPath(),oa:!1,la:r},this.databaseId,this.It,this.ignoreUndefinedProperties)}}function Z0(e){var t=e._freezeSettings(),n=jT(e._databaseId);return new X0(e._databaseId,!!t.ignoreUndefinedProperties,n)}function ek(e,t,n,r,i,s={}){const a=e.da(s.merge||s.mergeFields?2:0,t,n,i);pk("Data must be an object, but it was:",a,r);e=hk(r,a);let o,l;if(s.merge)o=new Ty(a.fieldMask),l=a.fieldTransforms;else if(s.mergeFields){const e=[];for(const r of s.mergeFields){const i=fk(t,r,n);if(!a.contains(i))throw new D(x.INVALID_ARGUMENT,`Field '${i}' is specified in your field mask but missing from your input data.`);yk(e,i)||e.push(i)}o=new Ty(e),l=a.fieldTransforms.filter(e=>o.covers(e.field))}else o=null,l=a.fieldTransforms;return new $0(new e_(e),o,l)}class tk extends z0{_toFieldTransform(e){if(2!==e.sa)throw 1===e.sa?e.ha(this._methodName+"() can only appear at the top level of your update data"):e.ha(this._methodName+"() cannot be used with set() unless you pass {merge:true}");return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof tk}}function nk(e,t,n){return new J0({sa:3,fa:t.settings.fa,methodName:e._methodName,oa:n},t.databaseId,t.It,t.ignoreUndefinedProperties)}class rk extends z0{_toFieldTransform(e){return new J_(e.path,new K_)}isEqual(e){return e instanceof rk}}class ik extends z0{constructor(e,t){super(e),this._a=t}_toFieldTransform(e){const t=nk(this,e,!0),n=this._a.map(e=>uk(e,t)),r=new W_(n);return new J_(e.path,r)}isEqual(e){return this===e}}class sk extends z0{constructor(e,t){super(e),this._a=t}_toFieldTransform(e){const t=nk(this,e,!0),n=this._a.map(e=>uk(e,t)),r=new G_(n);return new J_(e.path,r)}isEqual(e){return this===e}}class ak extends z0{constructor(e,t){super(e),this.wa=t}_toFieldTransform(e){var t=new $_(e.It,V_(e.It,this.wa));return new J_(e.path,t)}isEqual(e){return this===e}}function ok(e,i,s,t){const a=e.da(1,i,s),o=(pk("Data must be an object, but it was:",a,t),[]),l=e_.empty();my(t,(e,t)=>{var n=mk(i,e,s),r=(t=_(t),a.ca(n));if(t instanceof tk)o.push(n);else{const e=uk(t,r);null!=e&&(o.push(n),l.set(n,e))}});e=new Ty(o);return new Q0(l,e,a.fieldTransforms)}function lk(t,n,e,r,i,s){const a=t.da(1,n,e),o=[fk(n,r,e)],l=[i];if(s.length%2!=0)throw new D(x.INVALID_ARGUMENT,`Function ${n}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let e=0;e<s.length;e+=2)o.push(fk(n,s[e])),l.push(s[e+1]);const c=[],u=e_.empty();for(let e=o.length-1;0<=e;--e)if(!yk(c,o[e])){const n=o[e];var h=_(l[e]);const r=a.ca(n);if(h instanceof tk)c.push(n);else{const t=uk(h,r);null!=t&&(c.push(n),u.set(n,t))}}t=new Ty(c);return new Q0(u,t,a.fieldTransforms)}function ck(e,t,n,r=!1){return uk(n,e.da(r?4:3,t))}function uk(e,n){if(dk(e=_(e)))return pk("Unsupported field value:",n,e),hk(e,n);if(e instanceof z0){{var t=e;var r=n;if(!Y0(r.sa))throw r.ha(t._methodName+"() can only be used with update() and set()");if(!r.path)throw r.ha(t._methodName+"() is not currently supported inside arrays");t=t._toFieldTransform(r);t&&r.fieldTransforms.push(t)}return null}if(void 0===e&&n.ignoreUndefinedProperties)return null;if(n.path&&n.fieldMask.push(n.path),e instanceof Array){if(n.settings.oa&&4!==n.sa)throw n.ha("Nested arrays are not supported");{var i=n;const a=[];let t=0;for(const o of e){let e=uk(o,i.aa(t));null==e&&(e={nullValue:"NULL_VALUE"}),a.push(e),t++}return{arrayValue:{values:a}}}}var s,r=0,t=n;if(null===(r=_(e)))return{nullValue:"NULL_VALUE"};if("number"==typeof r)return V_(t.It,r);if("boolean"==typeof r)return{booleanValue:r};if("string"==typeof r)return{stringValue:r};if(r instanceof Date)return s=Bv.fromDate(r),{timestampValue:Lw(t.It,s)};if(r instanceof Bv)return s=new Bv(r.seconds,1e3*Math.floor(r.nanoseconds/1e3)),{timestampValue:Lw(t.It,s)};if(r instanceof G0)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof K0)return{bytesValue:Fw(t.It,r._byteString)};if(r instanceof j){const l=t.databaseId,c=r.firestore._databaseId;if(c.isEqual(l))return{referenceValue:qw(r.firestore._databaseId||t.databaseId,r._key.path)};throw t.ha(`Document reference is for database ${c.projectId}/${c.database} but should be for database ${l.projectId}/`+l.database)}throw t.ha("Unsupported field value: "+i0(r))}function hk(e,n){const r={};return vy(e)?n.path&&0<n.path.length&&n.fieldMask.push(n.path):my(e,(e,t)=>{t=uk(t,n.ra(e));null!=t&&(r[e]=t)}),{mapValue:{fields:r}}}function dk(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof Bv||e instanceof G0||e instanceof K0||e instanceof j||e instanceof z0)}function pk(e,t,n){var r;if(!dk(n)||"object"!=typeof(r=n)||null===r||Object.getPrototypeOf(r)!==Object.prototype&&null!==Object.getPrototypeOf(r))throw"an object"===(r=i0(n))?t.ha(e+" a custom object"):t.ha(e+" "+r)}function fk(e,t,n){if((t=_(t))instanceof W0)return t._internalPath;if("string"==typeof t)return mk(e,t);throw vk("Field path arguments must be of type string or ",e,!1,void 0,n)}const gk=new RegExp("[~\\*/\\[\\]]");function mk(t,n,r){if(0<=n.search(gk))throw vk(`Invalid field path (${n}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,r);try{return new W0(...n.split("."))._internalPath}catch(e){throw vk(`Invalid field path (${n}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,r)}}function vk(e,t,n,r,i){var s=r&&!r.isEmpty(),a=void 0!==i;let o=`Function ${t}() called with invalid data`,l=(n&&(o+=" (via `toFirestore()`)"),o+=". ","");return(s||a)&&(l+=" (found",s&&(l+=" in field "+r),a&&(l+=" in document "+i),l+=")"),new D(x.INVALID_ARGUMENT,o+e+l)}function yk(e,t){return e.some(e=>e.isEqual(t))}class _k{constructor(e,t,n,r,i){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=r,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new j(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){var e;if(this._document)return this._converter?(e=new wk(this._firestore,this._userDataWriter,this._key,this._document,null),this._converter.fromFirestore(e)):this._userDataWriter.convertValue(this._document.data.value)}get(e){if(this._document){e=this._document.data.field(bk("DocumentSnapshot.get",e));if(null!==e)return this._userDataWriter.convertValue(e)}}}class wk extends _k{data(){return super.data()}}function bk(e,t){return"string"==typeof t?mk(e,t):(t instanceof W0?t:t._delegate)._internalPath}function Ik(e){if("L"===e.limitType&&0===e.explicitOrderBy.length)throw new D(x.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Tk{}function Ek(e,...t){for(const n of t)e=n._apply(e);return e}class kk extends Tk{constructor(e,t,n){super(),this.ma=e,this.ga=t,this.ya=n,this.type="where"}_apply(e){var t=Z0(e.firestore),t=function(e,t,n,r,i,s,a){let o;if(i.isKeyField()){if("array-contains"===s||"array-contains-any"===s)throw new D(x.INVALID_ARGUMENT,`Invalid Query. You can't perform '${s}' queries on documentId().`);if("in"===s||"not-in"===s){Dk(a,s);const t=[];for(const n of a)t.push(xk(r,e,n));o={arrayValue:{values:t}}}else o=xk(r,e,a)}else"in"!==s&&"not-in"!==s&&"array-contains-any"!==s||Dk(a,s),o=ck(n,t,a,"in"===s||"not-in"===s);n=c_.create(i,s,o);{t=e;var l=n;if(l.dt()){const c=C_(t);if(null!==c&&!c.isEqual(l.field))throw new D(x.INVALID_ARGUMENT,`Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '${c.toString()}' and '${l.field.toString()}'`);a=S_(t);null!==a&&Pk(0,l.field,a)}const c=function(e,t){for(const n of e.filters)if(0<=t.indexOf(n.op))return n.op;return null}(t,function(){switch(l.op){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}());if(null!==c)throw c===l.op?new D(x.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${l.op.toString()}' filter.`):new D(x.INVALID_ARGUMENT,`Invalid query. You cannot use '${l.op.toString()}' filters with '${c.toString()}' filters.`)}return n}(e._query,"where",t,e.firestore._databaseId,this.ma,this.ga,this.ya);return new c0(e.firestore,e.converter,(t=(e=e._query).filters.concat([t]),new I_(e.path,e.collectionGroup,e.explicitOrderBy.slice(),t,e.limit,e.limitType,e.startAt,e.endAt)))}}class Sk extends Tk{constructor(e,t){super(),this.ma=e,this.pa=t,this.type="orderBy"}_apply(e){var t=function(e,t,n){if(null!==e.startAt)throw new D(x.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==e.endAt)throw new D(x.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");t=new __(t,n);return n=t,null===S_(e)&&null!==(e=C_(e))&&Pk(0,e,n.field),t}(e._query,this.ma,this.pa);return new c0(e.firestore,e.converter,(t=(e=e._query).explicitOrderBy.concat([t]),new I_(e.path,e.collectionGroup,t,e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)))}}class Ck extends Tk{constructor(e,t,n){super(),this.type=e,this.Ia=t,this.Ta=n}_apply(e){return new c0(e.firestore,e.converter,x_(e._query,this.Ia,this.Ta))}}class Ak extends Tk{constructor(e,t,n){super(),this.type=e,this.Ea=t,this.Aa=n}_apply(e){var t,n=Rk(e,this.type,this.Ea,this.Aa);return new c0(e.firestore,e.converter,(t=e._query,e=n,new I_(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,e,t.endAt)))}}class Nk extends Tk{constructor(e,t,n){super(),this.type=e,this.Ea=t,this.Aa=n}_apply(e){var t,n=Rk(e,this.type,this.Ea,this.Aa);return new c0(e.firestore,e.converter,(t=e._query,e=n,new I_(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,e)))}}function Rk(e,t,n,r){if(n[0]=_(n[0]),n[0]instanceof _k){var i=e._query,s=e.firestore._databaseId,a=t,o=n[0]._document,l=r;if(!o)throw new D(x.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${a}().`);const f=[];for(const a of N_(i))if(a.field.isKeyField())f.push(Wy(s,o.key));else{const i=o.data.field(a.field);if(Ny(i))throw new D(x.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+a.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===i){const i=a.field.canonicalString();throw new D(x.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${i}' (used as the orderBy) does not exist.`)}f.push(i)}return new y_(f,l)}a=Z0(e.firestore);{var c=e._query,u=e.firestore._databaseId,h=a,d=t,p=n,i=r;const g=c.explicitOrderBy;if(p.length>g.length)throw new D(x.INVALID_ARGUMENT,`Too many arguments provided to ${d}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const m=[];for(let e=0;e<p.length;e++){const v=p[e];if(g[e].field.isKeyField()){if("string"!=typeof v)throw new D(x.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${d}(), but got a `+typeof v);if(!A_(c)&&-1!==v.indexOf("/"))throw new D(x.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${d}() must be a plain document ID, but '${v}' contains a slash.`);const h=c.path.child(M.fromString(v));if(!L.isDocumentKey(h))throw new D(x.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${d}() must result in a valid document path, but '${h}' is not because it contains an odd number of segments.`);const p=new L(h);m.push(Wy(u,p))}else{const c=ck(h,d,v);m.push(c)}}return new y_(m,i)}}function xk(e,t,n){if("string"==typeof(n=_(n))){if(""===n)throw new D(x.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!A_(t)&&-1!==n.indexOf("/"))throw new D(x.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);t=t.path.child(M.fromString(n));if(L.isDocumentKey(t))return Wy(e,new L(t));throw new D(x.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${t}' is not because it has an odd number of segments (${t.length}).`)}if(n instanceof j)return Wy(e,n._key);throw new D(x.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${i0(n)}.`)}function Dk(e,t){if(!Array.isArray(e)||0===e.length)throw new D(x.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`);if(10<e.length)throw new D(x.INVALID_ARGUMENT,`Invalid Query. '${t.toString()}' filters support a maximum of 10 elements in the value array.`)}function Pk(e,t,n){if(!n.isEqual(t))throw new D(x.INVALID_ARGUMENT,`Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '${t.toString()}' and so you must also use '${t.toString()}' as your first argument to orderBy(), but your first orderBy() is on field '${n.toString()}' instead.`)}class Ok{convertValue(e,t="none"){switch(Uy(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Cy(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Ay(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw N()}}convertObject(e,n){const r={};return my(e.fields,(e,t)=>{r[e]=this.convertValue(t,n)}),r}convertGeoPoint(e){return new G0(Cy(e.latitude),Cy(e.longitude))}convertArray(e,t){return(e.values||[]).map(e=>this.convertValue(e,t))}convertServerTimestamp(e,t){switch(t){case"previous":var n=function e(t){t=t.mapValue.fields.__previous_value__;return Ny(t)?e(t):t}(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(Ry(e));default:return null}}convertTimestamp(e){e=Sy(e);return new Bv(e.seconds,e.nanos)}convertDocumentKey(e,t){const n=M.fromString(e),r=(R(nb(n)),new Dy(n.get(1),n.get(3))),i=new L(n.popFirst(5));return r.isEqual(t)||Sv(`Document ${i} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}function Mk(e,t,n){return e?n&&(n.merge||n.mergeFields)?e.toFirestore(t,n):e.toFirestore(t):t}class Lk extends Ok{constructor(e){super(),this.firestore=e}convertBytes(e){return new K0(e)}convertReference(e){e=this.convertDocumentKey(e,this.firestore._databaseId);return new j(this.firestore,null,e)}}class Fk{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class Uk extends _k{constructor(e,t,n,r,i,s){super(e,t,n,r,s),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){var t;if(this._document)return this._converter?(t=new qk(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null),this._converter.fromFirestore(t,e)):this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}get(e,t={}){if(this._document){e=this._document.data.field(bk("DocumentSnapshot.get",e));if(null!==e)return this._userDataWriter.convertValue(e,t.serverTimestamps)}}}class qk extends Uk{data(e={}){return super.data(e)}}class Vk{constructor(e,t,n,r){this._firestore=e,this._userDataWriter=t,this._snapshot=r,this.metadata=new Fk(r.hasPendingWrites,r.fromCache),this.query=n}get docs(){const t=[];return this.forEach(e=>t.push(e)),t}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(t,n){this._snapshot.docs.forEach(e=>{t.call(n,new qk(this._firestore,this._userDataWriter,e.key,e,new Fk(this._snapshot.mutatedKeys.has(e.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){e=!!e.includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new D(x.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(s,t){if(s._snapshot.oldDocs.isEmpty()){let n=0;return s._snapshot.docChanges.map(e=>{var t=new qk(s._firestore,s._userDataWriter,e.doc.key,e.doc,new Fk(s._snapshot.mutatedKeys.has(e.doc.key),s._snapshot.fromCache),s.query.converter);return e.doc,{type:"added",doc:t,oldIndex:-1,newIndex:n++}})}{let i=s._snapshot.oldDocs;return s._snapshot.docChanges.filter(e=>t||3!==e.type).map(e=>{var t=new qk(s._firestore,s._userDataWriter,e.doc.key,e.doc,new Fk(s._snapshot.mutatedKeys.has(e.doc.key),s._snapshot.fromCache),s.query.converter);let n=-1,r=-1;return 0!==e.type&&(n=i.indexOf(e.doc.key),i=i.delete(e.doc.key)),1!==e.type&&(i=i.add(e.doc),r=i.indexOf(e.doc.key)),{type:function(){switch(e.type){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return N()}}(),doc:t,oldIndex:n,newIndex:r}})}}(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges}}function Bk(e,t){return e instanceof Uk&&t instanceof Uk?e._firestore===t._firestore&&e._key.isEqual(t._key)&&(null===e._document?null===t._document:e._document.isEqual(t._document))&&e._converter===t._converter:e instanceof Vk&&t instanceof Vk&&e._firestore===t._firestore&&f0(e.query,t.query)&&e.metadata.isEqual(t.metadata)&&e._snapshot.isEqual(t._snapshot)}class jk extends Ok{constructor(e){super(),this.firestore=e}convertBytes(e){return new K0(e)}convertReference(e){e=this.convertDocumentKey(e,this.firestore._databaseId);return new j(this.firestore,null,e)}}function Kk(e,t,n){e=B(e,j);var r=B(e.firestore,L0),t=Mk(e.converter,t,n);return Hk(r,[ek(Z0(r),"setDoc",e._key,t,null!==e.converter,n).toMutation(e._key,Z_.none())])}function Wk(e,t,n,...r){e=B(e,j);var i=B(e.firestore,L0),s=Z0(i);let a;return Hk(i,[(a="string"==typeof(t=_(t))||t instanceof W0?lk(s,"updateDoc",e._key,t,n,r):ok(s,"updateDoc",e._key,t)).toMutation(e._key,Z_.exists(!0))])}function zk(t,...n){t=_(t);let e={includeMetadataChanges:!1},r=0;"object"!=typeof n[r]||O0(n[r])||(e=n[r],r++);var i={includeMetadataChanges:e.includeMetadataChanges};if(O0(n[r])){const t=n[r];n[r]=null==(c=t.next)?void 0:c.bind(t),n[r+1]=null==(c=t.error)?void 0:c.bind(t),n[r+2]=null==(c=t.complete)?void 0:c.bind(t)}let s,a,o;if(t instanceof j)a=B(t.firestore,L0),o=E_(t._key.path),s={next:e=>{n[r]&&n[r]($k(a,t,e))},error:n[r+1],complete:n[r+2]};else{const h=B(t,c0),d=(a=B(h.firestore,L0),o=h._query,new jk(a));s={next:e=>{n[r]&&n[r](new Vk(a,d,h,e))},error:n[r+1],complete:n[r+2]},Ik(t._query)}{var l=F0(a),c=o,u=s;const p=new m0(u),f=new kE(c,p,i);return l.asyncQueue.enqueueAndForget(async()=>IE(await N0(l),f)),()=>{p.bc(),l.asyncQueue.enqueueAndForget(async()=>TE(await N0(l),f))}}}function Gk(e,t){{var n=F0(e=B(e,L0));e=O0(t)?t:{next:t};const r=new m0(e);return n.asyncQueue.enqueueAndForget(async()=>{var e=await N0(n),t=r;e.Ru.add(t),t.next()}),()=>{r.bc(),n.asyncQueue.enqueueAndForget(async()=>{var e=await N0(n),t=r;e.Ru.delete(t)})}}}function Hk(e,t){{var n=F0(e),r=t;const i=new Nv;return n.asyncQueue.enqueueAndForget(async()=>async function(t,e,n){const r=QE(t);try{const t=await function(e,i){const s=e,a=Bv.now(),o=i.reduce((e,t)=>e.add(t.key),V());let l,c;return s.persistence.runTransaction("Locally write mutations","readwrite",n=>{let t=mw,r=V();return s.Gi.getEntries(n,o).next(e=>{(t=e).forEach((e,t)=>{t.isValidDocument()||(r=r.add(e))})}).next(()=>s.localDocuments.getOverlayedDocuments(n,t)).next(e=>{l=e;const t=[];for(const n of i){const i=function(e,t){let n=null;for(const r of e.fieldTransforms){const e=t.data.field(r.field),i=j_(r.transform,e||null);null!=i&&(n=null===n?e_.empty():n).set(r.field,i)}return n||null}(n,l.get(n.key).overlayedDocument);null!=i&&t.push(new aw(n.key,i,function r(e){const i=[];return my(e.fields,(e,t)=>{const n=new Wv([e]);if(Qy(t)){const e=r(t.mapValue).fields;if(0===e.length)i.push(n);else for(const t of e)i.push(n.child(t))}else i.push(n)}),new Ty(i)}(i.value.mapValue),Z_.exists(!0)))}return s.mutationQueue.addMutationBatch(n,a,t,i)}).next(e=>{var t=(c=e).applyToLocalDocumentSet(l,r);return s.documentOverlayCache.saveOverlays(n,e.batchId,t)})}).then(()=>({batchId:c.batchId,changes:_w(l)}))}(r.localStore,e);r.sharedClientState.addPendingMutation(t.batchId);{var i=r;var s=t.batchId;var a=n;let e=i.hc[i.currentUser.toKey()];e=(e=e||new yy(P)).insert(s,a),i.hc[i.currentUser.toKey()]=e}await zE(r,t.changes),await lE(r.remoteStore)}catch(t){const e=mE(t,"Failed to persist write");n.reject(e)}}(await A0(n),r,i)),i.promise}}function $k(e,t,n){var r=n.docs.get(t._key),i=new jk(e);return new Uk(e,i,t._key,r,new Fk(n.hasPendingWrites,n.fromCache),t.converter)}const Qk={maxAttempts:5};class Yk{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=Z0(e)}set(e,t,n){this._verifyNotCommitted();const r=Jk(e,this._firestore),i=Mk(r.converter,t,n),s=ek(this._dataReader,"WriteBatch.set",r._key,i,null!==r.converter,n);return this._mutations.push(s.toMutation(r._key,Z_.none())),this}update(e,t,n,...r){this._verifyNotCommitted();e=Jk(e,this._firestore);let i;return i="string"==typeof(t=_(t))||t instanceof W0?lk(this._dataReader,"WriteBatch.update",e._key,t,n,r):ok(this._dataReader,"WriteBatch.update",e._key,t),this._mutations.push(i.toMutation(e._key,Z_.exists(!0))),this}delete(e){this._verifyNotCommitted();e=Jk(e,this._firestore);return this._mutations=this._mutations.concat(new uw(e._key,Z_.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,0<this._mutations.length?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new D(x.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function Jk(e,t){if((e=_(e)).firestore!==t)throw new D(x.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}class Xk extends class{constructor(e,t){this._firestore=e,this._transaction=t,this._dataReader=Z0(e)}get(e){const n=Jk(e,this._firestore),r=new Lk(this._firestore);return this._transaction.lookup([n._key]).then(e=>{if(!e||1!==e.length)return N();const t=e[0];if(t.isFoundDocument())return new _k(this._firestore,r,t.key,t,n.converter);if(t.isNoDocument())return new _k(this._firestore,r,n._key,null,n.converter);throw N()})}set(e,t,n){e=Jk(e,this._firestore),t=Mk(e.converter,t,n),t=ek(this._dataReader,"Transaction.set",e._key,t,null!==e.converter,n);return this._transaction.set(e._key,t),this}update(e,t,n,...r){e=Jk(e,this._firestore),n="string"==typeof(t=_(t))||t instanceof W0?lk(this._dataReader,"Transaction.update",e._key,t,n,r):ok(this._dataReader,"Transaction.update",e._key,t);return this._transaction.update(e._key,n),this}delete(e){e=Jk(e,this._firestore);return this._transaction.delete(e._key),this}}{constructor(e,t){super(e,t),this._firestore=e}get(e){const t=Jk(e,this._firestore),n=new jk(this._firestore);return super.get(e).then(e=>new Uk(this._firestore,n,t._key,e._document,new Fk(!1,!1),t.converter))}}function Zk(e,t){if(void 0===t)return{merge:!1};if(void 0!==t.mergeFields&&void 0!==t.merge)throw new D("invalid-argument",`Invalid options passed to function ${e}(): You cannot `+'specify both "merge" and "mergeFields".');return t}function eS(){if("undefined"==typeof Uint8Array)throw new D("unimplemented","Uint8Arrays are not available in this environment.")}function tS(){if("undefined"==typeof atob)throw new D("unimplemented","Blobs are unavailable in Firestore in this environment.")}rN=_t,Tv=rN,gt(new o("firestore",(e,{instanceIdentifier:t,options:n})=>{const r=e.getProvider("app").getImmediate(),i=new L0(new Pv(e.getProvider("auth-internal")),new Fv(e.getProvider("app-check-internal")),function(e,t){if(Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))return new Dy(e.options.projectId,t);throw new D(x.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.')}(r,t),r);return n=Object.assign({useFetchStreams:!0},n),i._setSettings(n),i},"PUBLIC").setMultipleInstances(!0)),r(Gn,"3.7.3",void 0),r(Gn,"3.7.3","esm2017");class nS{constructor(e){this._delegate=e}static fromBase64String(e){return tS(),new nS(K0.fromBase64String(e))}static fromUint8Array(e){return eS(),new nS(K0.fromUint8Array(e))}toBase64(){return tS(),this._delegate.toBase64()}toUint8Array(){return eS(),this._delegate.toUint8Array()}isEqual(e){return this._delegate.isEqual(e._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}}function rS(e){if("object"==typeof e&&null!==e){var t=e;for(const n of["next","error","complete"])if(n in t&&"function"==typeof t[n])return 1}}class iS{enableIndexedDbPersistence(e,t){return e=e._delegate,t={forceOwnership:t},j0(e=B(e,L0)),n=F0(e),e=e._freezeSettings(),r=new ZE,q0(n,r,new JE(r,e.cacheSizeBytes,null==t?void 0:t.forceOwnership));var n,r}enableMultiTabIndexedDbPersistence(e){return j0(e=B(e=e._delegate,L0)),t=F0(e),e=e._freezeSettings(),n=new ZE,q0(t,n,new XE(n,e.cacheSizeBytes));var t,n}clearIndexedDbPersistence(e){{var t=e._delegate;if(t._initialized&&!t._terminated)throw new D(x.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const n=new Nv;return t._queue.enqueueAndForgetEvenWhileRestricted(async()=>{try{await async function(e){if(!iy.C())return Promise.resolve();e+="main";await iy.delete(e)}(hT(t._databaseId,t._persistenceKey)),n.resolve()}catch(e){n.reject(e)}}),n.promise}}}class sS{constructor(e,t,n){this._delegate=t,this._persistenceProvider=n,this.INTERNAL={delete:()=>this.terminate()},e instanceof Dy||(this._appCompat=e)}get _databaseId(){return this._delegate._databaseId}settings(e){var t=this._delegate._getSettings();e.merge||t.host===e.host||Cv("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),e.merge&&delete(e=Object.assign(Object.assign({},t),e)).merge,this._delegate._setSettings(e)}useEmulator(n,r,e={}){{var[n,r,e,i={}]=[this._delegate,n,r,e];const s=(n=B(n,l0))._getSettings();if("firestore.googleapis.com"!==s.host&&s.host!==r&&Cv("Host has been set in both settings() and useEmulator(), emulator host will be used"),n._setSettings(Object.assign(Object.assign({},s),{host:r+":"+e,ssl:!1})),i.mockUserToken){let e,t;if("string"==typeof i.mockUserToken)e=i.mockUserToken,t=Iv.MOCK_USER;else{e=ie(i.mockUserToken,null==(r=n._app)?void 0:r.options.projectId);const s=i.mockUserToken.sub||i.mockUserToken.user_id;if(!s)throw new D(x.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");t=new Iv(s)}n._authCredentials=new Dv(new Rv(e,t))}return}}enableNetwork(){return V0(this._delegate)}disableNetwork(){return e=this._delegate,(n=F0(e=B(e,L0))).asyncQueue.enqueue(async()=>{const e=await k0(n),t=await C0(n);return e.setNetworkEnabled(!1),async function(){const e=t;e._u.add(0),await JT(e),e.gu.set("Offline")}()});var e,n}enablePersistence(e){let t=!1,n=!1;return e&&(t=!!e.synchronizeTabs,n=!!e.experimentalForceOwningTab,t0("synchronizeTabs",t,"experimentalForceOwningTab",n)),t?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,n)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){var e=this._delegate;{var t=F0(e=B(e,L0));const n=new Nv;return t.asyncQueue.enqueueAndForget(async()=>async function(e,t){const n=e;iE(n.remoteStore)||p("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const e=await function(){const t=n.localStore;return t.persistence.runTransaction("Get highest unacknowledged batch id","readonly",e=>t.mutationQueue.getHighestUnacknowledgedBatchId(e))}();if(-1===e)return void t.resolve();const r=n.lc.get(e)||[];r.push(t),n.lc.set(e,r)}catch(e){const n=mE(e,"Initialization of waitForPendingWrites() operation failed");t.reject(n)}}(await A0(t),n)),n.promise}}onSnapshotsInSync(e){return Gk(this._delegate,e)}get app(){if(this._appCompat)return this._appCompat;throw new D("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available")}collection(e){try{return new _S(this,h0(this._delegate,e))}catch(e){throw hS(e,"collection()","Firestore.collection()")}}doc(e){try{return new uS(this,d0(this._delegate,e))}catch(e){throw hS(e,"doc()","Firestore.doc()")}}collectionGroup(e){try{return new mS(this,function(e,t){if(e=B(e,l0),e0("collectionGroup","collection id",t),0<=t.indexOf("/"))throw new D(x.INVALID_ARGUMENT,`Invalid collection ID '${t}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new c0(e,null,new I_(M.emptyPath(),t))}(this._delegate,e))}catch(e){throw hS(e,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(t){var n=this._delegate,r=e=>t(new oS(this,e)),e=void 0;if(n=B(n,L0),(e=Object.assign(Object.assign({},Qk),e)).maxAttempts<1)throw new D(x.INVALID_ARGUMENT,"Max attempts must be at least 1");{var i=F0(n),s=e=>r(new Xk(n,e)),a=e;const o=new Nv;return i.asyncQueue.enqueueAndForget(async()=>{var e=await E0(i).then(e=>e.datastore);new _0(i.asyncQueue,e,a,s,o).run()}),o.promise}}batch(){return F0(this._delegate),new lS(new Yk(this._delegate,e=>Hk(this._delegate,e)))}loadBundle(e){return n=F0(t=B(this._delegate,L0)),r=new M0,D0(n,t._databaseId,e,r),r;var t,n,r}namedQuery(e){return B0(this._delegate,e).then(e=>e?new mS(this,e):null)}}class aS extends Ok{constructor(e){super(),this.firestore=e}convertBytes(e){return new nS(new K0(e))}convertReference(e){e=this.convertDocumentKey(e,this.firestore._databaseId);return uS.forKey(e,this.firestore,null)}}class oS{constructor(e,t){this._firestore=e,this._delegate=t,this._userDataWriter=new aS(e)}get(e){const t=wS(e);return this._delegate.get(t).then(e=>new fS(this._firestore,new Uk(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,t.converter)))}set(e,t,n){e=wS(e);return n?(Zk("Transaction.set",n),this._delegate.set(e,t,n)):this._delegate.set(e,t),this}update(e,t,n,...r){e=wS(e);return 2===arguments.length?this._delegate.update(e,t):this._delegate.update(e,t,n,...r),this}delete(e){e=wS(e);return this._delegate.delete(e),this}}class lS{constructor(e){this._delegate=e}set(e,t,n){e=wS(e);return n?(Zk("WriteBatch.set",n),this._delegate.set(e,t,n)):this._delegate.set(e,t),this}update(e,t,n,...r){e=wS(e);return 2===arguments.length?this._delegate.update(e,t):this._delegate.update(e,t,n,...r),this}delete(e){e=wS(e);return this._delegate.delete(e),this}commit(){return this._delegate.commit()}}class cS{constructor(e,t,n){this._firestore=e,this._userDataWriter=t,this._delegate=n}fromFirestore(e,t){e=new qk(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,null);return this._delegate.fromFirestore(new gS(this._firestore,e),null!=t?t:{})}toFirestore(e,t){return t?this._delegate.toFirestore(e,t):this._delegate.toFirestore(e)}static getInstance(e,t){const n=cS.INSTANCES;let r=n.get(e),i=(r||(r=new WeakMap,n.set(e,r)),r.get(t));return i||(i=new cS(e,new aS(e),t),r.set(t,i)),i}}cS.INSTANCES=new WeakMap;class uS{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new aS(e)}static forPath(e,t,n){if(e.length%2!=0)throw new D("invalid-argument","Invalid document reference. Document references must have an even number of segments, but "+e.canonicalString()+" has "+e.length);return new uS(t,new j(t._delegate,n,new L(e)))}static forKey(e,t,n){return new uS(t,new j(t._delegate,n,e))}get id(){return this._delegate.id}get parent(){return new _S(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(e){try{return new _S(this.firestore,h0(this._delegate,e))}catch(e){throw hS(e,"collection()","DocumentReference.collection()")}}isEqual(e){return(e=_(e))instanceof j&&p0(this._delegate,e)}set(e,t){t=Zk("DocumentReference.set",t);try{return t?Kk(this._delegate,e,t):Kk(this._delegate,e)}catch(e){throw hS(e,"setDoc()","DocumentReference.set()")}}update(e,t,...n){try{return 1===arguments.length?Wk(this._delegate,e):Wk(this._delegate,e,t,...n)}catch(e){throw hS(e,"updateDoc()","DocumentReference.update()")}}delete(){return Hk(B((e=this._delegate).firestore,L0),[new uw(e._key,Z_.none())]);var e}onSnapshot(...e){var t=dS(e),e=pS(e,e=>new fS(this.firestore,new Uk(this.firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,this._delegate.converter)));return zk(this._delegate,t,e)}get(e){let t;return(t=("cache"===(null==e?void 0:e.source)?function(t){t=B(t,j);const n=B(t.firestore,L0),e=F0(n),r=new jk(n);return function(e,t){const n=new Nv;return e.asyncQueue.enqueueAndForget(async()=>async function(e,t,n){try{const r=await function(t){const n=e;return n.persistence.runTransaction("read document","readonly",e=>n.localDocuments.getDocument(e,t))}(t);r.isFoundDocument()?n.resolve(r):r.isNoDocument()?n.resolve(null):n.reject(new D(x.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(e){t=mE(e,`Failed to get document '${t} from cache`);n.reject(t)}}(await S0(e),t,n)),n.promise}(e,t._key).then(e=>new Uk(n,r,t._key,e,new Fk(null!==e&&e.hasLocalMutations,!0),t.converter))}:"server"===(null==e?void 0:e.source)?function(t){t=B(t,j);const n=B(t.firestore,L0);return R0(F0(n),t._key,{source:"server"}).then(e=>$k(n,t,e))}:function(t){t=B(t,j);const n=B(t.firestore,L0);return R0(F0(n),t._key).then(e=>$k(n,t,e))})(this._delegate)).then(e=>new fS(this.firestore,new Uk(this.firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,this._delegate.converter)))}withConverter(e){return new uS(this.firestore,e?this._delegate.withConverter(cS.getInstance(this.firestore,e)):this._delegate.withConverter(null))}}function hS(e,t,n){return e.message=e.message.replace(t,n),e}function dS(e){for(const t of e)if("object"==typeof t&&!rS(t))return t;return{}}function pS(e,t){let n;return{next:e=>{n.next&&n.next(t(e))},error:null==(e=(n=rS(e[0])?e[0]:rS(e[1])?e[1]:"function"==typeof e[0]?{next:e[0],error:e[1],complete:e[2]}:{next:e[1],error:e[2],complete:e[3]}).error)?void 0:e.bind(n),complete:null==(e=n.complete)?void 0:e.bind(n)}}class fS{constructor(e,t){this._firestore=e,this._delegate=t}get ref(){return new uS(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(e){return this._delegate.data(e)}get(e,t){return this._delegate.get(e,t)}isEqual(e){return Bk(this._delegate,e._delegate)}}class gS extends fS{data(e){e=this._delegate.data(e);return void 0===e&&N(),e}}class mS{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new aS(e)}where(e,t,n){try{return new mS(this.firestore,Ek(this._delegate,(r=n,i=t,s=bk("where",e),new kk(s,i,r))))}catch(e){throw hS(e,/(orderBy|where)\(\)/,"Query.$1()")}var r,i,s}orderBy(e,t){try{return new mS(this.firestore,Ek(this._delegate,([n,r="asc"]=[e,t],i=r,s=bk("orderBy",n),new Sk(s,i))))}catch(e){throw hS(e,/(orderBy|where)\(\)/,"Query.$1()")}var n,r,i,s}limit(e){try{return new mS(this.firestore,Ek(this._delegate,(s0("limit",t=e),new Ck("limit",t,"F"))))}catch(e){throw hS(e,"limit()","Query.limit()")}var t}limitToLast(e){try{return new mS(this.firestore,Ek(this._delegate,(s0("limitToLast",t=e),new Ck("limitToLast",t,"L"))))}catch(e){throw hS(e,"limitToLast()","Query.limitToLast()")}var t}startAt(...e){try{return new mS(this.firestore,Ek(this._delegate,([...t]=[...e],new Ak("startAt",t,!0))))}catch(e){throw hS(e,"startAt()","Query.startAt()")}var t}startAfter(...e){try{return new mS(this.firestore,Ek(this._delegate,([...t]=[...e],new Ak("startAfter",t,!1))))}catch(e){throw hS(e,"startAfter()","Query.startAfter()")}var t}endBefore(...e){try{return new mS(this.firestore,Ek(this._delegate,([...t]=[...e],new Nk("endBefore",t,!1))))}catch(e){throw hS(e,"endBefore()","Query.endBefore()")}var t}endAt(...e){try{return new mS(this.firestore,Ek(this._delegate,([...t]=[...e],new Nk("endAt",t,!0))))}catch(e){throw hS(e,"endAt()","Query.endAt()")}var t}isEqual(e){return f0(this._delegate,e._delegate)}get(e){let t;return(t=("cache"===(null==e?void 0:e.source)?function(t){t=B(t,c0);const n=B(t.firestore,L0),e=F0(n),r=new jk(n);return function(e,t){const n=new Nv;return e.asyncQueue.enqueueAndForget(async()=>async function(e,t,n){try{const r=await bT(e,t,!0),i=new DE(t,r.Hi),s=i.Wu(r.documents),a=i.applyChanges(s,!1);n.resolve(a.snapshot)}catch(e){t=mE(e,`Failed to execute query '${t} against cache`);n.reject(t)}}(await S0(e),t,n)),n.promise}(e,t._query).then(e=>new Vk(n,r,t,e))}:"server"===(null==e?void 0:e.source)?function(t){t=B(t,c0);const n=B(t.firestore,L0),e=F0(n),r=new jk(n);return x0(e,t._query,{source:"server"}).then(e=>new Vk(n,r,t,e))}:function(t){t=B(t,c0);const n=B(t.firestore,L0),e=F0(n),r=new jk(n);return Ik(t._query),x0(e,t._query).then(e=>new Vk(n,r,t,e))})(this._delegate)).then(e=>new yS(this.firestore,new Vk(this.firestore._delegate,this._userDataWriter,this._delegate,e._snapshot)))}onSnapshot(...e){var t=dS(e),e=pS(e,e=>new yS(this.firestore,new Vk(this.firestore._delegate,this._userDataWriter,this._delegate,e._snapshot)));return zk(this._delegate,t,e)}withConverter(e){return new mS(this.firestore,e?this._delegate.withConverter(cS.getInstance(this.firestore,e)):this._delegate.withConverter(null))}}class vS{constructor(e,t){this._firestore=e,this._delegate=t}get type(){return this._delegate.type}get doc(){return new gS(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}}class yS{constructor(e,t){this._firestore=e,this._delegate=t}get query(){return new mS(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map(e=>new gS(this._firestore,e))}docChanges(e){return this._delegate.docChanges(e).map(e=>new vS(this._firestore,e))}forEach(t,n){this._delegate.forEach(e=>{t.call(n,new gS(this._firestore,e))})}isEqual(e){return Bk(this._delegate,e._delegate)}}class _S extends mS{constructor(e,t){super(e,t),this.firestore=e,this._delegate=t}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){var e=this._delegate.parent;return e?new uS(this.firestore,e):null}doc(e){try{return void 0===e?new uS(this.firestore,d0(this._delegate)):new uS(this.firestore,d0(this._delegate,e))}catch(e){throw hS(e,"doc()","CollectionReference.doc()")}}add(e){return function(e,t){const n=B(e.firestore,L0),r=d0(e),i=Mk(e.converter,t);return Hk(n,[ek(Z0(e.firestore),"addDoc",r._key,i,null!==e.converter,{}).toMutation(r._key,Z_.exists(!1))]).then(()=>r)}(this._delegate,e).then(e=>new uS(this.firestore,e))}isEqual(e){return p0(this._delegate,e._delegate)}withConverter(e){return new _S(this.firestore,e?this._delegate.withConverter(cS.getInstance(this.firestore,e)):this._delegate.withConverter(null))}}function wS(e){return B(e,j)}var vo={Firestore:sS,GeoPoint:G0,Timestamp:Bv,Blob:nS,Transaction:oS,WriteBatch:lS,DocumentReference:uS,DocumentSnapshot:fS,Query:mS,QueryDocumentSnapshot:gS,QuerySnapshot:yS,CollectionReference:_S,FieldPath:class kR{constructor(...e){this._delegate=new W0(...e)}static documentId(){return new kR(Wv.keyField().canonicalString())}isEqual(e){return(e=_(e))instanceof W0&&this._delegate._internalPath.isEqual(e._internalPath)}},FieldValue:class SR{constructor(e){this._delegate=e}static serverTimestamp(){const e=new rk("serverTimestamp");return e._methodName="FieldValue.serverTimestamp",new SR(e)}static delete(){const e=new tk("deleteField");return e._methodName="FieldValue.delete",new SR(e)}static arrayUnion(...e){[...e]=[...e];const t=new ik("arrayUnion",e);return t._methodName="FieldValue.arrayUnion",new SR(t)}static arrayRemove(...e){[...e]=[...e];const t=new sk("arrayRemove",e);return t._methodName="FieldValue.arrayRemove",new SR(t)}static increment(e){const t=new ak("increment",e);return t._methodName="FieldValue.increment",new SR(t)}isEqual(e){return this._delegate.isEqual(e._delegate)}},setLogLevel:function(e){Ev.setLogLevel(e)},CACHE_SIZE_UNLIMITED:-1},Wp=qt,bS=(e,t)=>new sS(e,t,new iS);Wp.INTERNAL.registerComponent(new o("firestore-compat",e=>{var t=e.getProvider("app-compat").getImmediate(),e=e.getProvider("firestore").getImmediate();return bS(t,e)},"PUBLIC").setServiceProps(Object.assign({},vo))),Wp.registerVersion("@firebase/firestore-compat","0.2.3");const IS="type.googleapis.com/google.protobuf.Int64Value",TS="type.googleapis.com/google.protobuf.UInt64Value";function ES(e,t){const n={};for(const r in e)e.hasOwnProperty(r)&&(n[r]=t(e[r]));return n}function kS(e){if(null==e)return e;if(e["@type"])switch(e["@type"]){case IS:case TS:var t=Number(e.value);if(isNaN(t))throw new Error("Data cannot be decoded from JSON: "+e);return t;default:throw new Error("Data cannot be decoded from JSON: "+e)}return Array.isArray(e)?e.map(e=>kS(e)):"function"==typeof e||"object"==typeof e?ES(e,e=>kS(e)):e}const SS="functions",CS={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class AS extends se{constructor(e,t,n){super(SS+"/"+e,t||""),this.details=n}}class NS{constructor(e,t,n){this.auth=null,this.messaging=null,this.appCheck=null,this.auth=e.getImmediate({optional:!0}),this.messaging=t.getImmediate({optional:!0}),this.auth||e.get().then(e=>this.auth=e,()=>{}),this.messaging||t.get().then(e=>this.messaging=e,()=>{}),this.appCheck||n.get().then(e=>this.appCheck=e,()=>{})}async getAuthToken(){if(this.auth)try{var e=await this.auth.getToken();return null==e?void 0:e.accessToken}catch(e){return}}async getMessagingToken(){if(this.messaging&&"Notification"in self&&"granted"===Notification.permission)try{return this.messaging.getToken()}catch(e){return}}async getAppCheckToken(){var e;return!this.appCheck||(e=await this.appCheck.getToken()).error?null:e.token}async getContext(){return{authToken:await this.getAuthToken(),messagingToken:await this.getMessagingToken(),appCheckToken:await this.getAppCheckToken()}}}const RS="us-central1";class xS{constructor(e,t,n,r,i=RS,s){this.app=e,this.fetchImpl=s,this.emulatorOrigin=null,this.contextProvider=new NS(t,n,r),this.cancelAllRequests=new Promise(e=>{this.deleteService=()=>Promise.resolve(e())});try{var a=new URL(i);this.customDomain=a.origin,this.region=RS}catch(e){this.customDomain=null,this.region=i}}_delete(){return this.deleteService()}_url(e){var t=this.app.options.projectId;return null===this.emulatorOrigin?null!==this.customDomain?this.customDomain+"/"+e:`https://${this.region}-${t}.cloudfunctions.net/`+e:`${this.emulatorOrigin}/${t}/${this.region}/`+e}}async function DS(e,t,n,r){n={data:n=function t(e){if(null==e)return null;if("number"==typeof(e=e instanceof Number?e.valueOf():e)&&isFinite(e))return e;if(!0===e||!1===e)return e;if("[object String]"===Object.prototype.toString.call(e))return e;if(e instanceof Date)return e.toISOString();if(Array.isArray(e))return e.map(e=>t(e));if("function"==typeof e||"object"==typeof e)return ES(e,e=>t(e));throw new Error("Data cannot be encoded in JSON: "+e)}(n)};const i={};var s=await e.contextProvider.getContext();s.authToken&&(i.Authorization="Bearer "+s.authToken),s.messagingToken&&(i["Firebase-Instance-ID-Token"]=s.messagingToken),null!==s.appCheckToken&&(i["X-Firebase-AppCheck"]=s.appCheckToken);const a=function(n){let r=null;return{promise:new Promise((e,t)=>{r=setTimeout(()=>{t(new AS("deadline-exceeded","deadline-exceeded"))},n)}),cancel:()=>{r&&clearTimeout(r)}}}(r.timeout||7e4);if(s=await Promise.race([async function(e,t,n,r){n["Content-Type"]="application/json";let i;try{i=await r(e,{method:"POST",body:JSON.stringify(t),headers:n})}catch(e){return{status:0,json:null}}let s=null;try{s=await i.json()}catch(e){}return{status:i.status,json:s}}(t,n,i,e.fetchImpl),a.promise,e.cancelAllRequests]),a.cancel(),!s)throw new AS("cancelled","Firebase Functions instance was deleted.");if(n=function(e,t){let n=function(){if(200<=e&&e<300)return"ok";switch(e){case 0:return"internal";case 400:return"invalid-argument";case 401:return"unauthenticated";case 403:return"permission-denied";case 404:return"not-found";case 409:return"aborted";case 429:return"resource-exhausted";case 499:return"cancelled";case 500:return"internal";case 501:return"unimplemented";case 503:return"unavailable";case 504:return"deadline-exceeded"}return"unknown"}(),r=n,i=void 0;try{var s=t&&t.error;if(s){const e=s.status;if("string"==typeof e){if(!CS[e])return new AS("internal","internal");n=CS[e],r=e}var a=s.message;"string"==typeof a&&(r=a),void 0!==(i=s.details)&&(i=kS(i))}}catch(e){}return"ok"===n?null:new AS(n,r,i)}(s.status,s.json))throw n;if(!s.json)throw new AS("internal","Response is not valid JSON object.");let o=s.json.data;if(void 0===(o=void 0===o?s.json.result:o))throw new AS("internal","Response is missing data field.");return{data:kS(o)}}var PS,OS,MS,yf="@firebase/functions";function LS(e,t,n){_(e).emulatorOrigin=`http://${t}:`+n}fv=fetch.bind(self),gt(new o(SS,(e,{instanceIdentifier:t})=>{var n=e.getProvider("app").getImmediate(),r=e.getProvider("auth-internal"),i=e.getProvider("messaging-internal"),e=e.getProvider("app-check-internal");return new xS(n,r,i,e,t,fv)},"PUBLIC").setMultipleInstances(!0)),r(yf,"0.8.8",void 0),r(yf,"0.8.8","esm2017");class FS{constructor(e,t){this.app=e,this._delegate=t,this._region=this._delegate.region,this._customDomain=this._delegate.customDomain}httpsCallable(e,t){return i=_(this._delegate),s=e,a=t,e=>{return t=e,n=a||{},r=(e=i)._url(s),DS(e,r,t,n);var t,n,r};var i,s,a}httpsCallableFromURL(e,t){return n=this._delegate,r=_(n),i=e,s=t,e=>DS(r,i,e,s||{});var n,r,i,s}useFunctionsEmulator(e){e=e.match("[a-zA-Z]+://([a-zA-Z0-9.-]+)(?::([0-9]+))?");if(null==e)throw new se("functions","No origin provided to useFunctionsEmulator()");if(null==e[2])throw new se("functions","Port missing in origin provided to useFunctionsEmulator()");return LS(this._delegate,e[1],Number(e[2]))}useEmulator(e,t){return LS(this._delegate,e,t)}}vf={Functions:FS},qt.INTERNAL.registerComponent(new o("functions-compat",(e,{instanceIdentifier:t})=>{var n=e.getProvider("app-compat").getImmediate(),e=e.getProvider("functions").getImmediate({identifier:null!=t?t:"us-central1"});return new FS(n,e)},"PUBLIC").setServiceProps(vf).setMultipleInstances(!0)),qt.registerVersion("@firebase/functions-compat","0.2.8");const US="/firebase-messaging-sw.js",qS="/firebase-cloud-messaging-push-scope",VS="BDOU99-h67HcA6JeFXHbSNMu7e2yNNu3RzoMj8TM4W88jITfq7ZmPvIM1Iv-4_l2LxQcYwhqby2xGpWwzjfAnG4",BS="https://fcmregistrations.googleapis.com/v1",jS="google.c.a.c_id",KS="google.c.a.e";function WS(e){e=new Uint8Array(e);const t=btoa(String.fromCharCode(...e));return t.replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}(nl=yN=yN||{})[nl.DATA_MESSAGE=1]="DATA_MESSAGE",nl[nl.DISPLAY_NOTIFICATION=3]="DISPLAY_NOTIFICATION",(nl=PS=PS||{}).PUSH_RECEIVED="push-received",nl.NOTIFICATION_CLICKED="notification-clicked";const zS="fcm_token_details_db",GS="fcm_token_object_Store";const HS="firebase-messaging-database",$S=1,QS="firebase-messaging-store";let YS=null;function JS(){return YS=YS||et(HS,$S,{upgrade:(e,t)=>{0===t&&e.createObjectStore(QS)}})}async function XS(e){var t=eC(e);const n=await JS();return(t=await n.transaction(QS).objectStore(QS).get(t))?t:(t=await async function(a){if("databases"in indexedDB){const t=await indexedDB.databases(),n=t.map(e=>e.name);if(!n.includes(zS))return null}let o=null;const e=await et(zS,5,{upgrade:async(e,t,n,r)=>{if(!(t<2)&&e.objectStoreNames.contains(GS)){const s=r.objectStore(GS);var i,e=await s.index("fcmSenderId").get(a);await s.clear(),e&&(2===t?(i=e).auth&&i.p256dh&&i.endpoint&&(o={token:i.fcmToken,createTime:null!=(r=i.createTime)?r:Date.now(),subscriptionOptions:{auth:i.auth,p256dh:i.p256dh,endpoint:i.endpoint,swScope:i.swScope,vapidKey:"string"==typeof i.vapidKey?i.vapidKey:WS(i.vapidKey)}}):3===t?(i=e,o={token:i.fcmToken,createTime:i.createTime,subscriptionOptions:{auth:WS(i.auth),p256dh:WS(i.p256dh),endpoint:i.endpoint,swScope:i.swScope,vapidKey:WS(i.vapidKey)}}):4===t&&(o={token:e.fcmToken,createTime:e.createTime,subscriptionOptions:{auth:WS(e.auth),p256dh:WS(e.p256dh),endpoint:e.endpoint,swScope:e.swScope,vapidKey:WS(e.vapidKey)}}))}}});return e.close(),await tt(zS),await tt("fcm_vapid_details_db"),await tt("undefined"),function(e){var t;if(e&&e.subscriptionOptions)return t=e.subscriptionOptions,"number"==typeof e.createTime&&0<e.createTime&&"string"==typeof e.token&&0<e.token.length&&"string"==typeof t.auth&&0<t.auth.length&&"string"==typeof t.p256dh&&0<t.p256dh.length&&"string"==typeof t.endpoint&&0<t.endpoint.length&&"string"==typeof t.swScope&&0<t.swScope.length&&"string"==typeof t.vapidKey&&0<t.vapidKey.length}(o)?o:null}(e.appConfig.senderId))?(await ZS(e,t),t):void 0}async function ZS(e,t){e=eC(e);const n=await JS(),r=n.transaction(QS,"readwrite");return await r.objectStore(QS).put(t,e),await r.done,t}function eC({appConfig:e}){return e.appId}const tC=new ae("messaging","Messaging",{"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"only-available-in-window":"This method is available in a Window context.","only-available-in-sw":"This method is available in a service worker context.","permission-default":"The notification permission was not granted and dismissed instead.","permission-blocked":"The notification permission was not granted and blocked instead.","unsupported-browser":"This browser doesn't support the API's required to use the Firebase SDK.","indexed-db-unsupported":"This browser doesn't support indexedDb.open() (ex. Safari iFrame, Firefox Private Browsing, etc)","failed-service-worker-registration":"We are unable to register the default service worker. {$browserErrorMessage}","token-subscribe-failed":"A problem occurred while subscribing the user to FCM: {$errorInfo}","token-subscribe-no-token":"FCM returned no token when subscribing the user to push.","token-unsubscribe-failed":"A problem occurred while unsubscribing the user from FCM: {$errorInfo}","token-update-failed":"A problem occurred while updating the user from FCM: {$errorInfo}","token-update-no-token":"FCM returned no token when updating the user to push.","use-sw-after-get-token":"The useServiceWorker() method may only be called once and must be called before calling getToken() to ensure your service worker is used.","invalid-sw-registration":"The input to useServiceWorker() must be a ServiceWorkerRegistration.","invalid-bg-handler":"The input to setBackgroundMessageHandler() must be a function.","invalid-vapid-key":"The public VAPID key must be a string.","use-vapid-key-after-get-token":"The usePublicVapidKey() method may only be called once and must be called before calling getToken() to ensure your VAPID key is used."});async function nC(e,t){var n={method:"DELETE",headers:await iC(e)};try{const s=await fetch(rC(e.appConfig)+"/"+t,n);var r,i=await s.json();if(i.error)throw r=i.error.message,tC.create("token-unsubscribe-failed",{errorInfo:r})}catch(e){throw tC.create("token-unsubscribe-failed",{errorInfo:null==e?void 0:e.toString()})}}function rC({projectId:e}){return BS+`/projects/${e}/registrations`}async function iC({appConfig:e,installations:t}){t=await t.getToken();return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":e.apiKey,"x-goog-firebase-installations-auth":"FIS "+t})}function sC({p256dh:e,auth:t,endpoint:n,vapidKey:r}){const i={web:{endpoint:n,auth:t,p256dh:e}};return r!==VS&&(i.web.applicationPubKey=r),i}const aC=6048e5;async function oC(e){var t=await XS(e.firebaseDependencies);if(t){await nC(e.firebaseDependencies,t.token);{t=eC(t=e.firebaseDependencies);const r=await JS(),i=r.transaction(QS,"readwrite");await i.objectStore(QS).delete(t),await i.done}await 0}const n=await e.swRegistration.pushManager.getSubscription();return!n||n.unsubscribe()}async function lC(e,t){t={token:await async function(e,t){var n=await iC(e),t=sC(t),t={method:"POST",headers:n,body:JSON.stringify(t)};let r;try{const i=await fetch(rC(e.appConfig),t);r=await i.json()}catch(e){throw tC.create("token-subscribe-failed",{errorInfo:null==e?void 0:e.toString()})}if(r.error)throw t=r.error.message,tC.create("token-subscribe-failed",{errorInfo:t});if(r.token)return r.token;throw tC.create("token-subscribe-no-token")}(e,t),createTime:Date.now(),subscriptionOptions:t};return await ZS(e,t),t.token}function cC(e){var t,n,r,i,s={from:e.from,collapseKey:e.collapse_key,messageId:e.fcmMessageId},a=s;return(n=e).notification&&(a.notification={},(t=n.notification.title)&&(a.notification.title=t),(t=n.notification.body)&&(a.notification.body=t),(t=n.notification.image)&&(a.notification.image=t),(t=n.notification.icon)&&(a.notification.icon=t)),n=s,(a=e).data&&(n.data=a.data),a=s,(e.fcmOptions||null!=(r=e.notification)&&r.click_action)&&(a.fcmOptions={},(i=null!=(r=null==(r=e.fcmOptions)?void 0:r.link)?r:null==(i=e.notification)?void 0:i.click_action)&&(a.fcmOptions.link=i),(i=null==(i=e.fcmOptions)?void 0:i.analytics_label)&&(a.fcmOptions.analyticsLabel=i)),s}function uC(t,n){const r=[];for(let e=0;e<t.length;e++)r.push(t.charAt(e)),e<n.length&&r.push(n.charAt(e));r.join("")}function hC(e){return tC.create("missing-app-config-values",{valueName:e})}uC("hts/frbslgigp.ogepscmv/ieo/eaylg","tp:/ieaeogn-agolai.o/1frlglgc/o"),uC("AzSCbw63g1R0nCw85jG8","Iaya3yLKwmgvh7cF0q4");class dC{constructor(e,t,n){this.deliveryMetricsExportedToBigQueryEnabled=!1,this.onBackgroundMessageHandler=null,this.onMessageHandler=null,this.logEvents=[],this.isLogServiceStarted=!1;var r=function(e){if(!e||!e.options)throw hC("App Configuration Object");if(!e.name)throw hC("App Name");var t=e.options;for(const n of["projectId","apiKey","appId","messagingSenderId"])if(!t[n])throw hC(n);return{appName:e.name,projectId:t.projectId,apiKey:t.apiKey,appId:t.appId,senderId:t.messagingSenderId}}(e);this.firebaseDependencies={app:e,appConfig:r,installations:t,analyticsProvider:n}}_delete(){return Promise.resolve()}}async function pC(e){try{e.swRegistration=await navigator.serviceWorker.register(US,{scope:qS}),e.swRegistration.update().catch(()=>{})}catch(e){throw tC.create("failed-service-worker-registration",{browserErrorMessage:null==e?void 0:e.message})}}async function fC(e,t){if(!navigator)throw tC.create("only-available-in-window");if("default"===Notification.permission&&await Notification.requestPermission(),"granted"!==Notification.permission)throw tC.create("permission-blocked");var n=e,r=(await((r=null==t?void 0:t.vapidKey)?n.vapidKey=r:n.vapidKey||(n.vapidKey=VS)),e),n=null==t?void 0:t.serviceWorkerRegistration;if(n||r.swRegistration||await pC(r),n||!r.swRegistration){if(!(n instanceof ServiceWorkerRegistration))throw tC.create("invalid-sw-registration");r.swRegistration=n}return await 0,async function(e){o=e.swRegistration,r=e.vapidKey;const t=await(await o.pushManager.getSubscription()||o.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:function(){var e=(r+"=".repeat((4-r.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/");const t=atob(e),n=new Uint8Array(t.length);for(let e=0;e<t.length;++e)n[e]=t.charCodeAt(e);return n}()}));var r,n,i,s,a,o={vapidKey:e.vapidKey,swScope:e.swRegistration.scope,endpoint:t.endpoint,auth:WS(t.getKey("auth")),p256dh:WS(t.getKey("p256dh"))},l=await XS(e.firebaseDependencies);if(l){if(a=l.subscriptionOptions,n=o.vapidKey===a.vapidKey,i=o.endpoint===a.endpoint,s=o.auth===a.auth,a=o.p256dh===a.p256dh,n&&i&&s&&a)return Date.now()>=l.createTime+aC?async function(e,t){try{var n=await async function(e,t){var n=await iC(e),r=sC(t.subscriptionOptions),r={method:"PATCH",headers:n,body:JSON.stringify(r)};let i;try{const s=await fetch(rC(e.appConfig)+"/"+t.token,r);i=await s.json()}catch(e){throw tC.create("token-update-failed",{errorInfo:null==e?void 0:e.toString()})}if(i.error)throw r=i.error.message,tC.create("token-update-failed",{errorInfo:r});if(i.token)return i.token;throw tC.create("token-update-no-token")}(e.firebaseDependencies,t),r=Object.assign(Object.assign({},t),{token:n,createTime:Date.now()});return await ZS(e.firebaseDependencies,r),n}catch(t){throw await oC(e),t}}(e,{token:l.token,createTime:Date.now(),subscriptionOptions:o}):l.token;try{await nC(e.firebaseDependencies,l.token)}catch(e){console.warn(e)}return lC(e.firebaseDependencies,o)}return lC(e.firebaseDependencies,o)}(e)}async function gC(e,t){var n,r=t.data;if(r.isFirebaseMessaging&&(e.onMessageHandler&&r.messageType===PS.PUSH_RECEIVED&&("function"==typeof e.onMessageHandler?e.onMessageHandler(cC(r)):e.onMessageHandler.next(cC(r))),n=r.data,"object"==typeof(t=n)&&t&&jS in t&&"1"===n[KS])){t=e;var i=r.messageType;e=n,r=function(){switch(i){case PS.NOTIFICATION_CLICKED:return"notification_open";case PS.PUSH_RECEIVED:return"notification_foreground";default:throw new Error}}();const s=await t.firebaseDependencies.analyticsProvider.get();s.logEvent(r,{message_id:e[jS],message_name:e["google.c.a.c_l"],message_time:e["google.c.a.ts"],message_device_time:Math.floor(Date.now()/1e3)})}}e="@firebase/messaging";gt(new o("messaging",e=>{const t=new dC(e.getProvider("app").getImmediate(),e.getProvider("installations-internal").getImmediate(),e.getProvider("analytics-internal"));return navigator.serviceWorker.addEventListener("message",e=>gC(t,e)),t},"PUBLIC")),gt(new o("messaging-internal",e=>{const t=e.getProvider("messaging").getImmediate();return{getToken:e=>fC(t,e)}},"PRIVATE")),r(e,"0.11.0"),r(e,"0.11.0","esm2017");const mC="BDOU99-h67HcA6JeFXHbSNMu7e2yNNu3RzoMj8TM4W88jITfq7ZmPvIM1Iv-4_l2LxQcYwhqby2xGpWwzjfAnG4",vC="https://fcmregistrations.googleapis.com/v1",yC="FCM_MSG",_C="google.c.a.c_id",wC=3,bC=1;function IC(e){e=new Uint8Array(e);const t=btoa(String.fromCharCode(...e));return t.replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}(nl=OS=OS||{})[nl.DATA_MESSAGE=1]="DATA_MESSAGE",nl[nl.DISPLAY_NOTIFICATION=3]="DISPLAY_NOTIFICATION",Vt=MS={PUSH_RECEIVED:"push-received",NOTIFICATION_CLICKED:"notification-clicked"};const TC="fcm_token_details_db",EC="fcm_token_object_Store";const kC="firebase-messaging-database",SC=1,CC="firebase-messaging-store";let AC=null;function NC(){return AC=AC||et(kC,SC,{upgrade:(e,t)=>{0===t&&e.createObjectStore(CC)}})}async function RC(e){var t=DC(e);const n=await NC();return(t=await n.transaction(CC).objectStore(CC).get(t))?t:(t=await async function(a){if("databases"in indexedDB){const t=await indexedDB.databases(),n=t.map(e=>e.name);if(!n.includes(TC))return null}let o=null;const e=await et(TC,5,{upgrade:async(e,t,n,r)=>{if(!(t<2)&&e.objectStoreNames.contains(EC)){const s=r.objectStore(EC);var i,e=await s.index("fcmSenderId").get(a);await s.clear(),e&&(2===t?(i=e).auth&&i.p256dh&&i.endpoint&&(o={token:i.fcmToken,createTime:null!=(r=i.createTime)?r:Date.now(),subscriptionOptions:{auth:i.auth,p256dh:i.p256dh,endpoint:i.endpoint,swScope:i.swScope,vapidKey:"string"==typeof i.vapidKey?i.vapidKey:IC(i.vapidKey)}}):3===t?(i=e,o={token:i.fcmToken,createTime:i.createTime,subscriptionOptions:{auth:IC(i.auth),p256dh:IC(i.p256dh),endpoint:i.endpoint,swScope:i.swScope,vapidKey:IC(i.vapidKey)}}):4===t&&(o={token:e.fcmToken,createTime:e.createTime,subscriptionOptions:{auth:IC(e.auth),p256dh:IC(e.p256dh),endpoint:e.endpoint,swScope:e.swScope,vapidKey:IC(e.vapidKey)}}))}}});return e.close(),await tt(TC),await tt("fcm_vapid_details_db"),await tt("undefined"),function(e){var t;if(e&&e.subscriptionOptions)return t=e.subscriptionOptions,"number"==typeof e.createTime&&0<e.createTime&&"string"==typeof e.token&&0<e.token.length&&"string"==typeof t.auth&&0<t.auth.length&&"string"==typeof t.p256dh&&0<t.p256dh.length&&"string"==typeof t.endpoint&&0<t.endpoint.length&&"string"==typeof t.swScope&&0<t.swScope.length&&"string"==typeof t.vapidKey&&0<t.vapidKey.length}(o)?o:null}(e.appConfig.senderId))?(await xC(e,t),t):void 0}async function xC(e,t){e=DC(e);const n=await NC(),r=n.transaction(CC,"readwrite");return await r.objectStore(CC).put(t,e),await r.done,t}function DC({appConfig:e}){return e.appId}const PC=new ae("messaging","Messaging",{"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"only-available-in-window":"This method is available in a Window context.","only-available-in-sw":"This method is available in a service worker context.","permission-default":"The notification permission was not granted and dismissed instead.","permission-blocked":"The notification permission was not granted and blocked instead.","unsupported-browser":"This browser doesn't support the API's required to use the Firebase SDK.","indexed-db-unsupported":"This browser doesn't support indexedDb.open() (ex. Safari iFrame, Firefox Private Browsing, etc)","failed-service-worker-registration":"We are unable to register the default service worker. {$browserErrorMessage}","token-subscribe-failed":"A problem occurred while subscribing the user to FCM: {$errorInfo}","token-subscribe-no-token":"FCM returned no token when subscribing the user to push.","token-unsubscribe-failed":"A problem occurred while unsubscribing the user from FCM: {$errorInfo}","token-update-failed":"A problem occurred while updating the user from FCM: {$errorInfo}","token-update-no-token":"FCM returned no token when updating the user to push.","use-sw-after-get-token":"The useServiceWorker() method may only be called once and must be called before calling getToken() to ensure your service worker is used.","invalid-sw-registration":"The input to useServiceWorker() must be a ServiceWorkerRegistration.","invalid-bg-handler":"The input to setBackgroundMessageHandler() must be a function.","invalid-vapid-key":"The public VAPID key must be a string.","use-vapid-key-after-get-token":"The usePublicVapidKey() method may only be called once and must be called before calling getToken() to ensure your VAPID key is used."});async function OC(e,t){var n={method:"DELETE",headers:await LC(e)};try{const s=await fetch(MC(e.appConfig)+"/"+t,n);var r,i=await s.json();if(i.error)throw r=i.error.message,PC.create("token-unsubscribe-failed",{errorInfo:r})}catch(e){throw PC.create("token-unsubscribe-failed",{errorInfo:null==e?void 0:e.toString()})}}function MC({projectId:e}){return vC+`/projects/${e}/registrations`}async function LC({appConfig:e,installations:t}){t=await t.getToken();return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":e.apiKey,"x-goog-firebase-installations-auth":"FIS "+t})}function FC({p256dh:e,auth:t,endpoint:n,vapidKey:r}){const i={web:{endpoint:n,auth:t,p256dh:e}};return r!==mC&&(i.web.applicationPubKey=r),i}async function UC(e){var t=await RC(e.firebaseDependencies);if(t){await OC(e.firebaseDependencies,t.token);{t=DC(t=e.firebaseDependencies);const r=await NC(),i=r.transaction(CC,"readwrite");await i.objectStore(CC).delete(t),await i.done}await 0}const n=await e.swRegistration.pushManager.getSubscription();return!n||n.unsubscribe()}async function qC(e,t){t={token:await async function(e,t){var n=await LC(e),t=FC(t),t={method:"POST",headers:n,body:JSON.stringify(t)};let r;try{const i=await fetch(MC(e.appConfig),t);r=await i.json()}catch(e){throw PC.create("token-subscribe-failed",{errorInfo:null==e?void 0:e.toString()})}if(r.error)throw t=r.error.message,PC.create("token-subscribe-failed",{errorInfo:t});if(r.token)return r.token;throw PC.create("token-subscribe-no-token")}(e,t),createTime:Date.now(),subscriptionOptions:t};return await xC(e,t),t.token}function VC(t,n){const r=[];for(let e=0;e<t.length;e++)r.push(t.charAt(e)),e<n.length&&r.push(n.charAt(e));r.join("")}async function BC(e,t){var n=function({data:e}){if(!e)return null;try{return e.json()}catch(e){return null}}(e);if(n){t.deliveryMetricsExportedToBigQueryEnabled&&await async function(e,t){t=function(e,t){const n={};return e.from&&(n.project_number=e.from),e.fcmMessageId&&(n.message_id=e.fcmMessageId),n.instance_id=t,e.notification?n.message_type=OS.DISPLAY_NOTIFICATION.toString():n.message_type=OS.DATA_MESSAGE.toString(),n.sdk_platform=wC.toString(),n.package_name=self.origin.replace(/(^\w+:|^)\/\//,""),e.collapse_key&&(n.collapse_key=e.collapse_key),n.event=bC.toString(),null!=(t=e.fcmOptions)&&t.analytics_label&&(n.analytics_label=null==(t=e.fcmOptions)?void 0:t.analytics_label),n}(t,await e.firebaseDependencies.installations.getId());{const n={};return n.event_time_ms=Math.floor(Date.now()).toString(),n.source_extension_json_proto3=JSON.stringify(t),void e.logEvents.push(n)}}(t,n);var r,i,s,a,o=await jC();if(o.some(e=>"visible"===e.visibilityState&&!e.url.startsWith("chrome-extension://"))){var l=o,c=n;c.isFirebaseMessaging=!0,c.messageType=MS.PUSH_RECEIVED;for(const u of l)u.postMessage(c)}else n.notification&&(l=function(e){const t=Object.assign({},e.notification);return t.data={[yC]:e},t}(n),r=l.actions,a=Notification.maxActions,r&&a&&r.length>a&&console.warn(`This browser only supports ${a} actions. The remaining actions will not be displayed.`),await self.registration.showNotification(null!=(a=l.title)?a:"",l)),t&&t.onBackgroundMessageHandler&&(o=a={from:(r=n).from,collapseKey:r.collapse_key,messageId:r.fcmMessageId},(e=r).notification&&(o.notification={},(n=e.notification.title)&&(o.notification.title=n),(n=e.notification.body)&&(o.notification.body=n),(n=e.notification.image)&&(o.notification.image=n),(n=e.notification.icon)&&(o.notification.icon=n)),e=a,(o=r).data&&(e.data=o.data),o=a,(r.fcmOptions||null!=(i=r.notification)&&i.click_action)&&(o.fcmOptions={},(s=null!=(i=null==(i=r.fcmOptions)?void 0:i.link)?i:null==(s=r.notification)?void 0:s.click_action)&&(o.fcmOptions.link=s),(s=null==(s=r.fcmOptions)?void 0:s.analytics_label)&&(o.fcmOptions.analyticsLabel=s)),"function"==typeof t.onBackgroundMessageHandler?await t.onBackgroundMessageHandler(a):t.onBackgroundMessageHandler.next(a))}}function jC(){return self.clients.matchAll({type:"window",includeUncontrolled:!0})}function KC(e){return PC.create("missing-app-config-values",{valueName:e})}VC("hts/frbslgigp.ogepscmv/ieo/eaylg","tp:/ieaeogn-agolai.o/1frlglgc/o"),VC("AzSCbw63g1R0nCw85jG8","Iaya3yLKwmgvh7cF0q4");class WC{constructor(e,t,n){this.deliveryMetricsExportedToBigQueryEnabled=!1,this.onBackgroundMessageHandler=null,this.onMessageHandler=null,this.logEvents=[],this.isLogServiceStarted=!1;var r=function(e){if(!e||!e.options)throw KC("App Configuration Object");if(!e.name)throw KC("App Name");var t=e.options;for(const n of["projectId","apiKey","appId","messagingSenderId"])if(!t[n])throw KC(n);return{appName:e.name,projectId:t.projectId,apiKey:t.apiKey,appId:t.appId,senderId:t.messagingSenderId}}(e);this.firebaseDependencies={app:e,appConfig:r,installations:t,analyticsProvider:n}}_delete(){return Promise.resolve()}}var zC;gt(new o("messaging-sw",e=>{const t=new WC(e.getProvider("app").getImmediate(),e.getProvider("installations-internal").getImmediate(),e.getProvider("analytics-internal"));return self.addEventListener("push",e=>{e.waitUntil(BC(e,t))}),self.addEventListener("pushsubscriptionchange",e=>{e.waitUntil(async function(e,t){(e=e.newSubscription)?(e=await RC(t.firebaseDependencies),await UC(t),t.vapidKey=null!=(e=null==(e=null==e?void 0:e.subscriptionOptions)?void 0:e.vapidKey)?e:mC,await async function(e){o=e.swRegistration,r=e.vapidKey;const t=await(await o.pushManager.getSubscription()||o.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:function(){var e=(r+"=".repeat((4-r.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/");const t=atob(e),n=new Uint8Array(t.length);for(let e=0;e<t.length;++e)n[e]=t.charCodeAt(e);return n}()}));var r,n,i,s,a,o={vapidKey:e.vapidKey,swScope:e.swRegistration.scope,endpoint:t.endpoint,auth:IC(t.getKey("auth")),p256dh:IC(t.getKey("p256dh"))},l=await RC(e.firebaseDependencies);if(l){if(a=l.subscriptionOptions,n=o.vapidKey===a.vapidKey,i=o.endpoint===a.endpoint,s=o.auth===a.auth,a=o.p256dh===a.p256dh,n&&i&&s&&a)return Date.now()>=l.createTime+6048e5?async function(e,t){try{var n=await async function(e,t){var n=await LC(e),r=FC(t.subscriptionOptions),r={method:"PATCH",headers:n,body:JSON.stringify(r)};let i;try{const s=await fetch(MC(e.appConfig)+"/"+t.token,r);i=await s.json()}catch(e){throw PC.create("token-update-failed",{errorInfo:null==e?void 0:e.toString()})}if(i.error)throw r=i.error.message,PC.create("token-update-failed",{errorInfo:r});if(i.token)return i.token;throw PC.create("token-update-no-token")}(e.firebaseDependencies,t),r=Object.assign(Object.assign({},t),{token:n,createTime:Date.now()});return await xC(e.firebaseDependencies,r),n}catch(t){throw await UC(e),t}}(e,{token:l.token,createTime:Date.now(),subscriptionOptions:o}):l.token;try{await OC(e.firebaseDependencies,l.token)}catch(e){console.warn(e)}return qC(e.firebaseDependencies,o)}return qC(e.firebaseDependencies,o)}(t)):await UC(t)}(e,t))}),self.addEventListener("notificationclick",e=>{e.waitUntil(async function(e){const t=null==(r=null==(n=e.notification)?void 0:n.data)?void 0:r[yC];if(t&&!e.action){e.stopImmediatePropagation(),e.notification.close();e=t;s=(s=null!=(i=null==(i=e.fcmOptions)?void 0:i.link)?i:null==(s=e.notification)?void 0:s.click_action)||("object"==typeof(i=e.data)&&i&&_C in i?self.location.origin:null);if(s){var n=new URL(s,self.location.href),r=new URL(self.location.origin);if(n.host===r.host){let e=await async function(e){for(const n of await jC()){var t=new URL(n.url,self.location.href);if(e.host===t.host)return n}return null}(n);if(e?e=await e.focus():(e=await self.clients.openWindow(s),await new Promise(e=>{setTimeout(e,3e3)})),e)return t.messageType=MS.NOTIFICATION_CLICKED,t.isFirebaseMessaging=!0,e.postMessage(t)}}}var i,s}(e))}),t},"PUBLIC"));class GC{constructor(e,t){this.app=e,this._delegate=t,this.app=e,this._delegate=t}async getToken(t){return async function(e){return fC(_(e),t)}(this._delegate)}async deleteToken(){return async function(e){if(navigator)return e.swRegistration||await pC(e),oC(e);throw tC.create("only-available-in-window")}(_(this._delegate))}onMessage(e){var t=this._delegate,n=t=_(t);if(navigator)return n.onMessageHandler=e,()=>{n.onMessageHandler=null};throw tC.create("only-available-in-window")}onBackgroundMessage(e){var t=this._delegate,n=t=_(t),t=e;if(void 0!==self.document)throw PC.create("only-available-in-sw");return n.onBackgroundMessageHandler=t,()=>{n.onBackgroundMessageHandler=null}}}Ft={isSupported:function(){return self&&"ServiceWorkerGlobalScope"in self?Y()&&"PushManager"in self&&"Notification"in self&&ServiceWorkerRegistration.prototype.hasOwnProperty("showNotification")&&PushSubscription.prototype.hasOwnProperty("getKey"):"undefined"!=typeof window&&Y()&&X()&&"serviceWorker"in navigator&&"PushManager"in window&&"Notification"in window&&"fetch"in window&&ServiceWorkerRegistration.prototype.hasOwnProperty("showNotification")&&PushSubscription.prototype.hasOwnProperty("getKey")}};qt.INTERNAL.registerComponent(new o("messaging-compat",e=>self&&"ServiceWorkerGlobalScope"in self?new GC(e.getProvider("app-compat").getImmediate(),e.getProvider("messaging-sw").getImmediate()):new GC(e.getProvider("app-compat").getImmediate(),e.getProvider("messaging").getImmediate()),"PUBLIC").setServiceProps(Ft)),qt.registerVersion("@firebase/messaging-compat","0.1.21");const HC="firebasestorage.googleapis.com",$C="storageBucket";class QC extends se{constructor(e,t,n=0){super(YC(e),`Firebase Storage: ${t} (${YC(e)})`),this.status_=n,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,QC.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(e){return YC(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=this._baseMessage+`
`+this.customData.serverResponse:this.message=this._baseMessage}}function YC(e){return"storage/"+e}function JC(){return new QC("unknown","An unknown error occurred, please check the error payload for server response.")}function XC(){return new QC("retry-limit-exceeded","Max retry time for operation exceeded, please try again.")}function ZC(){return new QC("canceled","User canceled the upload/download.")}function eA(){return new QC("cannot-slice-blob","Cannot slice blob for upload. Please retry the upload.")}function tA(e){return new QC("invalid-argument",e)}function nA(){return new QC("app-deleted","The Firebase app was deleted.")}function rA(e){return new QC("invalid-root-operation","The operation '"+e+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}function iA(e,t){return new QC("invalid-format","String does not match format '"+e+"': "+t)}function sA(e){throw new QC("internal-error","Internal error: "+e)}class aA{constructor(e,t){this.bucket=e,this.path_=t}get path(){return this.path_}get isRoot(){return 0===this.path.length}fullServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o"}static makeFromBucketSpec(e,t){let n;try{n=aA.makeFromUrl(e,t)}catch(t){return new aA(e,"")}if(""===n.path)return n;throw new QC("invalid-default-bucket","Invalid default bucket '"+e+"'.")}static makeFromUrl(t,e){let n=null;var r="([A-Za-z0-9.\\-_]+)",i=new RegExp("^gs://"+r+"(/(.*))?$","i");function s(e){e.path_=decodeURIComponent(e.path)}var a=e.replace(/[.]/g,"\\."),o=new RegExp(`^https?://${a}/v[A-Za-z0-9_]+/b/${r}/o(/([^?#]*).*)?$`,"i"),a=e===HC?"(?:storage.googleapis.com|storage.cloud.google.com)":e,l=[{regex:i,indices:{bucket:1,path:3},postModify:function(e){"/"===e.path.charAt(e.path.length-1)&&(e.path_=e.path_.slice(0,-1))}},{regex:o,indices:{bucket:1,path:3},postModify:s},{regex:new RegExp(`^https?://${a}/${r}/([^?#]*)`,"i"),indices:{bucket:1,path:2},postModify:s}];for(let e=0;e<l.length;e++){const h=l[e];var c=h.regex.exec(t);if(c){var u=c[h.indices.bucket],c=c[h.indices.path]||"";n=new aA(u,c),h.postModify(n);break}}if(null==n)throw e=t,new QC("invalid-url","Invalid URL '"+e+"'.");return n}}class oA{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=0){}}function lA(e){return"string"==typeof e||e instanceof String}function cA(e){return uA()&&e instanceof Blob}function uA(){return"undefined"!=typeof Blob&&!z()}function hA(e,t,n,r){if(r<t)throw tA(`Invalid value for '${e}'. Expected ${t} or greater.`);if(n<r)throw tA(`Invalid value for '${e}'. Expected ${n} or less.`)}function dA(e,t,n){return n+`://${null==n?"https://"+t:t}/v0`+e}function pA(e){const t=encodeURIComponent;let n="?";for(const i in e){var r;e.hasOwnProperty(i)&&(r=t(i)+"="+t(e[i]),n=n+r+"&")}return n=n.slice(0,-1)}function fA(e,t){var n=500<=e&&e<600,r=-1!==[408,429].indexOf(e),t=-1!==t.indexOf(e);return n||r||t}Vt=zC={NO_ERROR:0,0:"NO_ERROR",NETWORK_ERROR:1,1:"NETWORK_ERROR",ABORT:2,2:"ABORT"};class gA{constructor(e,t,n,r,i,s,a,o,l,c,u,h=!0){this.url_=e,this.method_=t,this.headers_=n,this.body_=r,this.successCodes_=i,this.additionalRetryCodes_=s,this.callback_=a,this.errorCallback_=o,this.timeout_=l,this.progressCallback_=c,this.connectionFactory_=u,this.retry=h,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((e,t)=>{this.resolve_=e,this.reject_=t,this.start_()})}start_(){var e=(e,t)=>{const n=this.resolve_,r=this.reject_,i=t.connection;if(t.wasSuccessCode)try{var s=this.callback_(i,i.getResponse());void 0!==s?n(s):n()}catch(e){r(e)}else if(null!==i){const a=JC();a.serverResponse=i.getErrorText(),this.errorCallback_?r(this.errorCallback_(i,a)):r(a)}else{s=(t.canceled?this.appDelete_?nA:ZC:XC)();r(s)}};this.canceled_?e(0,new mA(!1,null,!0)):this.backoffId_=function(t,n,e){let r=1,i=null,s=null,a=!1,o=0;function l(){return 2===o}let c=!1;function u(...e){c||(c=!0,n.apply(null,e))}function h(e){i=setTimeout(()=>{i=null,t(p,l())},e)}function d(){s&&clearTimeout(s)}function p(e,...t){{if(!c)return e||l()||a?(d(),void u.call(null,e,...t)):(r<64&&(r*=2),void h(1===o?(o=2,0):1e3*(r+Math.random())));d()}}let f=!1;function g(e){f||(f=!0,d(),c||(null!==i?(e||(o=2),clearTimeout(i),h(0)):e||(o=1)))}return h(0),s=setTimeout(()=>{g(a=!0)},e),g}((r,e)=>{if(e)r(!1,new mA(!1,null,!0));else{const i=this.connectionFactory_(),s=(this.pendingConnection_=i,e=>{var t=e.loaded,e=e.lengthComputable?e.total:-1;null!==this.progressCallback_&&this.progressCallback_(t,e)});null!==this.progressCallback_&&i.addUploadProgressListener(s),i.send(this.url_,this.method_,this.body_,this.headers_).then(()=>{null!==this.progressCallback_&&i.removeUploadProgressListener(s),this.pendingConnection_=null;var e,t=i.getErrorCode()===zC.NO_ERROR,n=i.getStatus();t&&!fA(n,this.additionalRetryCodes_)||!this.retry?(e=-1!==this.successCodes_.indexOf(n),r(!0,new mA(e,i))):(e=i.getErrorCode()===zC.ABORT,r(!1,new mA(!1,null,e)))})}},e,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,null!==this.backoffId_&&(0,this.backoffId_)(!1),null!==this.pendingConnection_&&this.pendingConnection_.abort()}}class mA{constructor(e,t,n){this.wasSuccessCode=e,this.connection=t,this.canceled=!!n}}const vA={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"};class yA{constructor(e,t){this.data=e,this.contentType=t||null}}function _A(e,t){switch(e){case vA.RAW:return new yA(wA(t));case vA.BASE64:case vA.BASE64URL:return new yA(bA(e,t));case vA.DATA_URL:return new yA((n=t,(r=new IA(n)).base64?bA(vA.BASE64,r.rest):function(e){let t;try{t=decodeURIComponent(e)}catch(e){throw iA(vA.DATA_URL,"Malformed data URL.")}return wA(t)}(r.rest)),(n=t,new IA(n).contentType))}var n,r;throw JC()}function wA(n){const r=[];for(let t=0;t<n.length;t++){let e=n.charCodeAt(t);var i,s;e<=127?r.push(e):e<=2047?r.push(192|e>>6,128|63&e):55296==(64512&e)?t<n.length-1&&56320==(64512&n.charCodeAt(t+1))?(i=e,s=n.charCodeAt(++t),e=65536|(1023&i)<<10|1023&s,r.push(240|e>>18,128|e>>12&63,128|e>>6&63,128|63&e)):r.push(239,191,189):56320==(64512&e)?r.push(239,191,189):r.push(224|e>>12,128|e>>6&63,128|63&e)}return new Uint8Array(r)}function bA(e,t){switch(e){case vA.BASE64:var n=-1!==t.indexOf("-"),r=-1!==t.indexOf("_");if(n||r)throw iA(e,"Invalid character '"+(n?"-":"_")+"' found: is it base64url encoded?");break;case vA.BASE64URL:if(r=-1!==t.indexOf("+"),n=-1!==t.indexOf("/"),r||n)throw iA(e,"Invalid character '"+(r?"+":"/")+"' found: is it base64 encoded?");t=t.replace(/-/g,"+").replace(/_/g,"/")}let i;try{i=function(e){if("undefined"==typeof atob)throw new QC("unsupported-environment","base-64 is missing. Make sure to install the required polyfills. See https://firebase.google.com/docs/web/environments-js-sdk#polyfills for more information.");return atob(e)}(t)}catch(t){if(t.message.includes("polyfill"))throw t;throw iA(e,"Invalid character found")}const s=new Uint8Array(i.length);for(let e=0;e<i.length;e++)s[e]=i.charCodeAt(e);return s}class IA{constructor(e){this.base64=!1,this.contentType=null;var t,n=e.match(/^data:([^,]+)?,/);if(null===n)throw iA(vA.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");const r=n[1]||null;null!=r&&(this.base64=(n=r).length>=(t=";base64").length&&n.substring(n.length-t.length)===t,this.contentType=this.base64?r.substring(0,r.length-";base64".length):r),this.rest=e.substring(e.indexOf(",")+1)}}class TA{constructor(e,t){let n=0,r="";cA(e)?(this.data_=e,n=e.size,r=e.type):e instanceof ArrayBuffer?(t?this.data_=new Uint8Array(e):(this.data_=new Uint8Array(e.byteLength),this.data_.set(new Uint8Array(e))),n=this.data_.length):e instanceof Uint8Array&&(t?this.data_=e:(this.data_=new Uint8Array(e.length),this.data_.set(e)),n=e.length),this.size_=n,this.type_=r}size(){return this.size_}type(){return this.type_}slice(e,t){if(cA(this.data_))return r=e,i=t,null===(s=(n=s=this.data_).webkitSlice?n.webkitSlice(r,i):n.mozSlice?n.mozSlice(r,i):n.slice?n.slice(r,i):null)?null:new TA(s);var n,r,i,s=new Uint8Array(this.data_.buffer,e,t-e);return new TA(s,!0)}static getBlob(...e){var t;if(uA())return t=e.map(e=>e instanceof TA?e.data_:e),new TA(function(...t){const e="undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof WebKitBlobBuilder?WebKitBlobBuilder:void 0;if(void 0!==e){const n=new e;for(let e=0;e<t.length;e++)n.append(t[e]);return n.getBlob()}if(uA())return new Blob(t);throw new QC("unsupported-environment","This browser doesn't seem to support creating Blobs")}.apply(null,t));{const r=e.map(e=>lA(e)?_A(vA.RAW,e).data:e.data_);let t=0;r.forEach(e=>{t+=e.byteLength});const i=new Uint8Array(t);let n=0;return r.forEach(t=>{for(let e=0;e<t.length;e++)i[n++]=t[e]}),new TA(i,!0)}}uploadData(){return this.data_}}function EA(e){let t;try{t=JSON.parse(e)}catch(e){return null}return"object"!=typeof(e=t)||Array.isArray(e)?null:t}function kA(e){var t=e.lastIndexOf("/",e.length-2);return-1===t?e:e.slice(t+1)}function SA(e,t){return t}class CA{constructor(e,t,n,r){this.server=e,this.local=t||e,this.writable=!!n,this.xform=r||SA}}let AA=null;function NA(){if(AA)return AA;const e=[],t=(e.push(new CA("bucket")),e.push(new CA("generation")),e.push(new CA("metageneration")),e.push(new CA("name","fullPath",!0)),new CA("name")),n=(t.xform=function(e,t){return!lA(t)||t.length<2?t:kA(t)},e.push(t),new CA("size"));return n.xform=function(e,t){return void 0!==t?Number(t):t},e.push(n),e.push(new CA("timeCreated")),e.push(new CA("updated")),e.push(new CA("md5Hash",null,!0)),e.push(new CA("cacheControl",null,!0)),e.push(new CA("contentDisposition",null,!0)),e.push(new CA("contentEncoding",null,!0)),e.push(new CA("contentLanguage",null,!0)),e.push(new CA("contentType",null,!0)),e.push(new CA("metadata","customMetadata",!0)),AA=e}function RA(e,t,n){t=EA(t);if(null===t)return null;{var r=t,i=n;const l={type:"file"};var s,a,o=i.length;for(let e=0;e<o;e++){const c=i[e];l[c.local]=c.xform(l,r[c.server])}return s=l,a=e,Object.defineProperty(s,"ref",{get:function(){var e=s.bucket,t=s.fullPath,t=new aA(e,t);return a._makeStorageReference(t)}}),l}}function xA(t,n){const r={};var i=n.length;for(let e=0;e<i;e++){var s=n[e];s.writable&&(r[s.server]=t[s.local])}return JSON.stringify(r)}const DA="prefixes";class PA{constructor(e,t,n,r){this.url=e,this.method=t,this.handler=n,this.timeout=r,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}function OA(e){if(!e)throw JC()}function MA(n,r){return function(e,t){t=RA(n,t,r);return OA(null!==t),t}}function LA(n,r){return function(e,t){t=function(e,t,n){if(null===(n=EA(n)))return null;{var r=e,i=t,e=n;const o={prefixes:[],items:[],nextPageToken:e.nextPageToken};if(e[DA])for(const l of e[DA]){var s=l.replace(/\/$/,""),s=r._makeStorageReference(new aA(i,s));o.prefixes.push(s)}if(e.items)for(const c of e.items){var a=r._makeStorageReference(new aA(i,c.name));o.items.push(a)}return o}}(n,r,t);return OA(null!==t),t}}function FA(c,u){return function(e,t){var n=RA(c,t,u);OA(null!==n);{var r=n,i=c.host,s=c._protocol;if(null===(n=EA(t)))return null;if(!lA(n.downloadTokens))return null;const a=n.downloadTokens;if(0===a.length)return null;const o=encodeURIComponent,l=a.split(",");return l.map(e=>{var t=r.bucket,n=r.fullPath;return dA("/b/"+o(t)+"/o/"+o(n),i,s)+pA({alt:"media",token:e})})[0]}}}function UA(i){return function(e,t){let n;var r;return(n=401===e.getStatus()?e.getErrorText().includes("Firebase App Check token is invalid")?new QC("unauthorized-app","This app does not have permission to access Firebase Storage on this project."):new QC("unauthenticated","User is not authenticated, please authenticate using Firebase Authentication and try again."):402===e.getStatus()?(r=i.bucket,new QC("quota-exceeded","Quota for bucket '"+r+"' exceeded, please view quota on https://firebase.google.com/pricing/.")):403===e.getStatus()?(r=i.path,new QC("unauthorized","User does not have permission to access '"+r+"'.")):t).status=e.getStatus(),n.serverResponse=t.serverResponse,n}}function qA(r){const i=UA(r);return function(e,t){let n=i(e,t);return(n=404===e.getStatus()?(e=r.path,new QC("object-not-found","Object '"+e+"' does not exist.")):n).serverResponse=t.serverResponse,n}}function VA(e,t,n){var r=dA(t.fullServerUrl(),e.host,e._protocol),i=e.maxOperationRetryTime;const s=new PA(r,"GET",MA(e,n),i);return s.errorHandler=qA(t),s}function BA(e,t,n){const r=Object.assign({},n);return r.fullPath=e.path,r.size=t.size(),r.contentType||(r.contentType=(e=t,(t=null)&&t.contentType||e&&e.type()||"application/octet-stream")),r}class jA{constructor(e,t,n,r){this.current=e,this.total=t,this.finalized=!!n,this.metadata=r||null}}function KA(e,t){let n=null;try{n=e.getResponseHeader("X-Goog-Upload-Status")}catch(e){OA(!1)}const r=t||["active"];return OA(!!n&&-1!==r.indexOf(n)),n}const WA={RUNNING:"running",PAUSED:"paused",SUCCESS:"success",CANCELED:"canceled",ERROR:"error"};function zA(e){switch(e){case"running":case"pausing":case"canceling":return WA.RUNNING;case"paused":return WA.PAUSED;case"success":return WA.SUCCESS;case"canceled":return WA.CANCELED;default:return WA.ERROR}}class GA{constructor(e,t,n){"function"==typeof e||null!=t||null!=n?(this.next=e,this.error=null!=t?t:void 0,this.complete=null!=n?n:void 0):(this.next=(t=e).next,this.error=t.error,this.complete=t.complete)}}function HA(t){return(...e)=>{Promise.resolve().then(()=>t(...e))}}class $A extends class{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.initXhr(),this.errorCode_=zC.NO_ERROR,this.sendPromise_=new Promise(e=>{this.xhr_.addEventListener("abort",()=>{this.errorCode_=zC.ABORT,e()}),this.xhr_.addEventListener("error",()=>{this.errorCode_=zC.NETWORK_ERROR,e()}),this.xhr_.addEventListener("load",()=>{e()})})}send(e,t,n,r){if(this.sent_)throw sA("cannot .send() more than once");if(this.sent_=!0,this.xhr_.open(t,e,!0),void 0!==r)for(const i in r)r.hasOwnProperty(i)&&this.xhr_.setRequestHeader(i,r[i].toString());return void 0!==n?this.xhr_.send(n):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(this.sent_)return this.errorCode_;throw sA("cannot .getErrorCode() before sending")}getStatus(){if(!this.sent_)throw sA("cannot .getStatus() before sending");try{return this.xhr_.status}catch(e){return-1}}getResponse(){if(this.sent_)return this.xhr_.response;throw sA("cannot .getResponse() before sending")}getErrorText(){if(this.sent_)return this.xhr_.statusText;throw sA("cannot .getErrorText() before sending")}abort(){this.xhr_.abort()}getResponseHeader(e){return this.xhr_.getResponseHeader(e)}addUploadProgressListener(e){null!=this.xhr_.upload&&this.xhr_.upload.addEventListener("progress",e)}removeUploadProgressListener(e){null!=this.xhr_.upload&&this.xhr_.upload.removeEventListener("progress",e)}}{initXhr(){this.xhr_.responseType="text"}}function QA(){return new $A}class YA{constructor(e,t,n=null){this._transferred=0,this._needToFetchStatus=!1,this._needToFetchMetadata=!1,this._observers=[],this._error=void 0,this._uploadUrl=void 0,this._request=void 0,this._chunkMultiplier=1,this._resolve=void 0,this._reject=void 0,this._ref=e,this._blob=t,this._metadata=n,this._mappings=NA(),this._resumable=this._shouldDoResumable(this._blob),this._state="running",this._errorHandler=e=>{if(this._request=void 0,this._chunkMultiplier=1,e._codeEquals("canceled"))this._needToFetchStatus=!0,this.completeTransitions_();else{var t=this.isExponentialBackoffExpired();if(fA(e.status,[])){if(!t)return this.sleepTime=Math.max(2*this.sleepTime,1e3),this._needToFetchStatus=!0,void this.completeTransitions_();e=XC()}this._error=e,this._transition("error")}},this._metadataErrorHandler=e=>{this._request=void 0,e._codeEquals("canceled")?this.completeTransitions_():(this._error=e,this._transition("error"))},this.sleepTime=0,this.maxSleepTime=this._ref.storage.maxUploadRetryTime,this._promise=new Promise((e,t)=>{this._resolve=e,this._reject=t,this._start()}),this._promise.then(null,()=>{})}isExponentialBackoffExpired(){return this.sleepTime>this.maxSleepTime}_makeProgressCallback(){const t=this._transferred;return e=>this._updateProgress(t+e)}_shouldDoResumable(e){return 262144<e.size()}_start(){"running"===this._state&&void 0===this._request&&(this._resumable?void 0===this._uploadUrl?this._createResumable():this._needToFetchStatus?this._fetchStatus():this._needToFetchMetadata?this._fetchMetadata():this.pendingTimeout=setTimeout(()=>{this.pendingTimeout=void 0,this._continueUpload()},this.sleepTime):this._oneShotUpload())}_resolveToken(n){Promise.all([this._ref.storage._getAuthToken(),this._ref.storage._getAppCheckToken()]).then(([e,t])=>{switch(this._state){case"running":n(e,t);break;case"canceling":this._transition("canceled");break;case"pausing":this._transition("paused")}})}_createResumable(){this._resolveToken((e,t)=>{var n=function(e,t,n,r,i){var s=t.bucketOnlyServerUrl(),a={name:(i=BA(t,r,i)).fullPath},o=dA(s,e.host,e._protocol),r={"X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":""+r.size(),"X-Goog-Upload-Header-Content-Type":i.contentType,"Content-Type":"application/json; charset=utf-8"},s=xA(i,n),i=e.maxUploadRetryTime;const l=new PA(o,"POST",function(e){KA(e);let t;try{t=e.getResponseHeader("X-Goog-Upload-URL")}catch(e){OA(!1)}return OA(lA(t)),t},i);return l.urlParams=a,l.headers=r,l.body=s,l.errorHandler=UA(t),l}(this._ref.storage,this._ref._location,this._mappings,this._blob,this._metadata);const r=this._ref.storage._makeRequest(n,QA,e,t);(this._request=r).getPromise().then(e=>{this._request=void 0,this._uploadUrl=e,this._needToFetchStatus=!1,this.completeTransitions_()},this._errorHandler)})}_fetchStatus(){const i=this._uploadUrl;this._resolveToken((e,t)=>{var n=function(e,t,n,i){e=e.maxUploadRetryTime;const r=new PA(n,"POST",function(e){var t=KA(e,["active","final"]);let n=null;try{n=e.getResponseHeader("X-Goog-Upload-Size-Received")}catch(e){OA(!1)}n||OA(!1);var r=Number(n);return OA(!isNaN(r)),new jA(r,i.size(),"final"===t)},e);return r.headers={"X-Goog-Upload-Command":"query"},r.errorHandler=UA(t),r}(this._ref.storage,this._ref._location,i,this._blob);const r=this._ref.storage._makeRequest(n,QA,e,t);(this._request=r).getPromise().then(e=>{this._request=void 0,this._updateProgress(e.current),this._needToFetchStatus=!1,e.finalized&&(this._needToFetchMetadata=!0),this.completeTransitions_()},this._errorHandler)})}_continueUpload(){const i=262144*this._chunkMultiplier,s=new jA(this._transferred,this._blob.size()),a=this._uploadUrl;this._resolveToken((e,t)=>{let n;try{n=function(e,s,t,a,n,o,r,i){const l=new jA(0,0);if(r?(l.current=r.current,l.total=r.total):(l.current=0,l.total=a.size()),a.size()!==l.total)throw new QC("server-file-wrong-size","Server recorded incorrect upload file size, please retry the upload.");let c=r=l.total-l.current;0<n&&(c=Math.min(c,n));var u=(n=l.current)+c,r={"X-Goog-Upload-Command":0===c?"finalize":r===c?"upload, finalize":"upload","X-Goog-Upload-Offset":""+l.current};const h=a.slice(n,u);if(null===h)throw eA();u=s.maxUploadRetryTime;const d=new PA(t,"POST",function(e,t){var n=KA(e,["active","final"]),r=l.current+c,i=a.size(),e="final"===n?MA(s,o)(e,t):null;return new jA(r,i,"final"===n,e)},u);return d.headers=r,d.body=h.uploadData(),d.progressCallback=i||null,d.errorHandler=UA(e),d}(this._ref._location,this._ref.storage,a,this._blob,i,this._mappings,s,this._makeProgressCallback())}catch(e){return this._error=e,void this._transition("error")}const r=this._ref.storage._makeRequest(n,QA,e,t,!1);(this._request=r).getPromise().then(e=>{this._increaseMultiplier(),this._request=void 0,this._updateProgress(e.current),e.finalized?(this._metadata=e.metadata,this._transition("success")):this.completeTransitions_()},this._errorHandler)})}_increaseMultiplier(){262144*this._chunkMultiplier*2<33554432&&(this._chunkMultiplier*=2)}_fetchMetadata(){this._resolveToken((e,t)=>{var n=VA(this._ref.storage,this._ref._location,this._mappings);const r=this._ref.storage._makeRequest(n,QA,e,t);(this._request=r).getPromise().then(e=>{this._request=void 0,this._metadata=e,this._transition("success")},this._metadataErrorHandler)})}_oneShotUpload(){this._resolveToken((e,t)=>{var n=function(e,t,n,r,i){var s=t.bucketOnlyServerUrl();const a={"X-Goog-Upload-Protocol":"multipart"};var o=function(){let t="";for(let e=0;e<2;e++)t+=Math.random().toString().slice(2);return t}(),i=(a["Content-Type"]="multipart/related; boundary="+o,BA(t,r,i)),l="--"+o+"\r\nContent-Type: application/json; charset=utf-8\r\n\r\n"+xA(i,n)+"\r\n--"+o+"\r\nContent-Type: "+i.contentType+"\r\n\r\n",o="\r\n--"+o+"--";const c=TA.getBlob(l,r,o);if(null===c)throw eA();o={name:i.fullPath},i=dA(s,e.host,e._protocol),s=e.maxUploadRetryTime;const u=new PA(i,"POST",MA(e,n),s);return u.urlParams=o,u.headers=a,u.body=c.uploadData(),u.errorHandler=UA(t),u}(this._ref.storage,this._ref._location,this._mappings,this._blob,this._metadata);const r=this._ref.storage._makeRequest(n,QA,e,t);(this._request=r).getPromise().then(e=>{this._request=void 0,this._metadata=e,this._updateProgress(this._blob.size()),this._transition("success")},this._errorHandler)})}_updateProgress(e){var t=this._transferred;this._transferred=e,this._transferred!==t&&this._notifyObservers()}_transition(e){if(this._state!==e)switch(e){case"canceling":case"pausing":this._state=e,void 0!==this._request?this._request.cancel():this.pendingTimeout&&(clearTimeout(this.pendingTimeout),this.pendingTimeout=void 0,this.completeTransitions_());break;case"running":var t="paused"===this._state;this._state=e,t&&(this._notifyObservers(),this._start());break;case"paused":this._state=e,this._notifyObservers();break;case"canceled":this._error=ZC(),this._state=e,this._notifyObservers();break;case"error":case"success":this._state=e,this._notifyObservers()}}completeTransitions_(){switch(this._state){case"pausing":this._transition("paused");break;case"canceling":this._transition("canceled");break;case"running":this._start()}}get snapshot(){var e=zA(this._state);return{bytesTransferred:this._transferred,totalBytes:this._blob.size(),state:e,metadata:this._metadata,task:this,ref:this._ref}}on(e,t,n,r){const i=new GA(t||void 0,n||void 0,r||void 0);return this._addObserver(i),()=>{this._removeObserver(i)}}then(e,t){return this._promise.then(e,t)}catch(e){return this.then(null,e)}_addObserver(e){this._observers.push(e),this._notifyObserver(e)}_removeObserver(e){e=this._observers.indexOf(e);-1!==e&&this._observers.splice(e,1)}_notifyObservers(){this._finishPromise();const e=this._observers.slice();e.forEach(e=>{this._notifyObserver(e)})}_finishPromise(){if(void 0!==this._resolve){let e=!0;switch(zA(this._state)){case WA.SUCCESS:HA(this._resolve.bind(null,this.snapshot))();break;case WA.CANCELED:case WA.ERROR:const t=this._reject;HA(t.bind(null,this._error))();break;default:e=!1}e&&(this._resolve=void 0,this._reject=void 0)}}_notifyObserver(e){switch(zA(this._state)){case WA.RUNNING:case WA.PAUSED:e.next&&HA(e.next.bind(e,this.snapshot))();break;case WA.SUCCESS:e.complete&&HA(e.complete.bind(e))();break;case WA.CANCELED:case WA.ERROR:default:e.error&&HA(e.error.bind(e,this._error))()}}resume(){var e="paused"===this._state||"pausing"===this._state;return e&&this._transition("running"),e}pause(){var e="running"===this._state;return e&&this._transition("pausing"),e}cancel(){var e="running"===this._state||"pausing"===this._state;return e&&this._transition("canceling"),e}}class JA{constructor(e,t){this._service=e,t instanceof aA?this._location=t:this._location=aA.makeFromUrl(t,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,t){return new JA(e,t)}get root(){var e=new aA(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return kA(this._location.path)}get storage(){return this._service}get parent(){var e=function(e){if(0===e.length)return null;var t=e.lastIndexOf("/");return-1===t?"":e.slice(0,t)}(this._location.path);return null===e?null:(e=new aA(this._location.bucket,e),new JA(this._service,e))}_throwIfRoot(e){if(""===this._location.path)throw rA(e)}}function XA(e,t){null!=t&&"number"==typeof t.maxResults&&hA("options.maxResults",1,1e3,t.maxResults);t=function(e,t,n,r){const i={};t.isRoot?i.prefix="":i.prefix=t.path+"/",0<"/".length&&(i.delimiter="/"),n&&(i.pageToken=n),r&&(i.maxResults=r);n=dA(t.bucketOnlyServerUrl(),e.host,e._protocol),r=e.maxOperationRetryTime;const s=new PA(n,"GET",LA(e,t.bucket),r);return s.urlParams=i,s.errorHandler=UA(t),s}(e.storage,e._location,(t=t||{}).pageToken,t.maxResults);return e.storage.makeRequestWithTokens(t,QA)}function ZA(e,t){n=e._location.path,t=t.split("/").filter(e=>0<e.length).join("/");var n,t=0===n.length?t:n+"/"+t,t=new aA(e._location.bucket,t);return new JA(e.storage,t)}function eN(e,t){if(t&&/^[A-Za-z]+:\/\//.test(t)){if(e instanceof nN)return n=e,r=t,new JA(n,r);throw tA("To use ref(service, url), the first argument must be a Storage instance.")}return function e(t,n){if(t instanceof nN){var r=t;if(null==r._bucket)throw new QC("no-default-bucket","No default bucket found. Did you set the '"+$C+"' property when initializing the app?");return r=new JA(r,r._bucket),null!=n?e(r,n):r}return void 0!==n?ZA(t,n):t}(e,t);var n,r}function tN(e,t){t=null==t?void 0:t[$C];return null==t?null:aA.makeFromBucketSpec(t,e)}class nN{constructor(e,t,n,r,i){this.app=e,this._authProvider=t,this._appCheckProvider=n,this._url=r,this._firebaseVersion=i,this._bucket=null,this._host=HC,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=12e4,this._maxUploadRetryTime=6e5,this._requests=new Set,this._bucket=null!=r?aA.makeFromBucketSpec(r,this._host):tN(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,null!=this._url?this._bucket=aA.makeFromBucketSpec(this._url,e):this._bucket=tN(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){hA("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){hA("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const e=this._authProvider.getImmediate({optional:!0});if(e){var t=await e.getToken();if(null!==t)return t.accessToken}return null}async _getAppCheckToken(){const e=this._appCheckProvider.getImmediate({optional:!0});return e?(await e.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(e=>e.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new JA(this,e)}_makeRequest(e,t,n,r,i=!0){if(this._deleted)return new oA(nA());{[s,a,o,e,n,r,t=!0]=[e,this._appId,n,r,t,this._firebaseVersion,i],l=pA(s.urlParams),c=s.url+l,i=l=Object.assign({},s.headers),a&&(i["X-Firebase-GMPID"]=a),a=l,null!==o&&0<o.length&&(a.Authorization="Firebase "+o),l["X-Firebase-Storage-Version"]="webjs/"+(null!=r?r:"AppManager"),r=l,null!==e&&(r["X-Firebase-AppCheck"]=e);const u=new gA(c,s.method,l,s.body,s.successCodes,s.additionalRetryCodes,s.handler,s.errorHandler,s.timeout,s.progressCallback,n,t);return this._requests.add(u),u.getPromise().then(()=>this._requests.delete(u),()=>this._requests.delete(u)),u}var s,a,o,l,c}async makeRequestWithTokens(e,t){var[n,r]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,t,n,r).getPromise()}}var rN="@firebase/storage";function iN(e,t){return eN(e=_(e),t)}gt(new o("storage",function(e,{instanceIdentifier:t}){var n=e.getProvider("app").getImmediate(),r=e.getProvider("auth-internal"),e=e.getProvider("app-check-internal");return new nN(n,r,e,t,_t)},"PUBLIC").setMultipleInstances(!0)),r(rN,"0.9.14",""),r(rN,"0.9.14","esm2017");class sN{constructor(e,t,n){this._delegate=e,this.task=t,this.ref=n}get bytesTransferred(){return this._delegate.bytesTransferred}get metadata(){return this._delegate.metadata}get state(){return this._delegate.state}get totalBytes(){return this._delegate.totalBytes}}class aN{constructor(e,t){this._delegate=e,this._ref=t,this.cancel=this._delegate.cancel.bind(this._delegate),this.catch=this._delegate.catch.bind(this._delegate),this.pause=this._delegate.pause.bind(this._delegate),this.resume=this._delegate.resume.bind(this._delegate)}get snapshot(){return new sN(this._delegate.snapshot,this,this._ref)}then(t,e){return this._delegate.then(e=>{if(t)return t(new sN(e,this,this._ref))},e)}on(e,t,n,r){let i=void 0;return t&&(i="function"==typeof t?e=>t(new sN(e,this,this._ref)):{next:t.next?e=>t.next(new sN(e,this,this._ref)):void 0,complete:t.complete||void 0,error:t.error||void 0}),this._delegate.on(e,i,n||void 0,r||void 0)}}class oN{constructor(e,t){this._delegate=e,this._service=t}get prefixes(){return this._delegate.prefixes.map(e=>new lN(e,this._service))}get items(){return this._delegate.items.map(e=>new lN(e,this._service))}get nextPageToken(){return this._delegate.nextPageToken||null}}class lN{constructor(e,t){this._delegate=e,this.storage=t}get name(){return this._delegate.name}get bucket(){return this._delegate.bucket}get fullPath(){return this._delegate.fullPath}toString(){return this._delegate.toString()}child(e){e=ZA(this._delegate,e);return new lN(e,this.storage)}get root(){return new lN(this._delegate.root,this.storage)}get parent(){var e=this._delegate.parent;return null==e?null:new lN(e,this.storage)}put(e,t){return this._throwIfRoot("put"),new aN((n=this._delegate,e=e,t=t,(n=_(n))._throwIfRoot("uploadBytesResumable"),new YA(n,new TA(e),t)),this);var n}putString(e,t=vA.RAW,n){this._throwIfRoot("putString");t=_A(t,e);const r=Object.assign({},n);return null==r.contentType&&null!=t.contentType&&(r.contentType=t.contentType),new aN(new YA(this._delegate,new TA(t.data,!0),r),this)}listAll(){return function(e){const t={prefixes:[],items:[]};return async function e(t,n,r){r=await XA(t,{pageToken:r});n.prefixes.push(...r.prefixes),n.items.push(...r.items),null!=r.nextPageToken&&await e(t,n,r.nextPageToken)}(e,t).then(()=>t)}(_(this._delegate)).then(e=>new oN(e,this.storage))}list(e){return XA(_(this._delegate),e=e||void 0).then(e=>new oN(e,this.storage))}getMetadata(){return(e=e=_(e=this._delegate))._throwIfRoot("getMetadata"),t=VA(e.storage,e._location,NA()),e.storage.makeRequestWithTokens(t,QA);var e,t}updateMetadata(e){return t=_(this._delegate),e=e,t._throwIfRoot("updateMetadata"),e=function(e,t,n,r){var i=dA(t.fullServerUrl(),e.host,e._protocol),n=xA(n,r),s=e.maxOperationRetryTime;const a=new PA(i,"PATCH",MA(e,r),s);return a.headers={"Content-Type":"application/json; charset=utf-8"},a.body=n,a.errorHandler=qA(t),a}(t.storage,t._location,e,NA()),t.storage.makeRequestWithTokens(e,QA);var t}getDownloadURL(){return(e=_(this._delegate))._throwIfRoot("getDownloadURL"),t=function(e,t,n){var r=dA(t.fullServerUrl(),e.host,e._protocol),i=e.maxOperationRetryTime;const s=new PA(r,"GET",FA(e,n),i);return s.errorHandler=qA(t),s}(e.storage,e._location,NA()),e.storage.makeRequestWithTokens(t,QA).then(e=>{if(null===e)throw new QC("no-download-url","The given file does not have any download URLs.");return e});var e,t}delete(){return this._throwIfRoot("delete"),(e=_(this._delegate))._throwIfRoot("deleteObject"),t=function(e,t){var n=dA(t.fullServerUrl(),e.host,e._protocol),e=e.maxOperationRetryTime;const r=new PA(n,"DELETE",function(e,t){},e);return r.successCodes=[200,204],r.errorHandler=qA(t),r}(e.storage,e._location),e.storage.makeRequestWithTokens(t,QA);var e,t}_throwIfRoot(e){if(""===this._delegate._location.path)throw rA(e)}}class cN{constructor(e,t){this.app=e,this._delegate=t}get maxOperationRetryTime(){return this._delegate.maxOperationRetryTime}get maxUploadRetryTime(){return this._delegate.maxUploadRetryTime}ref(e){if(uN(e))throw tA("ref() expected a child path but got a URL, use refFromURL instead.");return new lN(iN(this._delegate,e),this)}refFromURL(e){if(!uN(e))throw tA("refFromURL() expected a full URL but got a child path, use ref() instead.");try{aA.makeFromUrl(e,this._delegate.host)}catch(e){throw tA("refFromUrl() expected a valid full URL but got an invalid one.")}return new lN(iN(this._delegate,e),this)}setMaxUploadRetryTime(e){this._delegate.maxUploadRetryTime=e}setMaxOperationRetryTime(e){this._delegate.maxOperationRetryTime=e}useEmulator(e,t,n={}){var[e,t,n,r={}]=[this._delegate,e,t,n],[e,t,n,r={}]=[e,t,n,r];e.host=t+":"+n,e._protocol="http",(t=r.mockUserToken)&&(e._overrideAuthToken="string"==typeof t?t:ie(t,e.app.options.projectId))}}function uN(e){return/^[A-Za-z]+:\/\//.test(e)}Gn=qt,vo={TaskState:WA,TaskEvent:{STATE_CHANGED:"state_changed"},StringFormat:vA,Storage:cN,Reference:lN},Gn.INTERNAL.registerComponent(new o("storage-compat",function(e,{instanceIdentifier:t}){var n=e.getProvider("app-compat").getImmediate(),e=e.getProvider("storage").getImmediate({identifier:t});return new cN(n,e)},"PUBLIC").setServiceProps(vo).setMultipleInstances(!0)),Gn.registerVersion("@firebase/storage-compat","0.1.22");const hN="@firebase/performance",dN="0.5.17",pN=dN,fN="FB-PERF-TRACE-MEASURE",gN="@firebase/performance/config",mN="@firebase/performance/configexpire";var vN,yN="Performance";const _N=new ae("performance",yN,{"trace started":"Trace {$traceName} was started before.","trace stopped":"Trace {$traceName} is not running.","nonpositive trace startTime":"Trace {$traceName} startTime should be positive.","nonpositive trace duration":"Trace {$traceName} duration should be positive.","no window":"Window is not available.","no app id":"App id is not available.","no project id":"Project id is not available.","no api key":"Api key is not available.","invalid cc log":"Attempted to queue invalid cc event","FB not default":"Performance can only start when Firebase app instance is the default one.","RC response not ok":"RC response is not ok","invalid attribute name":"Attribute name {$attributeName} is invalid.","invalid attribute value":"Attribute value {$attributeValue} is invalid.","invalid custom metric name":"Custom metric name {$customMetricName} is invalid","invalid String merger input":"Input for String merger is invalid, contact support team to resolve.","already initialized":"initializePerformance() has already been called with different options. To avoid this error, call initializePerformance() with the same options as when it was originally called, or call getPerformance() to return the already initialized instance."}),wN=new Be(yN);wN.logLevel=h.INFO;let bN,IN;class TN{constructor(e){if(!(this.window=e))throw _N.create("no window");this.performance=e.performance,this.PerformanceObserver=e.PerformanceObserver,this.windowLocation=e.location,this.navigator=e.navigator,this.document=e.document,this.navigator&&this.navigator.cookieEnabled&&(this.localStorage=e.localStorage),e.perfMetrics&&e.perfMetrics.onFirstInputDelay&&(this.onFirstInputDelay=e.perfMetrics.onFirstInputDelay)}getUrl(){return this.windowLocation.href.split("?")[0]}mark(e){this.performance&&this.performance.mark&&this.performance.mark(e)}measure(e,t,n){this.performance&&this.performance.measure&&this.performance.measure(e,t,n)}getEntriesByType(e){return this.performance&&this.performance.getEntriesByType?this.performance.getEntriesByType(e):[]}getEntriesByName(e){return this.performance&&this.performance.getEntriesByName?this.performance.getEntriesByName(e):[]}getTimeOrigin(){return this.performance&&(this.performance.timeOrigin||this.performance.timing.navigationStart)}requiredApisAvailable(){return fetch&&Promise&&X()?!!Y()||(wN.info("IndexedDB is not supported by current browswer"),!1):(wN.info("Firebase Performance cannot start if browser does not support fetch and Promise or cookie is disabled."),!1)}setupObserver(e,n){if(this.PerformanceObserver){const t=new this.PerformanceObserver(e=>{for(const t of e.getEntries())n(t)});t.observe({entryTypes:[e]})}}static getInstance(){return bN=void 0===bN?new TN(IN):bN}}let EN;function kN(t,n){var e=t.length-n.length;if(e<0||1<e)throw _N.create("invalid String merger input");const r=[];for(let e=0;e<t.length;e++)r.push(t.charAt(e)),n.length>e&&r.push(n.charAt(e));return r.join("")}let SN;class CN{constructor(){this.instrumentationEnabled=!0,this.dataCollectionEnabled=!0,this.loggingEnabled=!1,this.tracesSamplingRate=1,this.networkRequestsSamplingRate=1,this.logEndPointUrl="https://firebaselogging.googleapis.com/v0cc/log?format=json_proto",this.flTransportEndpointUrl=kN("hts/frbslgigp.ogepscmv/ieo/eaylg","tp:/ieaeogn-agolai.o/1frlglgc/o"),this.transportKey=kN("AzSC8r6ReiGqFMyfvgow","Iayx0u-XT3vksVM-pIV"),this.logSource=462,this.logTraceAfterSampling=!1,this.logNetworkAfterSampling=!1,this.configTimeToLive=12}getFlTransportFullUrl(){return this.flTransportEndpointUrl.concat("?key=",this.transportKey)}static getInstance(){return SN=void 0===SN?new CN:SN}}Vt=vN={UNKNOWN:0,0:"UNKNOWN",VISIBLE:1,1:"VISIBLE",HIDDEN:2,2:"HIDDEN"};const AN=["firebase_","google_","ga_"],NN=new RegExp("^[a-zA-Z]\\w*$");function RN(){switch(TN.getInstance().document.visibilityState){case"visible":return vN.VISIBLE;case"hidden":return vN.HIDDEN;default:return vN.UNKNOWN}}function xN(e){e=null==(e=e.options)?void 0:e.appId;if(e)return e;throw _N.create("no app id")}const DN="0.0.1",PN={loggingEnabled:!0},ON="FIREBASE_INSTALLATIONS_AUTH";function MN(t,e){var r,i,n=function(){const e=TN.getInstance().localStorage;if(e){var t=e.getItem(mN);if(t&&Number(t)>Date.now()&&(t=e.getItem(gN)))try{return JSON.parse(t)}catch(e){return}}}();return n?(FN(n),Promise.resolve()):(i=e,function(){const e=(r=t).installations.getToken();return e.then(e=>{}),e}().then(e=>{var t=function(){var e=null==(e=r.app.options)?void 0:e.projectId;if(e)return e;throw _N.create("no project id")}(),n=function(){var e=null==(e=r.app.options)?void 0:e.apiKey;if(e)return e;throw _N.create("no api key")}(),n=new Request(`https://firebaseremoteconfig.googleapis.com/v1/projects/${t}/namespaces/fireperf:fetch?key=`+n,{method:"POST",headers:{Authorization:ON+" "+e},body:JSON.stringify({app_instance_id:i,app_instance_id_token:e,app_id:xN(r.app),app_version:pN,sdk_version:DN})});return fetch(n).then(e=>{if(e.ok)return e.json();throw _N.create("RC response not ok")})}).catch(()=>{wN.info(LN)}).then(FN).then(e=>{{const t=TN.getInstance().localStorage;return void(e&&t&&(t.setItem(gN,JSON.stringify(e)),t.setItem(mN,String(Date.now()+60*CN.getInstance().configTimeToLive*60*1e3))))}},()=>{}))}const LN="Could not fetch config, will use default configs";function FN(e){if(!e)return e;const t=CN.getInstance();var n=e.entries||{};return void 0!==n.fpr_enabled?t.loggingEnabled="true"===String(n.fpr_enabled):t.loggingEnabled=PN.loggingEnabled,n.fpr_log_source?t.logSource=Number(n.fpr_log_source):PN.logSource&&(t.logSource=PN.logSource),n.fpr_log_endpoint_url?t.logEndPointUrl=n.fpr_log_endpoint_url:PN.logEndPointUrl&&(t.logEndPointUrl=PN.logEndPointUrl),n.fpr_log_transport_key?t.transportKey=n.fpr_log_transport_key:PN.transportKey&&(t.transportKey=PN.transportKey),void 0!==n.fpr_vc_network_request_sampling_rate?t.networkRequestsSamplingRate=Number(n.fpr_vc_network_request_sampling_rate):void 0!==PN.networkRequestsSamplingRate&&(t.networkRequestsSamplingRate=PN.networkRequestsSamplingRate),void 0!==n.fpr_vc_trace_sampling_rate?t.tracesSamplingRate=Number(n.fpr_vc_trace_sampling_rate):void 0!==PN.tracesSamplingRate&&(t.tracesSamplingRate=PN.tracesSamplingRate),t.logTraceAfterSampling=UN(t.tracesSamplingRate),t.logNetworkAfterSampling=UN(t.networkRequestsSamplingRate),e}function UN(e){return Math.random()<=e}let qN=1,VN;function BN(e){var t;return qN=2,VN=VN||(t=e,function(){const n=TN.getInstance().document;return new Promise(e=>{if(n&&"complete"!==n.readyState){const t=()=>{"complete"===n.readyState&&(n.removeEventListener("readystatechange",t),e())};n.addEventListener("readystatechange",t)}else e()})}().then(()=>{{const e=t.installations.getId();return e.then(e=>{EN=e}),e}}).then(e=>MN(t,e)).then(()=>jN(),()=>jN()))}function jN(){qN=3}let KN=3,WN=[],zN=!1;function GN(e){setTimeout(()=>{if(0!==KN)if(WN.length){const n=WN.splice(0,1e3),i=n.map(e=>({source_extension_json_proto3:e.message,event_time_ms:String(e.eventTime)})),s={request_time_ms:String(Date.now()),client_info:{client_type:1,js_client_info:{}},log_source:CN.getInstance().logSource,log_event:i};var e,r,t;e=s,r=n,e=s,t=CN.getInstance().getFlTransportFullUrl(),fetch(t,{method:"POST",body:JSON.stringify(e)}).then(e=>(e.ok||wN.info("Call to Firebase backend failed."),e.json())).then(e=>{var t=Number(e.nextRequestWaitMillis);let n=1e4;isNaN(t)||(n=Math.max(t,n)),t=e.logResponseDetails,Array.isArray(t)&&0<t.length&&"RETRY_REQUEST_LATER"===t[0].responseAction&&(WN=[...r,...WN],wN.info("Retry transport request later.")),KN=3,GN(n)}).catch(()=>{WN=[...n,...WN],KN--,wN.info(`Tries left: ${KN}.`),GN(1e4)});return}else return GN(1e4)},e)}let HN;function $N(e,t){var n;(HN=HN||(n=JN,(...e)=>{e={message:n(...e),eventTime:Date.now()};if(!e.eventTime||!e.message)throw _N.create("invalid cc log");WN=[...WN,e]}))(e,t)}function QN(e){var t=CN.getInstance();!t.instrumentationEnabled&&e.isAuto||!t.dataCollectionEnabled&&!e.isAuto||!TN.getInstance().requiredApisAvailable()||e.isAuto&&RN()!==vN.VISIBLE||(3===qN?YN(e):BN(e.performanceController).then(()=>YN(e),()=>YN(e)))}function YN(e){var t;EN&&(t=CN.getInstance()).loggingEnabled&&t.logTraceAfterSampling&&setTimeout(()=>$N(e,1),0)}function JN(e,t){if(0===t)return t={url:e.url,http_method:e.httpMethod||0,http_response_code:200,response_payload_bytes:e.responsePayloadBytes,client_start_time_us:e.startTimeUs,time_to_response_initiated_us:e.timeToResponseInitiatedUs,time_to_response_completed_us:e.timeToResponseCompletedUs},t={application_info:XN(e.performanceController.app),network_request_metric:t},JSON.stringify(t);{t=e;const n={name:t.name,is_auto:t.isAuto,client_start_time_us:t.startTimeUs,duration_us:t.durationUs};0!==Object.keys(t.counters).length&&(n.counters=t.counters);e=t.getAttributes();return 0!==Object.keys(e).length&&(n.custom_attributes=e),e={application_info:XN(t.performanceController.app),trace_metric:n},JSON.stringify(e)}}function XN(e){return{google_app_id:xN(e),app_instance_id:EN,web_app_info:{sdk_version:pN,page_url:TN.getInstance().getUrl(),service_worker_status:null!=(e=TN.getInstance().navigator)&&e.serviceWorker?e.serviceWorker.controller?2:3:1,visibility_state:RN(),effective_connection_type:function(){var e=TN.getInstance().navigator.connection;switch(e&&e.effectiveType){case"slow-2g":return 1;case"2g":return 2;case"3g":return 3;case"4g":return 4;default:return 0}}()},application_process_state:0}}const ZN=["_fp","_fcp","_fid"];class eR{constructor(e,t,n=!1,r){this.performanceController=e,this.name=t,this.isAuto=n,this.state=1,this.customAttributes={},this.counters={},this.api=TN.getInstance(),this.randomId=Math.floor(1e6*Math.random()),this.isAuto||(this.traceStartMark=`FB-PERF-TRACE-START-${this.randomId}-`+this.name,this.traceStopMark=`FB-PERF-TRACE-STOP-${this.randomId}-`+this.name,this.traceMeasure=r||`${fN}-${this.randomId}-`+this.name,r&&this.calculateTraceMetrics())}start(){if(1!==this.state)throw _N.create("trace started",{traceName:this.name});this.api.mark(this.traceStartMark),this.state=2}stop(){if(2!==this.state)throw _N.create("trace stopped",{traceName:this.name});this.state=3,this.api.mark(this.traceStopMark),this.api.measure(this.traceMeasure,this.traceStartMark,this.traceStopMark),this.calculateTraceMetrics(),QN(this)}record(e,t,n){if(e<=0)throw _N.create("nonpositive trace startTime",{traceName:this.name});if(t<=0)throw _N.create("nonpositive trace duration",{traceName:this.name});if(this.durationUs=Math.floor(1e3*t),this.startTimeUs=Math.floor(1e3*e),n&&n.attributes&&(this.customAttributes=Object.assign({},n.attributes)),n&&n.metrics)for(const r of Object.keys(n.metrics))isNaN(Number(n.metrics[r]))||(this.counters[r]=Math.floor(Number(n.metrics[r])));QN(this)}incrementMetric(e,t=1){void 0===this.counters[e]?this.putMetric(e,t):this.putMetric(e,this.counters[e]+t)}putMetric(e,t){if(r=this.name,0===(n=e).length||100<n.length||!(r&&r.startsWith("_wt_")&&-1<ZN.indexOf(n))&&n.startsWith("_"))throw _N.create("invalid custom metric name",{customMetricName:e});var n,r;this.counters[e]=(t=null!=t?t:0,(r=Math.floor(t))<t&&wN.info(`Metric value should be an Integer, setting the value as : ${r}.`),r)}getMetric(e){return this.counters[e]||0}putAttribute(e,t){var n,r=!(0===(n=e).length||40<n.length||AN.some(e=>n.startsWith(e))||!n.match(NN)),i=0!==t.length&&t.length<=100;if(r&&i)this.customAttributes[e]=t;else{if(!r)throw _N.create("invalid attribute name",{attributeName:e});if(!i)throw _N.create("invalid attribute value",{attributeValue:t})}}getAttribute(e){return this.customAttributes[e]}removeAttribute(e){void 0!==this.customAttributes[e]&&delete this.customAttributes[e]}getAttributes(){return Object.assign({},this.customAttributes)}setStartTime(e){this.startTimeUs=e}setDuration(e){this.durationUs=e}calculateTraceMetrics(){var e=this.api.getEntriesByName(this.traceMeasure);(e=e&&e[0])&&(this.durationUs=Math.floor(1e3*e.duration),this.startTimeUs=Math.floor(1e3*(e.startTime+this.api.getTimeOrigin())))}static createOobTrace(e,t,n,r){var i=TN.getInstance().getUrl();if(i){const s=new eR(e,"_wt_"+i,!0);i=Math.floor(1e3*TN.getInstance().getTimeOrigin()),s.setStartTime(i),t&&t[0]&&(s.setDuration(Math.floor(1e3*t[0].duration)),s.putMetric("domInteractive",Math.floor(1e3*t[0].domInteractive)),s.putMetric("domContentLoadedEventEnd",Math.floor(1e3*t[0].domContentLoadedEventEnd)),s.putMetric("loadEventEnd",Math.floor(1e3*t[0].loadEventEnd))),n&&((i=n.find(e=>"first-paint"===e.name))&&i.startTime&&s.putMetric("_fp",Math.floor(1e3*i.startTime)),(i=n.find(e=>"first-contentful-paint"===e.name))&&i.startTime&&s.putMetric("_fcp",Math.floor(1e3*i.startTime)),r&&s.putMetric("_fid",Math.floor(1e3*r))),QN(s)}}static createUserTimingTrace(e,t){QN(new eR(e,t,!1,t))}}function tR(e,t){const n=t;var r,i;if(n&&void 0!==n.responseStart){t=TN.getInstance().getTimeOrigin(),r=Math.floor(1e3*(n.startTime+t)),i=n.responseStart?Math.floor(1e3*(n.responseStart-n.startTime)):void 0,t=Math.floor(1e3*(n.responseEnd-n.startTime));{var s={performanceController:e,url:n.name&&n.name.split("?")[0],responsePayloadBytes:n.transferSize,startTimeUs:r,timeToResponseInitiatedUs:i,timeToResponseCompletedUs:t};const a=CN.getInstance();a.instrumentationEnabled&&(e=s.url,r=a.logEndPointUrl.split("?")[0],i=a.flTransportEndpointUrl.split("?")[0],e!==r&&e!==i&&a.loggingEnabled&&a.logNetworkAfterSampling&&setTimeout(()=>$N(s,0),0))}}}function nR(s){EN&&(setTimeout(()=>{{var n=s;const e=TN.getInstance(),r=e.getEntriesByType("navigation"),i=e.getEntriesByType("paint");if(e.onFirstInputDelay){let t=setTimeout(()=>{eR.createOobTrace(n,r,i),t=void 0},5e3);e.onFirstInputDelay(e=>{t&&(clearTimeout(t),eR.createOobTrace(n,r,i,e))})}else eR.createOobTrace(n,r,i);return}},0),setTimeout(()=>{{var t=s;const e=TN.getInstance(),n=e.getEntriesByType("resource");for(const r of n)tR(t,r);return void e.setupObserver("resource",e=>tR(t,e))}},0),setTimeout(()=>{{var t=s;const e=TN.getInstance(),n=e.getEntriesByType("measure");for(const r of n)rR(t,r);return void e.setupObserver("measure",e=>rR(t,e))}},0))}function rR(e,t){const n=t.name;n.substring(0,fN.length)!==fN&&eR.createUserTimingTrace(e,n)}class iR{constructor(e,t){this.app=e,this.installations=t,this.initialized=!1}_init(e){this.initialized||(void 0!==(null==e?void 0:e.dataCollectionEnabled)&&(this.dataCollectionEnabled=e.dataCollectionEnabled),void 0!==(null==e?void 0:e.instrumentationEnabled)&&(this.instrumentationEnabled=e.instrumentationEnabled),TN.getInstance().requiredApisAvailable()?J().then(e=>{e&&(zN||(GN(5500),zN=!0),BN(this).then(()=>nR(this),()=>nR(this)),this.initialized=!0)}).catch(e=>{wN.info("Environment doesn't support IndexedDB: "+e)}):wN.info('Firebase Performance cannot start if the browser does not support "Fetch" and "Promise", or cookies are disabled.'))}set instrumentationEnabled(e){CN.getInstance().instrumentationEnabled=e}get instrumentationEnabled(){return CN.getInstance().instrumentationEnabled}set dataCollectionEnabled(e){CN.getInstance().dataCollectionEnabled=e}get dataCollectionEnabled(){return CN.getInstance().dataCollectionEnabled}}gt(new o("performance",(e,{options:t})=>{var n=e.getProvider("app").getImmediate(),r=e.getProvider("installations-internal").getImmediate();if("[DEFAULT]"!==n.name)throw _N.create("FB not default");if("undefined"==typeof window)throw _N.create("no window");e=window,IN=e;const i=new iR(n,r);return i._init(t),i},"PUBLIC")),r(hN,dN),r(hN,dN,"esm2017");class sR{constructor(e,t){this.app=e,this._delegate=t}get instrumentationEnabled(){return this._delegate.instrumentationEnabled}set instrumentationEnabled(e){this._delegate.instrumentationEnabled=e}get dataCollectionEnabled(){return this._delegate.dataCollectionEnabled}set dataCollectionEnabled(e){this._delegate.dataCollectionEnabled=e}trace(e){return t=_(this._delegate),new eR(t,e);var t}}(Wp=qt).INTERNAL.registerComponent(new o("performance-compat",function(e){var t=e.getProvider("app-compat").getImmediate(),e=e.getProvider("performance").getImmediate();return new sR(t,e)},"PUBLIC")),Wp.registerVersion("@firebase/performance-compat","0.1.17");const aR="@firebase/remote-config";class oR{constructor(){this.listeners=[]}addEventListener(e){this.listeners.push(e)}abort(){this.listeners.forEach(e=>e())}}const lR=new ae("remoteconfig","Remote Config",{"registration-window":"Undefined window object. This SDK only supports usage in a browser environment.","registration-project-id":"Undefined project identifier. Check Firebase app initialization.","registration-api-key":"Undefined API key. Check Firebase app initialization.","registration-app-id":"Undefined app identifier. Check Firebase app initialization.","storage-open":"Error thrown when opening storage. Original error: {$originalErrorMessage}.","storage-get":"Error thrown when reading from storage. Original error: {$originalErrorMessage}.","storage-set":"Error thrown when writing to storage. Original error: {$originalErrorMessage}.","storage-delete":"Error thrown when deleting from storage. Original error: {$originalErrorMessage}.","fetch-client-network":"Fetch client failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.","fetch-timeout":'The config fetch request timed out.  Configure timeout using "fetchTimeoutMillis" SDK setting.',"fetch-throttle":'The config fetch request timed out while in an exponential backoff state. Configure timeout using "fetchTimeoutMillis" SDK setting. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.',"fetch-client-parse":"Fetch client could not parse response. Original error: {$originalErrorMessage}.","fetch-status":"Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.","indexed-db-unavailable":"Indexed DB is not supported by current browser"}),cR=["1","true","t","yes","y","on"];class uR{constructor(e,t=""){this._source=e,this._value=t}asString(){return this._value}asBoolean(){return"static"!==this._source&&0<=cR.indexOf(this._value.toLowerCase())}asNumber(){if("static"===this._source)return 0;let e=Number(this._value);return e=isNaN(e)?0:e}getSource(){return this._source}}async function hR(e){const t=_(e);var[e,n]=await Promise.all([t._storage.getLastSuccessfulFetchResponse(),t._storage.getActiveConfigEtag()]);return!!(e&&e.config&&e.eTag&&e.eTag!==n)&&(await Promise.all([t._storageCache.setActiveConfig(e.config),t._storage.setActiveConfigEtag(e.eTag)]),!0)}function dR(e){const t=_(e);return t._initializePromise||(t._initializePromise=t._storageCache.loadFromStorage().then(()=>{t._isInitializationComplete=!0})),t._initializePromise}async function pR(e){const t=_(e),n=new oR;setTimeout(async()=>{n.abort()},t.settings.fetchTimeoutMillis);try{await t._client.fetch({cacheMaxAgeMillis:t.settings.minimumFetchIntervalMillis,signal:n}),await t._storageCache.setLastFetchStatus("success")}catch(n){e=(e=n)instanceof se&&-1!==e.code.indexOf("fetch-throttle")?"throttle":"failure";throw await t._storageCache.setLastFetchStatus(e),n}}function fR(e,t){const n=_(e);n._isInitializationComplete||n._logger.debug(`A value was requested for key "${t}" before SDK initialization completed.`+" Await on ensureInitialized if the intent was to get a previously activated value.");e=n._storageCache.getActiveConfig();return e&&void 0!==e[t]?new uR("remote",e[t]):n.defaultConfig&&void 0!==n.defaultConfig[t]?new uR("default",String(n.defaultConfig[t])):(n._logger.debug(`Returning static value for key "${t}".`+" Define a default or remote value if this is unintentional."),new uR("static"))}class gR{constructor(e,t,n,r){this.client=e,this.storage=t,this.storageCache=n,this.logger=r}isCachedDataFresh(e,t){if(!t)return this.logger.debug("Config fetch cache check. Cache unpopulated."),!1;var t=Date.now()-t,n=t<=e;return this.logger.debug("Config fetch cache check."+` Cache age millis: ${t}.`+` Cache max age millis (minimumFetchIntervalMillis setting): ${e}.`+` Is cache hit: ${n}.`),n}async fetch(e){var[t,n]=await Promise.all([this.storage.getLastSuccessfulFetchTimestampMillis(),this.storage.getLastSuccessfulFetchResponse()]);if(n&&this.isCachedDataFresh(e.cacheMaxAgeMillis,t))return n;e.eTag=n&&n.eTag,n=await this.client.fetch(e);const r=[this.storageCache.setLastSuccessfulFetchTimestampMillis(Date.now())];return 200===n.status&&r.push(this.storage.setLastSuccessfulFetchResponse(n)),await Promise.all(r),n}}class mR{constructor(e,t,n,r,i,s){this.firebaseInstallations=e,this.sdkVersion=t,this.namespace=n,this.projectId=r,this.apiKey=i,this.appId=s}async fetch(n){var t,[e,r]=await Promise.all([this.firebaseInstallations.getId(),this.firebaseInstallations.getToken()]),i=`${window.FIREBASE_REMOTE_CONFIG_URL_BASE||"https://firebaseremoteconfig.googleapis.com"}/v1/projects/${this.projectId}/namespaces/${this.namespace}:fetch?key=`+this.apiKey,s={"Content-Type":"application/json","Content-Encoding":"gzip","If-None-Match":n.eTag||"*"},r={sdk_version:this.sdkVersion,app_instance_id:e,app_instance_id_token:r,app_id:this.appId,language_code:(t=navigator).languages&&t.languages[0]||t.language},r={method:"POST",headers:s,body:JSON.stringify(r)},i=fetch(i,r),r=new Promise((e,t)=>{n.signal.addEventListener(()=>{const e=new Error("The operation was aborted.");e.name="AbortError",t(e)})});let a;try{await Promise.race([i,r]),a=await i}catch(t){let e="fetch-client-network";throw"AbortError"===(null==t?void 0:t.name)&&(e="fetch-timeout"),lR.create(e,{originalErrorMessage:null==t?void 0:t.message})}let o=a.status;i=a.headers.get("ETag")||void 0;let l,c;if(200===a.status){let e;try{e=await a.json()}catch(t){throw lR.create("fetch-client-parse",{originalErrorMessage:null==t?void 0:t.message})}l=e.entries,c=e.state}if("INSTANCE_STATE_UNSPECIFIED"===c?o=500:"NO_CHANGE"===c?o=304:"NO_TEMPLATE"!==c&&"EMPTY_CONFIG"!==c||(l={}),304!==o&&200!==o)throw lR.create("fetch-status",{httpStatus:o});return{status:o,eTag:i,config:l}}}class vR{constructor(e,t){this.client=e,this.storage=t}async fetch(e){var t=await this.storage.getThrottleMetadata()||{backoffCount:0,throttleEndTimeMillis:Date.now()};return this.attemptFetch(e,t)}async attemptFetch(e,{throttleEndTimeMillis:t,backoffCount:n}){var i=e.signal,s=t;await new Promise((e,t)=>{var n=Math.max(s-Date.now(),0);const r=setTimeout(e,n);i.addEventListener(()=>{clearTimeout(r),t(lR.create("fetch-throttle",{throttleEndTimeMillis:s}))})});try{var r=await this.client.fetch(e);return await this.storage.deleteThrottleMetadata(),r}catch(t){if(function(e){if(e instanceof se&&e.customData)return 429===(e=Number(e.customData.httpStatus))||500===e||503===e||504===e}(t))return r={throttleEndTimeMillis:Date.now()+De(n),backoffCount:n+1},await this.storage.setThrottleMetadata(r),this.attemptFetch(e,r);throw t}}}class yR{constructor(e,t,n,r,i){this.app=e,this._client=t,this._storageCache=n,this._storage=r,this._logger=i,this._isInitializationComplete=!1,this.settings={fetchTimeoutMillis:6e4,minimumFetchIntervalMillis:432e5},this.defaultConfig={}}get fetchTimeMillis(){return this._storageCache.getLastSuccessfulFetchTimestampMillis()||-1}get lastFetchStatus(){return this._storageCache.getLastFetchStatus()||"no-fetch-yet"}}function _R(e,t){e=e.target.error||void 0;return lR.create(t,{originalErrorMessage:e&&(null==e?void 0:e.message)})}const wR="app_namespace_store";class bR{constructor(e,t,n,r=function(){return new Promise((t,n)=>{try{const e=indexedDB.open("firebase_remote_config",1);e.onerror=e=>{n(_R(e,"storage-open"))},e.onsuccess=e=>{t(e.target.result)},e.onupgradeneeded=e=>{const t=e.target.result;0===e.oldVersion&&t.createObjectStore(wR,{keyPath:"compositeKey"})}}catch(e){n(lR.create("storage-open",{originalErrorMessage:null==e?void 0:e.message}))}})}()){this.appId=e,this.appName=t,this.namespace=n,this.openDbPromise=r}getLastFetchStatus(){return this.get("last_fetch_status")}setLastFetchStatus(e){return this.set("last_fetch_status",e)}getLastSuccessfulFetchTimestampMillis(){return this.get("last_successful_fetch_timestamp_millis")}setLastSuccessfulFetchTimestampMillis(e){return this.set("last_successful_fetch_timestamp_millis",e)}getLastSuccessfulFetchResponse(){return this.get("last_successful_fetch_response")}setLastSuccessfulFetchResponse(e){return this.set("last_successful_fetch_response",e)}getActiveConfig(){return this.get("active_config")}setActiveConfig(e){return this.set("active_config",e)}getActiveConfigEtag(){return this.get("active_config_etag")}setActiveConfigEtag(e){return this.set("active_config_etag",e)}getThrottleMetadata(){return this.get("throttle_metadata")}setThrottleMetadata(e){return this.set("throttle_metadata",e)}deleteThrottleMetadata(){return this.delete("throttle_metadata")}async get(a){const o=await this.openDbPromise;return new Promise((t,n)=>{const e=o.transaction([wR],"readonly"),r=e.objectStore(wR);var i=this.createCompositeKey(a);try{const s=r.get(i);s.onerror=e=>{n(_R(e,"storage-get"))},s.onsuccess=e=>{e=e.target.result;t(e?e.value:void 0)}}catch(e){n(lR.create("storage-get",{originalErrorMessage:null==e?void 0:e.message}))}})}async set(a,o){const l=await this.openDbPromise;return new Promise((e,t)=>{const n=l.transaction([wR],"readwrite"),r=n.objectStore(wR);var i=this.createCompositeKey(a);try{const s=r.put({compositeKey:i,value:o});s.onerror=e=>{t(_R(e,"storage-set"))},s.onsuccess=()=>{e()}}catch(e){t(lR.create("storage-set",{originalErrorMessage:null==e?void 0:e.message}))}})}async delete(a){const o=await this.openDbPromise;return new Promise((e,t)=>{const n=o.transaction([wR],"readwrite"),r=n.objectStore(wR);var i=this.createCompositeKey(a);try{const s=r.delete(i);s.onerror=e=>{t(_R(e,"storage-delete"))},s.onsuccess=()=>{e()}}catch(e){t(lR.create("storage-delete",{originalErrorMessage:null==e?void 0:e.message}))}})}createCompositeKey(e){return[this.appId,this.appName,this.namespace,e].join()}}class IR{constructor(e){this.storage=e}getLastFetchStatus(){return this.lastFetchStatus}getLastSuccessfulFetchTimestampMillis(){return this.lastSuccessfulFetchTimestampMillis}getActiveConfig(){return this.activeConfig}async loadFromStorage(){var e=this.storage.getLastFetchStatus(),t=this.storage.getLastSuccessfulFetchTimestampMillis(),n=this.storage.getActiveConfig();(e=await e)&&(this.lastFetchStatus=e),(t=await t)&&(this.lastSuccessfulFetchTimestampMillis=t),(n=await n)&&(this.activeConfig=n)}setLastFetchStatus(e){return this.lastFetchStatus=e,this.storage.setLastFetchStatus(e)}setLastSuccessfulFetchTimestampMillis(e){return this.lastSuccessfulFetchTimestampMillis=e,this.storage.setLastSuccessfulFetchTimestampMillis(e)}setActiveConfig(e){return this.activeConfig=e,this.storage.setActiveConfig(e)}}gt(new o("remote-config",function(e,{instanceIdentifier:t}){var n=e.getProvider("app").getImmediate(),e=e.getProvider("installations-internal").getImmediate();if("undefined"==typeof window)throw lR.create("registration-window");if(!Y())throw lR.create("indexed-db-unavailable");var{projectId:r,apiKey:i,appId:s}=n.options;if(!r)throw lR.create("registration-project-id");if(!i)throw lR.create("registration-api-key");if(!s)throw lR.create("registration-app-id");t=t||"firebase";const a=new bR(s,n.name,t),o=new IR(a),l=new Be(aR);return l.logLevel=h.ERROR,s=new mR(e,_t,t,r,i,s),s=new vR(s,a),s=new gR(s,a,o,l),dR(s=new yR(n,s,o,a,l)),s},"PUBLIC").setMultipleInstances(!0)),r(aR,"0.3.15"),r(aR,"0.3.15","esm2017");class TR{constructor(e,t){this.app=e,this._delegate=t}get defaultConfig(){return this._delegate.defaultConfig}set defaultConfig(e){this._delegate.defaultConfig=e}get fetchTimeMillis(){return this._delegate.fetchTimeMillis}get lastFetchStatus(){return this._delegate.lastFetchStatus}get settings(){return this._delegate.settings}set settings(e){this._delegate.settings=e}activate(){return hR(this._delegate)}ensureInitialized(){return dR(this._delegate)}fetch(){return pR(this._delegate)}fetchAndActivate(){return async function(e){return await pR(e=_(e)),hR(e)}(this._delegate)}getAll(){{var n=this._delegate,e,t;const r=_(n);return[e={},t={}]=[r._storageCache.getActiveConfig(),r.defaultConfig],Object.keys(Object.assign(Object.assign({},e),t)).reduce((e,t)=>(e[t]=fR(n,t),e),{})}}getBoolean(e){return fR(_(this._delegate),e).asBoolean()}getNumber(e){return fR(_(this._delegate),e).asNumber()}getString(e){return fR(_(this._delegate),e).asString()}getValue(e){return fR(this._delegate,e)}setLogLevel(e){{var t;const n=_(this._delegate);switch(e){case"debug":n._logger.logLevel=h.DEBUG;break;case"silent":n._logger.logLevel=h.SILENT;break;default:n._logger.logLevel=h.ERROR}return}}}return(yf=qt).INTERNAL.registerComponent(new o("remoteConfig-compat",function(e,{instanceIdentifier:t}){var n=e.getProvider("app-compat").getImmediate(),e=e.getProvider("remote-config").getImmediate({identifier:t});return new TR(n,e)},"PUBLIC").setMultipleInstances(!0).setServiceProps({isSupported:async function(){if(!Y())return!1;try{return await J()}catch(e){return!1}}})),yf.registerVersion("@firebase/remote-config-compat","0.1.16"),console.warn("\nIt looks like you're using the development build of the Firebase JS SDK.\nWhen deploying Firebase apps to production, it is advisable to only import\nthe individual SDK components you intend to use.\n\nFor the CDN builds, these are available in the following manner\n(replace <PACKAGE> with the name of a component - i.e. auth, database, etc):\n\nhttps://www.gstatic.com/firebasejs/5.0.0/firebase-<PACKAGE>.js\n"),qt.registerVersion("firebase","9.14.0","compat-cdn"),qt});